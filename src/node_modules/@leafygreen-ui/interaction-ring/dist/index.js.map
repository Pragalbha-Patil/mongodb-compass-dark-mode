{"version":3,"file":"index.js","sources":["../src/InteractionRing.tsx"],"sourcesContent":["import React, { useEffect, useCallback, useMemo, useState } from 'react';\nimport { css, cx } from '@leafygreen-ui/emotion';\nimport { useUsingKeyboardContext } from '@leafygreen-ui/leafygreen-provider';\nimport { createDataProp } from '@leafygreen-ui/lib';\nimport { uiColors } from '@leafygreen-ui/palette';\n\nconst Mode = {\n  Light: 'light',\n  Dark: 'dark',\n} as const;\n\ntype Mode = typeof Mode[keyof typeof Mode];\n\ninterface ColorSet {\n  interactionRingHover: string;\n  interactionRingFocus: string;\n}\n\nconst colorSets: Record<Mode, ColorSet> = {\n  [Mode.Light]: {\n    interactionRingHover: uiColors.gray.light2,\n    interactionRingFocus: uiColors.focus,\n  },\n  [Mode.Dark]: {\n    interactionRingHover: uiColors.gray.dark1,\n    interactionRingFocus: uiColors.focus,\n  },\n};\n\nconst baseContainerStyle = css`\n  display: inline-flex;\n  align-items: stretch;\n  position: relative;\n  z-index: 0;\n`;\n\nconst baseInteractionRingStyle = css`\n  transition: all 150ms ease-in-out;\n  position: absolute;\n  z-index: -1;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  pointer-events: none;\n`;\n\nconst interactionRingDataProp = createDataProp('interaction-ring');\n\nfunction computeStyles({\n  mode,\n  hovered,\n  focused,\n  borderRadius = '4px',\n  color,\n}: {\n  mode: Mode;\n  hovered: boolean | undefined;\n  focused: boolean | undefined;\n  borderRadius?: string;\n  color?: {\n    focused?: string;\n    hovered?: string;\n  };\n}) {\n  const hoverStyle = css`\n    box-shadow: 0 0 0 3px\n      ${color?.hovered ?? colorSets[mode].interactionRingHover};\n  `;\n\n  const focusStyle = css`\n    box-shadow: 0 0 0 3px\n      ${color?.focused ?? colorSets[mode].interactionRingFocus};\n  `;\n\n  return {\n    container: cx(baseContainerStyle, {\n      [css`\n        &:hover > ${interactionRingDataProp.selector} {\n          ${hoverStyle}\n        }\n      `]: hovered !== false && !focused,\n    }),\n    interactionRing: cx(\n      baseInteractionRingStyle,\n      css`\n        border-radius: ${borderRadius};\n      `,\n      {\n        [hoverStyle]: hovered ?? false,\n      },\n      {\n        [focusStyle]: focused,\n      },\n    ),\n  };\n}\n\ninterface State {\n  hovered?: boolean;\n  focused?: boolean;\n}\n\ninterface InteractionRingProps {\n  darkMode?: boolean;\n  className?: string;\n  borderRadius?: string;\n  color?: {\n    focused?: string;\n    hovered?: string;\n  };\n  focusTargetElement?: HTMLElement | null;\n  children: React.ReactElement;\n  disabled?: boolean;\n  forceState?: State;\n  ignoreKeyboardContext?: boolean;\n}\n\nexport default function InteractionRing({\n  darkMode = false,\n  className,\n  borderRadius,\n  color,\n  focusTargetElement,\n  children,\n  disabled = false,\n  forceState = {},\n  ignoreKeyboardContext = false,\n  ...rest\n}: InteractionRingProps) {\n  const mode = darkMode ? Mode.Dark : Mode.Light;\n  const { usingKeyboard } = useUsingKeyboardContext();\n  const showFocus = ignoreKeyboardContext || usingKeyboard;\n\n  const [focused, setFocused] = useState<boolean>();\n\n  const styles = computeStyles({\n    mode,\n    hovered: forceState.hovered,\n    focused: showFocus && (forceState.focused ?? focused),\n    borderRadius,\n    color,\n  });\n\n  useEffect(() => {\n    if (focusTargetElement === undefined || focusTargetElement === null) {\n      return;\n    }\n\n    const focused = focusTargetElement === document.activeElement;\n    setFocused(focused);\n\n    if (focused) {\n      const offFocus = () => setFocused(false);\n      focusTargetElement.addEventListener('blur', offFocus);\n      return () => focusTargetElement.removeEventListener('blur', offFocus);\n    } else {\n      const onFocus = () => setFocused(true);\n      focusTargetElement.addEventListener('focus', onFocus);\n      return () => focusTargetElement.removeEventListener('focus', onFocus);\n    }\n  }, [focusTargetElement, focused]);\n\n  const { className: contentClassName } = children.props;\n\n  const childIsFocusTarget = focusTargetElement === undefined;\n\n  const onFocusProp = children.props.onFocus;\n  const onFocus = useCallback(\n    (event: React.FocusEvent) => {\n      if (childIsFocusTarget) {\n        setFocused(true);\n      }\n      onFocusProp?.(event);\n    },\n    [childIsFocusTarget, onFocusProp],\n  );\n\n  const onBlurProp = children.props.onBlur;\n  const onBlur = useCallback(\n    (event: React.FocusEvent) => {\n      if (childIsFocusTarget) {\n        setFocused(false);\n      }\n      onBlurProp?.(event);\n    },\n    [childIsFocusTarget, onBlurProp],\n  );\n\n  const content = useMemo(\n    () =>\n      React.cloneElement(children, {\n        className: contentClassName,\n        onFocus,\n        onBlur,\n      }),\n    [children, contentClassName, onBlur, onFocus],\n  );\n\n  return (\n    <div className={cx(styles.container, className)} {...rest}>\n      {content}\n      {!disabled && (\n        <div\n          {...interactionRingDataProp.prop}\n          className={styles.interactionRing}\n        />\n      )}\n    </div>\n  );\n}\n\nInteractionRing.displayName = 'InteractionRing';\n"],"names":["_colorSets","_templateObject","_templateObject2","_templateObject3","_templateObject4","_templateObject5","_templateObject6","_excluded","Mode","colorSets","_defineProperty","interactionRingHover","uiColors","gray","light2","interactionRingFocus","focus","dark1","baseContainerStyle","css","_taggedTemplateLiteral","baseInteractionRingStyle","interactionRingDataProp","createDataProp","InteractionRing","_ref2","_forceState$focused","_ref2$darkMode","darkMode","className","borderRadius","color","focusTargetElement","children","_ref2$disabled","disabled","_ref2$forceState","forceState","_ref2$ignoreKeyboardC","ignoreKeyboardContext","rest","_objectWithoutProperties","mode","usingKeyboard","useUsingKeyboardContext","showFocus","_useState2","_slicedToArray","useState","focused","setFocused","styles","_ref","_color$hovered","_color$focused","hovered","_ref$borderRadius","hoverStyle","focusStyle","container","cx","selector","interactionRing","computeStyles","useEffect","document","activeElement","offFocus","addEventListener","removeEventListener","_onFocus","contentClassName","props","childIsFocusTarget","undefined","onFocusProp","onFocus","useCallback","event","onBlurProp","onBlur","content","useMemo","React","cloneElement","___EmotionJSX","_extends","prop","displayName"],"mappings":"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"}