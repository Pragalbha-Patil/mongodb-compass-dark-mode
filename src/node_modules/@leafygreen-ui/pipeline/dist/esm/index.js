import e,{useRef as n,useState as r,useCallback as t,useDebugValue as o,createElement as i,Component as a,forwardRef as s,isValidElement as l,Children as c,createRef as u}from"react";import h from"prop-types";import f from"lodash/findLast";import{uiColors as d}from"@leafygreen-ui/palette";import p from"@leafygreen-ui/tooltip";import{css as g,cx as v}from"@leafygreen-ui/emotion";import{useMutationObserver as b}from"@leafygreen-ui/hooks";import{createDataProp as y}from"@leafygreen-ui/lib";import{jsx as m}from"@emotion/react";import w from"lodash/flatMap";function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function z(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function S(){return(S=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e}).apply(this,arguments)}function x(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function N(e,n){if(null==e)return{};var r,t,o=function(e,n){if(null==e)return{};var r,t,o={},i=Object.keys(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o}function j(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}function C(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var r=[],t=!0,o=!1,i=void 0;try{for(var a,s=e[Symbol.iterator]();!(t=(a=s.next()).done)&&(r.push(a.value),!n||r.length!==n);t=!0);}catch(e){o=!0,i=e}finally{try{t||null==s.return||s.return()}finally{if(o)throw i}}return r}(e,n)||function(e,n){if(!e)return;if("string"==typeof e)return k(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return k(e,n)}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,n){(null==n||n>e.length)&&(n=e.length);for(var r=0,t=new Array(n);r<n;r++)t[r]=e[r];return t}var V="production"===process.env.NODE_ENV;function E(e,n){if(!e){if(V)throw new Error("Invariant failed");throw new Error("Invariant failed: "+(n||""))}}function M(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function P(){return(P=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e}).apply(this,arguments)}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var A=new Map,H=new Map,I=new Map,D=0;function R(e,n,r){void 0===r&&(r={}),r.threshold||(r.threshold=0);var t=r,o=t.root,i=t.rootMargin,a=t.threshold;if(A.has(e)&&("production"!==process.env.NODE_ENV?E(!1,"react-intersection-observer: Trying to observe %s, but it's already being observed by another instance.\nMake sure the `ref` is only used by a single <Observer /> instance.\n\n%s"):E(!1)),e){var s=function(e){return e?I.has(e)?I.get(e):(D+=1,I.set(e,D.toString()),I.get(e)+"_"):""}(o)+(i?a.toString()+"_"+i:a.toString()),l=H.get(s);l||(l=new IntersectionObserver(L,r),s&&H.set(s,l));var c={callback:n,element:e,inView:!1,observerId:s,observer:l,thresholds:l.thresholds||(Array.isArray(a)?a:[a])};return A.set(e,c),l.observe(e),c}}function _(e){if(e){var n=A.get(e);if(n){var r=n.observerId,t=n.observer,o=t.root;t.unobserve(e);var i=!1,a=!1;r&&A.forEach((function(n,t){t!==e&&(n.observerId===r&&(i=!0,a=!0),n.observer.root===o&&(a=!0))})),!a&&o&&I.delete(o),t&&!i&&t.disconnect(),A.delete(e)}}}function L(e){e.forEach((function(e){var n=e.isIntersecting,r=e.intersectionRatio,t=e.target,o=A.get(t);if(o&&r>=0){var i=o.thresholds.some((function(e){return o.inView?r>e:r>=e}));void 0!==n&&(i=i&&n),o.inView=i,o.callback(i,e)}}))}var X,T=function(e){var n,r;function t(){for(var n,r=arguments.length,t=new Array(r),o=0;o<r;o++)t[o]=arguments[o];return M(W(n=e.call.apply(e,[this].concat(t))||this),"state",{inView:!1,entry:void 0}),M(W(n),"node",null),M(W(n),"handleNode",(function(e){n.node&&_(n.node),n.node=e||null,n.observeNode()})),M(W(n),"handleChange",(function(e,r){(e!==n.state.inView||e)&&n.setState({inView:e,entry:r}),n.props.onChange&&n.props.onChange(e,r)})),n}r=e,(n=t).prototype=Object.create(r.prototype),n.prototype.constructor=n,n.__proto__=r;var o=t.prototype;return o.componentDidMount=function(){this.node||("production"!==process.env.NODE_ENV?E(!1,'react-intersection-observer: No DOM node found. Make sure you forward "ref" to the root DOM element you want to observe.'):E(!1))},o.componentDidUpdate=function(e,n){e.rootMargin===this.props.rootMargin&&e.root===this.props.root&&e.threshold===this.props.threshold||(_(this.node),this.observeNode()),n.inView!==this.state.inView&&this.state.inView&&this.props.triggerOnce&&(_(this.node),this.node=null)},o.componentWillUnmount=function(){this.node&&(_(this.node),this.node=null)},o.observeNode=function(){if(this.node){var e=this.props,n=e.threshold,r=e.root,t=e.rootMargin;R(this.node,this.handleChange,{threshold:n,root:r,rootMargin:t})}},o.render=function(){var e=this.state,n=e.inView,r=e.entry;if(!function(e){return"function"!=typeof e.children}(this.props))return this.props.children({inView:n,entry:r,ref:this.handleNode});var t=this.props,o=t.children,a=t.as,s=t.tag,l=(t.triggerOnce,t.threshold,t.root,t.rootMargin,t.onChange,function(e,n){if(null==e)return{};var r,t,o={},i=Object.keys(e);for(t=0;t<i.length;t++)r=i[t],n.indexOf(r)>=0||(o[r]=e[r]);return o}(t,["children","as","tag","triggerOnce","threshold","root","rootMargin","onChange"]));return i(a||s||"div",P({ref:this.handleNode},l),o)},t}(a);function q(){var e=j(["\n    margin-left: ","px;\n    width: ","px;\n    height: 100%;\n    position: absolute;\n    right: -","px;\n    top: 0;\n    overflow: hidden;\n    align-self: center;\n\n    &::before {\n      content: '';\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      transform-origin: 0 0;\n      transform: rotate(45deg);\n    }\n  "]);return q=function(){return e},e}function U(){var e=j(["\n    position: relative;\n    flex-direction: row;\n    line-height: ",";\n    align-items: center;\n    justify-content: center;\n  "]);return U=function(){return e},e}function B(){var e=j(["\n    display: flex;\n    height: ","px;\n    line-height: ",";\n  "]);return B=function(){return e},e}M(T,"displayName","InView"),M(T,"defaultProps",{threshold:0,triggerOnce:!1});var J={XSmall:"xsmall",Small:"small",Normal:"normal",Large:"large"},$=(z(X={},J.XSmall,{borderRadius:4,chevron:{size:2},fontSize:12,fontWeight:600,gutter:{vertical:2,horizontal:4},height:22,lineHeight:1,minWidth:74}),z(X,J.Small,{borderRadius:4,chevron:{size:2},fontSize:14,fontWeight:600,gutter:{vertical:2,horizontal:6},height:25,lineHeight:1,minWidth:74}),z(X,J.Normal,{borderRadius:4,chevron:{size:3},fontSize:14,fontWeight:600,gutter:{vertical:2,horizontal:8},height:32,lineHeight:1,minWidth:74}),z(X,J.Large,{borderRadius:4,chevron:{size:4},fontSize:16,fontWeight:600,gutter:{vertical:2,horizontal:10},height:45,lineHeight:1,minWidth:74}),X),F={color:d.blue.base,primary:{backgroundColor:d.blue.light2},secondary:{backgroundColor:d.blue.light3}},G=function(e){var n=e.size,r=$[n],t=r.height,o=r.lineHeight;return g(B(),t,o)},K=function(e){var n=e.size,r=$[n].lineHeight;return g(U(),r)},Q=function(e){var n=e.size,r=$[n],t=r.gutter,o=r.height/2+2*r.chevron.size,i=o;return g(q(),2*t.horizontal,o,i)},Y=y("pipeline"),Z=y("pipeline-stages"),ee=y("pipeline-stage"),ne=y("pipeline-stage-chevron"),re=y("pipeline-counter"),te=y("pipeline-counter-chevron");function oe(){var e=j(["\n      &::before {\n        background-color: ",";\n        box-shadow: 0 0 0 ","px ",",\n          0 0 0 ","px ",";\n      }\n    "]);return oe=function(){return e},e}function ie(){var e=j(["\n      background-color: ",";\n      color: ",";\n      padding: ","px ","px;\n      margin-right: ","px;\n      font-size: ","px;\n      font-weight: ",";\n      line-height: ",";\n      flex: 1 1 auto;\n      white-space: nowrap;\n      z-index: 1;\n\n      &:first-of-type {\n        border-top-left-radius: ","px;\n        border-bottom-left-radius: ","px;\n      }\n\n      &[data-stage-visible='false'] {\n        counter-increment: hiddenCount;\n      }\n    "]);return ie=function(){return e},e}var ae=function(e){var n=e.size,r=void 0===n?J.XSmall:n,t=$[r],o=t.chevron,i=t.height,a=F.primary,s=i/2;return v(Q({size:r}),g(oe(),a.backgroundColor,o.size,d.white,s,a.backgroundColor))},se=s((function(e,i){var a,s=e.children,l=e.className,c=void 0===l?"":l,u=e.intersectionNode,h=e.size,f=e.threshold,d=void 0===f?.8:f,p=N(e,["children","className","intersectionNode","size","threshold"]),b=C(function(e){void 0===e&&(e={});var i=n(),a=r({inView:!1,entry:void 0}),s=a[0],l=a[1],c=t((function(n){i.current&&_(i.current),n&&R(n,(function(r,t){l({inView:r,entry:t}),r&&e.triggerOnce&&_(n)}),e),i.current=n}),[e.threshold,e.root,e.rootMargin,e.triggerOnce]);return o(s.inView),[c,s.inView,s.entry]}({threshold:d,root:u}),2),y=b[0],w=b[1],O=function(e){return{base:(n=e,r=n.size,t=void 0===r?J.XSmall:r,o=$[t],i=o.borderRadius,a=o.chevron,s=o.fontSize,l=o.fontWeight,c=o.gutter,u=o.height,h=o.lineHeight,f=F.color,d=F.primary,p=u/2+2*a.size,v(G({size:t}),K({size:t}),g(ie(),d.backgroundColor,f,c.vertical,c.horizontal,p,s,l,h,i,i))),chevron:ae(e)};var n,r,t,o,i,a,s,l,c,u,h,f,d,p}({size:h}),z=O.base,x=O.chevron;return m("li",S({},p,ee.prop,{ref:(a=[y,i],function(e){a.forEach((function(n){"function"==typeof n?n(e):null!=n&&(n.current=e)}))}),"data-testid":"pipeline-stage","data-stage-visible":w,className:v(z,c)}),s,m("div",S({"data-testid":"pipeline-stage-chevron"},ne.prop,{className:x})))}));function le(){var e=j(["\n      &::before {\n        background-color: ",";\n        box-shadow: 0 0 0 ","px transparent,\n          0 0 0 ","px transparent;\n      }\n    "]);return le=function(){return e},e}function ce(){var e=j(["\n      background-color: ",";\n      color: ",";\n      padding: ","px ","px;\n      margin-right: ","px;\n      font-size: ","px;\n      font-weight: ",";\n      line-height: ",";\n      flex: 1 1 auto;\n      white-space: nowrap;\n      z-index: 2;\n\n      &::before {\n        white-space: nowrap;\n        content: '+' counter(hiddenCount);\n      }\n    "]);return ce=function(){return e},e}se.displayName="Stage",se.propTypes={children:h.node.isRequired,className:h.string,intersectionNode:h.any,size:h.oneOf(Object.values(J)),threshold:h.oneOfType([h.number,h.arrayOf(h.number.isRequired)])};var ue=function(e){var n=e.size,r=void 0===n?J.XSmall:n,t=$[r],o=t.chevron,i=t.height,a=F.secondary,s=i/2;return v(Q({size:r}),g(le(),a.backgroundColor,o.size,s))},he=s((function(e,n){var r=e.className,t=void 0===r?"":r,o=e.children,i=e.size,a=N(e,["className","children","size"]),s=function(e){return{base:(n=e,r=n.size,t=void 0===r?J.XSmall:r,o=$[t],i=o.chevron,a=o.fontSize,s=o.fontWeight,l=o.gutter,c=o.height,u=o.lineHeight,h=F.color,f=F.secondary,d=c/2+2*i.size,v(G({size:t}),K({size:t}),g(ce(),f.backgroundColor,h,l.vertical,l.horizontal,d,a,s,u))),chevron:ue(e)};var n,r,t,o,i,a,s,l,c,u,h,f,d}({size:i}),l=s.base,c=s.chevron;return m("div",S({},a,re.prop,{"data-testid":"pipeline-counter",className:v(l,t),ref:n}),o,m("div",S({},te.prop,{"data-testid":"pipeline-counter-chevron",className:c})))}));he.displayName="Counter",he.propTypes={children:h.node,className:h.string,size:h.oneOf(Object.values(J)).isRequired};const fe=e=>l(e)&&Boolean(e.props.children),de=e=>null==e||"boolean"==typeof e||"{}"===JSON.stringify(e)?"":e.toString(),pe=e=>e instanceof Array||l(e)?c.toArray(e).reduce(((e,n)=>{let r="";return r=l(n)&&fe(n)?pe(n.props.children):l(n)&&!fe(n)?"":de(n),e.concat(r)}),""):de(e);function ge(){var e=j(["\n    ."," > ","::before {\n      background-color: ",";\n      box-shadow: 0 0 0 ","px ",",\n        0 0 0 ","px ",";\n    }\n  "]);return ge=function(){return e},e}function ve(){var e=j(["\n      flex-grow: 1;\n      flex-shrink: 1;\n      flex-basis: 100%;\n      flex-wrap: wrap;\n      overflow: hidden;\n      list-style: none;\n      padding: 0;\n      margin: 0;\n      min-width: ","px;\n    "]);return ve=function(){return e},e}function be(){var e=j(["\n      counter-reset: hiddenCount;\n      flex-direction: row;\n    "]);return be=function(){return e},e}var ye=function(e){var n=e.size,r=$[n].minWidth;return v(G({size:n}),g(ve(),r))},me="leafygreen-ui-pipeline-stage--last-visible",we=function(e){var n=e.hasHiddenStages,r=e.size,t=$[r],o=t.height,i=t.chevron,a=F.primary,s=F.secondary,l=o/2,c=n?{innerColor:d.white,outerColor:s.backgroundColor}:{innerColor:"transparent",outerColor:"transparent"};return g(ge(),me,ne.selector,a.backgroundColor,i.size,c.innerColor,l,c.outerColor)},Oe=s((function(n,t){var o=n.children,i=n.className,a=void 0===i?"":i,s=n.size,l=void 0===s?J.XSmall:s,c=N(n,["children","className","size"]),h=C(r(null),2),d=h[0],y=h[1],j=C(r(!1),2),k=j[0],V=j[1];b(d,{childList:!0,subtree:!0,attributes:!0},(function(e){var n,r,t=e.map((function(e){return e.type}));(e.map((function(e){return e.attributeName})).includes("data-stage-visible")||t.includes("childList"))&&(r=(n=d)&&n.scrollHeight>n.clientHeight||n&&n.scrollWidth>n.clientWidth,V(r),function(){var e=Array.from(d.children);e.forEach((function(e){e.classList.remove(me)}));var n=f(e,(function(e){return"false"!==e.dataset.stageVisible}));n&&n.classList.add(me)}())}));var E=e.Children.map(o,(function(n){var r,t={size:l,intersectionNode:d,ref:u()};return null!==(r=n)&&"object"===O(r)&&"type"in r&&"Stage"===r.type.displayName?e.cloneElement(n,t):e.createElement(se,function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?x(Object(r),!0).forEach((function(n){z(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}({},t,{children:n}))})),M=function(n){var r=(e.Children.map(n,pe)||[]).filter(Boolean);return w(r,(function(e,n,r){return r.length-1!==n?[e,">"]:e})).join(" ")}(E),P=function(e){return{base:(n=e,r=n.size,v(G({size:r}),g(be()))),pipeline:ye(e),lastVisibleStageChevron:we(e)};var n,r}({hasHiddenStages:k,size:l}),W=P.base,A=P.pipeline,H=P.lastVisibleStageChevron;return m("div",S({},c,Y.prop,{"data-testid":"pipeline",ref:t,className:v(W,a)}),m("ol",S({},Z.prop,{ref:y,"data-testid":"pipeline-stages",className:v(A,H)}),E),k&&e.Children.count(E)>0&&m(p,{align:"top",justify:"middle",trigger:m(he,{size:l}),triggerEvent:"hover",darkMode:!0},M))}));Oe.displayName="Pipeline",Oe.propTypes={children:h.node,className:h.string,size:h.oneOf(Object.values(J)).isRequired};export{he as Counter,Oe as Pipeline,J as Size,se as Stage};
//# sourceMappingURL=index.js.map
