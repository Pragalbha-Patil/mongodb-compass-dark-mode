import t,{useState as e,useMemo as n,Fragment as r}from"react";import o from"prop-types";import{Transition as i}from"react-transition-group";import{css as c,cx as a}from"@leafygreen-ui/emotion";import l from"@leafygreen-ui/portal";import{usePopoverPortalContainer as s}from"@leafygreen-ui/leafygreen-provider";import{useViewportSize as u,useMutationObserver as f,useObjectDependency as p,usePrevious as d,useIsomorphicLayoutEffect as g}from"@leafygreen-ui/hooks";import{jsx as h}from"@emotion/react";function m(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function v(){return(v=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function y(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function w(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?y(Object(n),!0).forEach((function(e){m(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function b(t,e){if(null==t)return{};var n,r,o=function(t,e){if(null==t)return{};var n,r,o={},i=Object.keys(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(r=0;r<i.length;r++)n=i[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}function P(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}function E(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var n=[],r=!0,o=!1,i=void 0;try{for(var c,a=t[Symbol.iterator]();!(r=(c=a.next()).done)&&(n.push(c.value),!e||n.length!==e);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return n}(t,e)||O(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(t){return function(t){if(Array.isArray(t))return C(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||O(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(t,e){if(t){if("string"==typeof t)return C(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(t,e):void 0}}function C(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var S,x,D,H,R,V,T,B,M={Top:"top",Bottom:"bottom",Left:"left",Right:"right",CenterVertical:"center-vertical",CenterHorizontal:"center-horizontal"},F={Start:"start",Middle:"middle",End:"end",Fit:"fit"};function L(t){var e=t.useRelativePositioning,n=t.spacing,r=t.align,o=t.justify,i=t.referenceElViewportPos,c=void 0===i?W:i,a=t.referenceElDocumentPos,l=void 0===a?W:a,s=t.contentElViewportPos,u=void 0===s?W:s,f=t.contentElDocumentPos,p=void 0===f?W:f,d=t.windowHeight,g=void 0===d?window.innerHeight:d,h=t.windowWidth,m=void 0===h?window.innerWidth:h,v={windowWidth:m,windowHeight:g,referenceElViewportPos:c,contentElViewportPos:u,spacing:n},y=function(t,e){var n=e.spacing,r=e.windowWidth,o=e.windowHeight,i=e.contentElViewportPos,c=e.referenceElViewportPos;return[t].concat(j(Q[t])).find((function(t){return[M.Top,M.Bottom,M.CenterVertical].includes(t)?K({top:q({align:t,contentElPos:i,referenceElPos:c,spacing:n}),windowHeight:o,contentHeight:i.height}):!![M.Left,M.Right,M.CenterHorizontal].includes(t)&&J({left:G({align:t,contentElPos:i,referenceElPos:c,spacing:n}),windowWidth:r,contentWidth:i.width})}))||t}(r,v),b=function(t,e,n){var r,o,i=n.spacing,c=n.windowWidth,a=n.windowHeight,l=n.contentElViewportPos,s=n.referenceElViewportPos,u=[t].concat(j(_[t]));switch(e){case M.Top:case M.Bottom:case M.CenterVertical:return null!==(r=u.find((function(t){return J({contentWidth:t===F.Fit?s.width:l.width,windowWidth:c,left:G({contentElPos:l,referenceElPos:s,spacing:i,align:e,justify:t})})})))&&void 0!==r?r:_[t][0];case M.Left:case M.Right:case M.CenterHorizontal:return null!==(o=u.find((function(t){return K({contentHeight:t===F.Fit?s.height:l.height,windowHeight:a,top:q({contentElPos:l,referenceElPos:s,spacing:i,align:e,justify:t})})})))&&void 0!==o?o:_[t][0]}}(o,y,v),P=function(t){var e,n,r=t.align,o=t.justify,i=k[r],c=null!==(e=i.x)&&void 0!==e?e:I[o],a=null!==(n=i.y)&&void 0!==n?n:A[o];return"".concat(c," ").concat(a)}({align:y,justify:b}),E=function(t,e){var n=.8;switch(t){case M.Top:return"translate3d(0, ".concat(e,"px, 0) scale(").concat(n,")");case M.Bottom:return"translate3d(0, -".concat(e,"px, 0) scale(").concat(n,")");case M.Left:return"translate3d(".concat(e,"px, 0, 0) scale(").concat(n,")");case M.Right:return"translate3d(-".concat(e,"px, 0, 0) scale(").concat(n,")");case M.CenterHorizontal:case M.CenterVertical:return"scale(".concat(n,")")}}(y,n);return e?{align:y,justify:b,positionCSS:w({},Y({align:y,justify:b,referenceElDocumentPos:l,contentElDocumentPos:p,spacing:n}),{transformOrigin:P,transform:E})}:{align:y,justify:b,positionCSS:w({},$({align:y,justify:b,referenceElDocumentPos:l,contentElDocumentPos:p,spacing:n,windowHeight:g,windowWidth:m}),{transformOrigin:P,transform:E})}}var W={top:0,bottom:0,left:0,right:0,height:0,width:0};function z(t,e){if(!t)return W;var n=t.getBoundingClientRect(),r=n.top,o=n.bottom,i=n.left,c=n.right,a=t.offsetHeight,l=t.offsetWidth;if(e){var s=e.scrollTop,u=e.scrollLeft,f=e.getBoundingClientRect();return{top:r+s-f.top,bottom:o+s-f.bottom,left:i+u-f.left,right:c+u-f.right,height:a,width:l}}var p=window,d=p.scrollX,g=p.scrollY;return{top:r+g,bottom:o+g,left:i+d,right:c+d,height:a,width:l}}function N(t,e){if(!t)return W;var n=t.getBoundingClientRect(),r=n.top,o=n.bottom,i=n.left,c=n.right,a=t.offsetHeight,l=t.offsetWidth;if(e){var s=e.getBoundingClientRect();return{top:r-s.top,bottom:o-s.bottom,left:i-s.left,right:c-s.right,height:a,width:l}}return{top:r,bottom:o,left:i,right:c,height:a,width:l}}var A=(m(S={},F.Start,"top"),m(S,F.Middle,"center"),m(S,F.End,"bottom"),m(S,F.Fit,"center"),S),I=(m(x={},F.Start,"left"),m(x,F.Middle,"center"),m(x,F.End,"right"),m(x,F.Fit,"center"),x),k=(m(D={},M.Left,{x:"right"}),m(D,M.Right,{x:"left"}),m(D,M.Top,{y:"bottom"}),m(D,M.Bottom,{y:"top"}),m(D,M.CenterHorizontal,{x:"center"}),m(D,M.CenterVertical,{y:"center"}),D);var Z=(m(H={},F.Start,{top:0}),m(H,F.End,{bottom:0}),m(H,F.Middle,(function(t){var e=t.contentElDocumentPos,n=t.referenceElDocumentPos;return{top:"".concat(n.height/2-e.height/2,"px")}})),m(H,F.Fit,{top:0,bottom:0}),H),U=(m(R={},F.Start,{left:0}),m(R,F.End,{right:0}),m(R,F.Middle,(function(t){var e=t.contentElDocumentPos,n=t.referenceElDocumentPos;return{left:"".concat(n.width/2-e.width/2,"px")}})),m(R,F.Fit,{left:0,right:0}),R),X=(m(V={},M.Top,{constant:function(t){var e=t.spacing;return{bottom:"calc(100% + ".concat(e,"px)")}},justifyPositions:U}),m(V,M.Bottom,{constant:function(t){var e=t.spacing;return{top:"calc(100% + ".concat(e,"px)")}},justifyPositions:U}),m(V,M.CenterVertical,{constant:function(t){var e=t.referenceElDocumentPos;return{top:"calc(".concat(e.height/2,"px - 50%)")}},justifyPositions:U}),m(V,M.Left,{constant:function(t){var e=t.spacing;return{right:"calc(100% + ".concat(e,"px)")}},justifyPositions:Z}),m(V,M.Right,{constant:function(t){var e=t.spacing;return{left:"calc(100% + ".concat(e,"px)")}},justifyPositions:Z}),m(V,M.CenterHorizontal,{constant:function(t){var e=t.referenceElDocumentPos;return{left:"calc(".concat(e.width/2,"px - 50%)")}},justifyPositions:Z}),V);function Y(t){var e,n=t.align,r=t.justify,o=t.referenceElDocumentPos,i=t.contentElDocumentPos,c=t.spacing,a=X[n],l=a.justifyPositions[r],s={contentElDocumentPos:i,referenceElDocumentPos:o,spacing:c};return w({},null===(e=a.constant)||void 0===e?void 0:e.call(a,s),{},"function"==typeof l?l(s):l)}function $(t){var e=t.align,n=t.justify,r=t.referenceElDocumentPos,o=t.contentElDocumentPos,i=t.spacing,c=t.windowWidth,a=t.windowHeight,l="".concat(G({align:e,justify:n,referenceElPos:r,contentElPos:o,spacing:i}),"px"),s="".concat(q({align:e,justify:n,referenceElPos:r,contentElPos:o,spacing:i}),"px");return n!==F.Fit?{left:l,top:s}:[M.Left,M.Right,M.CenterHorizontal].includes(e)?{left:l,top:s,bottom:"".concat(a-r.bottom,"px")}:{left:l,top:s,right:"".concat(c-r.right,"px")}}function q(t){var e=t.align,n=t.justify,r=t.contentElPos,o=t.referenceElPos,i=t.spacing;switch(e){case M.Left:case M.Right:case M.CenterHorizontal:switch(n){case F.Start:case F.Fit:return o.top;case F.End:return o.top+o.height-r.height;case F.Middle:default:return o.top-(r.height-o.height)/2}case M.CenterVertical:return o.top-(r.height-o.height)/2;case M.Top:return o.top-r.height-i;case M.Bottom:default:return o.top+o.height+i}}function G(t){var e=t.align,n=t.justify,r=t.contentElPos,o=t.referenceElPos,i=t.spacing;switch(e){case M.Top:case M.Bottom:case M.CenterVertical:switch(n){case F.End:return o.left+o.width-r.width;case F.Middle:return o.left-(r.width-o.width)/2;case F.Start:case F.Fit:default:return o.left}case M.Left:return o.left-r.width-i;case M.Right:return o.left+o.width+i;case M.CenterHorizontal:default:return o.left-(r.width-o.width)/2}}function J(t){var e=t.left,n=t.windowWidth,r=t.contentWidth;return e>=0&&!(e+r>n)}function K(t){var e=t.top,n=t.windowHeight,r=t.contentHeight;return e>=0&&!(e+r>n)}var Q=(m(T={},M.Top,[M.Bottom]),m(T,M.Bottom,[M.Top]),m(T,M.Left,[M.Right]),m(T,M.Right,[M.Left]),m(T,M.CenterHorizontal,[M.Left,M.Right]),m(T,M.CenterVertical,[M.Top,M.Bottom]),T);var _=(m(B={},F.Start,[F.End,F.Middle]),m(B,F.Middle,[F.End,F.Start]),m(B,F.End,[F.Start,F.Middle]),m(B,F.Fit,[F.Middle,F.Start,F.End]),B);function tt(){var t=P(["\n                    z-index: ",";\n                  "]);return tt=function(){return t},t}function et(){var t=P(["\n              display: none;\n            "]);return et=function(){return t},t}function nt(){var t=P(["\n    opacity: 1;\n    position: ",";\n    pointer-events: initial;\n  "]);return nt=function(){return t},t}function rt(){var t=P(["\n  position: absolute;\n  transition: transform 150ms ease-in-out, opacity 150ms ease-in-out;\n  opacity: 0;\n"]);return rt=function(){return t},t}var ot=c(rt()),it={attributes:!0,characterData:!0,childList:!0,subtree:!0};function ct(o){var y=o.active,w=void 0!==y&&y,P=o.spacing,j=void 0===P?10:P,O=o.align,C=void 0===O?M.Bottom:O,S=o.justify,x=void 0===S?F.Start:S,D=o.adjustOnMutation,H=void 0!==D&&D,R=o.children,V=o.className,T=o.popoverZIndex,B=o.refEl,W=o.usePortal,A=void 0===W||W,I=o.portalClassName,k=o.portalContainer,Z=o.scrollContainer,U=b(o,["active","spacing","align","justify","adjustOnMutation","children","className","popoverZIndex","refEl","usePortal","portalClassName","portalContainer","scrollContainer"]),X=E(e(null),2),Y=X[0],$=X[1],q=E(e(null),2),G=q[0],J=q[1],K=E(e(0),2),Q=K[0],_=K[1],rt=s(),ct=rt.portalContainer,at=rt.scrollContainer;ct=k||ct,at=Z||at;var lt=t.useRef(G);lt.current=G;var st=null;if(B&&B.current)st=B.current;else if(Y){var ut=Y.parentNode;ut&&ut instanceof HTMLElement&&(st=ut)}var ft=u(),pt=H&&w,dt=f(st,it,Date.now,pt),gt=f(G,it,Date.now,pt),ht=p(N(st,at)),mt=p(N(G,at)),vt=p(n((function(){return z(st,at)}),[st,at,ft,dt,w,C,x,Q])),yt=p(n((function(){return z(G)}),[G,ft,gt,w,C,x,Q])),wt=d(x),bt=d(C),Pt=wt!==x&&(x===F.Fit||wt===F.Fit)||bt!==C&&x===F.Fit;g((function(){Pt&&_((function(t){return t+1}))}),[Pt]);var Et=E(e(!1),2),jt=Et[0],Ot=Et[1];if(g((function(){return Ot(!0)}),[]),!jt)return null;var Ct,St=L({useRelativePositioning:!A,spacing:j,align:C,justify:x,referenceElViewportPos:ht,referenceElDocumentPos:vt,contentElViewportPos:mt,contentElDocumentPos:yt}),xt=St.align,Dt=St.justify,Ht=St.positionCSS,Rt=Ht.transform,Vt=b(Ht,["transform"]),Tt=c(nt(),A?"":"absolute"),Bt=A?l:r,Mt=A?ct?{container:ct}:{className:null!=I?I:void 0}:{};return Ct=null==R?null:"function"==typeof R?R({align:xt,justify:Dt,referenceElPos:vt}):R,h(i,{nodeRef:lt,in:w,timeout:150,mountOnEnter:!0,unmountOnExit:!0,appear:!0},(function(e){var n;return h(t.Fragment,null,h("div",{ref:$,className:c(et())}),h(Bt,Mt,h("div",v({},U,{className:a(ot,c(Vt),(n={},m(n,c({transform:Rt}),"entering"===e||"exiting"===e),m(n,Tt,"entered"===e),m(n,c(tt(),T),"number"==typeof T),n),V)}),h("div",{ref:J},Ct))))}))}ct.displayName="Popover",ct.propTypes={children:o.oneOfType([o.node,o.func]),active:o.bool,className:o.string,align:o.oneOf(Object.values(M)),justify:o.oneOf(Object.values(F)),refEl:o.shape({current:"undefined"!=typeof window?o.instanceOf(Element):o.any}),usePortal:o.bool,portalClassName:o.string,spacing:o.number,adjustOnMutation:o.bool};export default ct;export{M as Align,F as Justify};
//# sourceMappingURL=index.js.map
