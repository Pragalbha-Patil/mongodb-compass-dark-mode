{"version":3,"file":"index.js","sources":["../src/positionUtils.ts","../src/types.ts","../src/Popover.tsx"],"sourcesContent":["import { Align, Justify, ElementPosition } from './types';\n\ninterface ElementViewportPositions {\n  referenceElViewportPos: ElementPosition;\n  contentElViewportPos: ElementPosition;\n  spacing: number;\n}\n\ninterface ElementDocumentPositions {\n  referenceElDocumentPos: ElementPosition;\n  contentElDocumentPos: ElementPosition;\n  spacing: number;\n}\n\ninterface ElementPositions\n  extends Partial<ElementViewportPositions>,\n    Partial<ElementDocumentPositions> {}\n\ninterface WindowSize {\n  windowWidth: number;\n  windowHeight: number;\n}\n\ninterface CalculatePosition\n  extends Required<ElementPositions>,\n    Partial<WindowSize> {\n  useRelativePositioning: boolean;\n  align: Align;\n  justify: Justify;\n}\n\n// Returns the style object that is used to position and transition the popover component\nexport function calculatePosition({\n  useRelativePositioning,\n  spacing,\n  align,\n  justify,\n  referenceElViewportPos = defaultElementPosition,\n  referenceElDocumentPos = defaultElementPosition,\n  contentElViewportPos = defaultElementPosition,\n  contentElDocumentPos = defaultElementPosition,\n  windowHeight = window.innerHeight,\n  windowWidth = window.innerWidth,\n}: CalculatePosition): {\n  align: Align;\n  justify: Justify;\n  positionCSS: any;\n} {\n  const windowSafeCommonArgs = {\n    windowWidth,\n    windowHeight,\n    referenceElViewportPos,\n    contentElViewportPos,\n    spacing,\n  };\n\n  const windowSafeAlign = getWindowSafeAlign(align, windowSafeCommonArgs);\n  const windowSafeJustify = getWindowSafeJustify(\n    justify,\n    windowSafeAlign,\n    windowSafeCommonArgs,\n  );\n\n  const transformOrigin = getTransformOrigin({\n    align: windowSafeAlign,\n    justify: windowSafeJustify,\n  });\n\n  const transform = getTransform(windowSafeAlign, spacing);\n\n  if (useRelativePositioning) {\n    return {\n      align: windowSafeAlign,\n      justify: windowSafeJustify,\n      positionCSS: {\n        ...calcRelativePosition({\n          align: windowSafeAlign,\n          justify: windowSafeJustify,\n          referenceElDocumentPos,\n          contentElDocumentPos,\n          spacing,\n        }),\n        transformOrigin,\n        transform,\n      },\n    };\n  }\n\n  return {\n    align: windowSafeAlign,\n    justify: windowSafeJustify,\n    positionCSS: {\n      ...calcAbsolutePosition({\n        align: windowSafeAlign,\n        justify: windowSafeJustify,\n        referenceElDocumentPos,\n        contentElDocumentPos,\n        spacing,\n        windowHeight,\n        windowWidth,\n      }),\n      transformOrigin,\n      transform,\n    },\n  };\n}\n\nconst defaultElementPosition = {\n  top: 0,\n  bottom: 0,\n  left: 0,\n  right: 0,\n  height: 0,\n  width: 0,\n};\n\nexport function getElementDocumentPosition(\n  element: HTMLElement | null,\n  scrollContainer?: HTMLElement | null,\n): ElementPosition {\n  if (!element) {\n    return defaultElementPosition;\n  }\n\n  const { top, bottom, left, right } = element.getBoundingClientRect();\n  const { offsetHeight: height, offsetWidth: width } = element;\n\n  if (scrollContainer) {\n    const { scrollTop, scrollLeft } = scrollContainer;\n    const {\n      top: offsetTop,\n      bottom: offsetBottom,\n      left: offsetLeft,\n      right: offsetRight,\n    } = scrollContainer.getBoundingClientRect();\n\n    return {\n      top: top + scrollTop - offsetTop,\n      bottom: bottom + scrollTop - offsetBottom,\n      left: left + scrollLeft - offsetLeft,\n      right: right + scrollLeft - offsetRight,\n      height,\n      width,\n    };\n  }\n\n  const { scrollX, scrollY } = window;\n\n  return {\n    top: top + scrollY,\n    bottom: bottom + scrollY,\n    left: left + scrollX,\n    right: right + scrollX,\n    height,\n    width,\n  };\n}\n\n// Gets top offset, left offset, width and height dimensions for a node\nexport function getElementViewportPosition(\n  element: HTMLElement | null,\n  scrollContainer?: HTMLElement | null,\n): ElementPosition {\n  if (!element) {\n    return defaultElementPosition;\n  }\n\n  const { top, bottom, left, right } = element.getBoundingClientRect();\n  const { offsetHeight: height, offsetWidth: width } = element;\n\n  if (scrollContainer) {\n    const {\n      top: offsetTop,\n      bottom: offsetBottom,\n      left: offsetLeft,\n      right: offsetRight,\n    } = scrollContainer.getBoundingClientRect();\n\n    return {\n      top: top - offsetTop,\n      bottom: bottom - offsetBottom,\n      left: left - offsetLeft,\n      right: right - offsetRight,\n      height,\n      width,\n    };\n  }\n\n  return {\n    top,\n    bottom,\n    left,\n    right,\n    height,\n    width,\n  };\n}\n\ninterface TransformOriginArgs {\n  align: Align;\n  justify: Justify;\n}\n\ntype XOrigin = 'left' | 'right' | 'center';\ntype YOrigin = 'top' | 'bottom' | 'center';\n\nconst yJustifyOrigins: Record<Justify, YOrigin> = {\n  [Justify.Start]: 'top',\n  [Justify.Middle]: 'center',\n  [Justify.End]: 'bottom',\n  [Justify.Fit]: 'center',\n};\n\nconst xJustifyOrigins: Record<Justify, XOrigin> = {\n  [Justify.Start]: 'left',\n  [Justify.Middle]: 'center',\n  [Justify.End]: 'right',\n  [Justify.Fit]: 'center',\n};\n\nconst transformOriginMappings: {\n  [A in Align]: { x: XOrigin; y?: undefined } | { x?: undefined; y: YOrigin };\n} = {\n  [Align.Left]: { x: 'right' },\n  [Align.Right]: { x: 'left' },\n  [Align.Top]: { y: 'bottom' },\n  [Align.Bottom]: { y: 'top' },\n  [Align.CenterHorizontal]: { x: 'center' },\n  [Align.CenterVertical]: { y: 'center' },\n};\n\n// Constructs the transform origin for any given pair of alignment / justification\nfunction getTransformOrigin({ align, justify }: TransformOriginArgs): string {\n  const alignMapping = transformOriginMappings[align];\n  const x: XOrigin = alignMapping.x ?? xJustifyOrigins[justify];\n  const y: YOrigin = alignMapping.y ?? yJustifyOrigins[justify];\n\n  return `${x} ${y}`;\n}\n\n// Get transform styles for position object\nfunction getTransform(align: Align, transformAmount: number): string {\n  const scaleAmount = 0.8;\n\n  switch (align) {\n    case Align.Top:\n      return `translate3d(0, ${transformAmount}px, 0) scale(${scaleAmount})`;\n\n    case Align.Bottom:\n      return `translate3d(0, -${transformAmount}px, 0) scale(${scaleAmount})`;\n\n    case Align.Left:\n      return `translate3d(${transformAmount}px, 0, 0) scale(${scaleAmount})`;\n\n    case Align.Right:\n      return `translate3d(-${transformAmount}px, 0, 0) scale(${scaleAmount})`;\n\n    case Align.CenterHorizontal:\n    case Align.CenterVertical:\n      // NOTE(JeT): For centered alignments, \"spacing\" doesn't make sense\n      return `scale(${scaleAmount})`;\n  }\n}\n\ninterface AbsolutePositionObject {\n  top?: string | 0;\n  bottom?: string | 0;\n  left?: string | 0;\n  right?: string | 0;\n}\n\ninterface CalcPositionArgs extends ElementDocumentPositions {\n  align: Align;\n  justify: Justify;\n  spacing: number;\n}\n\ntype JustifyPositions = {\n  readonly [J in Justify]:\n    | AbsolutePositionObject\n    | ((positions: ElementDocumentPositions) => AbsolutePositionObject);\n};\n\n/**\n * Position mappings for when the main axis alignment is horizontal\n * (left/right/horizontal-center)\n */\nconst verticalJustifyRelativePositions: JustifyPositions = {\n  [Justify.Start]: { top: 0 },\n  [Justify.End]: { bottom: 0 },\n  [Justify.Middle]: ({ contentElDocumentPos, referenceElDocumentPos }) => ({\n    top: `${\n      referenceElDocumentPos.height / 2 - contentElDocumentPos.height / 2\n    }px`,\n  }),\n  [Justify.Fit]: { top: 0, bottom: 0 },\n};\n\n/**\n * Position mappings for when the main axis alignment is vertical\n * (top/bottom/vertical-center)\n */\nconst horizontalJustifyRelativePositions: JustifyPositions = {\n  [Justify.Start]: { left: 0 },\n  [Justify.End]: { right: 0 },\n  [Justify.Middle]: ({ contentElDocumentPos, referenceElDocumentPos }) => ({\n    left: `${\n      referenceElDocumentPos.width / 2 - contentElDocumentPos.width / 2\n    }px`,\n  }),\n  [Justify.Fit]: { left: 0, right: 0 },\n};\n\nconst relativePositionMappings: Record<\n  Align,\n  {\n    constant?: (positions: ElementDocumentPositions) => AbsolutePositionObject;\n    justifyPositions: JustifyPositions;\n  }\n> = {\n  [Align.Top]: {\n    constant: ({ spacing }) => ({ bottom: `calc(100% + ${spacing}px)` }),\n    justifyPositions: horizontalJustifyRelativePositions,\n  },\n  [Align.Bottom]: {\n    constant: ({ spacing }) => ({ top: `calc(100% + ${spacing}px)` }),\n    justifyPositions: horizontalJustifyRelativePositions,\n  },\n  [Align.CenterVertical]: {\n    constant: ({ referenceElDocumentPos }) => ({\n      top: `calc(${referenceElDocumentPos.height / 2}px - 50%)`,\n    }),\n    justifyPositions: horizontalJustifyRelativePositions,\n  },\n  [Align.Left]: {\n    constant: ({ spacing }) => ({ right: `calc(100% + ${spacing}px)` }),\n    justifyPositions: verticalJustifyRelativePositions,\n  },\n  [Align.Right]: {\n    constant: ({ spacing }) => ({ left: `calc(100% + ${spacing}px)` }),\n    justifyPositions: verticalJustifyRelativePositions,\n  },\n  [Align.CenterHorizontal]: {\n    constant: ({ referenceElDocumentPos }) => ({\n      left: `calc(${referenceElDocumentPos.width / 2}px - 50%)`,\n    }),\n    justifyPositions: verticalJustifyRelativePositions,\n  },\n};\n\n// Returns positioning for an element absolutely positioned within it's relative parent\nfunction calcRelativePosition({\n  align,\n  justify,\n  referenceElDocumentPos,\n  contentElDocumentPos,\n  spacing,\n}: CalcPositionArgs): AbsolutePositionObject {\n  const alignMapping = relativePositionMappings[align];\n  const justifyMapping = alignMapping.justifyPositions[justify];\n  const mappingArgs = { contentElDocumentPos, referenceElDocumentPos, spacing };\n\n  return {\n    ...alignMapping.constant?.(mappingArgs),\n    ...(typeof justifyMapping === 'function'\n      ? justifyMapping(mappingArgs)\n      : justifyMapping),\n  };\n}\n\ntype CalcAbsolutePositionArgs = CalcPositionArgs & WindowSize;\n\nfunction calcAbsolutePosition({\n  align,\n  justify,\n  referenceElDocumentPos,\n  contentElDocumentPos,\n  spacing,\n  windowWidth,\n  windowHeight,\n}: CalcAbsolutePositionArgs): AbsolutePositionObject {\n  const left = `${calcLeft({\n    align,\n    justify,\n    referenceElPos: referenceElDocumentPos,\n    contentElPos: contentElDocumentPos,\n    spacing,\n  })}px`;\n\n  const top = `${calcTop({\n    align,\n    justify,\n    referenceElPos: referenceElDocumentPos,\n    contentElPos: contentElDocumentPos,\n    spacing,\n  })}px`;\n\n  if (justify !== Justify.Fit) {\n    return { left, top };\n  }\n\n  if (\n    ([\n      Align.Left,\n      Align.Right,\n      Align.CenterHorizontal,\n    ] as Array<Align>).includes(align)\n  ) {\n    return {\n      left,\n      top,\n      bottom: `${windowHeight - referenceElDocumentPos.bottom}px`,\n    };\n  }\n\n  return {\n    left,\n    top,\n    right: `${windowWidth - referenceElDocumentPos.right}px`,\n  };\n}\n\ninterface CalcPosition {\n  align?: Align;\n  justify?: Justify;\n  spacing: number;\n  contentElPos: ElementPosition;\n  referenceElPos: ElementPosition;\n}\n\n// Returns the 'top' position in pixels for a valid alignment or justification.\nfunction calcTop({\n  align,\n  justify,\n  contentElPos,\n  referenceElPos,\n  spacing,\n}: CalcPosition): number {\n  switch (align) {\n    case Align.Left:\n    case Align.Right:\n    case Align.CenterHorizontal:\n      switch (justify) {\n        case Justify.Start:\n        case Justify.Fit:\n          return referenceElPos.top;\n\n        case Justify.End:\n          return (\n            referenceElPos.top + referenceElPos.height - contentElPos.height\n          );\n\n        case Justify.Middle:\n        default:\n          return (\n            referenceElPos.top -\n            (contentElPos.height - referenceElPos.height) / 2\n          );\n      }\n\n    case Align.CenterVertical:\n      return (\n        referenceElPos.top - (contentElPos.height - referenceElPos.height) / 2\n      );\n\n    case Align.Top:\n      return referenceElPos.top - contentElPos.height - spacing;\n\n    case Align.Bottom:\n    default:\n      return referenceElPos.top + referenceElPos.height + spacing;\n  }\n}\n\n// Returns the 'left' position in pixels for a valid alignment or justification.\nfunction calcLeft({\n  align,\n  justify,\n  contentElPos,\n  referenceElPos,\n  spacing,\n}: CalcPosition): number {\n  switch (align) {\n    case Align.Top:\n    case Align.Bottom:\n    case Align.CenterVertical:\n      switch (justify) {\n        case Justify.End:\n          return (\n            referenceElPos.left + referenceElPos.width - contentElPos.width\n          );\n\n        case Justify.Middle:\n          return (\n            referenceElPos.left -\n            (contentElPos.width - referenceElPos.width) / 2\n          );\n\n        case Justify.Start:\n        case Justify.Fit:\n        default:\n          return referenceElPos.left;\n      }\n\n    case Align.Left:\n      return referenceElPos.left - contentElPos.width - spacing;\n\n    case Align.Right:\n      return referenceElPos.left + referenceElPos.width + spacing;\n\n    case Align.CenterHorizontal:\n    default:\n      return (\n        referenceElPos.left - (contentElPos.width - referenceElPos.width) / 2\n      );\n  }\n}\n\n// Check if horizontal position is safely within edge of window\nfunction safelyWithinHorizontalWindow({\n  left,\n  windowWidth,\n  contentWidth,\n}: {\n  left: number;\n  windowWidth: number;\n  contentWidth: number;\n}): boolean {\n  const tooWide = left + contentWidth > windowWidth;\n\n  return left >= 0 && !tooWide;\n}\n\n// Check if vertical position is safely within edge of window\nfunction safelyWithinVerticalWindow({\n  top,\n  windowHeight,\n  contentHeight,\n}: {\n  top: number;\n  windowHeight: number;\n  contentHeight: number;\n}): boolean {\n  const tooTall = top + contentHeight > windowHeight;\n\n  return top >= 0 && !tooTall;\n}\n\ninterface WindowSafeCommonArgs extends ElementViewportPositions, WindowSize {}\n\nconst alignFallbacks: { [A in Align]: ReadonlyArray<Align> } = {\n  [Align.Top]: [Align.Bottom],\n  [Align.Bottom]: [Align.Top],\n  [Align.Left]: [Align.Right],\n  [Align.Right]: [Align.Left],\n  [Align.CenterHorizontal]: [Align.Left, Align.Right],\n  [Align.CenterVertical]: [Align.Top, Align.Bottom],\n};\n\n// Determines the alignment to render based on an order of alignment fallbacks\n// Returns the first alignment that doesn't collide with the window,\n// defaulting to the align prop if all alignments fail.\nfunction getWindowSafeAlign(\n  align: Align,\n  windowSafeCommon: WindowSafeCommonArgs,\n): Align {\n  const {\n    spacing,\n    windowWidth,\n    windowHeight,\n    contentElViewportPos,\n    referenceElViewportPos,\n  } = windowSafeCommon;\n\n  const alignOptions = [align, ...alignFallbacks[align]];\n\n  return (\n    alignOptions.find(fallback => {\n      // Check that an alignment will not cause the popover to collide with the window.\n\n      if (\n        ([\n          Align.Top,\n          Align.Bottom,\n          Align.CenterVertical,\n        ] as Array<Align>).includes(fallback)\n      ) {\n        const top = calcTop({\n          align: fallback,\n          contentElPos: contentElViewportPos,\n          referenceElPos: referenceElViewportPos,\n          spacing,\n        });\n\n        return safelyWithinVerticalWindow({\n          top,\n          windowHeight,\n          contentHeight: contentElViewportPos.height,\n        });\n      }\n\n      if (\n        ([\n          Align.Left,\n          Align.Right,\n          Align.CenterHorizontal,\n        ] as Array<Align>).includes(fallback)\n      ) {\n        const left = calcLeft({\n          align: fallback,\n          contentElPos: contentElViewportPos,\n          referenceElPos: referenceElViewportPos,\n          spacing,\n        });\n        return safelyWithinHorizontalWindow({\n          left,\n          windowWidth,\n          contentWidth: contentElViewportPos.width,\n        });\n      }\n\n      return false;\n    }) || align\n  );\n}\n\nconst justifyFallbacks: { [J in Justify]: ReadonlyArray<Justify> } = {\n  [Justify.Start]: [Justify.End, Justify.Middle],\n  [Justify.Middle]: [Justify.End, Justify.Start],\n  [Justify.End]: [Justify.Start, Justify.Middle],\n  [Justify.Fit]: [Justify.Middle, Justify.Start, Justify.End],\n};\n\n// Determines the justification to render based on an order of justification fallbacks\n// Returns the first justification that doesn't collide with the window,\n// defaulting to the justify prop if all justifications fail.\nfunction getWindowSafeJustify(\n  justify: Justify,\n  align: Align,\n  windowSafeCommon: WindowSafeCommonArgs,\n): Justify {\n  const {\n    spacing,\n    windowWidth,\n    windowHeight,\n    contentElViewportPos,\n    referenceElViewportPos,\n  } = windowSafeCommon;\n\n  const justifyOptions = [justify, ...justifyFallbacks[justify]];\n\n  switch (align) {\n    case Align.Top:\n    case Align.Bottom:\n    case Align.CenterVertical:\n      return (\n        justifyOptions.find(fallback =>\n          safelyWithinHorizontalWindow({\n            contentWidth:\n              fallback === Justify.Fit\n                ? referenceElViewportPos.width\n                : contentElViewportPos.width,\n            windowWidth,\n            left: calcLeft({\n              contentElPos: contentElViewportPos,\n              referenceElPos: referenceElViewportPos,\n              spacing,\n              align: align,\n              justify: fallback,\n            }),\n          }),\n        ) ?? justifyFallbacks[justify][0]\n      );\n\n    case Align.Left:\n    case Align.Right:\n    case Align.CenterHorizontal:\n      return (\n        justifyOptions.find(fallback =>\n          safelyWithinVerticalWindow({\n            contentHeight:\n              fallback === Justify.Fit\n                ? referenceElViewportPos.height\n                : contentElViewportPos.height,\n            windowHeight,\n            top: calcTop({\n              contentElPos: contentElViewportPos,\n              referenceElPos: referenceElViewportPos,\n              spacing,\n              align,\n              justify: fallback,\n            }),\n          }),\n        ) ?? justifyFallbacks[justify][0]\n      );\n  }\n}\n","import React from 'react';\n\n/**\n * Options to determine the alignment of the popover relative to\n * the other component\n * @param Top will align content above other element\n * @param Bottom will align content below other element\n * @param Left will align content to the left of other element\n * @param Right will align content to the right of other element\n */\nconst Align = {\n  Top: 'top',\n  Bottom: 'bottom',\n  Left: 'left',\n  Right: 'right',\n  CenterVertical: 'center-vertical',\n  CenterHorizontal: 'center-horizontal',\n} as const;\n\ntype Align = typeof Align[keyof typeof Align];\n\nexport { Align };\n\n/**\n * Options to determine the justification of the popover relative to\n * the other component\n * @param Start will justify content against the start of other element\n * @param Middle will justify content against the middle of other element\n * @param Bottom will justify content against the end of other element\n * @param Fit will justify content against both the start and the end of the other element\n */\nconst Justify = {\n  Start: 'start',\n  Middle: 'middle',\n  End: 'end',\n  Fit: 'fit',\n} as const;\n\ntype Justify = typeof Justify[keyof typeof Justify];\n\nexport { Justify };\n\nexport interface ElementPosition {\n  top: number;\n  bottom: number;\n  left: number;\n  right: number;\n  height: number;\n  width: number;\n}\n\ninterface ChildrenFunctionParameters {\n  align: Align;\n  justify: Justify;\n  referenceElPos: ElementPosition;\n}\n\nexport type PortalControlProps =\n  | {\n      /**\n       * Specifies that the popover content should be rendered at the end of the DOM,\n       * rather than in the DOM tree.\n       *\n       * default: `true`\n       */\n      usePortal?: true;\n\n      /**\n       * When usePortal is `true`, specifies a class name to apply to the root element of the portal.\n       */\n      portalClassName?: string;\n\n      /**\n       * When usePortal is `true`, specifies an element to portal within. The default behavior is to generate a div at the end of the document to render within.\n       */\n      portalContainer?: HTMLElement | null;\n\n      /**\n       * When usePortal is `true`, specifies the scrollable element to position relative to.\n       */\n      scrollContainer?: HTMLElement | null;\n    }\n  | {\n      /**\n       * Specifies that the popover content should be rendered at the end of the DOM,\n       * rather than in the DOM tree.\n       *\n       * default: `true`\n       */\n      usePortal: false;\n\n      /**\n       * When usePortal is `true`, specifies a class name to apply to the root element of the portal.\n       */\n      portalClassName?: undefined;\n\n      /**\n       * When usePortal is `true`, specifies an element to portal within. The default behavior is to generate a div at the end of the document to render within.\n       */\n      portalContainer?: null;\n\n      /**\n       * When usePortal is `true`, specifies the scrollable element to position relative to.\n       */\n      scrollContainer?: null;\n    };\n\nexport type PopoverProps = {\n  /**\n   * Content that will appear inside of the popover component.\n   */\n  children:\n    | React.ReactNode\n    | ((Options: ChildrenFunctionParameters) => React.ReactNode);\n\n  /**\n   * Determines the active state of the popover component\n   *\n   * default: `false`\n   */\n  active?: boolean;\n\n  /**\n   * Class name applied to popover content container.\n   */\n  className?: string;\n\n  /**\n   * Determines the alignment of the popover content relative to the trigger element\n   *\n   * default: `bottom`\n   */\n  align?: Align;\n\n  /**\n   * Determines the justification of the popover content relative to the trigger element\n   *\n   * default: `start`\n   */\n  justify?: Justify;\n\n  /**\n   * A reference to the element against which the popover component will be positioned.\n   */\n  refEl?: React.RefObject<HTMLElement>;\n\n  /**\n   * Specifies the amount of spacing (in pixels) between the trigger element and the Popover content.\n   *\n   * default: `10`\n   */\n  spacing?: number;\n\n  /**\n   * Should the Popover auto adjust its content when the DOM changes (using MutationObserver).\n   *\n   * default: false\n   */\n  adjustOnMutation?: boolean;\n\n  /**\n   * Click event handler passed to the root div element within the portal container.\n   */\n  onClick?: React.MouseEventHandler;\n\n  /**\n   * Number that controls the z-index of the popover element directly.\n   */\n  popoverZIndex?: number;\n} & PortalControlProps;\n","import React, { useMemo, Fragment, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { Transition } from 'react-transition-group';\nimport { css, cx } from '@leafygreen-ui/emotion';\nimport Portal from '@leafygreen-ui/portal';\nimport { usePopoverPortalContainer } from '@leafygreen-ui/leafygreen-provider';\nimport {\n  useViewportSize,\n  useMutationObserver,\n  useIsomorphicLayoutEffect,\n  useObjectDependency,\n  usePrevious,\n} from '@leafygreen-ui/hooks';\nimport { Align, Justify, PopoverProps } from './types';\nimport {\n  calculatePosition,\n  getElementViewportPosition,\n  getElementDocumentPosition,\n} from './positionUtils';\n\nconst rootPopoverStyle = css`\n  position: absolute;\n  transition: transform 150ms ease-in-out, opacity 150ms ease-in-out;\n  opacity: 0;\n`;\n\nconst mutationOptions = {\n  // If attributes changes, such as className which affects layout\n  attributes: true,\n  // Watch if text changes in the node\n  characterData: true,\n  // Watch for any immediate children are modified\n  childList: true,\n  // Extend watching to entire sub tree to make sure we catch any modifications\n  subtree: true,\n};\n\n/**\n * # Popover\n *\n * React Component that handles positioning of content relative to another element.\n *\n * ```\n<button>\n  <Popover active={true}>Hello world!</Popover>\n</button>\n```\n * @param props.active Boolean to describe whether or not Popover is active.\n * @param props.spacing The spacing (in pixels) between the reference element, and the popover.\n * @param props.align Alignment of Popover component relative to another element: `top`, `bottom`, `left`, `right`, `center-horizontal`, `center-vertical`.\n * @param props.justify Justification of Popover component relative to another element: `start`, `middle`, `end`, `fit`.\n * @param props.adjustOnMutation Should the Popover auto adjust its content when the DOM changes (using MutationObserver).\n * @param props.children Content to appear inside of Popover container.\n * @param props.className Classname applied to Popover container.\n * @param props.popoverZIndex Number that controls the z-index of the popover element directly.\n * @param props.refEl Reference element that Popover component should be positioned against.\n * @param props.usePortal Boolean to describe if content should be portaled to end of DOM, or appear in DOM tree.\n * @param props.portalClassName Classname applied to root element of the portal.\n * @param props.portalContainer HTML element that the popover is portaled within.\n * @param props.scrollContainer HTML ancestor element that's scrollable to position the popover accurately within scrolling containers.\n */\nfunction Popover({\n  active = false,\n  spacing = 10,\n  align = Align.Bottom,\n  justify = Justify.Start,\n  adjustOnMutation = false,\n  children,\n  className,\n  popoverZIndex,\n  refEl,\n  usePortal = true,\n  portalClassName,\n  portalContainer: portalContainerProp,\n  scrollContainer: scrollContainerProp,\n  ...rest\n}: PopoverProps) {\n  const [placeholderNode, setPlaceholderNode] = useState<HTMLElement | null>(\n    null,\n  );\n  const [contentNode, setContentNode] = useState<HTMLElement | null>(null);\n  const [forceUpdateCounter, setForceUpdateCounter] = useState(0);\n\n  let { portalContainer, scrollContainer } = usePopoverPortalContainer();\n\n  portalContainer = portalContainerProp || portalContainer;\n  scrollContainer = scrollContainerProp || scrollContainer;\n\n  // To remove StrictMode warnings produced by react-transition-group we need\n  // to pass in a useRef object to the <Transition> component.\n  // To do so we're shadowing the contentNode onto this nodeRef as\n  // <Transition> only accepts useRef objects.\n  const contentNodeRef = React.useRef(contentNode);\n  contentNodeRef.current = contentNode;\n\n  let referenceElement: HTMLElement | null = null;\n\n  if (refEl && refEl.current) {\n    referenceElement = refEl.current;\n  } else if (placeholderNode) {\n    const parent = placeholderNode.parentNode;\n\n    if (parent && parent instanceof HTMLElement) {\n      referenceElement = parent;\n    }\n  }\n\n  const viewportSize = useViewportSize();\n\n  // We calculate the position of the popover when it becomes active,\n  // so it's safe for us to only enable the mutation observers once the popover is active.\n  const observeMutations = adjustOnMutation && active;\n\n  const lastTimeRefElMutated = useMutationObserver(\n    referenceElement,\n    mutationOptions,\n    Date.now,\n    observeMutations,\n  );\n\n  const lastTimeContentElMutated = useMutationObserver(\n    contentNode,\n    mutationOptions,\n    Date.now,\n    observeMutations,\n  );\n\n  // We don't memoize these values as they're reliant on scroll positioning\n  const referenceElViewportPos = useObjectDependency(\n    getElementViewportPosition(referenceElement, scrollContainer),\n  );\n\n  const contentElViewportPos = useObjectDependency(\n    getElementViewportPosition(contentNode, scrollContainer),\n  );\n\n  const referenceElDocumentPos = useObjectDependency(\n    useMemo(\n      () => getElementDocumentPosition(referenceElement, scrollContainer),\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [\n        referenceElement,\n        scrollContainer,\n        viewportSize,\n        lastTimeRefElMutated,\n        active,\n        align,\n        justify,\n        forceUpdateCounter,\n      ],\n    ),\n  );\n\n  const contentElDocumentPos = useObjectDependency(\n    useMemo(\n      () => getElementDocumentPosition(contentNode),\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      [\n        contentNode,\n        viewportSize,\n        lastTimeContentElMutated,\n        active,\n        align,\n        justify,\n        forceUpdateCounter,\n      ],\n    ),\n  );\n\n  const prevJustify = usePrevious<Justify>(justify);\n  const prevAlign = usePrevious<Align>(align);\n\n  const layoutMightHaveChanged =\n    (prevJustify !== justify &&\n      (justify === Justify.Fit || prevJustify === Justify.Fit)) ||\n    (prevAlign !== align && justify === Justify.Fit);\n\n  useIsomorphicLayoutEffect(() => {\n    // justify={Justify.Fit} can cause the content's height/width to change\n    // If we're switching to/from Fit, force an extra pass to make sure the popover is positioned correctly.\n    // Also if we're switching between alignments and have Justify.Fit, it may switch between setting the width and\n    // setting the height, so force an update in that case as well.\n    if (layoutMightHaveChanged) {\n      setForceUpdateCounter(n => n + 1);\n    }\n  }, [layoutMightHaveChanged]);\n\n  // Don't render the popover initially since computing the position depends on\n  // the window which isn't available if the component is rendered on server side.\n  const [shouldRender, setShouldRender] = useState(false);\n\n  useIsomorphicLayoutEffect(() => setShouldRender(true), []);\n\n  if (!shouldRender) {\n    return null;\n  }\n\n  const {\n    align: windowSafeAlign,\n    justify: windowSafeJustify,\n    positionCSS: { transform, ...positionCSS },\n  } = calculatePosition({\n    useRelativePositioning: !usePortal,\n    spacing,\n    align,\n    justify,\n    referenceElViewportPos,\n    referenceElDocumentPos,\n    contentElViewportPos,\n    contentElDocumentPos,\n  });\n\n  const activeStyle = css`\n    opacity: 1;\n    position: ${usePortal ? '' : 'absolute'};\n    pointer-events: initial;\n  `;\n\n  const Root = usePortal ? Portal : Fragment;\n  const rootProps = usePortal\n    ? portalContainer\n      ? { container: portalContainer }\n      : { className: portalClassName ?? undefined }\n    : {};\n\n  let renderedChildren: null | React.ReactNode;\n\n  if (children == null) {\n    renderedChildren = null;\n  } else if (typeof children === 'function') {\n    renderedChildren = children({\n      align: windowSafeAlign,\n      justify: windowSafeJustify,\n      referenceElPos: referenceElDocumentPos,\n    });\n  } else {\n    renderedChildren = children;\n  }\n\n  return (\n    <Transition\n      nodeRef={contentNodeRef}\n      in={active}\n      timeout={150}\n      mountOnEnter\n      unmountOnExit\n      appear\n    >\n      {state => (\n        <>\n          <div\n            ref={setPlaceholderNode}\n            className={css`\n              display: none;\n            `}\n          />\n          <Root {...rootProps}>\n            <div\n              {...rest}\n              className={cx(\n                rootPopoverStyle,\n                css(positionCSS),\n                {\n                  [css({ transform })]:\n                    state === 'entering' || state === 'exiting',\n                  [activeStyle]: state === 'entered',\n                  [css`\n                    z-index: ${popoverZIndex};\n                  `]: typeof popoverZIndex === 'number',\n                },\n                className,\n              )}\n            >\n              {/*\n                We create this inner node with a ref because placing it on its parent\n                creates an infinite loop in some cases when dynamic styles are applied.\n               */}\n              <div ref={setContentNode}>{renderedChildren}</div>\n            </div>\n          </Root>\n        </>\n      )}\n    </Transition>\n  );\n}\n\nPopover.displayName = 'Popover';\n\nPopover.propTypes = {\n  children: PropTypes.oneOfType([PropTypes.node, PropTypes.func]),\n  active: PropTypes.bool,\n  className: PropTypes.string,\n  align: PropTypes.oneOf(Object.values(Align)),\n  justify: PropTypes.oneOf(Object.values(Justify)),\n  refEl: PropTypes.shape({\n    current:\n      typeof window !== 'undefined'\n        ? PropTypes.instanceOf(Element)\n        : PropTypes.any,\n  }),\n  usePortal: PropTypes.bool,\n  portalClassName: PropTypes.string,\n  spacing: PropTypes.number,\n  adjustOnMutation: PropTypes.bool,\n};\n\nexport default Popover;\n"],"names":["_yJustifyOrigins","_xJustifyOrigins","_transformOriginMappi","_verticalJustifyRelat","_horizontalJustifyRel","_relativePositionMapp","_alignFallbacks","_justifyFallbacks","Align","Top","Bottom","Left","Right","CenterVertical","CenterHorizontal","Justify","Start","Middle","End","Fit","calculatePosition","_ref","useRelativePositioning","spacing","align","justify","_ref$referenceElViewp","referenceElViewportPos","defaultElementPosition","_ref$referenceElDocum","referenceElDocumentPos","_ref$contentElViewpor","contentElViewportPos","_ref$contentElDocumen","contentElDocumentPos","_ref$windowHeight","windowHeight","window","innerHeight","_ref$windowWidth","windowWidth","innerWidth","windowSafeCommonArgs","windowSafeAlign","windowSafeCommon","concat","_toConsumableArray","alignFallbacks","find","fallback","includes","safelyWithinVerticalWindow","top","calcTop","contentElPos","referenceElPos","contentHeight","height","safelyWithinHorizontalWindow","left","calcLeft","contentWidth","width","getWindowSafeAlign","windowSafeJustify","_justifyOptions$find","_justifyOptions$find2","justifyOptions","justifyFallbacks","getWindowSafeJustify","transformOrigin","_ref2","_alignMapping$x","_alignMapping$y","alignMapping","transformOriginMappings","x","xJustifyOrigins","y","yJustifyOrigins","getTransformOrigin","transform","transformAmount","scaleAmount","getTransform","positionCSS","_objectSpread","calcRelativePosition","calcAbsolutePosition","bottom","right","getElementDocumentPosition","element","scrollContainer","_element$getBoundingC","getBoundingClientRect","offsetHeight","offsetWidth","scrollTop","scrollLeft","_scrollContainer$getB","_window","scrollX","scrollY","getElementViewportPosition","_element$getBoundingC2","_scrollContainer$getB2","_defineProperty","verticalJustifyRelativePositions","_ref3","horizontalJustifyRelativePositions","_ref4","relativePositionMappings","constant","_ref5","justifyPositions","_ref6","_ref7","_ref8","_ref9","_ref10","_ref11","_alignMapping$constan","justifyMapping","mappingArgs","call","_ref12","_ref13","_ref14","_ref15","_ref16","_templateObject4","data","_taggedTemplateLiteral","_templateObject3","_templateObject2","_templateObject","rootPopoverStyle","css","mutationOptions","attributes","characterData","childList","subtree","Popover","_ref$active","active","_ref$spacing","_ref$align","_ref$justify","_ref$adjustOnMutation","adjustOnMutation","children","className","popoverZIndex","refEl","_ref$usePortal","usePortal","portalClassName","portalContainerProp","portalContainer","scrollContainerProp","rest","_objectWithoutProperties","_useState2","_slicedToArray","useState","placeholderNode","setPlaceholderNode","_useState4","contentNode","setContentNode","_useState6","forceUpdateCounter","setForceUpdateCounter","_usePopoverPortalCont","usePopoverPortalContainer","contentNodeRef","React","useRef","current","referenceElement","parent","parentNode","HTMLElement","viewportSize","useViewportSize","observeMutations","lastTimeRefElMutated","useMutationObserver","Date","now","lastTimeContentElMutated","useObjectDependency","useMemo","prevJustify","usePrevious","prevAlign","layoutMightHaveChanged","useIsomorphicLayoutEffect","n","_useState8","shouldRender","setShouldRender","renderedChildren","_calculatePosition","_calculatePosition$po","activeStyle","Root","Portal","Fragment","rootProps","container","undefined","___EmotionJSX","Transition","nodeRef","in","timeout","mountOnEnter","unmountOnExit","appear","state","_cx","ref","_extends","cx","displayName","propTypes","PropTypes","oneOfType","node","func","bool","string","oneOf","Object","values","shape","instanceOf","Element","any","number"],"mappings":"mkHAIIA,EAAkBC,EAAkBC,EAAuBC,EAAuBC,EAAuBC,EAAuBC,EAAiBC,ECIjJC,EAAQ,CACVC,IAAK,MACLC,OAAQ,SACRC,KAAM,OACNC,MAAO,QACPC,eAAgB,kBAChBC,iBAAkB,qBAYhBC,EAAU,CACZC,MAAO,QACPC,OAAQ,SACRC,IAAK,MACLC,IAAK,ODtBA,SAASC,EAAkBC,GAChC,IAAIC,EAAyBD,EAAKC,uBAC9BC,EAAUF,EAAKE,QACfC,EAAQH,EAAKG,MACbC,EAAUJ,EAAKI,QACfC,EAAwBL,EAAKM,uBAC7BA,OAAmD,IAA1BD,EAAmCE,EAAyBF,EACrFG,EAAwBR,EAAKS,uBAC7BA,OAAmD,IAA1BD,EAAmCD,EAAyBC,EACrFE,EAAwBV,EAAKW,qBAC7BA,OAAiD,IAA1BD,EAAmCH,EAAyBG,EACnFE,EAAwBZ,EAAKa,qBAC7BA,OAAiD,IAA1BD,EAAmCL,EAAyBK,EACnFE,EAAoBd,EAAKe,aACzBA,OAAqC,IAAtBD,EAA+BE,OAAOC,YAAcH,EACnEI,EAAmBlB,EAAKmB,YACxBA,OAAmC,IAArBD,EAA8BF,OAAOI,WAAaF,EAChEG,EAAuB,CACzBF,YAAaA,EACbJ,aAAcA,EACdT,uBAAwBA,EACxBK,qBAAsBA,EACtBT,QAASA,GAEPoB,EAkbN,SAA4BnB,EAAOoB,GACjC,IAAIrB,EAAUqB,EAAiBrB,QAC3BiB,EAAcI,EAAiBJ,YAC/BJ,EAAeQ,EAAiBR,aAChCJ,EAAuBY,EAAiBZ,qBACxCL,EAAyBiB,EAAiBjB,uBAE9C,MADmB,CAACH,GAAOqB,OAAOC,EAAmBC,EAAevB,KAChDwB,MAAK,SAAUC,GAEjC,MAAI,CAACzC,EAAMC,IAAKD,EAAME,OAAQF,EAAMK,gBAAgBqC,SAASD,GAOpDE,EAA2B,CAChCC,IAPQC,EAAQ,CAChB7B,MAAOyB,EACPK,aAActB,EACduB,eAAgB5B,EAChBJ,QAASA,IAITa,aAAcA,EACdoB,cAAexB,EAAqByB,WAIpC,CAACjD,EAAMG,KAAMH,EAAMI,MAAOJ,EAAMM,kBAAkBoC,SAASD,IAOtDS,EAA6B,CAClCC,KAPSC,EAAS,CAClBpC,MAAOyB,EACPK,aAActB,EACduB,eAAgB5B,EAChBJ,QAASA,IAITiB,YAAaA,EACbqB,aAAc7B,EAAqB8B,YAKnCtC,EAxdgBuC,CAAmBvC,EAAOkB,GAC5CsB,EA8dN,SAA8BvC,EAASD,EAAOoB,GAC5C,IAAIqB,EAAsBC,EAEtB3C,EAAUqB,EAAiBrB,QAC3BiB,EAAcI,EAAiBJ,YAC/BJ,EAAeQ,EAAiBR,aAChCJ,EAAuBY,EAAiBZ,qBACxCL,EAAyBiB,EAAiBjB,uBAC1CwC,EAAiB,CAAC1C,GAASoB,OAAOC,EAAmBsB,EAAiB3C,KAE1E,OAAQD,GACN,KAAKhB,EAAMC,IACX,KAAKD,EAAME,OACX,KAAKF,EAAMK,eACT,OAYQ,QAZAoD,EAAuBE,EAAenB,MAAK,SAAUC,GAC3D,OAAOS,EAA6B,CAClCG,aAAcZ,IAAalC,EAAQI,IAAMQ,EAAuBmC,MAAQ9B,EAAqB8B,MAC7FtB,YAAaA,EACbmB,KAAMC,EAAS,CACbN,aAActB,EACduB,eAAgB5B,EAChBJ,QAASA,EACTC,MAAOA,EACPC,QAASwB,gBAG0B,IAAzBgB,EAAkCA,EAAuBG,EAAiB3C,GAAS,GAErG,KAAKjB,EAAMG,KACX,KAAKH,EAAMI,MACX,KAAKJ,EAAMM,iBACT,OAYQ,QAZAoD,EAAwBC,EAAenB,MAAK,SAAUC,GAC5D,OAAOE,EAA2B,CAChCK,cAAeP,IAAalC,EAAQI,IAAMQ,EAAuB8B,OAASzB,EAAqByB,OAC/FrB,aAAcA,EACdgB,IAAKC,EAAQ,CACXC,aAActB,EACduB,eAAgB5B,EAChBJ,QAASA,EACTC,MAAOA,EACPC,QAASwB,gBAG2B,IAA1BiB,EAAmCA,EAAwBE,EAAiB3C,GAAS,IAzgBjF4C,CAAqB5C,EAASkB,EAAiBD,GACnE4B,EAuJN,SAA4BC,GAC1B,IAAIC,EAAiBC,EAEjBjD,EAAQ+C,EAAM/C,MACdC,EAAU8C,EAAM9C,QAChBiD,EAAeC,EAAwBnD,GACvCoD,EAA2C,QAAtCJ,EAAkBE,EAAaE,SAAmC,IAApBJ,EAA6BA,EAAkBK,EAAgBpD,GAClHqD,EAA2C,QAAtCL,EAAkBC,EAAaI,SAAmC,IAApBL,EAA6BA,EAAkBM,EAAgBtD,GACtH,MAAO,GAAGoB,OAAO+B,EAAG,KAAK/B,OAAOiC,GA/JVE,CAAmB,CACvCxD,MAAOmB,EACPlB,QAASuC,IAEPiB,EA+JN,SAAsBzD,EAAO0D,GAC3B,IAAIC,EAAc,GAElB,OAAQ3D,GACN,KAAKhB,EAAMC,IACT,MAAO,kBAAkBoC,OAAOqC,EAAiB,iBAAiBrC,OAAOsC,EAAa,KAExF,KAAK3E,EAAME,OACT,MAAO,mBAAmBmC,OAAOqC,EAAiB,iBAAiBrC,OAAOsC,EAAa,KAEzF,KAAK3E,EAAMG,KACT,MAAO,eAAekC,OAAOqC,EAAiB,oBAAoBrC,OAAOsC,EAAa,KAExF,KAAK3E,EAAMI,MACT,MAAO,gBAAgBiC,OAAOqC,EAAiB,oBAAoBrC,OAAOsC,EAAa,KAEzF,KAAK3E,EAAMM,iBACX,KAAKN,EAAMK,eAET,MAAO,SAASgC,OAAOsC,EAAa,MAlLxBC,CAAazC,EAAiBpB,GAE9C,OAAID,EACK,CACLE,MAAOmB,EACPlB,QAASuC,EACTqB,YAAaC,EAAc,GAAIC,EAAqB,CAClD/D,MAAOmB,EACPlB,QAASuC,EACTlC,uBAAwBA,EACxBI,qBAAsBA,EACtBX,QAASA,IACP,CACF+C,gBAAiBA,EACjBW,UAAWA,KAKV,CACLzD,MAAOmB,EACPlB,QAASuC,EACTqB,YAAaC,EAAc,GAAIE,EAAqB,CAClDhE,MAAOmB,EACPlB,QAASuC,EACTlC,uBAAwBA,EACxBI,qBAAsBA,EACtBX,QAASA,EACTa,aAAcA,EACdI,YAAaA,IACX,CACF8B,gBAAiBA,EACjBW,UAAWA,KAIjB,IAAIrD,EAAyB,CAC3BwB,IAAK,EACLqC,OAAQ,EACR9B,KAAM,EACN+B,MAAO,EACPjC,OAAQ,EACRK,MAAO,GAEF,SAAS6B,EAA2BC,EAASC,GAClD,IAAKD,EACH,OAAOhE,EAGT,IAAIkE,EAAwBF,EAAQG,wBAChC3C,EAAM0C,EAAsB1C,IAC5BqC,EAASK,EAAsBL,OAC/B9B,EAAOmC,EAAsBnC,KAC7B+B,EAAQI,EAAsBJ,MAE9BjC,EAASmC,EAAQI,aACjBlC,EAAQ8B,EAAQK,YAEpB,GAAIJ,EAAiB,CACnB,IAAIK,EAAYL,EAAgBK,UAC5BC,EAAaN,EAAgBM,WAE7BC,EAAwBP,EAAgBE,wBAM5C,MAAO,CACL3C,IAAKA,EAAM8C,EANGE,EAAsBhD,IAOpCqC,OAAQA,EAASS,EANAE,EAAsBX,OAOvC9B,KAAMA,EAAOwC,EANEC,EAAsBzC,KAOrC+B,MAAOA,EAAQS,EANCC,EAAsBV,MAOtCjC,OAAQA,EACRK,MAAOA,GAIX,IAAIuC,EAAUhE,OACViE,EAAUD,EAAQC,QAClBC,EAAUF,EAAQE,QACtB,MAAO,CACLnD,IAAKA,EAAMmD,EACXd,OAAQA,EAASc,EACjB5C,KAAMA,EAAO2C,EACbZ,MAAOA,EAAQY,EACf7C,OAAQA,EACRK,MAAOA,GAIJ,SAAS0C,EAA2BZ,EAASC,GAClD,IAAKD,EACH,OAAOhE,EAGT,IAAI6E,EAAyBb,EAAQG,wBACjC3C,EAAMqD,EAAuBrD,IAC7BqC,EAASgB,EAAuBhB,OAChC9B,EAAO8C,EAAuB9C,KAC9B+B,EAAQe,EAAuBf,MAE/BjC,EAASmC,EAAQI,aACjBlC,EAAQ8B,EAAQK,YAEpB,GAAIJ,EAAiB,CACnB,IAAIa,EAAyBb,EAAgBE,wBAM7C,MAAO,CACL3C,IAAKA,EANSsD,EAAuBtD,IAOrCqC,OAAQA,EANSiB,EAAuBjB,OAOxC9B,KAAMA,EANS+C,EAAuB/C,KAOtC+B,MAAOA,EANSgB,EAAuBhB,MAOvCjC,OAAQA,EACRK,MAAOA,GAIX,MAAO,CACLV,IAAKA,EACLqC,OAAQA,EACR9B,KAAMA,EACN+B,MAAOA,EACPjC,OAAQA,EACRK,MAAOA,GAGX,IAAIiB,GAA0C4B,EAAvB3G,EAAmB,GAAsCe,EAAQC,MAAO,OAAQ2F,EAAgB3G,EAAkBe,EAAQE,OAAQ,UAAW0F,EAAgB3G,EAAkBe,EAAQG,IAAK,UAAWyF,EAAgB3G,EAAkBe,EAAQI,IAAK,UAAWnB,GACpR6E,GAA0C8B,EAAvB1G,EAAmB,GAAsCc,EAAQC,MAAO,QAAS2F,EAAgB1G,EAAkBc,EAAQE,OAAQ,UAAW0F,EAAgB1G,EAAkBc,EAAQG,IAAK,SAAUyF,EAAgB1G,EAAkBc,EAAQI,IAAK,UAAWlB,GACpR0E,GAAuDgC,EAA5BzG,EAAwB,GAA2CM,EAAMG,KAAM,CAC5GiE,EAAG,UACD+B,EAAgBzG,EAAuBM,EAAMI,MAAO,CACtDgE,EAAG,SACD+B,EAAgBzG,EAAuBM,EAAMC,IAAK,CACpDqE,EAAG,WACD6B,EAAgBzG,EAAuBM,EAAME,OAAQ,CACvDoE,EAAG,QACD6B,EAAgBzG,EAAuBM,EAAMM,iBAAkB,CACjE8D,EAAG,WACD+B,EAAgBzG,EAAuBM,EAAMK,eAAgB,CAC/DiE,EAAG,WACD5E,GAyCJ,IAAI0G,GAAgED,EAA5BxG,EAAwB,GAA2CY,EAAQC,MAAO,CACxHoC,IAAK,IACHuD,EAAgBxG,EAAuBY,EAAQG,IAAK,CACtDuE,OAAQ,IACNkB,EAAgBxG,EAAuBY,EAAQE,QAAQ,SAAU4F,GACnE,IAAI3E,EAAuB2E,EAAM3E,qBAC7BJ,EAAyB+E,EAAM/E,uBACnC,MAAO,CACLsB,IAAK,GAAGP,OAAOf,EAAuB2B,OAAS,EAAIvB,EAAqBuB,OAAS,EAAG,UAEpFkD,EAAgBxG,EAAuBY,EAAQI,IAAK,CACtDiC,IAAK,EACLqC,OAAQ,IACNtF,GAMA2G,GAAkEH,EAA5BvG,EAAwB,GAA2CW,EAAQC,MAAO,CAC1H2C,KAAM,IACJgD,EAAgBvG,EAAuBW,EAAQG,IAAK,CACtDwE,MAAO,IACLiB,EAAgBvG,EAAuBW,EAAQE,QAAQ,SAAU8F,GACnE,IAAI7E,EAAuB6E,EAAM7E,qBAC7BJ,EAAyBiF,EAAMjF,uBACnC,MAAO,CACL6B,KAAM,GAAGd,OAAOf,EAAuBgC,MAAQ,EAAI5B,EAAqB4B,MAAQ,EAAG,UAEnF6C,EAAgBvG,EAAuBW,EAAQI,IAAK,CACtDwC,KAAM,EACN+B,MAAO,IACLtF,GACA4G,GAAwDL,EAA5BtG,EAAwB,GAA2CG,EAAMC,IAAK,CAC5GwG,SAAU,SAAkBC,GAC1B,IAAI3F,EAAU2F,EAAM3F,QACpB,MAAO,CACLkE,OAAQ,eAAe5C,OAAOtB,EAAS,SAG3C4F,iBAAkBL,IAChBH,EAAgBtG,EAAuBG,EAAME,OAAQ,CACvDuG,SAAU,SAAkBG,GAC1B,IAAI7F,EAAU6F,EAAM7F,QACpB,MAAO,CACL6B,IAAK,eAAeP,OAAOtB,EAAS,SAGxC4F,iBAAkBL,IAChBH,EAAgBtG,EAAuBG,EAAMK,eAAgB,CAC/DoG,SAAU,SAAkBI,GAC1B,IAAIvF,EAAyBuF,EAAMvF,uBACnC,MAAO,CACLsB,IAAK,QAAQP,OAAOf,EAAuB2B,OAAS,EAAG,eAG3D0D,iBAAkBL,IAChBH,EAAgBtG,EAAuBG,EAAMG,KAAM,CACrDsG,SAAU,SAAkBK,GAC1B,IAAI/F,EAAU+F,EAAM/F,QACpB,MAAO,CACLmE,MAAO,eAAe7C,OAAOtB,EAAS,SAG1C4F,iBAAkBP,IAChBD,EAAgBtG,EAAuBG,EAAMI,MAAO,CACtDqG,SAAU,SAAkBM,GAC1B,IAAIhG,EAAUgG,EAAMhG,QACpB,MAAO,CACLoC,KAAM,eAAed,OAAOtB,EAAS,SAGzC4F,iBAAkBP,IAChBD,EAAgBtG,EAAuBG,EAAMM,iBAAkB,CACjEmG,SAAU,SAAkBO,GAC1B,IAAI1F,EAAyB0F,EAAO1F,uBACpC,MAAO,CACL6B,KAAM,QAAQd,OAAOf,EAAuBgC,MAAQ,EAAG,eAG3DqD,iBAAkBP,IAChBvG,GAEJ,SAASkF,EAAqBkC,GAC5B,IAAIC,EAEAlG,EAAQiG,EAAOjG,MACfC,EAAUgG,EAAOhG,QACjBK,EAAyB2F,EAAO3F,uBAChCI,EAAuBuF,EAAOvF,qBAC9BX,EAAUkG,EAAOlG,QACjBmD,EAAesC,EAAyBxF,GACxCmG,EAAiBjD,EAAayC,iBAAiB1F,GAC/CmG,EAAc,CAChB1F,qBAAsBA,EACtBJ,uBAAwBA,EACxBP,QAASA,GAEX,OAAO+D,EAAc,GAAwD,QAAnDoC,EAAwBhD,EAAauC,gBAAgD,IAA1BS,OAAmC,EAASA,EAAsBG,KAAKnD,EAAckD,GAAc,GAA8B,mBAAnBD,EAAgCA,EAAeC,GAAeD,GAGnQ,SAASnC,EAAqBsC,GAC5B,IAAItG,EAAQsG,EAAOtG,MACfC,EAAUqG,EAAOrG,QACjBK,EAAyBgG,EAAOhG,uBAChCI,EAAuB4F,EAAO5F,qBAC9BX,EAAUuG,EAAOvG,QACjBiB,EAAcsF,EAAOtF,YACrBJ,EAAe0F,EAAO1F,aACtBuB,EAAO,GAAGd,OAAOe,EAAS,CAC5BpC,MAAOA,EACPC,QAASA,EACT8B,eAAgBzB,EAChBwB,aAAcpB,EACdX,QAASA,IACP,MACA6B,EAAM,GAAGP,OAAOQ,EAAQ,CAC1B7B,MAAOA,EACPC,QAASA,EACT8B,eAAgBzB,EAChBwB,aAAcpB,EACdX,QAASA,IACP,MAEJ,OAAIE,IAAYV,EAAQI,IACf,CACLwC,KAAMA,EACNP,IAAKA,GAIL,CAAC5C,EAAMG,KAAMH,EAAMI,MAAOJ,EAAMM,kBAAkBoC,SAAS1B,GACtD,CACLmC,KAAMA,EACNP,IAAKA,EACLqC,OAAQ,GAAG5C,OAAOT,EAAeN,EAAuB2D,OAAQ,OAI7D,CACL9B,KAAMA,EACNP,IAAKA,EACLsC,MAAO,GAAG7C,OAAOL,EAAcV,EAAuB4D,MAAO,OAKjE,SAASrC,EAAQ0E,GACf,IAAIvG,EAAQuG,EAAOvG,MACfC,EAAUsG,EAAOtG,QACjB6B,EAAeyE,EAAOzE,aACtBC,EAAiBwE,EAAOxE,eACxBhC,EAAUwG,EAAOxG,QAErB,OAAQC,GACN,KAAKhB,EAAMG,KACX,KAAKH,EAAMI,MACX,KAAKJ,EAAMM,iBACT,OAAQW,GACN,KAAKV,EAAQC,MACb,KAAKD,EAAQI,IACX,OAAOoC,EAAeH,IAExB,KAAKrC,EAAQG,IACX,OAAOqC,EAAeH,IAAMG,EAAeE,OAASH,EAAaG,OAEnE,KAAK1C,EAAQE,OACb,QACE,OAAOsC,EAAeH,KAAOE,EAAaG,OAASF,EAAeE,QAAU,EAGlF,KAAKjD,EAAMK,eACT,OAAO0C,EAAeH,KAAOE,EAAaG,OAASF,EAAeE,QAAU,EAE9E,KAAKjD,EAAMC,IACT,OAAO8C,EAAeH,IAAME,EAAaG,OAASlC,EAEpD,KAAKf,EAAME,OACX,QACE,OAAO6C,EAAeH,IAAMG,EAAeE,OAASlC,GAK1D,SAASqC,EAASoE,GAChB,IAAIxG,EAAQwG,EAAOxG,MACfC,EAAUuG,EAAOvG,QACjB6B,EAAe0E,EAAO1E,aACtBC,EAAiByE,EAAOzE,eACxBhC,EAAUyG,EAAOzG,QAErB,OAAQC,GACN,KAAKhB,EAAMC,IACX,KAAKD,EAAME,OACX,KAAKF,EAAMK,eACT,OAAQY,GACN,KAAKV,EAAQG,IACX,OAAOqC,EAAeI,KAAOJ,EAAeO,MAAQR,EAAaQ,MAEnE,KAAK/C,EAAQE,OACX,OAAOsC,EAAeI,MAAQL,EAAaQ,MAAQP,EAAeO,OAAS,EAE7E,KAAK/C,EAAQC,MACb,KAAKD,EAAQI,IACb,QACE,OAAOoC,EAAeI,KAG5B,KAAKnD,EAAMG,KACT,OAAO4C,EAAeI,KAAOL,EAAaQ,MAAQvC,EAEpD,KAAKf,EAAMI,MACT,OAAO2C,EAAeI,KAAOJ,EAAeO,MAAQvC,EAEtD,KAAKf,EAAMM,iBACX,QACE,OAAOyC,EAAeI,MAAQL,EAAaQ,MAAQP,EAAeO,OAAS,GAKjF,SAASJ,EAA6BuE,GACpC,IAAItE,EAAOsE,EAAOtE,KACdnB,EAAcyF,EAAOzF,YACrBqB,EAAeoE,EAAOpE,aAE1B,OAAOF,GAAQ,KADDA,EAAOE,EAAerB,GAKtC,SAASW,EAA2B+E,GAClC,IAAI9E,EAAM8E,EAAO9E,IACbhB,EAAe8F,EAAO9F,aACtBoB,EAAgB0E,EAAO1E,cAE3B,OAAOJ,GAAO,KADAA,EAAMI,EAAgBpB,GAItC,IAAIW,GAAwC4D,EAAtBrG,EAAkB,GAAqCE,EAAMC,IAAK,CAACD,EAAME,SAAUiG,EAAgBrG,EAAiBE,EAAME,OAAQ,CAACF,EAAMC,MAAOkG,EAAgBrG,EAAiBE,EAAMG,KAAM,CAACH,EAAMI,QAAS+F,EAAgBrG,EAAiBE,EAAMI,MAAO,CAACJ,EAAMG,OAAQgG,EAAgBrG,EAAiBE,EAAMM,iBAAkB,CAACN,EAAMG,KAAMH,EAAMI,QAAS+F,EAAgBrG,EAAiBE,EAAMK,eAAgB,CAACL,EAAMC,IAAKD,EAAME,SAAUJ,GA6Cxc,IAAI8D,GAA4CuC,EAAxBpG,EAAoB,GAAuCQ,EAAQC,MAAO,CAACD,EAAQG,IAAKH,EAAQE,SAAU0F,EAAgBpG,EAAmBQ,EAAQE,OAAQ,CAACF,EAAQG,IAAKH,EAAQC,QAAS2F,EAAgBpG,EAAmBQ,EAAQG,IAAK,CAACH,EAAQC,MAAOD,EAAQE,SAAU0F,EAAgBpG,EAAmBQ,EAAQI,IAAK,CAACJ,EAAQE,OAAQF,EAAQC,MAAOD,EAAQG,MAAOX,GErfrY,SAAS4H,IACP,IAAIC,EAAOC,EAAuB,CAAC,kCAAmC,0BAMtE,OAJAF,EAAmB,WACjB,OAAOC,GAGFA,EAGT,SAASE,IACP,IAAIF,EAAOC,EAAuB,CAAC,iDAMnC,OAJAC,EAAmB,WACjB,OAAOF,GAGFA,EAGT,SAASG,IACP,IAAIH,EAAOC,EAAuB,CAAC,oCAAqC,wCAMxE,OAJAE,EAAmB,WACjB,OAAOH,GAGFA,EAGT,SAASI,KACP,IAAIJ,EAAOC,EAAuB,CAAC,oHAMnC,OAJAG,GAAkB,WAChB,OAAOJ,GAGFA,EAaT,IAAIK,GAAmBC,MAAIF,MACvBG,GAAkB,CAEpBC,YAAY,EAEZC,eAAe,EAEfC,WAAW,EAEXC,SAAS,GA2BX,SAASC,GAAQ3H,GACf,IAAI4H,EAAc5H,EAAK6H,OACnBA,OAAyB,IAAhBD,GAAiCA,EAC1CE,EAAe9H,EAAKE,QACpBA,OAA2B,IAAjB4H,EAA0B,GAAKA,EACzCC,EAAa/H,EAAKG,MAClBA,OAAuB,IAAf4H,EAAwB5I,EAAME,OAAS0I,EAC/CC,EAAehI,EAAKI,QACpBA,OAA2B,IAAjB4H,EAA0BtI,EAAQC,MAAQqI,EACpDC,EAAwBjI,EAAKkI,iBAC7BA,OAA6C,IAA1BD,GAA2CA,EAC9DE,EAAWnI,EAAKmI,SAChBC,EAAYpI,EAAKoI,UACjBC,EAAgBrI,EAAKqI,cACrBC,EAAQtI,EAAKsI,MACbC,EAAiBvI,EAAKwI,UACtBA,OAA+B,IAAnBD,GAAmCA,EAC/CE,EAAkBzI,EAAKyI,gBACvBC,EAAsB1I,EAAK2I,gBAC3BC,EAAsB5I,EAAKwE,gBAC3BqE,EAAOC,EAAyB9I,EAAM,CAAC,SAAU,UAAW,QAAS,UAAW,mBAAoB,WAAY,YAAa,gBAAiB,QAAS,YAAa,kBAAmB,kBAAmB,oBAG1M+I,EAAaC,EADDC,WAAS,MACkB,GACvCC,EAAkBH,EAAW,GAC7BI,EAAqBJ,EAAW,GAGhCK,EAAaJ,EADAC,WAAS,MACkB,GACxCI,EAAcD,EAAW,GACzBE,EAAiBF,EAAW,GAG5BG,EAAaP,EADAC,WAAS,GACkB,GACxCO,EAAqBD,EAAW,GAChCE,EAAwBF,EAAW,GAEnCG,EAAwBC,8BACxBhB,EAAkBe,EAAsBf,gBACxCnE,EAAkBkF,EAAsBlF,gBAE5CmE,EAAkBD,GAAuBC,EACzCnE,EAAkBoE,GAAuBpE,EAKzC,IAAIoF,EAAiBC,UAAMC,OAAOT,GAClCO,EAAeG,QAAUV,EACzB,IAAIW,GAAmB,KAEvB,GAAI1B,GAASA,EAAMyB,QACjBC,GAAmB1B,EAAMyB,aACpB,GAAIb,EAAiB,CAC1B,IAAIe,GAASf,EAAgBgB,WAEzBD,IAAUA,cAAkBE,cAC9BH,GAAmBC,IAIvB,IAAIG,GAAeC,oBAGfC,GAAmBpC,GAAoBL,EACvC0C,GAAuBC,sBAAoBR,GAAkB1C,GAAiBmD,KAAKC,IAAKJ,IACxFK,GAA2BH,sBAAoBnB,EAAa/B,GAAiBmD,KAAKC,IAAKJ,IAEvFhK,GAAyBsK,sBAAoBzF,EAA2B6E,GAAkBxF,IAC1F7D,GAAuBiK,sBAAoBzF,EAA2BkE,EAAa7E,IACnF/D,GAAyBmK,sBAAoBC,WAAQ,WACvD,OAAOvG,EAA2B0F,GAAkBxF,KAEtD,CAACwF,GAAkBxF,EAAiB4F,GAAcG,GAAsB1C,EAAQ1H,EAAOC,EAASoJ,KAC5F3I,GAAuB+J,sBAAoBC,WAAQ,WACrD,OAAOvG,EAA2B+E,KAEpC,CAACA,EAAae,GAAcO,GAA0B9C,EAAQ1H,EAAOC,EAASoJ,KAC1EsB,GAAcC,cAAY3K,GAC1B4K,GAAYD,cAAY5K,GACxB8K,GAAyBH,KAAgB1K,IAAYA,IAAYV,EAAQI,KAAOgL,KAAgBpL,EAAQI,MAAQkL,KAAc7K,GAASC,IAAYV,EAAQI,IAC/JoL,6BAA0B,WAKpBD,IACFxB,GAAsB,SAAU0B,GAC9B,OAAOA,EAAI,OAGd,CAACF,KAGJ,IACIG,GAAapC,EADAC,YAAS,GACkB,GACxCoC,GAAeD,GAAW,GAC1BE,GAAkBF,GAAW,GAMjC,GAJAF,6BAA0B,WACxB,OAAOI,IAAgB,KACtB,KAEED,GACH,OAAO,KAGT,IAuBIE,GAvBAC,GAAqBzL,EAAkB,CACzCE,wBAAyBuI,EACzBtI,QAASA,EACTC,MAAOA,EACPC,QAASA,EACTE,uBAAwBA,GACxBG,uBAAwBA,GACxBE,qBAAsBA,GACtBE,qBAAsBA,KAEpBS,GAAkBkK,GAAmBrL,MACrCwC,GAAoB6I,GAAmBpL,QACvCqL,GAAwBD,GAAmBxH,YAC3CJ,GAAY6H,GAAsB7H,UAClCI,GAAc8E,EAAyB2C,GAAuB,CAAC,cAE/DC,GAAcrE,MAAIH,IAAoBsB,EAAY,GAAK,YACvDmD,GAAOnD,EAAYoD,UAASC,WAC5BC,GAAYtD,EAAYG,EAAkB,CAC5CoD,UAAWpD,GACT,CACFP,UAAWK,MAAAA,EAAyDA,OAAkBuD,GACpF,GAeJ,OAXET,GADc,MAAZpD,EACiB,KACU,mBAAbA,EACGA,EAAS,CAC1BhI,MAAOmB,GACPlB,QAASuC,GACTT,eAAgBzB,KAGC0H,EAGd8D,MAAcC,aAAY,CAC/BC,QAASvC,EACTwC,GAAIvE,EACJwE,QAAS,IACTC,cAAc,EACdC,eAAe,EACfC,QAAQ,IACP,SAAUC,GACX,IAAIC,EAEJ,OAAOT,MAAcpC,UAAMgC,SAAU,KAAMI,MAAc,MAAO,CAC9DU,IAAKxD,EACLf,UAAWf,MAAIJ,OACbgF,MAAcN,GAAMG,GAAWG,MAAc,MAAOW,EAAS,GAAI/D,EAAM,CACzET,UAAWyE,KAAGzF,GAAkBC,MAAIrD,KAAe0I,EAAM,GAAIpH,EAAgBoH,EAAKrF,MAAI,CACpFzD,UAAWA,KACC,aAAV6I,GAAkC,YAAVA,GAAsBnH,EAAgBoH,EAAKhB,GAAuB,YAAVe,GAAsBnH,EAAgBoH,EAAKrF,MAAIP,IAAoBuB,GAAyC,iBAAlBA,GAA6BqE,GAAMtE,KAC/M6D,MAAc,MAAO,CACvBU,IAAKrD,GACJiC,UAIP5D,GAAQmF,YAAc,UACtBnF,GAAQoF,UAAY,CAClB5E,SAAU6E,UAAUC,UAAU,CAACD,UAAUE,KAAMF,UAAUG,OACzDtF,OAAQmF,UAAUI,KAClBhF,UAAW4E,UAAUK,OACrBlN,MAAO6M,UAAUM,MAAMC,OAAOC,OAAOrO,IACrCiB,QAAS4M,UAAUM,MAAMC,OAAOC,OAAO9N,IACvC4I,MAAO0E,UAAUS,MAAM,CACrB1D,QAA2B,oBAAX/I,OAAyBgM,UAAUU,WAAWC,SAAWX,UAAUY,MAErFpF,UAAWwE,UAAUI,KACrB3E,gBAAiBuE,UAAUK,OAC3BnN,QAAS8M,UAAUa,OACnB3F,iBAAkB8E,UAAUI"}