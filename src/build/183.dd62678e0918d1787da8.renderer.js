"use strict";(global.webpackChunkMongoDBCompass=global.webpackChunkMongoDBCompass||[]).push([[183],{38183:(e,t,o)=>{o.r(t),o.d(t,{CompassShell:()=>B,default:()=>L});var n=o(2784),i=o(13980),s=o.n(i),r=o(59337),a=o(72379),l=o(50517);const c=(0,l.css)({td:{padding:0}}),h=[{key:"Ctrl+`",description:"Toggle shell."},{key:"Ctrl+A",description:"Moves the cursor to the beginning of the line."},{key:"Ctrl+B",description:"Moves the cursor Backward one character."},{key:"Ctrl+C",description:"Stop currently running command."},{key:"Ctrl+D",description:"Deletes the next character."},{key:"Ctrl+E",description:"Moves the cursor to the end of the line."},{key:"Ctrl+F",description:"Moves the cursor Forward one character."},{key:"Ctrl+H",description:"Erases one character, similar to hitting backspace."},{key:"Ctrl/Cmd+L",description:"Clears the screen, similar to the clear command."},{key:"Ctrl+T",description:"Swap the last two characters before the cursor."},{key:"Ctrl+U",description:"Changes the line to Uppercase."},{key:"↑",description:"Cycle backwards through command history."},{key:"↓",description:"Cycle forwards through command history."}];function d(){return n.createElement(l.Table,{data:h,columns:[n.createElement(l.TableHeader,{key:"name",label:"Key"}),n.createElement(l.TableHeader,{key:"value",label:"Description"})]},(({datum:e})=>n.createElement(l.Row,{className:c,key:e.key},n.createElement(l.Cell,null,n.createElement(l.Body,{weight:"medium"},e.key)),n.createElement(l.Cell,null,n.createElement(l.Description,null,e.description)))))}const p=`v${o(49245).dependencies["@mongosh/browser-repl"].replace("^","")}`,m=(0,l.css)({padding:"initial"}),u=(0,l.css)({marginTop:l.spacing[2],maxHeight:"50vh",overflow:"auto"}),g=(0,l.css)({marginTop:l.spacing[4]}),y=(0,l.css)({padding:l.spacing[5]});function f({hideInfoModal:e,show:t}){const o=(0,n.useCallback)((t=>{t||e()}),[e]);return n.createElement(l.Modal,{open:t,trackingId:"shell_info_modal",setOpen:o,contentClassName:m},n.createElement("div",{className:y},n.createElement(l.ModalTitle,null,"mongosh ",p),n.createElement(l.Banner,null,"For more information please visit the ",n.createElement(l.Link,{id:"mongosh-info-link",href:"https://docs.mongodb.com/compass/beta/embedded-shell/",target:"_blank"},"MongoDB Shell Documentation"),"."),n.createElement(l.Subtitle,{className:g},"Keyboard Shortcuts"),n.createElement("div",{className:u},n.createElement(d,null))),n.createElement(l.ModalFooter,null,n.createElement(l.Button,{onClick:e},"Close")))}f.propTypes={hideInfoModal:s().func.isRequired,show:s().bool.isRequired};const C=f,b=(0,l.css)({height:l.spacing[5],display:"flex",color:l.uiColors.gray.light1}),k=(0,l.css)({flexGrow:1,display:"flex",alignItems:"center"}),E=l.uiColors.gray.light1,S=l.uiColors.gray.base,v=l.uiColors.gray.light2,w=l.keyframes`
  0% { color: ${E}; }
  10% { color: ${S}; }
  20% { color: ${v}; }
  30% { color: ${S}; }
  40% { color: ${v}; }
  50% { color: ${S}; }
  60% { color: ${v}; }
  70% { color: ${S}; }
  80% { color: ${v}; }
  100% { color: ${E}; }
`,O=(0,l.css)({background:"none",border:"none",cursor:"pointer",color:E,padding:`0px ${l.spacing[2]}px`,height:"100%",display:"flex",verticalAlign:"middle",flexDirection:"row",alignItems:"center",margin:"auto 0",fontWeight:"bold",fontSize:1.5*l.spacing[2],lineHeight:`${l.spacing[5]}px`,transition:"all 200ms",userSelect:"none",textTransform:"uppercase",animation:`${w} 2s linear`,"&:hover":{color:l.uiColors.gray.light3}}),x=(0,l.css)({display:"flex",paddingTop:l.spacing[1]/2,paddingRight:l.spacing[2]}),M=(0,l.css)({marginRight:l.spacing[2]}),I=(0,l.css)({color:l.uiColors.green.light2,marginLeft:l.spacing[2]});class H extends n.Component{static propTypes={isExpanded:s().bool.isRequired,isOperationInProgress:s().bool.isRequired,onShellToggleClicked:s().func.isRequired,showInfoModal:s().func.isRequired};componentDidMount(){document.addEventListener("keydown",this.handleKeyboardToggle.bind(this))}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyboardToggle.bind(this))}handleKeyboardToggle({ctrlKey:e,key:t}){e&&"`"===t&&this.props.onShellToggleClicked()}render(){const{isExpanded:e,isOperationInProgress:t,onShellToggleClicked:o,showInfoModal:i}=this.props;return n.createElement("div",{className:b},n.createElement("div",{className:k},n.createElement("button",{"data-test-id":"shell-expand-button",className:O,"aria-label":e?"Close Shell":"Open Shell",onClick:o,"aria-pressed":e},">_MONGOSH",!e&&t&&n.createElement("span",{className:I},n.createElement(a.ShellLoader,{size:"12px"})," Command in progress…"))),n.createElement("div",{className:x},e&&n.createElement(l.IconButton,{className:M,variant:"dark","aria-label":"Shell Info","aria-haspopup":"dialog",onClick:i},n.createElement(l.Icon,{glyph:"InfoWithCircle",size:"small"})),n.createElement(l.IconButton,{variant:"dark","aria-label":e?"Close Shell":"Open Shell",onClick:o,"aria-pressed":e},n.createElement(l.Icon,{glyph:e?"ChevronDown":"ChevronUp",size:"small"}))))}}const R=H,T=(0,l.css)({backgroundColor:l.uiColors.gray.dark3,display:"flex",flexBasis:"auto",position:"relative",flexDirection:"column",maxHeight:"95%"}),D=(0,l.css)({flexGrow:1,display:"none",overflow:"auto",borderTop:`1px solid ${l.uiColors.gray.dark2}`,"*::-webkit-scrollbar-thumb":{background:"rgba(180, 180, 180, 0.5)"}}),$=(0,l.css)({display:"flex"}),N=100;function P(){return Math.max(240,window.innerHeight-100)}class B extends n.Component{static propTypes={emitShellPluginOpened:s().func,runtime:s().object,shellOutput:s().array,historyStorage:s().object};static defaultProps={emitShellPluginOpened:()=>{},runtime:null};constructor(e){super(e),this.shellRef=n.createRef(),this.shellOutput=this.props.shellOutput||[],this.state={height:32,prevHeight:240,initialHistory:this.props.historyStorage?null:[],isOperationInProgress:!1,showInfoModal:!1}}componentDidMount(){this.loadHistory(),window.addEventListener("beforeunload",this.terminateRuntime)}componentDidUpdate(e,t){const{height:o}=this.state;t.height<N&&o>N&&this.props.emitShellPluginOpened()}componentWillUnmount(){window.removeEventListener("beforeunload",this.terminateRuntime)}onShellOutputChanged=e=>{this.shellOutput=e};onOperationStarted=()=>{this.setState({isOperationInProgress:!0})};onOperationEnd=()=>{this.setState({isOperationInProgress:!1})};terminateRuntime=()=>{this.props.runtime&&this.props.runtime.terminate()};saveHistory=async e=>{if(this.props.historyStorage)try{await this.props.historyStorage.save(e)}catch(e){console.error(e)}};loadHistory=async()=>{if(this.props.historyStorage)try{const e=await this.props.historyStorage.load();this.setState({initialHistory:e})}catch(e){console.error(e),this.setState({initialHistory:[]})}};updateHeight(e){this.setState(e>N?{height:e,prevHeight:e}:{height:e})}hideInfoModal(){this.setState({showInfoModal:!1}),this.shellRef.current&&this.shellRef.current.focusEditor()}render(){const{height:e,prevHeight:t,isOperationInProgress:o,showInfoModal:i}=this.state;if(!this.props.runtime||!this.state.initialHistory)return n.createElement("div",null);const s=e>N,r=s?function(e){const t=P();return Math.min(t,Math.max(N,e))}(e):32;return n.createElement(n.Fragment,null,n.createElement(C,{show:i,hideInfoModal:this.hideInfoModal.bind(this)}),n.createElement("div",{"data-test-id":"shell-section",className:T,style:{height:r},id:"content"},n.createElement(l.ResizeHandle,{direction:l.ResizeDirection.TOP,onChange:e=>this.updateHeight(e),value:e,minValue:32,maxValue:P(),title:"MongoDB Shell"}),n.createElement(R,{isExpanded:s,onShellToggleClicked:()=>s?this.updateHeight(32):this.updateHeight(t),isOperationInProgress:o,showInfoModal:()=>this.setState({showInfoModal:!0})}),n.createElement("div",{"data-test-id":"shell-content",className:(0,l.cx)(D,{[$]:s})},n.createElement(a.Shell,{ref:this.shellRef,runtime:this.props.runtime,initialHistory:this.state.initialHistory,initialOutput:this.shellOutput,onHistoryChanged:this.saveHistory,onOutputChanged:this.onShellOutputChanged,onOperationStarted:this.onOperationStarted,onOperationEnd:this.onOperationEnd}))))}}const L=(0,r.$j)((e=>({emitShellPluginOpened:()=>{e.appRegistry&&e.appRegistry.globalAppRegistry&&e.appRegistry.globalAppRegistry.emit("compass:compass-shell:opened")},runtime:e.runtime?e.runtime.runtime:null})))(B)}}]);