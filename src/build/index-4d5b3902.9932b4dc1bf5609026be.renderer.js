(global.webpackChunkMongoDBCompass=global.webpackChunkMongoDBCompass||[]).push([[796],{62106:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});const s={"instance-error":"instance-module-instance-error__2FUrC"}},65005:(e,t,n)=>{"use strict";n.r(t)},51387:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>yn,configureStore:()=>cn,deactivate:()=>fn,default:()=>vn,metadata:()=>mn});var s=n(2784),a=n(16435),i=n(13980),r=n.n(i),o=n(70602);const l="indexes/is-writable/WRITE_STATE_CHANGED",c=e=>({type:l,isWritable:e}),d="indexes/description/GET_DESCRIPTION",p="Topology type not yet discovered.",u=e=>({type:d,description:e}),m="indexes/data-service/DATA_SERVICE_CONNECTED";function h(e=null,t){return t.type===m?t.dataService:e}const g=e=>({type:m,dataService:e});var b=n(64755),y=n.n(b),f=n(79343),v=n.n(f),E=n(54954),S=n.n(E);const x="indexes/error/HANDLE_ERROR",w="indexes/error/CLEAR_ERROR",C=null;function k(e=null,t){return t.type===x?t.error:t.type===w?null:e}const N=e=>({type:x,error:e}),_=()=>({type:w});var T=n(39752),A=n.n(T);const R=n(14069)("mongodb-compass:modules:indexes"),O="indexes/indexes/LOAD_INDEXES",D="indexes/indexes/SORT_INDEXES",P="Name and Definition",I="fa-sort-asc",L="fa-sort-desc",j=[],M=(e,t)=>{const n=t===I?1:-1;return"properties"===e?(e=>function(t,n){const s="compound"===t.cardinality?"compound":t.properties[0]||"",a="compound"===n.cardinality?"compound":n.properties[0]||"";return s>a?e:s<a?-e:0})(n):function(t,s){return t[e]>s[e]?n:t[e]<s[e]?-n:0}},q=e=>e===P?"name":"Usage"===e?"usageCount":e.toLowerCase(),F=e=>"string"==typeof e.message?e.message:"string"==typeof e.errmsg?e.errmsg:"Unknown error",V=e=>({type:O,indexes:e}),B=()=>(e,t)=>{const n=t();if(n.isReadonly)e(V([])),e((0,T.localAppRegistryEmit)("indexes-changed",[]));else if(n.dataService&&n.dataService.isConnected()){const t=n.namespace;n.dataService.indexes(n.namespace,{},((s,a)=>{if(s)e(N(F(s))),e(V([])),e((0,T.localAppRegistryEmit)("indexes-changed",[]));else{for(const e of a)e.ns=t;const s=((e,t,n)=>(e=>{const t=S()(e.map((e=>e.size)));return v()(e,(e=>{const n=new(y())((new(y())).parse(e));return n.relativeSize=n.size/t*100,n}))})(e).sort(M(q(t),n)))(a,n.sortColumn,n.sortOrder);e(V(s)),e((0,T.localAppRegistryEmit)("indexes-changed",s))}}))}else n.dataService&&!n.dataService.isConnected()&&R("warning: trying to load indexes but dataService is disconnected",n.dataService)},U="indexes/reset",H=()=>({type:U}),$="indexes/drop-index/name/CHANGE_NAME",z=e=>({type:$,name:e}),G=navigator.userAgent.toLowerCase(),Q=e=>()=>{if(G.indexOf("electron")>-1){const{shell:t}=n(72298);t.openExternal(e)}else window.open(e,"_new")};class W extends s.PureComponent{static displayName="CreateIndexButton";static propTypes={localAppRegistry:r().object.isRequired};constructor(e){super(e),this.TextWriteButton=global.hadronApp.appRegistry.getComponent("DeploymentAwareness.TextWriteButton")}clickCreateHandler(e){e.preventDefault(),e.stopPropagation(),this.props.localAppRegistry.emit("toggle-create-index-modal",!0)}render(){return s.createElement("div",{className:"create-index-btn action-bar"},s.createElement(this.TextWriteButton,{className:"btn btn-primary btn-xs",dataTestId:"open-create-index-modal-button",isCollectionLevel:!0,text:"Create Index",tooltipId:"index-is-not-writable",clickHandler:this.clickCreateHandler.bind(this)}))}}const K=W;var Z=n(72779),X=n.n(Z);const Y={"index-header-column-sort":"index-header-column-module-index-header-column-sort__3omAs","index-header-column":"index-header-column-module-index-header-column__2yWFJ","index-header-column-active":"index-header-column-module-index-header-column-active__1Nfe6"};class J extends s.PureComponent{static displayName="IndexHeaderColumn";static propTypes={indexes:r().array.isRequired,sortOrder:r().string.isRequired,sortColumn:r().string.isRequired,dataTestId:r().string.isRequired,name:r().string.isRequired,sortIndexes:r().func.isRequired};handleIndexSort(e){let t;e.preventDefault(),e.stopPropagation(),t=this.props.sortColumn===this.props.name?this.props.sortOrder===I?L:I:this.props.sortColumn===P?I:L,this.props.sortIndexes(this.props.indexes,this.props.name,t)}_renderClassName(){const e=this.props.sortColumn===this.props.name?"-active":"";return X()(Y[`index-header-column${e}`])}render(){return s.createElement("th",{"data-test-id":this.props.dataTestId,className:this._renderClassName(),onClick:this.handleIndexSort.bind(this)},this.props.name,s.createElement("i",{className:X()(Y["index-header-column-sort"],`fa fa-fw ${this.props.sortOrder}`),onClick:this.handleIndexSort.bind(this)}))}}const ee=J;class te extends s.PureComponent{static displayName="IndexHeader";static propTypes={isWritable:r().bool.isRequired,isReadonly:r().bool.isRequired,indexes:r().array.isRequired,sortOrder:r().string.isRequired,sortColumn:r().string.isRequired,sortIndexes:r().func.isRequired};render(){return s.createElement("thead",{className:X()("index-header-module-index-header__1rGTD")},s.createElement("tr",null,s.createElement(ee,{dataTestId:"index-header-name",name:"Name and Definition",sortOrder:this.props.sortOrder,sortColumn:this.props.sortColumn,sortIndexes:this.props.sortIndexes,indexes:this.props.indexes}),s.createElement(ee,{dataTestId:"index-header-type",name:"Type",sortOrder:this.props.sortOrder,sortColumn:this.props.sortColumn,sortIndexes:this.props.sortIndexes,indexes:this.props.indexes}),s.createElement(ee,{dataTestId:"index-header-size",name:"Size",sortOrder:this.props.sortOrder,sortColumn:this.props.sortColumn,sortIndexes:this.props.sortIndexes,indexes:this.props.indexes}),s.createElement(ee,{dataTestId:"index-header-usage",name:"Usage",sortOrder:this.props.sortOrder,sortColumn:this.props.sortColumn,sortIndexes:this.props.sortIndexes,indexes:this.props.indexes}),s.createElement(ee,{dataTestId:"index-header-properties",name:"Properties",sortOrder:this.props.sortOrder,sortColumn:this.props.sortColumn,sortIndexes:this.props.sortIndexes,indexes:this.props.indexes}),!this.props.isReadonly&&this.props.isWritable?s.createElement("th",null):null))}}const ne=te,se="index-definition-type-module-index-definition-type-pair-field-sort__20OV2";class ae extends s.PureComponent{static displayName="IndexDefinitionType";static propTypes={index:r().object.isRequired,dataTestId:r().string};renderDirection(e){return 1===e.value?s.createElement("span",{className:X()(se)},s.createElement("i",{className:"fa fa-arrow-circle-up fa-lg"})):-1===e.value?s.createElement("span",{className:X()(se)},s.createElement("i",{className:"fa fa-arrow-circle-down fa-lg"})):s.createElement("span",{className:X()("index-definition-type-module-index-definition-type-pair-field-type__2WIoc")},e.value._bsontype?this.renderBsonValue(e.value):e.value)}renderBsonValue(e){return"Decimal128"===e._bsontype?e.toString():"Int32"===e._bsontype?e.valueOf():"Long"===e._bsontype?e.toNumber():e}render(){const e=v()(this.props.index.fields.serialize(),(e=>s.createElement("span",{key:e.field,className:X()("index-definition-type-module-index-definition-type-pair__3y_8d")},s.createElement("span",{className:X()("index-definition-type-module-index-definition-type-pair-field__3av89")},e.field,this.renderDirection(e)))));return s.createElement("div",{className:X()("index-definition-type-module-index-definition__7bI3g")},s.createElement("p",{className:X()("index-definition-type-module-index-definition-type__pdjpB"),"data-test-id":this.props.dataTestId},e))}}const ie=ae;class re extends s.PureComponent{static displayName="NameColumn";static propTypes={index:r().object.isRequired};render(){return s.createElement("td",{className:X()("name-column-module-name-column__vPPtS")},s.createElement("div",{className:"index-definition"},s.createElement("div",{className:X()("name-column-module-name-column-name__1OOW8"),"data-test-id":"name-column-name",title:this.props.index.name},this.props.index.name),s.createElement(ie,{index:this.props.index})))}}const oe=re;var le=n(32711),ce=n.n(le),de=n(73837),pe=n(45658),ue=n(40158),me=n.n(ue);const he={"type-column":"type-column-module-type-column__7zH8D","type-column-property-cardinality":"type-column-module-type-column-property-cardinality__1tpwv","type-column-property-hashed":"type-column-module-type-column-property-hashed__3VUNf","type-column-property-text":"type-column-module-type-column-property-text__Ue8h9","type-column-property-geospatial":"type-column-module-type-column-property-geospatial__1RPEZ","type-column-property-wildcard":"type-column-module-type-column-property-wildcard__2goZa","type-column-property-regular":"type-column-module-type-column-property-regular__3Rq9j"};function ge(){return ge=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ge.apply(this,arguments)}const be="index-type";class ye extends s.PureComponent{static displayName="TypeColumn";static propTypes={index:r().object.isRequired,openLink:r().func.isRequired};_textTooltip(){const e=ce()(this.props.index.extra,["weights","default_language","language_override","wildcardProjection"]);return v()(e,((e,t)=>(0,de.format)("%s: %j",t,e))).join("<br />")}renderType(){let e={};return this.props.index.type,e={"data-tip":`${this._textTooltip()}`,"data-for":be,"data-effect":"solid","data-multiline":!0,"data-border":!0},s.createElement("div",ge({},e,{className:X()(he[`type-column-property-${this.props.index.type}`]),"data-test-id":"index-table-type"}),this.props.index.type,s.createElement(o.InfoSprinkle,{helpLink:me()(this.props.index.type.toUpperCase()),onClickHandler:this.props.openLink}))}render(){return s.createElement("td",{className:X()(he["type-column"])},this.renderType(),s.createElement(pe.Z,{id:be}))}}const fe=ye;var ve=n(62717),Ee=n.n(ve);function Se(){return Se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Se.apply(this,arguments)}const xe="index-size";class we extends s.PureComponent{static displayName="SizeColumn";static propTypes={size:r().number.isRequired,relativeSize:r().number.isRequired};_format(e){const t=e<=1e3?"0":"0.0";return Ee()(e).format(t+" b")}render(){const e=this._format(this.props.size).split(" "),t={"data-tip":`${this.props.relativeSize.toFixed(2)}% compared to largest index`,"data-for":xe,"data-effect":"solid","data-border":!0};return s.createElement("td",{className:X()("size-column-module-size-column__1W2sl")},s.createElement("div",{className:X()("size-column-module-size-column-quantity__2oqaX"),"data-test-id":"index-table-size"},e[0]),s.createElement("div",{className:X()("size-column-module-size-column-unit__3_95s")},e[1]),s.createElement("div",Se({},t,{className:X()("size-column-module-size-column-progress__SZbIE")}),s.createElement(pe.Z,{id:xe}),s.createElement("div",{className:X()("size-column-module-size-column-progress-bar__2CBYu"),style:{width:`${this.props.relativeSize}%`}})))}}const Ce=we;var ke=n(73978),Ne=n.n(ke);function _e(){return _e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},_e.apply(this,arguments)}const Te="index-usage";class Ae extends s.PureComponent{static displayName="UsageColumn";static propTypes={usage:r().any,since:r().any};tooltip(){return Ne()(this.props.usage)?"Either the server does not support the $indexStats commandor the user is not authorized to execute it.":`${this.props.usage} index hits since index creation or last\n server restart`}renderSince(){return Ne()(this.props.since)?null:s.createElement("div",{className:X()("usage-column-module-usage-column-since__3Q9Ej")},"sinceÂ ",s.createElement("span",null,this.props.since?this.props.since.toDateString():"N/A"))}render(){const e=Ne()(this.props.usage)?"0":this.props.usage,t={"data-tip":`${this.tooltip()}`,"data-for":Te,"data-effect":"solid","data-border":!0,"data-multiline":!0};return s.createElement("td",{className:X()("usage-column-module-usage-column__cban-")},s.createElement("span",null,s.createElement("div",_e({},t,{className:X()("usage-column-module-usage-column-quantity__1ZBnP"),"data-test-id":"index-table-usage"}),s.createElement(pe.Z,{id:Te}),e),this.renderSince()))}}const Re=Ae;var Oe=n(72298);const De="property-column-module-property-column-property__Z0Mo8";function Pe(){return Pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Pe.apply(this,arguments)}const Ie="index-property";class Le extends s.PureComponent{static displayName="PropertyColumn";static propTypes={index:r().object.isRequired,openLink:r().func.isRequired};_partialTooltip(){return(0,de.format)("partialFilterExpression: %j",this.props.index.extra.partialFilterExpression)}_ttlTooltip(){return(0,de.format)("expireAfterSeconds: %d",this.props.index.extra.expireAfterSeconds)}renderCardinality(){if("compound"===this.props.index.cardinality)return s.createElement("div",{className:X()("property-column-module-property-column-property-cardinality__2eZTz")},this.props.index.cardinality,s.createElement(o.InfoSprinkle,{helpLink:me()("COMPOUND"),onClickHandler:this.props.openLink}))}renderProperty(e){const t={"data-for":Ie,"data-effect":"solid","data-border":!0};return"ttl"===e?(t["data-tip"]=this._ttlTooltip(),s.createElement("div",Pe({},t,{key:e,className:X()(De)}),e,s.createElement(o.InfoSprinkle,{helpLink:me()("TTL"),onClickHandler:Oe.shell.openExternal}))):"partial"===e?(t["data-tip"]=this._partialTooltip(),s.createElement("div",Pe({},t,{key:e,className:X()(De)}),e,s.createElement(o.InfoSprinkle,{helpLink:me()("PARTIAL"),onClickHandler:Oe.shell.openExternal}))):s.createElement("div",{key:e,className:X()(De)},e,s.createElement(o.InfoSprinkle,{helpLink:me()(e.toUpperCase()),onClickHandler:Oe.shell.openExternal}))}render(){const e=v()(this.props.index.properties,(e=>this.renderProperty(e)));return s.createElement("td",{className:X()("property-column-module-property-column__duo8X")},s.createElement("div",null,e,s.createElement(pe.Z,{id:Ie}),this.renderCardinality()))}}const je=Le;class Me extends s.PureComponent{static displayName="DropColumn";static propTypes={indexName:r().string.isRequired,isReadonly:r().bool.isRequired,isWritable:r().bool.isRequired,localAppRegistry:r().object.isRequired};clickDropHandler(e){e.preventDefault(),e.stopPropagation(),this.props.localAppRegistry.emit("toggle-drop-index-modal",!0,this.props.indexName)}isDroppable(){return this.props.isWritable&&"_id_"!==this.props.indexName&&!this.props.isReadonly}render(){return s.createElement("td",{className:X()("drop-column-module-drop-column__24bgm")},this.isDroppable()?s.createElement("button",{className:"drop-btn btn btn-default btn-sm",type:"button",onClick:this.clickDropHandler.bind(this)},s.createElement("i",{className:"drop-column-icon fa fa-trash-o"})):null)}}const qe=Me;class Fe extends s.PureComponent{static displayName="IndexComponent";static propTypes={index:r().object.isRequired,isReadonly:r().bool.isRequired,isWritable:r().bool.isRequired,localAppRegistry:r().object.isRequired,changeName:r().func.isRequired,openLink:r().func.isRequired};render(){return s.createElement("tr",{className:X()("index-component-module-index-component__6rvx5"),"data-test-id":`index-component-${this.props.index.name}`},s.createElement(oe,{index:this.props.index}),s.createElement(fe,{index:this.props.index,openLink:this.props.openLink}),s.createElement(Ce,{size:this.props.index.size,relativeSize:this.props.index.relativeSize}),s.createElement(Re,{usage:this.props.index.usageCount,since:this.props.index.usageSince}),s.createElement(je,{index:this.props.index,openLink:this.props.openLink}),s.createElement(qe,{indexName:this.props.index.name,isReadonly:this.props.isReadonly,isWritable:this.props.isWritable,localAppRegistry:this.props.localAppRegistry,changeName:this.props.changeName}))}}const Ve=Fe;class Be extends s.PureComponent{static displayName="IndexList";static propTypes={indexes:r().array.isRequired,isReadonly:r().bool.isRequired,isWritable:r().bool.isRequired,localAppRegistry:r().object.isRequired,changeName:r().func.isRequired,openLink:r().func.isRequired};render(){const e=v()(this.props.indexes,(e=>s.createElement(Ve,{key:e.name,index:e,isReadonly:this.props.isReadonly,isWritable:this.props.isWritable,localAppRegistry:this.props.localAppRegistry,changeName:this.props.changeName,openLink:this.props.openLink})));return s.createElement("tbody",{"data-test-id":"index-list"},e)}}const Ue=Be;class He extends s.PureComponent{static displayName="IndexesComponent";static propTypes={isWritable:r().bool.isRequired,isReadonly:r().bool.isRequired,isReadonlyView:r().bool.isRequired,description:r().string.isRequired,indexes:r().array.isRequired,sortColumn:r().string.isRequired,sortOrder:r().string.isRequired,sortIndexes:r().func.isRequired,localAppRegistry:r().object.isRequired,reset:r().func.isRequired,error:r().string,changeName:r().func.isRequired,openLink:r().func.isRequired};renderComponent(){return s.createElement("div",{className:"indexes-module-indexes__2q4Ns"},s.createElement("table",{className:"indexes-module-indexes-table__3wSEx"},s.createElement(ne,{isWritable:this.props.isWritable,isReadonly:this.props.isReadonly,indexes:this.props.indexes,sortColumn:this.props.sortColumn,sortOrder:this.props.sortOrder,sortIndexes:this.props.sortIndexes}),s.createElement(Ue,{isWritable:this.props.isWritable,isReadonly:this.props.isReadonly,indexes:this.props.indexes,localAppRegistry:this.props.localAppRegistry,changeName:this.props.changeName,openLink:this.props.openLink})))}renderBanner(){return this.props.isReadonlyView?s.createElement(o.StatusRow,{style:"warning"},"Readonly views may not contain indexes."):s.createElement(o.StatusRow,{style:"error"},this.props.error)}renderCreateIndexButton(){return this.props.isReadonly||this.props.isReadonlyView||null!==this.props.error&&void 0!==this.props.error?s.createElement("div",{className:"create-index-btn action-bar"}):s.createElement(K,{localAppRegistry:this.props.localAppRegistry})}render(){return s.createElement("div",{className:"indexes-module-indexes-container__31tR2"},s.createElement("div",{className:"controls-container"},this.renderCreateIndexButton()),this.props.isReadonlyView||null!==this.props.error&&void 0!==this.props.error?this.renderBanner():this.renderComponent())}}const $e=(0,a.$j)((e=>({indexes:e.indexes,isWritable:e.isWritable,isReadonly:e.isReadonly,isReadonlyView:e.isReadonlyView,description:e.description,error:e.error,dataService:e.dataService,sortColumn:e.sortColumn,sortOrder:e.sortOrder,localAppRegistry:e.appRegistry.localAppRegistry})),{writeStateChanged:c,getDescription:u,dataServiceConnected:g,sortIndexes:(e,t,n)=>({type:D,indexes:e,column:t,order:n}),reset:H,changeName:z,openLink:Q})(He);class ze extends s.Component{static displayName="IndexesPlugin";static propTypes={store:r().object.isRequired};render(){return s.createElement(a.zt,{store:this.props.store},s.createElement($e,null))}}const Ge=ze;var Qe=n(4858),We=n(15251),Ke=n(10244),Ze=n.n(Ke);const Xe={"create-index-modal":"create-index-modal-module-create-index-modal__3wKLM","modal-content":"create-index-modal-module-modal-content__2Maaz","modal-header":"create-index-modal-module-modal-header__uSgNw","create-index-modal-fields":"create-index-modal-module-create-index-modal-fields__1SusD","create-index-modal-fields-description":"create-index-modal-module-create-index-modal-fields-description__2K1QY",caret:"create-index-modal-module-caret__2oZCS","create-index-modal-toggle-bar":"create-index-modal-module-create-index-modal-toggle-bar__2xMDs","create-index-modal-toggle-bar-header":"create-index-modal-module-create-index-modal-toggle-bar-header__1Kwkk","create-index-modal-toggle-bar-header-text":"create-index-modal-module-create-index-modal-toggle-bar-header-text__2n1PE","create-index-modal-options-checkbox":"create-index-modal-module-create-index-modal-options-checkbox__3uhIp","create-index-modal-options-param":"create-index-modal-module-create-index-modal-options-param__Vy6Ew","create-index-modal-options-param-wrapper":"create-index-modal-module-create-index-modal-options-param-wrapper__1qa6G"};var Ye=n(3681);const Je=["1 (asc)","-1 (desc)","2dsphere","text"];class et extends s.PureComponent{static displayName="CreateIndexField";static propTypes={fields:r().array.isRequired,field:r().object.isRequired,idx:r().number.isRequired,disabledFields:r().array.isRequired,isRemovable:r().bool.isRequired,addField:r().func.isRequired,removeField:r().func.isRequired,updateFieldName:r().func.isRequired,updateFieldType:r().func.isRequired};getDropdownFieldsSelect(){return this.props.fields.map((e=>({value:e,label:e,disabled:this.props.disabledFields.some((t=>t===e))})))}getDropdownTypes(){return Je.map((e=>({value:e,label:e})))}selectFieldName(e){null!==e&&this.props.updateFieldName(this.props.idx,e.label)}selectFieldType(e){this.props.updateFieldType(this.props.idx,e.label)}remove(e){e.preventDefault(),e.stopPropagation(),this.props.removeField(this.props.idx)}_promptText(e){return`Create Index: '${e}'`}render(){const e=""!==this.props.field.name?"":"has-error",t=""!==this.props.field.type?"":"has-error";return s.createElement("div",{className:X()("create-index-field-module-create-index-field__2m39S")},s.createElement("div",{className:X()("create-index-field-module-create-index-field-dropdown-name__diiih"),"data-test-id":"create-index-modal-field-select"},s.createElement(Ye.ZP.Creatable,{value:this.props.field.name,placeholder:"Select or type a field name",options:this.getDropdownFieldsSelect(this.props.fields),onChange:this.selectFieldName.bind(this),clearable:!1,promptTextCreator:this._promptText,className:e})),s.createElement("div",{className:X()("create-index-field-module-create-index-field-dropdown-type__4hACb"),"data-test-id":"create-index-modal-type-select"},s.createElement(Ye.ZP,{value:this.props.field.type,placeholder:"Select a type",options:this.getDropdownTypes(),onChange:this.selectFieldType.bind(this),clearable:!1,searchable:!1,className:t})),s.createElement("div",null,s.createElement("button",{disabled:this.props.isRemovable,className:"btn btn-primary btn-circle",onClick:this.remove.bind(this)},s.createElement("i",{className:"fa fa-minus","aria-hidden":"true"}))))}}const tt=et,nt="indexes/in-progress/TOGGLE_IN_PROGRESS";function st(e=!1,t){return t.type===nt?t.inProgress:e}const at=e=>({type:nt,inProgress:e}),it="indexes/create-indexes/show-options/TOGGLE_SHOW_OPTIONS";var rt=n(78487),ot=n.n(rt);const lt="indexes/create-index/name/CHANGE_SCHEMA_FIELDS",ct=[],dt=e=>({type:lt,schemaFields:e}),pt="indexes/create-index/fields/ADD_FIELD",ut="indexes/create-index/fields/UPDATE_FIELD_TYPE",mt="indexes/create-index/fields/REMOVE_FIELD",ht="indexes/create-index/fields/CHANGE_FIELDS",gt=[{name:"",type:""}],bt="indexes/create-index/name/CHANGE_NAME",yt="indexes/is-visible/TOGGLE_IS_VISIBLE";function ft(e=!1,t){return t.type===yt?t.isVisible:e}const vt=e=>({type:yt,isVisible:e}),Et="indexes/create-indexes/is-background/TOGGLE_IS_BACKGROUND",St="indexes/create-indexes/is-unique/TOGGLE_IS_UNIQUE",xt="indexes/create-indexes/is-partial_filter_expression/TOGGLE_IS_PARTIAL_FILTER_EXPRESSION",wt="indexes/create-indexes/is-ttl/TOGGLE_IS_TTL",Ct="indexes/create-index/ttl/CHANGE_TTL",kt="indexes/create-indexes/is-wildcard/TOGGLE_IS_WILDCARD",Nt="indexes/create-index/wildcard-projection/CHANGE_WILDCARD_PROJECTION",_t="indexes/create-index/partial-filter-expression/CHANGE_PARTIAL_FILTER_EXPRESSION",Tt="indexes/create-index/is-custom-collation/TOGGLE_IS_CUSTOM_COLLATION",At="indexes/create-index/collation/CHANGE_COLLATION_OPTION",Rt={};var Ot=n(24179),Dt=n(18717),Pt=n(6909);const It="explain/namespace/NAMESPACE_CHANGED";function Lt(e="",t){return t.type===It?t.namespace:e}const jt=e=>({type:It,namespace:e}),Mt="indexes/reset-form",qt=()=>({type:Mt}),{track:Ft}=(0,Pt.createLoggerAndTelemetry)("COMPASS-INDEXES-UI"),Vt=(0,Dt.combineReducers)({dataService:h,appRegistry:A(),collation:function(e=Rt,t){return t.type===At?{...e,[t.field]:t.value}:e},fields:function(e=gt,t){const n=[...e];if(t.type===pt)return n.push({name:"",type:""}),n;if(t.type===mt)return n.splice(t.idx,1),n;if(t.type===ut){if(t.idx>=0&&t.idx<n.length){const e={...n[t.idx]};e.type=t.fType,n[t.idx]=e}return n}return t.type===ht?t.fields:e},inProgress:st,isCustomCollation:function(e=!1,t){return t.type===Tt?t.isCustomCollation:e},schemaFields:function(e=ct,t){return t.type===lt?t.schemaFields:e},showOptions:function(e=!1,t){return t.type===it?t.showOptions:e},isVisible:ft,error:k,isBackground:function(e=!1,t){return t.type===Et?t.isBackground:e},isUnique:function(e=!1,t){return t.type===St?t.isUnique:e},isTtl:function(e=!1,t){return t.type===wt?t.isTtl:e},isWildcard:function(e=!1,t){return t.type===kt?t.isWildcard:e},isPartialFilterExpression:function(e=!1,t){return t.type===xt?t.isPartialFilterExpression:e},ttl:function(e="",t){return t.type===Ct?t.ttl:e},wildcardProjection:function(e="",t){return t.type===Nt?t.wildcardProjection:e},partialFilterExpression:function(e="",t){return t.type===_t?t.partialFilterExpression:e},name:function(e="",t){return t.type===bt?t.name:e},namespace:Lt}),Bt=(e,t)=>t.type===U||t.type===Mt?{...e,collation:Rt,fields:gt,inProgress:false,isCustomCollation:!1,showOptions:!1,isVisible:false,error:C,isBackground:!1,isUnique:!1,isTtl:!1,isWildcard:!1,isPartialFilterExpression:!1,ttl:"",wildcardProjection:"",partialFilterExpression:"",name:""}:Vt(e,t),{track:Ut}=(0,Pt.createLoggerAndTelemetry)("COMPASS-IMPORT-EXPORT-UI");class Ht extends s.PureComponent{static displayName="CreateIndexModal";static propTypes={showOptions:r().bool.isRequired,error:r().string,inProgress:r().bool.isRequired,schemaFields:r().array.isRequired,fields:r().array.isRequired,dataService:r().object,isVisible:r().bool.isRequired,isBackground:r().bool.isRequired,isUnique:r().bool.isRequired,isTtl:r().bool.isRequired,ttl:r().string.isRequired,isWildcard:r().bool.isRequired,wildcardProjection:r().string.isRequired,isPartialFilterExpression:r().bool.isRequired,partialFilterExpression:r().string.isRequired,isCustomCollation:r().bool.isRequired,collation:r().object.isRequired,name:r().string.isRequired,updateFieldName:r().func.isRequired,updateFieldType:r().func.isRequired,addField:r().func.isRequired,removeField:r().func.isRequired,toggleIsUnique:r().func.isRequired,toggleIsVisible:r().func.isRequired,toggleShowOptions:r().func.isRequired,toggleIsBackground:r().func.isRequired,toggleIsTtl:r().func.isRequired,toggleIsWildcard:r().func.isRequired,toggleIsPartialFilterExpression:r().func.isRequired,toggleIsCustomCollation:r().func.isRequired,resetForm:r().func.isRequired,createIndex:r().func.isRequired,openLink:r().func.isRequired,changeTtl:r().func.isRequired,changeWildcardProjection:r().func.isRequired,changePartialFilterExpression:r().func.isRequired,changeCollationOption:r().func.isRequired,changeName:r().func.isRequired};constructor(e){super(e),this.CollationSelect=global.hadronApp.appRegistry.getComponent("Collation.Select")}handleShow(){Ut("Screen",{name:"create_index_modal"})}handleClose(){this.props.toggleIsVisible(!1),this.props.resetForm()}onFormSubmit(e){e.preventDefault(),e.stopPropagation(),this.props.createIndex()}handleToggleBarClick(e){this.props.toggleShowOptions(!this.props.showOptions),e.preventDefault(),e.stopPropagation()}handleAddField(e){this.props.addField(),e.preventDefault(),e.stopPropagation()}renderIndexFields(){if(!this.props.fields.length)return null;const e=Ze()(this.props.fields,"name");return this.props.fields.map(((t,n)=>s.createElement(tt,{fields:this.props.schemaFields,key:n,idx:n,field:t,disabledFields:e,isRemovable:!(this.props.fields.length>1),updateFieldName:this.props.updateFieldName,updateFieldType:this.props.updateFieldType,addField:this.props.addField,removeField:this.props.removeField})))}renderOptions(){return this.props.showOptions?s.createElement("div",{className:Xe["create-index-modal-options"],"data-test-id":"create-index-modal-options"},s.createElement(o.ModalCheckbox,{name:"Build index in the background","data-test-id":"toggle-is-background",titleClassName:Xe["create-index-modal-options-checkbox"],checked:this.props.isBackground,helpUrl:me()("BACKGROUND"),onClickHandler:()=>this.props.toggleIsBackground(!this.props.isBackground),onLinkClickHandler:this.props.openLink}),s.createElement(o.ModalCheckbox,{name:"Create unique index","data-test-id":"toggle-is-unique",titleClassName:Xe["create-index-modal-options-checkbox"],checked:this.props.isUnique,helpUrl:me()("UNIQUE"),onClickHandler:()=>this.props.toggleIsUnique(!this.props.isUnique),onLinkClickHandler:this.props.openLink}),s.createElement(o.ModalCheckbox,{name:"Create TTL","data-test-id":"toggle-is-ttl",titleClassName:Xe["create-index-modal-options-param"],checked:this.props.isTtl,helpUrl:me()("TTL"),onClickHandler:()=>this.props.toggleIsTtl(!this.props.isTtl),onLinkClickHandler:this.props.openLink}),this.renderTtl(),s.createElement(o.ModalCheckbox,{name:"Partial Filter Expression","data-test-id":"toggle-is-pfe",titleClassName:Xe["create-index-modal-options-param"],checked:this.props.isPartialFilterExpression,helpUrl:me()("PARTIAL"),onClickHandler:()=>this.props.toggleIsPartialFilterExpression(!this.props.isPartialFilterExpression),onLinkClickHandler:this.props.openLink}),this.renderPartialFilterExpression(),s.createElement(o.ModalCheckbox,{name:"Use Custom Collation","data-test-id":"toggle-is-custom-collation",titleClassName:Xe["create-index-modal-options-param"],checked:this.props.isCustomCollation,helpUrl:me()("COLLATION_REF"),onClickHandler:()=>this.props.toggleIsCustomCollation(!this.props.isCustomCollation),onLinkClickHandler:this.props.openLink}),this.renderCollation(),s.createElement(o.ModalCheckbox,{name:"Wildcard Projection","data-test-id":"toggle-is-wildcard",titleClassName:Xe["create-index-modal-options-param"],checked:this.props.isWildcard,helpUrl:me()("WILDCARD"),onClickHandler:()=>this.props.toggleIsWildcard(!this.props.isWildcard),onLinkClickHandler:this.props.openLink}),this.renderWildcard()):null}renderTtl(){if(this.props.showOptions&&this.props.isTtl)return s.createElement("div",{className:Xe["create-index-modal-options-param-wrapper"]},s.createElement(o.ModalInput,{id:"ttl-value",name:"seconds",value:this.props.ttl,onChangeHandler:e=>this.props.changeTtl(e.target.value)}))}renderWildcard(){if(this.props.showOptions&&this.props.isWildcard)return s.createElement("div",{className:Xe["create-index-modal-options-param-wrapper"]},s.createElement(o.ModalInput,{id:"wildcard-projection-value",name:"",value:this.props.wildcardProjection,onChangeHandler:e=>this.props.changeWildcardProjection(e.target.value)}))}renderPartialFilterExpression(){if(this.props.showOptions&&this.props.isPartialFilterExpression)return s.createElement("div",{className:Xe["create-index-modal-options-param-wrapper"]},s.createElement(o.ModalInput,{id:"partial-filter-expression-value",name:"",value:this.props.partialFilterExpression,onChangeHandler:e=>this.props.changePartialFilterExpression(e.target.value)}))}renderCollation(){if(this.props.isCustomCollation)return s.createElement("div",{className:Xe["create-index-modal-options-param-wrapper"]},s.createElement(this.CollationSelect,{collation:this.props.collation||{},changeCollationOption:this.props.changeCollationOption}))}render(){return s.createElement(Qe.Z,{className:"with-global-bootstrap-styles",show:this.props.isVisible,backdrop:"static",dialogClassName:Xe["create-index-modal"],onShow:this.handleShow.bind(this),onHide:this.handleClose.bind(this)},s.createElement(Qe.Z.Header,null,s.createElement(Qe.Z.Title,null,"Create Index")),s.createElement(Qe.Z.Body,null,s.createElement("form",{name:"create-index-modal-form",onSubmit:this.onFormSubmit.bind(this),"data-test-id":"create-index-modal"},s.createElement(o.ModalInput,{autoFocus:!0,id:"create-index-name",name:"Choose an index name",value:this.props.name,onChangeHandler:e=>this.props.changeName(e.target.value)}),s.createElement("div",{className:Xe["create-index-modal-fields"]},s.createElement("p",{className:Xe["create-index-modal-fields-description"]},"Configure the index definition"),this.renderIndexFields(),s.createElement("button",{onClick:this.handleAddField.bind(this),id:"add-field",className:"btn btn-primary btn-sm btn-full-width"},"Add another field")),s.createElement("div",{className:Xe["create-index-modal-toggle-bar"],onClick:this.handleToggleBarClick.bind(this)},s.createElement("div",{className:Xe["create-index-modal-toggle-bar-header"]},this.props.showOptions?s.createElement("i",{className:"fa fa-angle-down"}):s.createElement("i",{className:"fa fa-angle-right"}),s.createElement("p",{className:Xe["create-index-modal-toggle-bar-header-text"]}," Options"))),this.renderOptions(),null!==this.props.error&&void 0!==this.props.error?s.createElement(o.ModalStatusMessage,{icon:"times",message:this.props.error,type:"error",className:Xe["create-index-modal-message"]}):null,!this.props.inProgress||null!==this.props.error&&void 0!==this.props.error?null:s.createElement(o.ModalStatusMessage,{icon:"spinner",message:"Create in Progress",type:"in-progress",className:Xe["create-index-modal-message"]}))),s.createElement(Qe.Z.Footer,null,s.createElement(We.TextButton,{className:"btn btn-default btn-sm",dataTestId:"cancel-create-index-button",disabled:this.props.inProgress,text:"Cancel",clickHandler:this.handleClose.bind(this)}),s.createElement(We.TextButton,{className:"btn btn-primary btn-sm",disabled:!this.props.fields.length||this.props.inProgress,dataTestId:"create-index-button",text:"Create Index",clickHandler:this.props.createIndex})))}}const $t=(0,a.$j)((e=>({dataService:e.dataService,fields:e.fields,inProgress:e.inProgress,showOptions:e.showOptions,schemaFields:e.schemaFields,error:e.error,isVisible:e.isVisible,isBackground:e.isBackground,isTtl:e.isTtl,ttl:e.ttl,isWildcard:e.isWildcard,wildcardProjection:e.wildcardProjection,isUnique:e.isUnique,isPartialFilterExpression:e.isPartialFilterExpression,partialFilterExpression:e.partialFilterExpression,isCustomCollation:e.isCustomCollation,collation:e.collation,name:e.name})),{toggleInProgress:at,toggleShowOptions:e=>({type:it,showOptions:e}),changeSchemaFields:dt,clearError:_,handleError:N,toggleIsVisible:vt,toggleIsBackground:e=>({type:Et,isBackground:e}),toggleIsTtl:e=>({type:wt,isTtl:e}),toggleIsWildcard:e=>({type:kt,isWildcard:e}),toggleIsUnique:e=>({type:St,isUnique:e}),toggleIsPartialFilterExpression:e=>({type:xt,isPartialFilterExpression:e}),toggleIsCustomCollation:e=>({type:Tt,isCustomCollation:e}),changePartialFilterExpression:e=>({type:_t,partialFilterExpression:e}),changeTtl:e=>({type:Ct,ttl:e}),changeWildcardProjection:e=>({type:Nt,wildcardProjection:e}),changeCollationOption:(e,t)=>({type:At,field:e,value:t}),openLink:Q,changeName:e=>({type:bt,name:e}),createIndex:()=>(e,t)=>{const n=t(),s={};if(n.fields.some((e=>""===e.name||""===e.type)))return void e(N("You must select a field name and type"));n.fields.forEach((e=>{let t=e.type;"1 (asc)"===t&&(t=1),"-1 (desc)"===t&&(t=-1),s[e.name]=t}));const a={};if(a.background=n.isBackground,a.unique=n.isUnique,a.name=n.name,""===n.name&&(a.name=((e,t)=>e.map((e=>`${e.name}_${t[e.name]}`)).join("_").replace(/\$\*\*/gi,"wildcard"))(n.fields,s)),n.isCustomCollation&&(a.collation=n.collation),n.isTtl&&(a.expireAfterSeconds=Number(n.ttl),isNaN(a.expireAfterSeconds)))return void e(N(`Bad TTL: "${n.ttl}"`));if(n.isWildcard)try{a.wildcardProjection=Ot.EJSON.parse(n.wildcardProjection)}catch(t){return void e(N(`Bad WildcardProjection: ${String(t)}`))}if(n.isPartialFilterExpression)try{a.partialFilterExpression=Ot.EJSON.parse(n.partialFilterExpression)}catch(t){return void e(N(`Bad PartialFilterExpression: ${String(t)}`))}e(at(!0));const i=n.namespace;n.dataService.createIndex(i,s,a,(t=>{if(t)e(at(!1)),e(N(F(t)));else{const t={background:n.isBackground,unique:n.isUnique,ttl:n.isTtl,wildcard:n.isWildcard,custom_collation:n.isCustomCollation,geo:n.fields.filter((({type:e})=>"2dsphere"===e)).length>0};Ft("Index Created",t),e(H()),e((0,T.localAppRegistryEmit)("refresh-data")),e((0,T.globalAppRegistryEmit)("compass:indexes:created",{isCollation:n.isCustomCollation,isBackground:n.isBackground,isPartialFilterExpression:n.isPartialFilterExpression,isTTL:n.isTtl,isUnique:n.isUnique,isWildcard:n.isWildcard,collation:n.collation,ttl:n.ttl})),e(_()),e(at(!1)),e(vt(!1))}}))},resetForm:qt,addField:()=>({type:pt}),removeField:e=>({type:mt,idx:e}),updateFieldName:(e,t)=>(n,s)=>{const a=s(),i=[...a.fields];if(e>=0&&e<a.fields.length){if(a.fields.some((e=>e.name===t)))return void n(N("Index keys must be unique"));const s={...i[e]};if(s.name=t,i[e]=s,n((e=>({type:ht,fields:e}))(i)),!ot()(a.schemaFields,t)){const e=[...a.schemaFields];e.push(t),n(dt(e))}}},updateFieldType:(e,t)=>({type:ut,idx:e,fType:t})})(Ht);class zt extends s.Component{static displayName="CreateIndexPlugin";static propTypes={store:r().object.isRequired};render(){return s.createElement(a.zt,{store:this.props.store},s.createElement($t,null))}}const Gt=zt;var Qt=n(50517);const Wt={"drop-index-modal-confirm":"drop-index-modal-module-drop-index-modal-confirm__VSPAs"},Kt="indexes/drop-index/confirm-name/CHANGE_CONFIRM_NAME",{track:Zt}=(0,Pt.createLoggerAndTelemetry)("COMPASS-INDEXES-UI"),Xt=(0,Dt.combineReducers)({dataService:h,appRegistry:A(),isVisible:ft,inProgress:st,error:k,name:function(e="",t){return t.type===$?t.name:e},confirmName:function(e="",t){return t.type===Kt?t.name:e},namespace:Lt}),Yt=(e,t)=>t.type===U||t.type===Mt?{...e,inProgress:false,isVisible:false,error:C,name:"",confirmName:""}:Xt(e,t);class Jt extends s.PureComponent{static displayName="DropIndexModal";static propTypes={dataService:r().object,isVisible:r().bool.isRequired,inProgress:r().bool.isRequired,error:r().string,name:r().string.isRequired,confirmName:r().string.isRequired,toggleIsVisible:r().func.isRequired,toggleInProgress:r().func.isRequired,changeConfirmName:r().func.isRequired,resetForm:r().func.isRequired,dropIndex:r().func.isRequired};onFormSubmit(e){e.preventDefault(),e.stopPropagation()}handleClose(e){e&&(e.preventDefault(),e.stopPropagation()),this.props.toggleIsVisible(!1),this.props.resetForm()}handleConfirm(e){e.preventDefault(),e.stopPropagation(),this.props.dropIndex(this.props.name)}render(){return s.createElement(Qt.ConfirmationModal,{title:"Drop Index",open:this.props.isVisible,onConfirm:this.handleConfirm.bind(this),onCancel:this.handleClose.bind(this),buttonText:"Drop",variant:"danger",submitDisabled:this.props.confirmName!==this.props.name,className:Wt["drop-index-modal"],trackingId:"drop_index_modal"},s.createElement("div",null,s.createElement("p",{className:Wt["drop-index-modal-confirm"]},s.createElement("i",{className:"fa fa-exclamation-triangle","aria-hidden":"true"}),"Type the index name",s.createElement("strong",null," ",this.props.name," "),"to drop")),s.createElement("form",{onSubmit:this.onFormSubmit.bind(this)},s.createElement("div",{className:"form-group"},s.createElement("input",{type:"text",className:"form-control","data-test-id":"confirm-drop-index-name",value:this.props.confirmName,onChange:e=>this.props.changeConfirmName(e.target.value)})),null!==this.props.error&&void 0!==this.props.error?s.createElement(o.ModalStatusMessage,{icon:"times",message:this.props.error,type:"error"}):null,!this.props.inProgress||null!==this.props.error&&void 0!==this.props.error?null:s.createElement(o.ModalStatusMessage,{icon:"spinner",message:"Drop in Progress",type:"in-progress"})))}}const en=(0,a.$j)((e=>({dataService:e.dataService,isVisible:e.isVisible,inProgress:e.inProgress,error:e.error,name:e.name,confirmName:e.confirmName})),{toggleIsVisible:vt,toggleInProgress:at,clearError:_,handleError:N,changeName:z,changeConfirmName:e=>({type:Kt,name:e}),dropIndex:e=>(t,n)=>{const s=n(),a=s.namespace;t(at(!0)),s.dataService.dropIndex(a,e,(e=>{e?(t(at(!1)),t(N(F(e)))):(Zt("Index Dropped"),t(H()),t((0,T.localAppRegistryEmit)("refresh-data")),t(_()),t(at(!1)),t(vt(!1)))}))},resetForm:qt})(Jt);class tn extends s.Component{static displayName="DropIndexPlugin";static propTypes={store:r().object.isRequired};render(){return s.createElement(a.zt,{store:this.props.store},s.createElement(en,null))}}const nn=tn,sn="indexes/is-readonly-view/READONLY_VIEW_CHANGED",an=(0,Dt.combineReducers)({indexes:function(e=j,t){return t.type===D?[...t.indexes].sort(M(q(t.column),t.order)):t.type===O?t.indexes:e},isWritable:(e=!0,t)=>t.type===l?t.isWritable:e,isReadonly:function(e=!1){return e},isReadonlyView:function(e=!1,t){return t.type===sn?t.isReadonlyView:e},description:(e=p,t)=>t.type===d?t.description:e,appRegistry:A(),dataService:h,sortOrder:(e="fa-sort-asc",t)=>t.type===D?t.order:e,sortColumn:(e="Name and Definition",t)=>t.type===D?t.column:e,error:k,namespace:Lt}),rn=(e,t)=>t.type===U?{...e,isWritable:!0,isReadonly:!1,isReadonlyView:!1,description:p,indexes:j,sortOrder:"fa-sort-asc",sortColumn:"Name and Definition",error:C,namespace:""}:an(e,t);var on=n(43292);const ln=n(14069)("mongodb-compass:stores:IndexesStore"),cn=(e={})=>{const t=(0,Dt.createStore)(rn,(0,Dt.applyMiddleware)(on.Z));if(e.localAppRegistry){const n=e.localAppRegistry;t.dispatch((0,T.localAppRegistryActivated)(n)),n.on("refresh-data",(()=>{t.dispatch(B())}))}if(e.globalAppRegistry){const n=e.globalAppRegistry;t.dispatch((0,T.globalAppRegistryActivated)(n)),n.getStore("DeploymentAwareness.WriteStateStore").listen((e=>{t.dispatch(c(e.isWritable)),t.dispatch(u(e.description))})),n.on("refresh-data",(()=>{t.dispatch(B())}))}if(e.namespace&&t.dispatch(jt(e.namespace)),e.isReadonly){const n=e.isReadonly;t.dispatch((e=>({type:sn,isReadonlyView:e}))(n))}return e.dataProvider&&((e,t,n)=>{null!==t?e.dispatch(N(F(t))):(e.dispatch(g(n)),e.dispatch(B()))})(t,e.dataProvider.error,e.dataProvider.dataProvider),t.subscribe((()=>{const e=t.getState();ln("IndexesStore changed to",e)})),t},{track:dn}=(0,Pt.createLoggerAndTelemetry)("COMPASS-INDEXES-UI"),pn=(e,t,n)=>{null!==t?e.dispatch(N(F(t))):e.dispatch(g(n))},un=(e,t,n)=>{null!==t?e.dispatch(N(F(t))):e.dispatch(g(n))},mn=JSON.parse('{"name":"@mongodb-js/compass-indexes","productName":"Compass Indexes plugin","version":"4.23.0","apiVersion":"3.0.0","description":"Indexes support for Compass","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-cov":"nyc npm run test","check":"npm run lint && npm run depcheck","prepublishOnly":"npm run compile","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","bootstrap":"npm run compile"},"license":"SSPL","peerDependencies":{"@hot-loader/react-dom":"^16.9.0","@mongodb-js/compass-components":"^0.13.0","@mongodb-js/compass-deployment-awareness":"^11.21.0","bson":"^4.4.1","debug":"4.3.0","hadron-react-buttons":"^5.7.0","hadron-react-components":"^5.13.0","mongodb-index-model":"^3.9.0","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","react-redux":"^5.0.6","react-select-plus":"^1.2.0","react-tooltip":"^3.11.1","redux":"^4.1.2","redux-thunk":"^2.3.0"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","@hot-loader/react-dom":"^16.9.0","@mongodb-js/compass-components":"^0.13.0","@mongodb-js/compass-deployment-awareness":"^11.21.0","@mongodb-js/compass-field-store":"^7.21.0","autoprefixer":"^9.4.6","babel-loader":"^8.2.2","bson":"^4.4.1","chai":"^4.2.0","chai-enzyme":"1.0.0-beta.1","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^7.0.0","css-loader":"^4.3.0","debug":"4.3.0","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^5.0.3","extract-text-webpack-plugin":"^4.0.0-beta.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","hadron-react-buttons":"^5.7.0","hadron-react-components":"^5.13.0","html-webpack-plugin":"^3.2.0","ignore-loader":"^0.1.2","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","less":"^3.11.1","less-loader":"^7.3.0","mocha":"^7.0.1","mocha-webpack":"^2.0.0-beta.0","mongodb-connection-model":"^21.15.0","mongodb-data-service":"^21.19.0","mongodb-index-model":"^3.9.0","mongodb-reflux-store":"^0.0.1","node-loader":"^0.6.0","nyc":"^15.0.0","peer-deps-externals-webpack-plugin":"^1.0.4","postcss-loader":"^2.1.6","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","react-hot-loader":"^4.13.0","react-redux":"^5.0.6","react-select-plus":"^1.2.0","redux":"^4.1.2","redux-thunk":"^2.3.0","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","resolve":"^1.15.1","rimraf":"^3.0.1","semver":"^5.4.1","shebang-loader":"^0.0.1","sinon":"^8.1.1","sinon-chai":"^3.4.0","style-loader":"^2.0.0","url-loader":"^3.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^3.6.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-merge":"^4.2.2","webpack-node-externals":"^3.0.0","xvfb-maybe":"^0.2.1"},"dependencies":{"@mongodb-js/compass-logging":"^0.10.0","@mongodb-js/mongodb-redux-common":"^1.10.0","lodash.contains":"^2.4.3","lodash.isundefined":"^3.0.1","lodash.map":"^4.6.0","lodash.max":"^4.0.1","lodash.pick":"^4.4.0","lodash.pluck":"^3.1.2","lodash.sortby":"^4.7.0","lodash.sortbyorder":"^3.4.4","lodash.trim":"^4.5.1","lodash.zipobject":"^4.1.3","mongodb-ns":"^2.3.0","numeral":"^2.0.6","react-bootstrap":"^0.32.1","reflux":"^0.4.1"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"}}'),hn={name:"Indexes",component:Ge,order:6,configureStore:cn,configureActions:()=>{},storeName:"Indexes.Store",actionName:"Indexes.Actions"},gn={name:"Create Index",component:Gt,configureStore:(e={})=>{const t=(0,Dt.createStore)(Bt,(0,Dt.applyMiddleware)(on.Z));if(e.localAppRegistry){const n=e.localAppRegistry;t.dispatch((0,T.localAppRegistryActivated)(n)),n.on("fields-changed",(e=>{t.dispatch(dt(Object.keys(e.fields).filter((e=>"_id"!==e))))})),n.on("toggle-create-index-modal",(e=>{dn("Index Create Opened"),t.dispatch(vt(e))})),n.on("data-service-connected",((e,n)=>{pn(t,e,n)}))}if(e.globalAppRegistry){const n=e.globalAppRegistry;t.dispatch((0,T.globalAppRegistryActivated)(n))}return e.namespace&&t.dispatch(jt(e.namespace)),e.dataProvider&&pn(t,e.dataProvider.error,e.dataProvider.dataProvider),t},configureActions:()=>{},storeName:"Indexes.CreateIndexStore",actionName:"Indexes.CreateIndexActions"},bn={name:"Drop Index",component:nn,configureStore:(e={})=>{const t=(0,Dt.createStore)(Yt,(0,Dt.applyMiddleware)(on.Z));if(e.localAppRegistry){const n=e.localAppRegistry;t.dispatch((0,T.localAppRegistryActivated)(n)),n.on("toggle-drop-index-modal",((e,n)=>{t.dispatch(z(n)),t.dispatch(vt(e))})),n.on("data-service-connected",((e,n)=>{un(t,e,n)}))}if(e.globalAppRegistry){const n=e.globalAppRegistry;t.dispatch((0,T.globalAppRegistryActivated)(n))}return e.namespace&&t.dispatch(jt(e.namespace)),e.dataProvider&&un(t,e.dataProvider.error,e.dataProvider.dataProvider),t},configureActions:()=>{},storeName:"Indexes.DropIndexStore",actionName:"Indexes.DropIndexActions"};function yn(e){e.registerRole("Collection.Tab",hn),e.registerRole("Collection.ScopedModal",gn),e.registerRole("Collection.ScopedModal",bn),e.registerComponent("Indexes.IndexDefinitionType",ie)}function fn(e){e.deregisterRole("Collection.Tab",hn),e.deregisterRole("Collection.ScopedModal",gn),e.deregisterRole("Collection.ScopedModal",bn),e.deregisterComponent("Indexes.IndexDefinitionType")}const vn=Ge},40158:e=>{const t={SINGLE:"https://docs.mongodb.org/manual/core/index-single/",COMPOUND:"https://docs.mongodb.org/manual/core/index-compound/",UNIQUE:"https://docs.mongodb.org/manual/core/index-unique/",BACKGROUND:"https://docs.mongodb.com/manual/core/index-creation/#index-creation-background",PARTIAL:"https://docs.mongodb.org/manual/core/index-partial/",SPARSE:"https://docs.mongodb.org/manual/core/index-sparse/",TTL:"https://docs.mongodb.org/manual/core/index-ttl/","2D":"https://docs.mongodb.org/manual/core/2d/","2DSPHERE":"https://docs.mongodb.org/manual/core/2dsphere/",GEOHAYSTACK:"https://docs.mongodb.org/manual/core/geohaystack/",GEOSPATIAL:"https://docs.mongodb.org/manual/applications/geospatial-indexes/#geospatial-indexes",WILDCARD:"https://docs.mongodb.com/manual/core/index-wildcard/",TEXT:"https://docs.mongodb.org/manual/core/index-text/",HASHED:"https://docs.mongodb.org/manual/core/index-hashed/",REGULAR:"https://docs.mongodb.com/manual/indexes/#single-field",COLLATION:"https://docs.mongodb.com/master/reference/bson-type-comparison-order/#collation",COLLATION_REF:"https://docs.mongodb.com/master/reference/collation",UNKNOWN:null};e.exports=function(e){return t[e]||null}},75310:(e,t,n)=>{const s=n(2784),a=n(13980),{Banner:i,BannerVariant:r,ErrorBoundary:o,TabNavBar:l}=n(50517),{track:c}=n(6909).createLoggerAndTelemetry("COMPASS-INSTANCE-UI"),{createLoggerAndTelemetry:d}=n(6909),{default:p}=n(62106),{debug:u}=d("mongodb-compass:compass-collection:context");function m({name:e}){return e.toLowerCase().replace(/ /g,"_")}const h=({status:e,error:t,isDataLake:n,tabs:a,activeTabId:d,onTabClick:h})=>{const g=s.useMemo((()=>a.filter((e=>"Performance"!==e.name||!n))),[n]),b=g[d];return s.useEffect((()=>{c("Screen",{name:m(b)})}),[b]),"error"===e?(t.includes("not master and slaveOk=false")&&(t=`'${t}': It is recommended to change your read\n preference in the connection dialog to Primary Preferred or Secondary Preferred\n or provide a replica set name for a full topology connection.`),s.createElement("div",{className:p["instance-error"]},s.createElement(i,{variant:r.Danger},"An error occurred while loading instance info",": ",t))):"ready"===e||"refreshing"===e?s.createElement("div",{className:"rtss"},s.createElement(l,{"data-test-id":"instance-tabs","aria-label":"Instance Tabs",tabs:g.map((e=>e.name)),views:g.map((e=>s.createElement(o,{displayName:e.displayName,key:e.name,onError:(t,n)=>{u("error rendering instance view",e.name,t,n)}},s.createElement(e.component,null)))),activeTabIndex:d,onTabClicked:h})):null};h.propTypes={status:a.string.isRequired,error:a.string,isDataLake:a.bool.isRequired,tabs:a.array.isRequired,activeTabId:a.number.isRequired,onTabClick:a.func.isRequired},e.exports={InstanceComponent:h}},60816:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>l,deactivate:()=>c,default:()=>d,metadata:()=>o});var s=n(60162),a=n.n(s),i=n(73664),r=n.n(i);const o=JSON.parse('{"name":"@mongodb-js/compass-instance","productName":"Instance plugin","version":"3.21.0","apiVersion":"3.0.0","description":"compass instance plugin","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-cov":"nyc npm run test","check":"npm run lint && npm run depcheck","prepublishOnly":"npm run compile","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","bootstrap":"npm run compile"},"license":"SSPL","peerDependencies":{"hadron-react-components":"^5.13.0","react":"^16.14.0","react-dom":"^16.14.0","react-tooltip":"^3.11.1"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","@mongodb-js/compass-components":"^0.13.0","@mongodb-js/compass-database":"^2.21.0","@mongodb-js/compass-logging":"^0.10.0","@mongodb-js/compass-serverstats":"^15.21.0","autoprefixer":"^9.7.4","babel-loader":"^8.2.2","chai":"^4.2.0","chai-as-promised":"^7.1.1","chai-enzyme":"1.0.0-beta.1","cheerio":"^1.0.0-rc.3","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^7.0.0","css-loader":"^4.3.0","debug":"4.3.0","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^5.0.3","extract-text-webpack-plugin":"^4.0.0-beta.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","hadron-react-components":"^5.13.0","html-webpack-plugin":"^3.2.0","ignore-loader":"^0.1.2","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","less":"^3.11.1","less-loader":"^7.3.0","mocha":"^7.0.1","mocha-webpack":"^2.0.0-beta.0","mongodb-connection-model":"^21.15.0","mongodb-reflux-store":"^0.0.1","node-loader":"^0.6.0","nyc":"^15.0.0","peer-deps-externals-webpack-plugin":"^1.0.4","postcss-loader":"^2.1.6","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","react-hot-loader":"^4.13.0","react-redux":"^7.1.3","redux":"^4.1.2","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","resolve":"^1.15.1","rimraf":"^3.0.2","semver":"^5.4.1","shebang-loader":"^0.0.1","sinon":"^8.1.1","sinon-chai":"^3.4.0","style-loader":"^2.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^3.6.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-merge":"^4.2.2","webpack-node-externals":"^3.0.0","xvfb-maybe":"^0.2.1"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"}}');function l(e){e.registerComponent("Instance.Workspace",a()),e.registerStore("Instance.Store",r())}function c(e){e.deregisterComponent("Instance.Workspace"),e.deregisterStore("Instance.Store")}const d=a()},60162:(e,t,n)=>{const s=n(2784),{Provider:a,connect:i}=n(55773),r=n(73664),{InstanceComponent:o}=n(75310),l=i((e=>e),{onTabClick:e=>({type:"change-tab",id:e})})(o);e.exports=()=>s.createElement(a,{store:r},s.createElement(l,null))},73664:(e,t,n)=>{const{createStore:s}=n(18717),a={status:"initial",error:null,isDataLake:!1,activeTabId:0},i=s((function(e={tabs:[],...a},t){switch(t.type){case"app-registry-activated":return{...e,tabs:t.appRegistry.getRole("Instance.Tab")??[]};case"instance-status-change":return{...e,status:t.instance.status,error:t.instance.statusError,isDataLake:t.instance.dataLake.isDataLake};case"reset":return{...e,...a};case"change-tab":return{...e,activeTabId:t.id};default:return e}}));i.onActivated=function(e){i.dispatch({type:"app-registry-activated",appRegistry:e}),e.on("instance-created",(({instance:e})=>{e.on("change:status",(()=>{i.dispatch({type:"instance-status-change",instance:e})}))})),e.on("instance-destroyed",(()=>{i.dispatch({type:"reset"})})),e.on("open-instance-workspace",(e=>{if(e){const t=i.getState().tabs.findIndex((t=>t.name===e));-1!==t&&i.dispatch({type:"change-tab",id:t})}else i.dispatch({type:"change-tab",id:0})}))},e.exports=i},6909:(e,t,n)=>{"use strict";n.r(t),n.d(t,{createLoggerAndTelemetry:()=>c,default:()=>d});var s=n(36269),a=n(4283),i=n.n(a),r=n(68957),o=n.n(r);function l(e,t,n){e?.callQuiet?.(t,n),"undefined"!=typeof process&&"function"==typeof process.emit&&process.emit(t,n)}function c(e){const t=i()?n(45727):null,a={write(e,n){l(t,"compass:log",{line:e}),n()},end(e){e()}},r=new s.r_("",null,a),c=o()(`mongodb-compass:${e.toLowerCase()}`);return r.on("log",(({s:e,ctx:t,msg:n,attr:s})=>{c(n,s?{s:e,ctx:t,...s}:{s:e,ctx:t})})),{log:r.bindComponent(e),mongoLogId:s.lQ,debug:c,track:(...e)=>{Promise.resolve().then((()=>(async(e,n={})=>{const s=global?.hadronApp?.isFeatureEnabled("trackUsageStatistics");if(!s)return;const a={event:e,properties:n};"function"==typeof n&&(a.properties=await n()),l(t,"compass:track",a)})(...e))).catch((e=>c("track failed",e)))}}}const d=c},25340:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>me,deactivate:()=>he,default:()=>ge,metadata:()=>ue});var s=n(18717);const a={};var i=n(10745),r=n.n(i),o=n(97587),l=n(91491);const c=/(^localhost)|(^127\.0\.0\.1)/gi;function d(e){return!!(e&&Object.keys(e).length>0)}const p=[{registryEvent:"compass:screen:viewed",resource:"Screen",action:"viewed",condition:()=>!0,metadata:(e,t)=>({...t,compass_version:e})},{registryEvent:"compass:deployment-awareness:topology-changed",resource:"Topology",action:"detected",condition:()=>!0,metadata:(e,t)=>({"topology type":t.topologyType,"server count":t.servers.length,"server types":t.servers.map((e=>e.type)),compass_version:e})},{registryEvent:"instance-refreshed",resource:"Deployment",action:"detected",condition:e=>e.instance&&e.instance.build&&e.instance.build.version,metadata:async(e,t)=>{const n=await async function(e){try{const t=(new l.ZP(e.getConnectionOptions().connectionString).hosts[0]||"").split(":")[0];return await(0,o.getCloudInfo)(t)}catch(e){return{}}}(t.dataService);return{"mongodb version":t.instance.build.version,"enterprise module":t.instance.build.isEnterprise,"server architecture":t.instance.host.arch,"server cpu cores":t.instance.host.cpu_cores,"server cpu frequency (mhz)":t.instance.host.cpu_frequency/1e3/1e3,"server memory (gb)":t.instance.host.memory_bits/1024/1024/1024,"server os":t.instance.host.os,"server arch":t.instance.host.arch,"server os family":t.instance.host.os_family,"server kernel version":t.instance.host.kernel_version,"server kernel version string":t.instance.host.kernel_version_string,"is genuine mongodb":void 0===t.instance.genuineMongoDB||t.instance.genuineMongoDB.isGenuine,"server name":void 0===t.instance.genuineMongoDB?"mongodb":t.instance.genuineMongoDB.dbType,"is data lake":void 0!==t.instance.dataLake&&t.instance.dataLake.isDataLake,"data lake version":void 0===t.instance.dataLake?null:t.instance.dataLake.version,is_atlas:t.instance.isAtlas,is_localhost:!!t.instance._id.match(c),compass_version:e,...n}}},{registryEvent:"compass:schema:schema-sampled",resource:"Schema",action:"sampled",condition:e=>"complete"===e.samplingState,metadata:(e,t)=>({"sampling time ms":t.samplingTimeMS,"number of fields":t.schema.fields.length,"schema width":r().width(t.schema),"schema depth":r().depth(t.schema),"schema branching factors":r().branch(t.schema),is_geo:Object.keys(t.geo).length>0,geo_layers:Object.values(t.geo).map((e=>e.type)),compass_version:e})},{registryEvent:"document-deleted",resource:"Document",action:"deleted",condition:()=>!0,metadata:(e,{view:t})=>({view:t,compass_version:e})},{registryEvent:"document-updated",resource:"Document",action:"updated",condition:()=>!0,metadata:(e,t,n)=>({screen:n,view:t,compass_version:e})},{registryEvent:"document-inserted",resource:"Document",action:"inserted",condition:()=>!0,metadata:(e,{view:t,mode:n,multiple:s})=>({mode:n,multiple:s,view:t,compass_version:e})},{registryEvent:"document-view-changed",resource:"Document",action:"viewed",condition:()=>!0,metadata:(e,t)=>({view:t,compass_version:e})},{registryEvent:"documents-refreshed",resource:"Documents",action:"refreshed",condition:()=>!0,metadata:(e,t)=>({view:t,compass_version:e})},{registryEvent:"documents-paginated",resource:"Documents",action:"paginated",condition:()=>!0,metadata:(e,t)=>({view:t,compass_version:e})},{registryEvent:"schema-validation-activated",resource:"SchemaValidation",action:"activated",condition:()=>!0,metadata:(e,t)=>({ruleCount:t.ruleCount,validationLevel:t.validationLevel,validationAction:t.validationAction,jsonSchema:t.jsonSchema,collectionSize:t.collectionSize,compass_version:e})},{registryEvent:"schema-validation-saved",resource:"SchemaValidation",action:"saved",condition:()=>!0,metadata:(e,t)=>({ruleCount:t.ruleCount,validationLevel:t.validationLevel,validationAction:t.validationAction,jsonSchema:t.jsonSchema,collectionSize:t.collectionSize,compass_version:e})},{registryEvent:"schema-validation-rules-added",resource:"SchemaValidation",action:"rulesadded",condition:()=>!0,metadata:(e,t)=>({collectionSize:t.collectionSize,compass_version:e})},{registryEvent:"schema-validation-fetched",resource:"SchemaValidation",action:"fetched",condition:()=>!0,metadata:(e,t)=>({ruleCount:t.ruleCount,validationLevel:t.validationLevel,validationAction:t.validationAction,jsonSchema:t.jsonSchema,collectionSize:t.collectionSize,compass_version:e})},{registryEvent:"explain-plan-fetched",resource:"Explain",action:"fetched",condition:()=>!0,metadata:(e,t)=>({viewMode:t.viewMode,executionTimeMS:t.executionTimeMS,inMemorySort:t.inMemorySort,isCollectionScan:t.isCollectionScan,isCovered:t.isCovered,isMultiKey:t.isMultiKey,isSharded:t.isSharded,indexType:t.indexType,numberOfDocsReturned:t.numberOfDocsReturned,numberOfShards:t.numberOfShards,totalDocsExamined:t.totalDocsExamined,totalKeysExamined:t.totalKeysExamined,compass_version:e})},{registryEvent:"compass:collection:created",resource:"Collection",action:"created",condition:()=>!0,metadata:(e,t)=>({is_capped:t.isCapped,has_custom_collation:t.hasCustomCollation,collection_type:t.collectionType,compass_version:e})},{registryEvent:"compass:collection-stats:loaded",resource:"Collection Stats",action:"fetched",condition:e=>void 0!==e,metadata:(e,t)=>({"document count":t.documentCount,"total document size kb":t.totalDocumentSize,"avg document size kb":t.avgDocumentSize,"index count":t.indexCount,"total index size kb":t.totalIndexSize,"avg index size kb":t.avgIndexSize,compass_version:e})},{registryEvent:"compass:indexes:created",resource:"Indexes",action:"created",condition:()=>!0,metadata:e=>({compass_version:e})},{registryEvent:"compass:query-bar:query-changed",resource:"Query",action:"applied",condition:e=>"apply"===e.queryState,metadata:(e,t)=>({has_filter:d(t.filter),has_project:d(t.project),has_sort:d(t.sort),skip:t.skip,limit:t.limit,collection_type:t.collectionType,compass_version:e})},{registryEvent:"open-export",resource:"Export",action:"opened",condition:()=>!0,metadata:e=>({compass_version:e})},{registryEvent:"export-finished",resource:"Export",action:"completed",condition:()=>!0,metadata:(e,t,n)=>({size:t,"file type":n,compass_version:e})},{registryEvent:"open-import",resource:"Import",action:"opened",condition:()=>!0,metadata:e=>({compass_version:e})},{registryEvent:"import-finished",resource:"Import",action:"completed",condition:()=>!0,metadata:(e,{size:t,fileType:n})=>({size:t,"file type":n,compass_version:e})},{registryEvent:"agg-pipeline-executed",resource:"Aggregation",action:"executed",condition:()=>!0,metadata:(e,t)=>({numStages:t.numStages,stageOperators:t.stageOperators,compass_version:e})},{registryEvent:"agg-pipeline-saved",resource:"Aggregation",action:"saved",condition:()=>!0,metadata:e=>({compass_version:e})},{registryEvent:"agg-pipeline-deleted",resource:"Aggregation",action:"deleted",condition:()=>!0,metadata:e=>({compass_version:e})},{registryEvent:"compass:aggregations:update-view",resource:"Aggregation",action:"viewUpdated",condition:()=>!0,metadata:(e,t)=>({numStages:t.numStages,compass_version:e})},{registryEvent:"compass:aggregations:create-view",resource:"Aggregation",action:"viewCreated",condition:()=>!0,metadata:(e,t)=>({numStages:t.numStages,compass_version:e})},{registryEvent:"compass:aggregations:settings-applied",resource:"Aggregation",action:"settingsChanged",condition:()=>!0,metadata:(e,t)=>({...t,compass_version:e})},{registryEvent:"compass:aggregations:pipeline-imported",resource:"Aggregation",action:"pipelineImported",condition:()=>!0,metadata:e=>({compass_version:e})},{registryEvent:"compass:aggregations:pipeline-opened",resource:"Aggregation",action:"pipelineOpened",condition:()=>!0,metadata:e=>({compass_version:e})},{registryEvent:"compass:export-to-language:opened",resource:"ExportToLanguage",action:"opened",condition:()=>!0,metadata:(e,t)=>({source:t.source,compass_version:e})},{registryEvent:"compass:export-to-language:run",resource:"ExportToLanguage",action:"run",condition:()=>!0,metadata:(e,t)=>({language:t.language,showImports:t.showImports,type:t.type,driver:t.driver,compass_version:e})},{registryEvent:"tour-closed",resource:"Tour",action:"closed",condition:()=>!0,metadata:(e,t)=>({tab:t,compass_version:e})},{registryEvent:"create-atlas-cluster-clicked",resource:"AtlasLink",action:"clicked",condition:()=>!0,metadata:e=>({compass_version:e})},{registryEvent:"compass:compass-shell:opened",resource:"Shell",action:"opened",condition:()=>!0,metadata:e=>({compass_version:e})},{registryEvent:"mongosh:show",resource:"Shell",action:"show",condition:()=>!0,metadata:(e,t)=>({compass_version:e,properties:{method:t.method}})},{registryEvent:"mongosh:use",resource:"Shell",action:"use",condition:()=>!0,metadata:e=>({compass_version:e})},{registryEvent:"mongosh:api-call",resource:"Shell",action:"api-call",condition:()=>!0,metadata:(e,t)=>({compass_version:e,method:t.method,class:t.class})},{registryEvent:"mongosh:error",resource:"Shell",action:"error",condition:e=>e&&e.name&&e.name.includes("Mongosh"),metadata:(e,t)=>({compass_version:e,properties:{error:t}})}];var u=n(75558),m=n.n(u),h=n(10244),g=n.n(h),b=n(76670),y=n.n(b),f=n(39854),v=n(73837),E=n(45727),S=n.n(E);const x=n(39854)(),w=e=>new MutationObserver((t=>{t.forEach((t=>{t.addedNodes&&[].forEach.call(t.addedNodes,e)}))}));var C=n(74587),k=n.n(C),N=n(79343),_=n.n(N);const T=f.resources.BaseResource,A=f.resources.FeatureResource,R=n(42667)("mongodb-compass:metrics:features"),O=k()(_()(["Clipboard Detection","Document Viewer","Query Builder","Help Window","Network Opt-in","Share Schema","Intercom Panel","Feature Tour","Connection","Indexes"],(function(e){return[e,new(A.extend({id:e,eventTrackers:["stitch"]}))]}))),D=A.extend({id:"Geo Data",eventTrackers:["stitch"],detected:function(e,t){this._send_event(e,t)}}),P=A.extend({id:"Collection",eventTrackers:["stitch"],fetched:function(e,t){this._send_event(e,t)},created:function(e,t){this._send_event(e,t)}}),I=A.extend({id:"Deployment",eventTrackers:["ga","intercom","stitch"],detected:function(e,t){this._send_event(e,t)}}),L=T.extend({id:"Schema",eventTrackers:["stitch"],sampled:function(e,t){this._send_event(e,t)}}),j=T.extend({id:"Indexes",eventTrackers:["stitch"],fetched:function(e,t){this._send_event(e,t)}}),M=T.extend({id:"Collection Stats",eventTrackers:["stitch"],fetched:function(e,t){this._send_event(e,t)}}),q=T.extend({id:"Topology",eventTrackers:["stitch"],detected:function(e,t){this._send_event(e,t)}}),F=T.extend({id:"Query",eventTrackers:["stitch"],applied:function(e,t){this._send_event(e,t)}}),V=T.extend({id:"Application",eventTrackers:["stitch"],connected:function(e,t){this._send_event(e,t)}}),B=T.extend({id:"Validation Rules",eventTrackers:["stitch"],fetched:function(e,t){this._send_event(e,t)}}),U=T.extend({id:"SchemaValidation",eventTrackers:["stitch"],fetched:function(e,t){this._send_event(e,t)},activated:function(e,t){this._send_event(e,t)},saved:function(e,t){this._send_event(e,t)},rulesadded:function(e,t){this._send_event(e,t)}}),H=T.extend({id:"Explain",eventTrackers:["stitch"],fetched:function(e,t){this._send_event(e,t)}}),$=T.extend({id:"Document",eventTrackers:["stitch"],inserted:function(e,t){this._send_event(e,t)},updated:function(e,t){this._send_event(e,t)},deleted:function(e,t){this._send_event(e,t)}}),z=T.extend({id:"Aggregation",eventTrackers:["stitch"],executed:function(e,t){this._send_event(e,t)},saved:function(e,t){this._send_event(e,t)},deleted:function(e,t){this._send_event(e,t)}}),G=T.extend({id:"AtlasLink",eventTrackers:["stitch"],clicked:function(e,t){this._send_event(e,t)}}),Q=T.extend({id:"Documents",eventTrackers:["stitch"],loaded:function(e,t){this._send_event(e,t)}}),W=T.extend({id:"Documents List View",eventTrackers:["stitch"],paginated:function(e,t){this._send_event(e,t)}}),K=T.extend({id:"Documents Table View",eventTrackers:["stitch"],paginated:function(e,t){this._send_event(e,t)}}),Z=T.extend({id:"License",eventTrackers:["stitch"],viewed:function(e,t){this._send_event(e,t)}}),X=T.extend({id:"Auto Update",eventTrackers:["ga","intercom","stitch"],checking:function(e,t){this._send_event(e,t)},uptodate:function(e,t){this._send_event(e,t)},available:function(e,t){this._send_event(e,t)},downloaded:function(e,t){this._send_event(e,t)},cancelled:function(e,t){this._send_event(e,t)},confirmed:function(e,t){this._send_event(e,t)}}),Y=T.extend({id:"Import",eventTrackers:["stitch"],completed:function(e,t){this._send_event(e,t)}}),J=T.extend({id:"Export",eventTrackers:["stitch"],completed:function(e,t){this._send_event(e,t)}}),ee=T.extend({id:"ExportToLanguage",eventTrackers:["stitch"],opened:function(e,t){this._send_event(e,t)},run:function(e,t){this._send_event(e,t)}}),te=T.extend({id:"Tour",eventTrackers:["stitch"],closed:function(e,t){this._send_event(e,t)}}),ne=T.extend({id:"Shell",eventTrackers:["stitch"],opened:function(e,t){this._send_event(e,t)},show:function(e,t){this._send_event(e,t)},use:function(e,t){this._send_event(e,t)},"api-call":function(e,t){this._send_event(e,t)},error:function(e,t){this._send_event(e,t)}}),se=T.extend({id:"Screen",eventTrackers:["stitch"],viewed:function(e,t){this._send_event(e,t)}});O.Screen=new se,O.Tour=new te,O["Geo Data"]=new D,O["Auto Update"]=new X,O.Collection=new P,O.AtlasLink=new G,O.ExportToLanguageResource=new ee,O.Deployment=new I,O.Shell=new ne,O.Schema=new L,O.Indexes=new j,O["Collection Stats"]=new M,O.Topology=new q,O.Query=new F,O.Application=new V,O["Validation Rules"]=new B,O.SchemaValidation=new U,O.Explain=new H,O.Import=new Y,O.Export=new J,O.Aggregation=new z,O.Document=new $,O.Documents=new Q,O.DocumentsListView=new W,O.DocumentsTableView=new K,O.License=new Z,R("feature resources",O);const ae=O,ie=n(39854)(),re=n(42667)("mongodb-compass:metrics:setup"),oe="p57suhg7",le=(e,t,n)=>{const s=global.hadronApp;{let e=!1;if(ie.configure({stitch:{appId:"datawarehouseprod-compass-nqnxw",enabled:s.preferences.trackUsageStatistics},bugsnag:{apiKey:"0d11ab5f4d97452cc83d3365c21b491c",metaData:{user:{"User Profile in Intercom":(0,v.format)("https://app.intercom.io/apps/%s/users/show?user_id=%s",oe,s.user.id)}},enabled:!1}}),s.preferences.enableFeedbackPanel){const t=new XMLHttpRequest;t.onreadystatechange=()=>{try{t.readyState===XMLHttpRequest.DONE&&(t.status<400?ie.configure({intercom:{appId:oe,enabled:s.preferences.enableFeedbackPanel,panelEnabled:s.preferences.enableFeedbackPanel}}):e=!0)}catch(t){e=!0}};try{t.open("GET",(0,v.format)("https://widget.intercom.io/widget/%s",oe),!0),t.send()}catch(t){e=!0}}const a=new f.resources.AppResource({appName:t,appVersion:n,appPlatform:process.platform,appStage:"production"}),i=new f.resources.UserResource({userId:s.user.id,createdAt:s.user.createdAt,name:s.user.name,email:s.user.email,twitter:s.user.twitter,developer:!1}),r=new f.resources.ErrorResource;ie.addResource(a,i,r),ie.addResource.apply(ie,y()(m()(ae))),re("metrics configured with trackers %j and resources %j",g()(ie.trackers.filter("enabled"),"id"),ie.resources.pluck("id")),S().once("app:launched",(function(){ie.track("App","launched"),s.preferences.trigger("app-restart"),s.preferences.lastKnownVersion!==n&&(ie.track("App","upgraded",s.preferences.lastKnownVersion),s.preferences.trigger("app-version-mismatch"))})),S().once("app:quit",(function(){ie.track("App","quit")})),window.addEventListener("error",(function(e){re("error encountered, notify trackers",e),ie.error(e)})),s.preferences.on("change:trackUsageStatistics",(function(e,t){if(ie.trackers.get("ga").enabled=t,ie.trackers.get("intercom").enabled=t,t&&!s.preferences.enableFeedbackPanel){const e=document.querySelector("#intercom-container");e&&e.classList.add("hidden")}})),s.preferences.on("change:enableFeedbackPanel",(function(e,t){if(ie.trackers.get("intercom").panelEnabled=t,Window&&document.querySelector("#intercom-container")){const e=document.querySelector("#intercom-container");e&&(t?e.classList.remove("hidden"):e.classList.add("hidden"))}})),!e&&s.preferences.enableFeedbackPanel&&(()=>{const e=global.hadronApp;S().on("window:show-intercom-panel",(function(){window.Intercom&&e.preferences.enableFeedbackPanel&&e.preferences.trackUsageStatistics&&(document.querySelector("#intercom-container").classList.remove("hidden"),x.track("Intercom Panel","used"))}));const t=w((function(t){"A"===t.nodeName?t.onclick=e.state.onLinkClick.bind(e.state):t.querySelectorAll&&t.querySelectorAll("a").forEach((function(t){t.onclick=e.state.onLinkClick.bind(e.state)}))})),n=w((e=>{"intercom-container"===e.id&&(t.observe(e,{childList:!0,subtree:!0}),n.disconnect())}));n.observe(document.body,{childList:!0})})()}s.metrics=ie},ce=(0,s.createStore)((function(e=a){return e})),de=n(39854)();ce.onActivated=e=>{e.on("application-initialized",((t,n)=>{le(0,n,t),p.forEach((n=>{const s=n.registryEvent;((e,t,n,s)=>{e.on(t,(async(...e)=>{n.condition(...e)&&de.track(n.resource,n.action,await n.metadata(s,...e))}))})(e,s,n,t)}))}))};const pe=ce,ue=JSON.parse('{"name":"@mongodb-js/compass-metrics","productName":"Compass Metrics Plugin","version":"4.21.0","apiVersion":"3.0.0","description":"Compass Metrics Plugin","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","test-cov":"nyc npm run test","check":"npm run lint && npm run depcheck","prepublishOnly":"npm run compile","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","bootstrap":"npm run compile"},"license":"SSPL","peerDependencies":{"debug":"*","hadron-ipc":"^2.9.0","mongodb-js-metrics":"^7.9.0","mongodb-schema":"^8.2.5","redux":"^4.1.2"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","autoprefixer":"^9.4.6","babel-loader":"^8.2.2","chai":"^4.2.0","chai-enzyme":"1.0.0-beta.1","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^7.0.0","css-loader":"^4.3.0","debug":"mongodb-js/debug#v2.2.3","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^5.0.3","eslint-plugin-react":"^7.24.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","hadron-ipc":"^2.9.0","hadron-react-components":"^5.13.0","html-webpack-plugin":"^3.2.0","ignore-loader":"^0.1.2","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","json-loader":"^0.5.7","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","less":"^3.11.1","less-loader":"^7.3.0","mini-css-extract-plugin":"^0.9.0","mocha":"^7.0.1","mocha-webpack":"^2.0.0-beta.0","mongodb-connection-model":"^21.15.0","mongodb-js-metrics":"^7.9.0","mongodb-reflux-store":"^0.0.1","mongodb-schema":"^8.2.5","node-loader":"^0.6.0","nyc":"^15.0.0","peer-deps-externals-webpack-plugin":"^1.0.4","postcss-loader":"^2.1.6","react":"^16.14.0","react-bootstrap":"^0.33.1","react-dom":"^16.14.0","react-fontawesome":"^1.6.1","react-hot-loader":"^4.13.0","redux":"^4.1.2","resolve":"^1.15.1","rimraf":"^3.0.0","semver":"^5.4.1","shebang-loader":"^0.0.1","sinon":"^8.1.1","sinon-chai":"^3.4.0","style-loader":"^2.0.0","url-loader":"^3.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^3.0.3","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-merge":"^4.2.2","webpack-node-externals":"^3.0.0","xvfb-maybe":"^0.2.1"},"dependencies":{"lodash.compact":"^3.0.1","lodash.map":"^4.6.0","lodash.pluck":"^3.1.2","lodash.values":"^4.3.0","lodash.zipobject":"^4.1.3","mongodb-cloud-info":"^1.1.3","mongodb-connection-string-url":"^2.5.1"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"}}');function me(e){e.registerStore("Metrics.Store",pe)}function he(e){e.deregisterStore("Metrics.Store")}const ge=null},75650:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>A,deactivate:()=>R,default:()=>O,metadata:()=>_});var s=n(2784),a=n(70602),i=n(13980),r=n.n(i),o=n(72779),l=n.n(o);class c extends s.Component{static displayName="PluginDetailComponent";static propTypes={isActivated:r().bool.isRequired,isExpanded:r().bool.isRequired,metadata:r().object.isRequired,error:r().object,expandHandler:r().func};static defaultProps={isActivated:!1};rootClassNames(){const e={"plugin-detail-module-plugin-detail__19RV3":!0};return e["plugin-detail-module-plugin-detail-has-error__3gdzn"]=this.props.error,e}renderIsActivated(){return this.props.isActivated?s.createElement("i",{className:"fa fa-check-circle"}):s.createElement("i",{className:"fa fa-exclamation-circle"})}renderExpandIcon(){return this.props.isExpanded?s.createElement("i",{className:"fa fa-minus-square-o"}):s.createElement("i",{className:"fa fa-plus-square-o"})}renderExpand(){if(this.props.error)return s.createElement("span",{onClick:this.props.expandHandler},this.renderExpandIcon())}render(){return s.createElement("div",{className:l()(this.rootClassNames())},s.createElement("div",{className:l()("plugin-detail-module-plugin-detail-expand__201JZ")},this.renderExpand()),s.createElement("div",{className:l()("plugin-detail-module-plugin-detail-product-name__n5cW2")},this.props.metadata.productName||this.props.metadata.name),s.createElement("div",{className:l()("plugin-detail-module-plugin-detail-name__1Qu99")},this.props.metadata.name),s.createElement("div",{className:l()("plugin-detail-module-plugin-detail-version__2_Fpq")},this.props.metadata.version),s.createElement("div",{className:l()("plugin-detail-module-plugin-detail-description__1N3Y1")},this.props.metadata.description),s.createElement("div",{className:l()("plugin-detail-module-plugin-detail-is-activated__18CZz")},this.renderIsActivated()))}}const d=c;class p extends s.Component{static displayName="PluginErrorComponent";static propTypes={error:r().object.isRequired};render(){return s.createElement("div",{className:l()("plugin-error-module-plugin-error__3Quha")},s.createElement("div",{className:l()("plugin-error-module-plugin-error-message__2Rm7y")},this.props.error.message),s.createElement("div",{className:l()("plugin-error-module-plugin-error-stack__LSQP9")},this.props.error.stack))}}const u=p;function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},m.apply(this,arguments)}class h extends s.Component{static displayName="PluginComponent";static propTypes={isActivated:r().bool.isRequired,metadata:r().object.isRequired,error:r().object};static defaultProps={isActivated:!1};constructor(e){super(e),this.state={isExpanded:!1}}onExpandClick(){this.setState({isExpanded:!this.state.isExpanded})}rootClassNames(){const e={"plugin-module-plugin__3WMFV":!0};return e["plugin-module-plugin-has-error__1SjnB"]=this.props.error,e}renderPluginError(){if(this.state.isExpanded)return s.createElement(u,{error:this.props.error})}render(){return s.createElement("div",{className:l()(this.rootClassNames())},s.createElement(d,m({},this.props,{isExpanded:this.state.isExpanded,expandHandler:this.onExpandClick.bind(this)})),this.renderPluginError())}}const g=h;var b=n(10862),y=n.n(b);const f=y().createActions(["show","hide"]);class v extends s.Component{static displayName="SecurityComponent";static propTypes={isVisible:r().bool,plugins:r().array};static defaultProps={isVisible:!1,plugins:[]};hide(){f.hide()}rootClassNames(){const e={"security-module-security__23Omw":!0};return e["security-module-security-is-visible__3hR4I"]=this.props.isVisible,e}renderPlugins(){return this.props.plugins.map(((e,t)=>s.createElement(g,{key:t,isActivated:e.isActivated,metadata:e.metadata,error:e.error})))}render(){return s.createElement("div",{className:l()(this.rootClassNames())},s.createElement("div",{className:l()("security-module-security-header__3E1Fq")},s.createElement("span",null,"Installed Plugins"),s.createElement("button",{className:"btn btn-default btn-xs",onClick:this.hide.bind(this)},"Close")),s.createElement("div",{className:l()("security-module-security-content__2blqh")},this.renderPlugins()))}}const E=v;var S=n(99837),x=n.n(S);const w=y().createStore({mixins:[x().store],listenables:f,onActivated(){this.setState({plugins:global.hadronApp.pluginManager.plugins})},show(){this.setState({isVisible:!0})},hide(){this.setState({isVisible:!1})},getInitialState:()=>({plugins:[],isVisible:!1})});function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},C.apply(this,arguments)}class k extends s.Component{static displayName="SecurityPlugin";render(){return s.createElement(a.StoreConnector,{store:w},s.createElement(E,C({actions:f},this.props)))}}const N=k,_=JSON.parse('{"name":"@mongodb-js/compass-plugin-info","productName":"Compass Plugin Info","version":"3.21.0","apiVersion":"3.0.0","description":"Compass Plugin Information Plugin","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-cov":"nyc npm run test","check":"npm run lint && npm run depcheck","prepublishOnly":"npm run compile","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","bootstrap":"npm run compile"},"license":"SSPL","peerDependencies":{"hadron-react-components":"^5.13.0","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","@mongodb-js/hadron-plugin-manager":"^6.12.0","autoprefixer":"^7.1.2","babel-loader":"^8.2.2","chai":"^4.1.2","chai-enzyme":"1.0.0-beta.0","cheerio":"^1.0.0-rc.2","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^5.0.1","css-loader":"^4.3.0","debug":"^3.0.1","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^2.1.0","eslint-plugin-react":"^7.24.0","extract-text-webpack-plugin":"^4.0.0-beta.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","hadron-react-components":"^5.13.0","html-webpack-plugin":"^3.2.0","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","less":"^3.11.1","less-loader":"^7.3.0","mocha":"^4.1.0","mocha-webpack":"^2.0.0-beta.0","mongodb-reflux-store":"^0.0.1","nyc":"^11.0.3","peer-deps-externals-webpack-plugin":"^1.0.4","postcss-loader":"^2.1.6","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","react-hot-loader":"^4.13.0","react-test-renderer":"^15.6.1","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","resolve":"^1.15.1","rimraf":"^2.6.1","semver":"^5.4.1","sinon":"^3.2.0","sinon-chai":"^2.11.0","style-loader":"^2.0.0","url-loader":"^3.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^2.9.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^3.0.0"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"}}'),T={name:"Security",component:N};function A(e){e.registerRole("Application.Security",T),e.registerAction("Security.Actions",f),e.registerStore("Security.Store",w)}function R(e){e.deregisterRole("Application.Security",T),e.deregisterAction("Security.Actions"),e.deregisterStore("Security.Store")}const O=N},10842:(e,t,n)=>{var s=n(75551);e.exports=s},75551:(e,t,n)=>{var s=n(71305),a=n(37421),i=n(77485),r=n(73837).format,o=n(72298),l=o.remote?o.remote.app:void 0,c=n(22374)("mongodb-compass:models:preferences"),d={DARK:"DARK",LIGHT:"LIGHT",OS_THEME:"OS_THEME"},p={id:{type:"string",default:"General",required:!0},lastKnownVersion:{type:"string",required:!1},showFeatureTour:{type:"string",required:!1,default:void 0},showedNetworkOptIn:{type:"boolean",required:!0,default:!1},theme:{type:"string",required:!0,default:d.LIGHT},currentUserId:{type:"string",required:!1},telemetryAnonymousId:{type:"string",required:!0,default:""},agreedToLicense:{type:"boolean",required:!0,default:!1},networkTraffic:{type:"boolean",required:!0,default:!0},enableMaps:{type:"boolean",required:!0,default:!1},trackErrors:{type:"boolean",required:!0,default:!1},enableFeedbackPanel:{type:"boolean",required:!0,default:!1},trackUsageStatistics:{type:"boolean",required:!0,default:!1},autoUpdates:{type:"boolean",required:!0,default:!1},indexDDL:{type:"boolean",required:!0,default:!1},showAutoUpdateBanner:{type:"boolean",required:!0,default:!1},queryBuilder:{type:"boolean",required:!0,default:!0},showExplainPlanTab:{type:"boolean",required:!0,default:!1},singleDocumentCrud:{type:"boolean",required:!0,default:!1},serverStats:{type:"boolean",required:!0,default:!1},chartView:{type:"boolean",required:!0,default:!1},authMongodb:{type:"boolean",required:!0,default:!0},authKerberos:{type:"boolean",required:!0,default:!0},authLdap:{type:"boolean",required:!0,default:!0},authX509:{type:"boolean",required:!0,default:!1},sslUnvalidated:{type:"boolean",required:!0,default:!0},sslServer:{type:"boolean",required:!0,default:!0},sslAll:{type:"boolean",required:!0,default:!0}},u=s.extend(a,{props:p,extraProperties:"ignore",idAttribute:"id",namespace:"AppPreferences",storage:{backend:"disk",basepath:l?l.getPath("userData"):void 0},initialize:function(){this.on("page-refresh",this.onPageRefresh.bind(this)),this.on("app-restart",this.onAppRestart.bind(this)),this.on("app-version-mismatch",this.onAppVersionMismatch.bind(this))},onPageRefresh:function(){c("app page refresh detected")},onAppRestart:function(){c("app restart detected")},onAppVersionMismatch:function(e,t){c("version mismatch detected: was %s, now %s",e,t)},isFeatureEnabled:function(e){if(-1!==["enableMaps","trackErrors","enableFeedbackPanel","trackUsageStatistics","autoUpdates"].indexOf(e))return this.networkTraffic&&i(this,e);var t=i(this,e,null);if(null===t)throw new Error(r("Feature %s unknown.",e));return t}});e.exports=u,e.exports.THEMES=d},58666:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>le,configureActions:()=>j,configureStore:()=>ie,deactivate:()=>ce,default:()=>de,metadata:()=>re});var s=n(2784),a=n(13980),i=n.n(a),r=n(70602),o=n(72779),l=n.n(o),c=n(82752),d=n(13253),p=n(76635),u=n(12170),m=n.n(u),h=(n(95095),n(21291)),g=n(52908);var b=n(59910),y=n.n(b);n(59047),n(10826);const f={enableLiveAutocompletion:!0,tabSize:2,useSoftTabs:!0,fontSize:11,minLines:1,maxLines:10,highlightActiveLine:!1,showPrintMargin:!1,showGutter:!1,useWorker:!1,mode:"ace/mode/mongodb"};class v extends s.Component{static displayName="OptionEditor";static propTypes={label:i().string.isRequired,serverVersion:i().string.isRequired,autoPopulated:i().bool.isRequired,actions:i().object.isRequired,value:i().any,onChange:i().func,onApply:i().func,placeholder:i().string,schemaFields:i().array};static defaultProps={label:"",value:"",serverVersion:"3.6.0",autoPopulated:!1,schemaFields:[]};constructor(e){super(e);const t=y().textCompleter;this.completer=new g.QueryAutoCompleter(e.serverVersion,t,e.schemaFields),this.boundOnFieldsChanged=this.onFieldsChanged.bind(this)}componentDidMount(){this.unsub=this.props.actions.refreshEditor.listen((()=>{this.editor.setValue(this.props.value),this.editor.clearSelection()}))}shouldComponentUpdate(e){return this.boundOnFieldsChanged(e.schemaFields),e.autoPopulated||e.serverVersion!==this.props.serverVersion}componentWillUnmount(){this.unsub()}onFieldsChanged(e){this.completer.update(e)}onChangeQuery=e=>{this.props.onChange({target:{value:e}})};render(){return s.createElement(h.default,{className:"option-editor-module-option-editor__Tlr1U",mode:"javascript",theme:"mongodb-query",width:"100%",value:this.props.value,onChange:this.onChangeQuery,editorProps:{$blockScrolling:1/0},name:`query-bar-option-input-${this.props.label}`,setOptions:f,onFocus:()=>{y().setCompleters([this.completer])},placeholder:this.props.placeholder,onLoad:e=>{this.editor=e,this.editor.setBehavioursEnabled(!0),this.editor.commands.addCommand({name:"executeQuery",bindKey:{win:"Enter",mac:"Enter"},exec:()=>{this.props.onApply()}})}})}}const E=v,S={component:"query-option-module-component__2hv9N","has-toggle":"query-option-module-has-toggle__3PtHF","has-error":"query-option-module-has-error__3zef6",label:"query-option-module-label__k43Ag","is-document-type":"query-option-module-is-document-type__2tkrB","is-numeric-type":"query-option-module-is-numeric-type__GTf-E","is-boolean-type":"query-option-module-is-boolean-type__RT66b",input:"query-option-module-input__2y47p","input-boolean":"query-option-module-input-boolean__3ZtMx"};class x extends s.Component{static displayName="QueryOption";static propTypes={placeholder:i().string,label:i().string.isRequired,serverVersion:i().string.isRequired,link:i().string.isRequired,actions:i().object.isRequired,inputType:i().oneOf(["numeric","boolean","document"]).isRequired,value:i().any,autoPopulated:i().bool,hasToggle:i().bool,hasError:i().bool,validationFunc:i().func,onChange:i().func,onApply:i().func,schemaFields:i().array};static defaultProps={placeholder:"",value:"",hasToggle:!1,schemaFields:[]};_getInnerClassName(){const{label:e,inputType:t,hasToggle:n}=this.props;return l()(S.input,{[S[`input-${e}`]]:e},{[S[`input-${t}`]]:t},{[S["has-toggle"]]:n})}_renderCheckboxInput(){const{label:e,value:t,onChange:n}=this.props;return s.createElement("input",{id:`querybar-option-input-${e}`,"data-test-id":"query-bar-option-input",className:this._getInnerClassName(),type:"checkbox",checked:t,onChange:n})}_openLink(e){if(navigator.userAgent.toLowerCase().indexOf("electron")>-1){const{shell:t}=n(72298);t.openExternal(e)}else window.open(e,"_new")}_renderAutoCompleteInput(){return s.createElement(E,{label:this.props.label,value:this.props.value,serverVersion:this.props.serverVersion,onChange:this.props.onChange,onApply:this.props.onApply,autoPopulated:this.props.autoPopulated,actions:this.props.actions,schemaFields:this.props.schemaFields,placeholder:this.props.placeholder})}_renderSimpleInput(){return s.createElement("input",{id:`querybar-option-input-${this.props.label}`,"data-test-id":"query-bar-option-input",className:this._getInnerClassName(),type:"text",value:this.props.value,onChange:this.props.onChange,placeholder:this.props.placeholder})}render(){const{inputType:e,hasError:t,link:n,label:a,hasToggle:i}=this.props;let o=null;o=["filter","project","sort","collation"].includes(a)?this._renderAutoCompleteInput():"boolean"===this.props.inputType?this._renderCheckboxInput():this._renderSimpleInput();const c=l()(S.component,{[S[`is-${e}-type`]]:!0},{[S["has-error"]]:t},{[S["has-toggle"]]:i});return s.createElement("div",{className:c,"data-test-id":"query-bar-option"},s.createElement("div",{className:S.label,"data-test-id":"query-bar-option-label"},s.createElement(r.InfoSprinkle,{helpLink:n,onClickHandler:this._openLink}),a),o)}}const w=x;class C extends s.PureComponent{static displayName="OptionsToggle";static propTypes={actions:i().object.isRequired,className:i().string,expanded:i().bool.isRequired};static defaultProps={className:""};onClick=()=>{this.props.actions.toggleQueryOptions()};render(){const{expanded:e,className:t}=this.props,n=e?"caret-down":"caret-right",a=l()("btn","btn-default","btn-xs","options-toggle-module-component__17Hnk",{"options-toggle-module-is-open__2ht9A":e},t);return s.createElement("div",{className:a,onClick:this.onClick,"data-test-id":"query-bar-options-toggle"},s.createElement(m(),{fixedWidth:!0,name:n}),s.createElement("span",{"data-test-id":"query-bar-options-toggle-text"},"Options"))}}const k=C,N=["filter","project","collation","sort","skip","limit","sample","maxTimeMS"],_={component:"query-bar-module-component__3qf8c","input-container":"query-bar-module-input-container__2ZLiG","is-feature-flag":"query-bar-module-is-feature-flag__3ch-1","form-control":"query-bar-module-form-control__2mpSW","syntax-help":"query-bar-module-syntax-help__xAIrm","input-group":"query-bar-module-input-group__2I4tM","option-container":"query-bar-module-option-container__2M1A9",option:"query-bar-module-option__2sLUN","CodeMirror-placeholder":"query-bar-module-CodeMirror-placeholder__UQfic","has-focus":"query-bar-module-has-focus__3GEwX","option-group":"query-bar-module-option-group__1_7u8","button-group":"query-bar-module-button-group__1qwsJ","reset-button":"query-bar-module-reset-button__3s08v","query-history-button":"query-bar-module-query-history-button__2xm1a","query-option-toggle-row":"query-bar-module-query-option-toggle-row__1YYQF"},T={filter:{type:"document",placeholder:"{ field: 'value' }",link:"https://docs.mongodb.com/compass/current/query/filter/"},project:{type:"document",placeholder:"{ field: 0 }",link:"https://docs.mongodb.com/manual/tutorial/project-fields-from-query-results/"},sort:{type:"document",placeholder:"{ field: -1 } or [['field', -1]]",link:"https://docs.mongodb.com/manual/reference/method/cursor.sort/"},collation:{type:"document",placeholder:"{ locale: 'simple' }",link:"https://docs.mongodb.com/master/reference/collation/"},skip:{type:"numeric",placeholder:"0",link:"https://docs.mongodb.com/manual/reference/method/cursor.skip/"},limit:{type:"numeric",placeholder:"0",link:"https://docs.mongodb.com/manual/reference/method/cursor.limit/"},maxTimeMS:{label:"Max Time MS",type:"numeric",placeholder:"60000",link:"https://docs.mongodb.com/manual/reference/method/cursor.maxTimeMS/"},sample:{type:"boolean",placeholder:null,link:"https://docs.mongodb.com/TBD"}};class A extends s.Component{static displayName="QueryBar";static propTypes={store:i().object.isRequired,filter:i().object,project:i().object,sort:i().object,collation:i().object,skip:i().number,limit:i().number,maxTimeMS:i().number,sample:i().bool,valid:i().bool,filterValid:i().bool,projectValid:i().bool,collationValid:i().bool,sortValid:i().bool,skipValid:i().bool,limitValid:i().bool,featureFlag:i().bool,autoPopulated:i().bool,filterString:i().string,projectString:i().string,collationString:i().string,sortString:i().string,skipString:i().string,limitString:i().string,filterPlaceholder:i().string,projectPlaceholder:i().string,collationPlaceholder:i().string,sortPlaceholder:i().string,skipPlaceholder:i().string,limitPlaceholder:i().string,maxTimeMSPlaceholder:i().string,actions:i().object,buttonLabel:i().string,queryState:i().string,serverVersion:i().string,layout:i().array,expanded:i().bool,lastExecutedQuery:i().object,onReset:i().func,onApply:i().func,resultId:i().number,schemaFields:i().array,showQueryHistoryButton:i().bool,showExportToLanguageButton:i().bool};static defaultProps={expanded:!1,buttonLabel:"Apply",layout:["filter","project",["sort","maxTimeMS"],["collation","skip","limit"]],schemaFields:[],showQueryHistoryButton:!0,showExportToLanguageButton:!0,resultId:0};state={hasFocus:!1};onChange(e,t){const n=T[e].type,{actions:s}=this.props;return["numeric","document"].includes(n)?s.typeQueryString(e,t.target.value):"boolean"===n?s.toggleSample(t.target.checked):void 0}onApplyButtonClicked=e=>{e&&(e.preventDefault(),e.stopPropagation());const{actions:t,valid:n,featureFlag:s,onApply:a}=this.props;(n||s)&&(t.apply(),(0,p.isFunction)(a)&&a())};onResetButtonClicked=()=>{const{actions:e,onReset:t}=this.props;e.reset(),(0,p.isFunction)(t)&&t()};getQueryOption(e,t,n,a,i,r,o,l){return s.createElement(w,{label:e,autoPopulated:t,serverVersion:this.props.serverVersion,hasToggle:n,hasError:a,key:`query-option-${i}`,value:r,actions:this.props.actions,placeholder:o,link:T[l].link,inputType:T[l].type,onChange:this.onChange.bind(this,l),onApply:this.onApplyButtonClicked,schemaFields:this.props.schemaFields})}_onFocus=()=>{this.setState({hasFocus:!0})};_onBlur=()=>{this.setState({hasFocus:!1})};_showToggle(){return this.props.layout.length>1}_queryHasChanges(){const e=(0,p.pick)(this.props,N);return!(0,p.isEqual)(e,this.props.lastExecutedQuery)}renderToggle(){const{expanded:e,actions:t}=this.props;return this._showToggle()?s.createElement(k,{expanded:e,actions:t}):null}renderOption(e,t,n){const{filterValid:a,featureFlag:i,autoPopulated:r}=this.props,o="filter"===e?!(a||i):!this.props[`${e}Valid`],l="boolean"===T[e].type?this.props[e]:this.props[`${e}String`],c=T[e].label||e,d=this.props[`${e}Placeholder`]||T[e].placeholder,p=this.getQueryOption(c,r,n,o,t,l,d,e);return n?s.createElement("div",{className:_["query-option-toggle-row"],key:`query-option-${t}`},p,this.renderToggle()):p}renderOptionGroup(e,t){const n=(0,p.map)(e,((e,t)=>this.renderOption(e,t,!1)));return s.createElement("div",{className:l()(_["option-group"]),key:`option-group-${t}`},n)}renderOptionRows(){const{layout:e,expanded:t}=this.props;if(this._showToggle()&&!(0,p.isString)(e[0]))throw new Error(`First item in multi-line layout must be single option, found ${e[0]}`);const n=(0,p.map)(e,((e,t)=>{const n=0===t&&this._showToggle();if((0,p.isString)(e))return this.renderOption(e,t,n);if((0,p.isArray)(e))return this.renderOptionGroup(e,t);throw new Error("Layout items must be string or array, found "+e)}));return t?n:n.slice(0,1)}renderForm=()=>{const{valid:e,featureFlag:t,queryState:n,buttonLabel:a,showQueryHistoryButton:i,showExportToLanguageButton:r}=this.props,{hasFocus:o}=this.state,p=l()(_["input-group"],{"has-error":!e},{"is-feature-flag":t}),u=!(e||t),h=l()(_["option-container"],{[_["has-focus"]]:o}),g=l()("btn","btn-primary","btn-sm",_["apply-button"]),b=l()("btn","btn-default","btn-sm",_["reset-button"],{disabled:"apply"!==n}),y=l()("btn","btn-default","btn-sm",_["query-history-button"]);return s.createElement("div",{className:p},s.createElement("div",{onBlur:this._onBlur,onFocus:this._onFocus,className:h},this.renderOptionRows()),s.createElement("div",{className:_["button-group"]},s.createElement("button",{"data-test-id":"query-bar-apply-filter-button",key:"apply-button",className:g,type:"button",onClick:this.onApplyButtonClicked,disabled:u},a),s.createElement("button",{"data-test-id":"query-bar-reset-filter-button",key:"reset-button",className:b,type:"button",onClick:this.onResetButtonClicked},"Reset"),i&&s.createElement("button",{id:"query_history_button",key:"query-history-button",className:y,"data-test-id":"query-history-button",type:"button",onClick:this.props.actions.toggleQueryHistory,title:"Toggle Query History"},s.createElement(m(),{"data-test-id":"query-history-button-icon",name:"history"}))),r&&s.createElement(c.Z,{pullRight:!0,id:"query-bar-menu-actions"},s.createElement(c.Z.Toggle,{noCaret:!0},s.createElement("i",{className:"mms-icon-ellipsis","aria-hidden":!0})),s.createElement(c.Z.Menu,null,s.createElement(d.Z,{onClick:this.props.actions.exportToLanguage},"Export To Language"))))};render(){return s.createElement("div",{className:l()(_.component),"data-test-id":"query-bar","data-result-id":this.props.resultId},s.createElement("div",{className:l()(_["input-container"])},this.renderForm()))}}const R=A;function O(){return O=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},O.apply(this,arguments)}class D extends s.Component{static displayName="QueryBarPlugin";static propTypes={store:i().object.isRequired,actions:i().object.isRequired};render(){return s.createElement(r.StoreConnector,{store:this.props.store},s.createElement(R,O({actions:this.props.actions},this.props)))}}const P=D;var I=n(10862),L=n.n(I);const j=()=>L().createActions({toggleQueryOptions:{sync:!0},toggleSample:{sync:!0},setQuery:{sync:!0},setQueryString:{sync:!0},typeQueryString:{sync:!0},setValue:{sync:!0},clearValue:{sync:!0},addDistinctValue:{sync:!0},removeDistinctValue:{sync:!0},toggleDistinctValue:{sync:!0},setDistinctValues:{sync:!0},setRangeValues:{sync:!0},setGeoWithinValue:{sync:!0},apply:{sync:!0},reset:{sync:!0},exportToLanguage:{sync:!0},toggleQueryHistory:{sync:!0},refreshEditor:{sync:!0}});var M=n(99837),q=n.n(M),F=n(93347),V=n.n(F),B=n(39491),U=n.n(B),H=n(77776),$=n.n(H),z=n(64943);const G=["$geoIntersects","$geoWithin","$near","$nearSphere"];function Q(e){return!!(0,p.isPlainObject)(e)&&0!==(0,p.intersection)(Object.keys(e),G).length}function W(e){return null!==e&&"object"==typeof e&&("[object RegExp]"===Object.prototype.toString.call(e)||Object.values(e).some(W))}var K=n(11378);const Z={},X=n.n(K)()("1m"),Y=n(55224)("mongodb-compass:stores:query-changed-store"),J=N.concat(["queryState","ns"]),ee=(e={})=>{const t=L().createStore({mixins:[q().store],init:function(){this.queryBarStore=e.store,this.queryBarStore.listen(this.onQueryBarStoreChanged.bind(this)),this.lastExecutedQuery=this.queryBarStore.state.lastExecutedQuery,this.namespace=e.namespace},getInitialState:()=>(0,p.pick)(e.store.getInitialState(),J),_detectChange(e){const t=!(0,p.isEqual)(this.lastExecutedQuery,e.lastExecutedQuery)||!(0,p.isEqual)(this.namespace,e.ns);return t&&(this.lastExecutedQuery=(0,p.cloneDeep)(e.lastExecutedQuery),this.namespace=e.ns),t},onQueryBarStoreChanged(e){if(this._detectChange(e)){const t={},n=e.lastExecutedQuery||this.getInitialState();for(const e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);t.queryState=e.queryState,t.ns=e.ns;const s=this.localAppRegistry,a=this.globalAppRegistry;if(s?s.emit("query-changed",t):Y("Error: AppRegistry not available for query-changed-store"),a){const e=this.queryBarStore.state.isTimeSeries?"time-series":"collection";a.emit("compass:query-bar:query-changed",{...t,collectionType:e})}this.setState(t)}}});return e.localAppRegistry&&(t.localAppRegistry=e.localAppRegistry),e.globalAppRegistry&&(t.globalAppRegistry=e.globalAppRegistry),t};var te=n(6909);const{track:ne,debug:se}=(0,te.createLoggerAndTelemetry)("COMPASS-QUERY-BAR-UI"),ae="Query.ChangedStore",ie=(e={})=>{const t=L().createStore({mixins:[q().store],listenables:e.actions,onCollectionChanged(e,t,n){const s=this.getInitialState();s.ns=e,s.isTimeSeries=t,s.isReadonly=n,this.setState(s)},onServerVersionChanged(e){this.setState({serverVersion:e})},exportToLanguage(){this.localAppRegistry.emit("open-query-export-to-language",{filter:this.state.filterString,project:this.state.projectString,sort:this.state.sortString,collation:this.state.collationString,skip:this.state.skipString,limit:this.state.limitString,maxTimeMS:this.state.maxTimeMSString}),this.globalAppRegistry.emit("compass:export-to-language:opened",{source:"Query"})},toggleQueryHistory(){this.localAppRegistry.emit("toggle-query-history")},getInitialState:()=>({filter:Z,project:null,sort:null,collation:null,skip:0,limit:0,sample:!1,maxTimeMS:X,filterString:"",projectString:"",sortString:"",collationString:"",skipString:"",limitString:"",maxTimeMSString:"",queryState:"reset",valid:!0,filterValid:!0,projectValid:!0,sortValid:!0,collationValid:!0,skipValid:!0,limitValid:!0,sampleValid:!0,maxTimeMSValid:!0,lastExecutedQuery:null,userTyping:!1,autoPopulated:!1,expanded:!1,ns:"",isTimeSeries:!1,isReadonly:!1,serverVersion:"3.6.0",schemaFields:[]}),_stoppedTyping(){this.userTypingTimer=null,this.setState({userTyping:!1})},toggleQueryOptions(e){this.setState({expanded:(0,p.isBoolean)(e)?e:!this.state.expanded})},toggleSample(e){const t={sample:(0,p.isBoolean)(e)?e:!this.state.sample};t.sample&&0===this.state.limit&&(t.limit=1e3,t.limitString=String(1e3),t.limitValid=!0),this.setState(t)},typeQueryString(e,t){this.userTypingTimer&&clearTimeout(this.userTypingTimer),this.userTypingTimer=setTimeout(this._stoppedTyping,100),this.setQueryString(e,t,!0)},setQueryString(e,t,n){U()(N.includes(e));const s=this._validateInput(e,t),a={userTyping:Boolean(n)};if(a[`${e}String`]=t,a[`${e}Valid`]=!1!==s,!1!==s){a[e]=s;const t={filter:this.state.filterValid,project:this.state.projectValid,sort:this.state.sortValid,collation:this.state.collationValid,skip:this.state.skipValid,limit:this.state.limitValid,maxTimeMS:this.state.maxTimeMSValid};t[e]=!1!==s,a.valid=(0,p.every)((0,p.values)(t))}else a.valid=!1;a.autoPopulated=!n,this.setState(a)},autoPopulateQuery(e){this.setQuery(e,!0)},handleGeoQueryFromSchema(e){const t=function(e,t){const n={...e};for(const[e,t]of Object.entries(n))Q(t)&&delete n[e];Array.isArray(n.$or)&&(n.$or=n.$or.filter((e=>!function(e){return!!(0,p.isPlainObject)(e)&&void 0!==Object.values(e).find(Q)}(e))),n.$or.length||delete n.$or);for(const[e,s]of Object.entries(t))Q(s)&&(n[e]=s);return t.$or&&(n.$or=[...Array.isArray(n.$or)?n.$or:[],...t.$or]),n}(this.state.filter,e);this.setQuery({filter:t},!0)},setQuery(e,t=!1){((0,p.isUndefined)(e)||(0,p.isNull)(e))&&(e=this._getDefaultQuery());const n=(0,p.without)(N,"sample");let s=(0,p.mapValues)((0,p.pick)(e,n),V().stringify),a=(0,p.mapValues)(s,((e,t)=>!1!==this._validateInput(t,e)));const i=[];Object.keys(a).forEach((e=>{!0===a[e]&&i.push(e)}));const r=(0,p.every)((0,p.values)(Object.assign({filter:this.state.filterValid,project:this.state.projectValid,sort:this.state.sortValid,collation:this.state.collationValid,skip:this.state.skipValid,limit:this.state.limitValid,maxTimeMS:this.state.maxTimeMSValid},a)));s=(0,p.mapKeys)(s,((e,t)=>`${t}String`)),a=(0,p.mapKeys)(a,((e,t)=>`${t}Valid`));const o=Object.assign({},(0,p.pick)(e,i),s,a);(0,p.has)(e,"sample")&&this.toggleSample(e.sample),o.autoPopulated=t,o.valid=r,this.setState(o)},_cloneQuery(){return(0,p.mapValues)((0,p.pick)(this.state,N),p.clone)},_getDefaultQuery(){return(0,p.pick)(this.getInitialState(),N)},_validateInput(e,t){const n=V().validate(e,t,{validate:!1});return("filter"!==e||""!==n)&&n},_validateQuery(){return!1!==V().isFilterValid(this.state.filterString,{validate:!1})&&!1!==V().isProjectValid(this.state.projectString)&&!1!==V().isSortValid(this.state.sortString)&&!1!==V().isCollationValid(this.state.collationString)&&!1!==V().isSkipValid(this.state.skipString)&&!1!==V().isLimitValid(this.state.limitString)&&!1!==V().isMaxTimeMSValid(this.state.maxTimeMSString)},setValue(e){const t=(0,p.clone)(this.state.filter);e.unsetIfSet&&(0,p.isEqual)(t[e.field],e.value,z.bsonEqual)?delete t[e.field]:t[e.field]=e.value,this.setQuery({filter:t},!0)},setDistinctValues(e){const t=(0,p.clone)(this.state.filter);if((0,p.isArray)(e.value))return e.value.length>1?t[e.field]={$in:e.value}:1===e.value.length?t[e.field]=e.value[0]:this.clearValue(e),void this.setQuery({filter:t},!0);t[e.field]=e.value,this.setQuery({filter:t},!0)},clearValue(e){const t=(0,p.clone)(this.state.filter);delete t[e.field],this.setQuery({filter:t},!0)},addDistinctValue(e){const t=(0,p.clone)(this.state.filter),n=(0,p.get)(t,e.field,void 0);if(void 0===n)return t[e.field]=e.value,void this.setQuery({filter:t},!0);if((0,p.isPlainObject)(n)){if((0,p.has)(n,"$in")){const n=t[e.field].$in;return void((0,p.includes)(n,e.value)||(t[e.field].$in.push(e.value),this.setQuery({filter:t},!0)))}return t[e.field]=e.value,void this.setQuery({filter:t},!0)}t[e.field]={$in:[n,e.value]},this.setQuery({filter:t},!0)},removeDistinctValue(e){const t=(0,p.clone)(this.state.filter),n=(0,p.get)(t,e.field,void 0);if(void 0!==n){if((0,p.isPlainObject)(n)&&(0,p.has)(n,"$in")){const n=t[e.field].$in,s=(0,p.pull)(n,e.value);return s.length>1?t[e.field].$in=s:1===s.length?t[e.field]=s[0]:delete t[e.field],void this.setQuery({filter:t},!0)}return(0,p.isEqual)(n,e.value,z.bsonEqual)?(delete t[e.field],void this.setQuery({filter:t},!0)):void 0}},toggleDistinctValue(e){const t=(0,p.get)(this.state.filter,e.field,void 0);((0,z.hasDistinctValue)(t,e.value)?this.removeDistinctValue:this.addDistinctValue)(e)},setRangeValues(e){const t=(0,p.clone)(this.state.filter),n={};let s;const a=(0,p.get)(e,"min",void 0),i=(0,p.get)(e,"max",void 0);void 0!==a||void 0!==i?(void 0!==a&&(s=(0,p.get)(e,"minInclusive",!0)?"$gte":"$gt",n[s]=a),void 0!==i&&(s=(0,p.get)(e,"maxInclusive",!1)?"$lte":"$lt",n[s]=i),e.unsetIfSet&&(0,p.isEqual)(t[e.field],n,z.bsonEqual)?delete t[e.field]:t[e.field]=n,this.setQuery({filter:t},!0)):this.clearValue({field:e.field})},setGeoWithinValue(e){const t=(0,p.clone)(this.state.filter),n={},s=(0,p.get)(e,"radius",0),a=(0,p.get)(e,"center",null);if(s&&a)return n.$geoWithin={$centerSphere:[[a[0],a[1]],s]},t[e.field]=n,void this.setQuery({filter:t},!0);this.clearValue({field:e.field})},apply(){if(this._validateQuery()){ne("Query Executed",{has_projection:!!this.state.project&&Object.keys(this.state.project).length>0,has_skip:this.state.skip>0,has_limit:this.state.limit>0,has_collation:!!this.state.collation,changed_maxtimems:this.state.maxTimeMS!==X,collection_type:this.state.isTimeSeries?"time-series":this.state.isReadonly?"readonly":"collection",used_regex:W(this.state.filter)});const e=this.localAppRegistry;if(e){const t={filter:this.state.filter,project:this.state.project,sort:this.state.sort,collation:this.state.collation,skip:this.state.skip,limit:this.state.limit,ns:this.state.ns,maxTimeMS:this.state.maxTimeMS};e.emit("query-applied",t)}this.setState({valid:!0,queryState:"apply",lastExecutedQuery:this._cloneQuery()})}},reset(){if(!(0,p.isEqual)(this._cloneQuery(),this._getDefaultQuery()))if((0,p.isEqual)(this.state.lastExecutedQuery,this._getDefaultQuery()))this.setQuery();else if(this.state.valid){const e=this.getInitialState();e.ns=this.state.ns,e.isTimeSeries=this.state.isTimeSeries,e.isReadonly=this.state.isReadonly,e.autoPopulated=!0,this.setState((0,p.omit)(e,"expanded"))}},storeDidUpdate(e){se("query store changed",$()(e,this.state))}});if(e.localAppRegistry){const n=e.localAppRegistry;t.localAppRegistry=n,n.on("auto-populate-query",(e=>{t.autoPopulateQuery(e)})),n.on("fields-changed",(e=>{t.setState({schemaFields:e.aceFields})})),n.on("subtab-changed",(()=>{e.actions.refreshEditor()})),n.on("compass:schema:geo-query",(e=>{t.handleGeoQueryFromSchema(e)})),n.on("compass:query-history:run-query",(e=>{t.setQuery(e,!0)})),n.getStore(ae).onQueryBarStoreChanged||(e.store=t,n.registerStore(ae,ee(e)))}return e.globalAppRegistry&&(t.globalAppRegistry=e.globalAppRegistry),e.namespace&&t.onCollectionChanged(e.namespace,e.isTimeSeries,e.isReadonly),e.serverVersion&&t.onServerVersionChanged(e.serverVersion),e.query&&t.setQuery(e.query,!0),t},re=JSON.parse('{"name":"@mongodb-js/compass-query-bar","productName":"Query Bar plugin","version":"7.20.0","apiVersion":"3.0.0","description":"Renders a component for executing MongoDB queries through a GUI.","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"homepage":"https://github.com/mongodb-js/compass","license":"SSPL","author":{"name":"MongoDB Inc","email":"compass@mongodb.com"},"bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" \\"./test/**/*.js\\"","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" \\"./test/**/*.js\\" --watch","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-cov":"nyc npm run test","check":"npm run lint && npm run depcheck","prepublishOnly":"npm run compile","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","bootstrap":"npm run compile"},"peerDependencies":{"ace-builds":"^1.4.3","debug":"*","hadron-react-components":"^5.13.0","mongodb-ace-autocompleter":"*","mongodb-ace-mode":"^1.6.0","mongodb-ace-theme-query":"^1.6.0","mongodb-query-parser":"^2.4.4","prop-types":"^15.7.2","react":"^16.14.0","react-ace":"^9.5.0","react-bootstrap":"^0.32.1","react-dom":"^16.14.0","react-fontawesome":"^1.6.1","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","ace-builds":"^1.4.3","autoprefixer":"^9.7.4","babel-loader":"^8.2.2","chai":"^4.1.2","chai-enzyme":"^1.0.0-beta.0","cheerio":"^1.0.0-rc.2","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^7.0.0","css-loader":"^4.3.0","debug":"4.3.0","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^5.0.3","extract-text-webpack-plugin":"^4.0.0-beta.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app-registry":"^8.10.0","hadron-react-components":"^5.13.0","html-webpack-plugin":"^3.2.0","htmlhint":"^0.11.0","ignore-loader":"^0.1.2","inject-loader":"^4.0.1","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","less":"^3.11.1","less-loader":"^7.3.0","mocha":"^7.0.1","mocha-webpack":"^2.0.0-beta.0","mongodb-ace-autocompleter":"^0.11.0","mongodb-ace-mode":"^1.6.0","mongodb-ace-theme-query":"^1.6.0","mongodb-connection-model":"^21.15.0","mongodb-query-parser":"^2.4.4","mongodb-reflux-store":"^0.0.1","mongodb-schema":"^8.2.5","ms":"^2.1.2","numeral":"^2.0.6","nyc":"^15.0.0","object-diff":"0.0.4","peer-deps-externals-webpack-plugin":"^1.0.4","pluralize":"^8.0.0","postcss-loader":"^2.1.6","prop-types":"^15.7.2","react":"^16.14.0","react-ace":"^9.5.0","react-bootstrap":"^0.32.1","react-dom":"^16.14.0","react-fontawesome":"^1.6.1","react-hot-loader":"^4.13.0","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","resolve":"^1.15.1","rimraf":"^3.0.1","semver":"^5.4.1","shebang-loader":"^0.0.1","sinon":"^8.1.1","sinon-chai":"^3.4.0","style-loader":"^2.0.0","url-loader":"^3.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^3.6.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-merge":"^4.2.2","webpack-node-externals":"^3.0.0","xvfb-maybe":"^0.2.1"},"dependencies":{"@mongodb-js/compass-logging":"^0.10.0","lodash":"^4.17.15","mongodb-query-util":"^0.2.1"}}'),oe={name:"Query Bar",component:P,configureStore:ie,configureActions:j,storeName:"Query.Store",actionName:"Query.Actions"};function le(e){e.registerRole("Query.QueryBar",oe)}function ce(e){e.deregisterRole("Query.QueryBar",oe)}const de=P},1984:(e,t,n)=>{"use strict";n.r(t),n.d(t,{FavoriteQueryStorage:()=>z,activate:()=>Me,configureActions:()=>Ie,configureStore:()=>Pe,deactivate:()=>qe,default:()=>Fe,metadata:()=>Le});var s=n(2784),a=n(70602),i=n(13980),r=n.n(i),o=n(84935),l=n.n(o),c=n(72779),d=n.n(c);class p extends s.PureComponent{static displayName="QueryHistoryHeader";static propTypes={actions:r().object.isRequired,showing:r().oneOf(["recent","favorites"]).isRequired};static defaultProps={showing:"recent"};onViewSwitch=e=>{"Recent"===e?this.showRecent():"Favorites"===e&&this.showFavorites()};showRecent=()=>{const{showing:e,actions:t}=this.props;"recent"!==e&&t.showRecent()};showFavorites=()=>{const{showing:e,actions:t}=this.props;"favorites"!==e&&t.showFavorites()};collapse=()=>{this.props.actions.collapse()};render(){const{showing:e}=this.props,t="recent"===e?"Recent":"Favorites";return s.createElement("div",{className:d()("header-module-component__2SVhh")},s.createElement(a.ViewSwitcher,{dataTestId:"past-queries",label:"Past Queries",buttonLabels:["Recent","Favorites"],activeButton:t,onClick:this.onViewSwitch}),s.createElement("span",{className:d()("header-module-close__j1Vlf"),"data-test-id":"query-history-button-close-panel",href:"#",onClick:this.collapse},"Ã"))}}const u=p;function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},m.apply(this,arguments)}const h=({children:e,className:t,...n})=>{const a=d()("card-module-component__1SpQ3",t);return s.createElement("div",m({className:a},n),e)};h.propTypes={children:r().any,className:r().string},h.defaultProps={className:""};const g=h;function b(){return b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},b.apply(this,arguments)}const y=({children:e,title:t,className:n,actionsVisible:a,...i})=>{const r=d()("card-module-component-header__2xUNh",n),o=d()("card-module-component-header-inner__3PQic"),l=d()("card-module-component-header-title__-YZgv"),c=d()("card-module-component-header-actions__3OCQy",{"card-module-is-visible__1ccb6":a});return s.createElement("div",b({className:r},i),t?(p=t,s.Children.map(p,(e=>void 0===e.type?s.createElement("div",{className:l},e):s.createElement("div",{className:o},e)))):null,e?s.createElement("div",{className:c},e):null);var p};y.propTypes={children:r().any,className:r().string,title:r().any,actionsVisible:r().bool},y.defaultProps={className:"",title:null,actionsVisible:!1};const f=y;function v(){return v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},v.apply(this,arguments)}const E=({children:e,className:t,...n})=>{const a=d()("card-module-component-body__tA_o6",t);return s.createElement("div",v({className:a},n),e)};E.propTypes={children:r().any,className:r().string},E.defaultProps={className:""};const S=E,x="list-module-item__1Q3o4",w=(e,t)=>{class n extends s.Component{static displayName="QueryHistoryList";static propTypes={items:r().oneOfType([r().array,r().object]).isRequired,actions:r().object.isRequired,zeroStateTitle:r().string.isRequired,current:r().object,ns:r().object};static defaultProps={items:[],zeroStateTitle:"",current:null,ns:l()("")};renderSaving=()=>{const{current:e,actions:n}=this.props;return"function"!=typeof t||null===e?null:s.createElement(t,{key:0,className:d()(x),model:e,actions:n})};renderZeroState=e=>{const{current:t,zeroStateTitle:n}=this.props;return 0===e&&null===t?s.createElement(g,null,s.createElement(S,{className:d()("list-module-zeroState__1FggQ")},s.createElement("div",{className:d()("list-module-zeroState-title__3s-tL")},n))):null};render(){const{items:t,ns:n,actions:a}=this.props,i=t.filter((e=>e._ns===n.ns)).map(((t,n)=>s.createElement(e,{key:n+1,className:d()(x),model:t,actions:a})));return s.createElement("div",{className:d()("list-module-component__cu1n2")},this.renderSaving(),this.renderZeroState(i.length),s.createElement("ul",{className:d()("list-module-items__1-7LR")},i))}}return n};var C=n(12170),k=n.n(C),N=n(93347),_=n.n(N);const T=e=>_().toJSString(e);var A=n(29487),R=n(71305),O=n.n(R),D=n(24179),P=n(98022),I=n.n(P);const L=O().extend({idAttribute:"_id",props:{_id:{type:"string",default:function(){return I().v4()}},filter:"object",project:"object",sort:"object",skip:"number",limit:"number",collation:"object",_lastExecuted:"date",_ns:"string"},parse:function(e){return e?D.EJSON.deserialize(e):void 0},serialize:function(){return D.EJSON.serialize(this.getAttributes({props:!0}))}});var j=n(72298),M=n(37421),q=n.n(M);const F=L.extend(q(),{idAttribute:"_id",namespace:"FavoriteQueries",storage:{backend:"disk",basepath:j.remote?j.remote.app.getPath("userData"):void 0},props:{_name:"string",_dateSaved:"date",_dateModified:"date"}}),V=L.extend(q(),{idAttribute:"_id",namespace:"RecentQueries",storage:{backend:"disk",basepath:j.remote?j.remote.app.getPath("userData"):void 0}});var B=n(51762),U=n.n(B);const H=U().extend(q(),{model:F,namespace:"FavoriteQueries",storage:{backend:"disk",basepath:j.remote?j.remote.app.getPath("userData"):void 0},mainIndex:"_id",comparator:e=>-e._dateSaved}),$=U().extend(q(),{model:V,namespace:"RecentQueries",storage:{backend:"disk",basepath:j.remote?j.remote.app.getPath("userData"):void 0},mainIndex:"_id",comparator:e=>-e._lastExecuted});class z{async loadAll(){const e=new H,t=(0,A.promisifyAmpersandMethod)(e.fetch.bind(e));return(await t()).map((e=>e.getAttributes({props:!0},!0)))}async updateAttributes(e,t){if(!e)throw new Error("modelId is required");const n=new F({_id:e}),s=(0,A.promisifyAmpersandMethod)(n.fetch.bind(n));await s(),n.set({...t,_dateModified:Date.now()});const a=(0,A.promisifyAmpersandMethod)(n.save.bind(n));return await a(n),n.getAttributes({props:!0},!0)}async delete(e){const t=new F({_id:e});return(0,A.promisifyAmpersandMethod)(t.destroy.bind(t))()}}var G=n(28316),Q=n(77826),W=n.n(Q),K=n(61637),Z=n.n(K);class X extends s.PureComponent{static displayName="Code";static propTypes={code:r().string.isRequired,language:r().string.isRequired};static defaultProps={};componentDidMount(){W().registerLanguage("javascript",Z()),this.highlightCode()}componentDidUpdate(){this.highlightCode()}highlightCode=()=>{const e=G.findDOMNode(this.refs.code);W().highlightBlock(e)};render(){const{language:e,code:t}=this.props;return s.createElement("pre",{className:d()("code-module-component__2k1Ai")},s.createElement("code",{className:d()("code-module-code__1w8Wd",e),ref:"code"},t))}}const Y=X;class J extends s.PureComponent{static displayName="Query";static propTypes={attributes:r().object,actions:r().object.isRequired};static defaultProps={};populateQuery=()=>{this.props.actions.runQuery(this.props.attributes)};renderAttr=(e,t)=>{const{attributes:n}=this.props;return s.createElement("li",{key:t},s.createElement("label",{"data-test-id":"query-history-query-label",className:d()("query-module-label__dG5Ze")},e),s.createElement(Y,{"data-test-id":"query-history-query-code",code:T(n[e]),language:"js"}))};render(){const{attributes:e}=this.props;return s.createElement("ul",{onClick:this.populateQuery,className:d()("query-module-component__2NKX9"),"data-test-id":"query-history-query-attributes"},Object.keys(e).map(this.renderAttr))}}const ee=J,te="recent-list-item-module-button__1AFAi";class ne extends s.PureComponent{static displayName="QueryHistoryRecentListItem";static propTypes={model:r().object.isRequired,actions:r().object.isRequired,className:r().string};static defaultProps={};saveRecent=()=>{const{actions:e,model:t}=this.props;e.saveRecent(t)};copyQuery=()=>{const{actions:e,model:t}=this.props;e.copyQuery(t)};deleteRecent=()=>{const{actions:e,model:t}=this.props;e.deleteRecent(t)};render(){const{model:e,className:t}=this.props,n=this.props.model.getAttributes({props:!0});return Object.keys(n).filter((e=>"_"===e.charAt(0))).forEach((e=>delete n[e])),s.createElement(g,{"data-testid":"recent-query-list-item",className:t},s.createElement(f,{title:e._lastExecuted.toString()},s.createElement("button",{title:"Favorite Query","data-test-id":"query-history-button-fav",className:d()("btn","btn-xs","btn-default",te),onClick:this.saveRecent},s.createElement(k(),{name:"star-o"})),s.createElement("button",{title:"Copy Query to Clipboard","data-test-id":"query-history-button-copy-query",className:d()("btn","btn-xs","btn-default",te,"recent-list-item-module-button-copy__2WRsk"),onClick:this.copyQuery},s.createElement(k(),{name:"clipboard"})),s.createElement("button",{title:"Delete Query from Recent List","data-test-id":"query-history-button-delete-recent",className:d()("btn","btn-xs","btn-default",te),onClick:this.deleteRecent},s.createElement(k(),{name:"trash"}))),s.createElement(S,null,s.createElement(ee,{attributes:n,actions:this.props.actions})))}}const se=w(ne,null),ae="favorite-list-item-module-button__3qmsF";class ie extends s.PureComponent{static displayName="QueryHistoryFavoritesListItem";static propTypes={model:r().object.isRequired,actions:r().object.isRequired,className:r().string};static defaultProps={};copyQuery=()=>{const{actions:e,model:t}=this.props;e.copyQuery(t)};deleteFavorite=()=>{const{actions:e,model:t}=this.props;e.deleteFavorite(t)};render(){const{model:e,className:t}=this.props,n=this.props.model.getAttributes({props:!0});return Object.keys(n).filter((e=>"_"===e.charAt(0))).forEach((e=>delete n[e])),s.createElement(g,{className:t},s.createElement(f,{title:e._name},s.createElement("button",{title:"Copy Query to Clipboard","data-test-id":"query-history-button-copy-query",className:d()("btn","btn-xs","btn-default",ae,"favorite-list-item-module-button-copy__3WIlM"),onClick:this.copyQuery},s.createElement(k(),{name:"clipboard"})),s.createElement("button",{title:"Delete Query from Favorites List","data-test-id":"query-history-button-delete-fav",className:d()("btn","btn-xs","btn-default",ae),onClick:this.deleteFavorite},s.createElement(k(),{name:"trash"}))),s.createElement(S,null,s.createElement(ee,{attributes:n,actions:this.props.actions,title:e._name})))}}const re=ie,oe="saving-module-button__dENC8";class le extends s.PureComponent{static displayName="QueryHistorySaving";static propTypes={model:r().object,actions:r().object.isRequired,className:r().string};static defaultProps={model:null};constructor(e){super(e),this._name=e.model?e.model._lastExecuted.toString():null}cancel=()=>{this.props.actions.cancelSave()};handleChange=e=>{this._name=e.target.value};handleSubmit=()=>{const{actions:e,model:t}=this.props;e.saveFavorite(t,this._name)};handleFormSubmit=e=>{e.preventDefault(),e.stopPropagation(),this.handleSubmit()};renderSaveForm=()=>s.createElement("form",{"data-test-id":"query-history-saving-form",className:d()("saving-module-form__XllkK"),onSubmit:this.handleFormSubmit},s.createElement("input",{"data-test-id":"query-history-saving-form-input-name",type:"text",className:d()("saving-module-form-input__29g6d"),placeholder:"Favorite Name",onChange:this.handleChange,autoFocus:!0}));render(){const{model:e,className:t}=this.props;if(null===e)return null;const n=this.props.model.serialize();return Object.keys(n).filter((e=>"_"===e.charAt(0))).forEach((e=>delete n[e])),s.createElement(g,{className:t,"data-test-id":"query-history-saving"},s.createElement(f,{title:this.renderSaveForm(),"data-test-id":"query-history-saving-header",actionsVisible:!0},s.createElement("button",{"data-test-id":"query-history-saving-form-button-save",className:d()("btn","btn-sm","btn-primary",oe),onClick:this.handleSubmit},"Save"),s.createElement("button",{"data-test-id":"query-history-saving-form-button-cancel",className:d()("btn","btn-sm","btn-default",oe),onClick:this.cancel},"Cancel")),s.createElement(S,null,s.createElement(ee,{"data-test-id":"query-history-saving-query",attributes:n})))}}const ce=w(re,le);class de extends s.PureComponent{static displayName="QueryHistory";static propTypes={actions:r().object.isRequired,store:r().object.isRequired,showing:r().oneOf(["recent","favorites"]),collapsed:r().bool,ns:r().object};static defaultProps={showing:"recent",collapsed:!0,ns:l()("")};renderFavorites=()=>s.createElement(a.StoreConnector,{store:this.props.store.localAppRegistry.getStore("QueryHistory.FavoriteListStore")},s.createElement(ce,{"data-test-id":"query-history-list-favorites",ns:this.props.ns,actions:this.props.actions,zeroStateTitle:"Favorite a query to see it saved here!"}));renderRecents=()=>s.createElement(a.StoreConnector,{store:this.props.store.localAppRegistry.getStore("QueryHistory.RecentListStore")},s.createElement(se,{"data-test-id":"query-history-list-recent",ns:this.props.ns,actions:this.props.actions,zeroStateTitle:"Run a query to see it saved here!"}));render(){const{collapsed:e,showing:t,actions:n}=this.props;return e?null:s.createElement("div",{"data-test-id":"query-history",className:"query-history-module-component__Cyzg9"},s.createElement("div",{className:"query-history-module-inner__2CB5D"},s.createElement(a.StoreConnector,{store:this.props.store.localAppRegistry.getStore("QueryHistory.HeaderStore")},s.createElement(u,{"data-test-id":"query-history-header",actions:n,showing:t})),"favorites"===t?this.renderFavorites():null,"recent"===t?this.renderRecents():null))}}const pe=de;function ue(){return ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ue.apply(this,arguments)}class me extends s.Component{static displayName="QueryHistoryPlugin";static propTypes={store:r().object.isRequired,actions:r().object.isRequired};render(){return s.createElement(a.StoreConnector,{store:this.props.store},s.createElement(pe,ue({actions:this.props.actions},this.props)))}}const he=me;var ge=n(10862),be=n.n(ge),ye=n(99837),fe=n.n(ye),ve=n(6909),Ee=n(73837);const{track:Se}=(0,ve.createLoggerAndTelemetry)("COMPASS-QUERY-HISTORY-UI"),xe=(e={})=>{const t=be().createStore({mixins:[fe().store],listenables:e.actions,saveRecent(t){this.setState({current:t}),e.actions.showFavorites()},saveFavorite(t,n){Se("Query History Favorite Added"),e.actions.deleteRecent(t);const s=Date.now(),a=t.getAttributes({props:!0});a._name=n,a._dateSaved=s,a._dateModified=s;const i=new F(a);this.state.items.add(i),i.save(),this.state.current=null,this.trigger(this.state)},cancelSave(){this.setState({current:null}),e.actions.showRecent()},deleteFavorite(e){Se("Query History Favorite Removed",{id:e._id,screen:"documents"}),e.destroy({success:()=>{this.state.items.remove(e._id),this.trigger(this.state)}})},runQuery(e){const t=this.state.items.map((e=>e.serialize())).find((t=>(0,Ee.isDeepStrictEqual)(t.filter,e.filter)));t&&Se("Query History Favorite Used",{id:t._id,screen:"documents"}),this.localAppRegistry.emit("compass:query-history:run-query",e)},getInitialState:()=>({items:new H,current:null})});return t.state.items.fetch({success:()=>{t.trigger(t.state)}}),e.localAppRegistry&&(t.localAppRegistry=e.localAppRegistry),t};var we=n(76635),Ce=n.n(we);const{track:ke}=(0,ve.createLoggerAndTelemetry)("COMPASS-QUERY-HISTORY-UI"),Ne=["filter","project","sort","skip","limit","collation"],_e=(e={})=>{const t=be().createStore({mixins:[fe().store],listenables:e.actions,_filterDefaults(e){for(const t in e)e.hasOwnProperty(t)&&(e[t]&&-1!==Ne.indexOf(t)?Ce().isObject(e[t])&&Ce().isEmpty(e[t])&&delete e[t]:delete e[t])},onConnected(){this.state.items.fetch({success:()=>{this.trigger(this.state)}})},onQueryApplied(e){this.addRecent(e)},addRecent(e){if(!("ns"in e))return;const t=e.ns;if(this._filterDefaults(e),Ce().isEmpty(e))return;const n=this.state.items.filter((e=>e._ns===t));if(n.length>=30){const e=n[29];this.state.items.remove(e._id),e.destroy()}const s=new V(e);s._lastExecuted=Date.now(),s._ns=t,this.state.items.add(s),s.save(),this.trigger(this.state)},deleteRecent(e){e.destroy({success:()=>{this.state.items.remove(e._id),this.trigger(this.state)}})},runQuery(e){this.state.items.map((e=>e.serialize())).some((t=>(0,Ee.isDeepStrictEqual)(t.filter,e.filter)))&&ke("Query History Recent Used"),this.localAppRegistry.emit("compass:query-history:run-query",e)},copyQuery(e){const t=e.getAttributes({props:!0});Object.keys(t).filter((e=>"_"===e.charAt(0))).forEach((e=>delete t[e])),j.remote.clipboard.writeText(T(t))},getInitialState:()=>({items:new $})});return t.onConnected(),e.localAppRegistry&&(t.localAppRegistry=e.localAppRegistry,e.localAppRegistry.on("query-applied",(e=>{t.onQueryApplied(e)}))),t},Te=(e={})=>be().createStore({mixins:[fe().store],listenables:e.actions,init(){},showFavorites(){this.setState({showing:"favorites"})},showRecent(){this.setState({showing:"recent"})},getInitialState:()=>({showing:"recent"})}),{track:Ae}=(0,ve.createLoggerAndTelemetry)("COMPASS-QUERY-HISTORY-UI"),Re="QueryHistory.FavoriteListStore",Oe="QueryHistory.RecentListStore",De="QueryHistory.HeaderStore",Pe=(e={})=>{const t=be().createStore({mixins:[fe().store],listenables:e.actions,showFavorites(){Ae("Query History Favorites"),this.setState({showing:"favorites"})},showRecent(){Ae("Query History Recent"),this.setState({showing:"recent"})},collapse(){this.state.collapsed||(Ae("Query History Closed"),this.setState({collapsed:!0}))},toggleCollapse(){Ae(this.state.collapsed?"Query History Opened":"Query History Closed"),this.setState({collapsed:!this.state.collapsed})},onCollectionChanged(e){const t=l()(e);this.setState({ns:t})},getInitialState:()=>({showing:"recent",collapsed:!0,ns:l()("")})});if(e.namespace&&t.onCollectionChanged(e.namespace),e.localAppRegistry){const n=e.localAppRegistry;n.on("collapse-query-history",(()=>{t.collapse()})),n.on("toggle-query-history",(()=>{t.toggleCollapse()}));const s=n.getStore(Re),a=n.getStore(Oe),i=n.getStore(De);s.saveRecent||n.registerStore(Re,xe(e)),a.addRecent||n.registerStore(Oe,_e(e)),i.showRecent||n.registerStore(De,Te(e)),t.localAppRegistry=n}return t},Ie=()=>be().createActions(["showFavorites","showRecent","collapse","toggleCollapse","copyQuery","deleteRecent","deleteFavorite","addRecent","saveRecent","saveFavorite","cancelSave","runQuery","namespaceChanged"]),Le=JSON.parse('{"name":"@mongodb-js/compass-query-history","productName":"Query History plugin","version":"8.21.0","apiVersion":"3.0.0","description":"The query history sidebar.","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"homepage":"https://github.com/mongodb-js/compass","license":"SSPL","author":{"name":"MongoDB Inc","email":"compass@mongodb.com"},"bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","start:prod":"npm run compile && electron --noDevServer ./electron","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-cov":"nyc npm run test","check":"npm run lint && npm run depcheck","prepublishOnly":"npm run compile","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","bootstrap":"npm run compile"},"dependencies":{"@mongodb-js/compass-logging":"^0.10.0","bson":"^4.4.1","highlight.js":"^9.12.0","lodash":"^4.17.15","mongodb-data-service":"^21.19.0"},"peerDependencies":{"bson":"^4.4.1","debug":"*","hadron-react-components":"^5.13.0","mongodb-query-parser":"^2.4.4","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","react-fontawesome":"^1.6.1","react-tooltip":"^3.11.1","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","storage-mixin":"^4.13.0"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","ampersand-model":"^8.0.1","ampersand-rest-collection":"^6.0.0","autoprefixer":"^9.4.6","babel-loader":"^8.2.2","bson":"^4.4.1","chai":"^4.1.2","chai-enzyme":"1.0.0-beta.1","cheerio":"^1.0.0-rc.2","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^7.0.0","css-loader":"^4.3.0","debug":"4.3.0","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^5.0.3","eslint-plugin-react":"^7.24.0","extract-text-webpack-plugin":"^4.0.0-beta.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","hadron-react-components":"^5.13.0","har-validator":"^5.1.3","html-webpack-plugin":"^3.2.0","ignore-loader":"^0.1.2","inject-loader":"^4.0.1","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","less":"^3.11.1","less-loader":"^7.3.0","mime-db":"^1.27.0","mocha":"^5.0.0","mocha-webpack":"^2.0.0-beta.0","mongodb-connection-model":"^21.15.0","mongodb-js-metrics":"^7.9.0","mongodb-ns":"^2.3.0","mongodb-query-parser":"^2.4.4","mongodb-reflux-store":"^0.0.1","node-loader":"^0.6.0","nyc":"^15.0.0","peer-deps-externals-webpack-plugin":"^1.0.4","postcss-loader":"^2.1.6","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","react-hot-loader":"^4.13.0","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","rimraf":"^3.0.1","semver":"^5.4.1","shebang-loader":"^0.0.1","sinon":"^8.1.1","sinon-chai":"^3.4.0","sshpk":"^1.13.0","storage-mixin":"^4.13.0","style-loader":"^2.0.0","tough-cookie":"^2.3.2","url-loader":"^3.0.0","uuid":"^3.1.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^3.0.3","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-merge":"^4.2.2","webpack-node-externals":"^3.0.0"}}'),je={name:"Query History",component:he,configureStore:Pe,configureActions:Ie,storeName:"Query.History"};function Me(e){e.registerRole("Collection.ScopedModal",je)}function qe(e){e.deregisterRole("Collection.ScopedModal",je)}const Fe=he},8381:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>at,deactivate:()=>it,metadata:()=>nt});var s=n(18717),a=n(43292),i=n(84935),r=n.n(i),o=n(1984),l=n(3711),c=n(6909);const{track:d}=(0,c.createLoggerAndTelemetry)("COMPASS-MY-QUERIES-UI");let p;!function(e){e.DeleteItem="compass-saved-aggregations-queries/deleteItem",e.DeleteItemConfirm="compass-saved-aggregations-queries/deleteItemConfirm",e.DeleteItemCancel="compass-saved-aggregations-queries/deleteItemCancel"}(p||(p={}));const u=new o.FavoriteQueryStorage,m=new l.PipelineStorage,h={id:null},g={id:void 0};let b;!function(e){e.EditItemClicked="compass-saved-aggregations-queries/edit-item/editItemClicked",e.EditItemCancelled="compass-saved-aggregations-queries/edit-item/editItemCancelled",e.EditItemUpdated="compass-saved-aggregations-queries/edit-item/editItemUpdated"}(b||(b={}));let y;!function(e){e.ITEMS_FETCHED="compass-saved-aggregations-queries/itemsFetched"}(y||(y={}));const f={loading:!0,items:[]},v=new o.FavoriteQueryStorage,E=new l.PipelineStorage,S=async()=>(await E.loadAll()).map(w),x=async()=>(await v.loadAll()).map(C),w=e=>{const{database:t,collection:n}=r()(e.namespace);return{id:e.id,lastModified:e.lastModified,name:e.name,database:t,collection:n,type:"aggregation",aggregation:e}},C=e=>{const{database:t,collection:n}=r()(e._ns);return{id:e._id,name:e._name,lastModified:e._dateModified??e._dateSaved,database:t,collection:n,type:"query",query:e}};let k;!function(e){e.SetInstance="compass-saved-aggregations-queries/setInstance",e.ResetInstance="compass-saved-aggregations-queries/resetInstance"}(k||(k={}));let N;!function(e){e.SetDataService="compass-saved-aggregations-queries/setDataService",e.ResetDataService="compass-saved-aggregations-queries/resetDataService"}(N||(N={}));const{track:_}=(0,c.createLoggerAndTelemetry)("COMPASS-MY-QUERIES-UI"),T={isModalOpen:!1,selectedItem:null,createCollectionStatus:"initial",databases:[],selectedDatabase:null,databasesStatus:"initial",collections:[],selectedCollection:null,collectionsStatus:"initial"};let A;!function(e){e.OpenModal="compass-saved-aggregations-queries/openModal",e.CloseModal="compass-saved-aggregations-queries/closeModal",e.CreateNamespaceStatusChange="compass-saved-aggregations-queries/createNamespaceStatusChange",e.SelectDatabase="compass-saved-aggregations-queries/selectDatabase",e.LoadDatabases="compass-saved-aggregations-queries/loadDatabases",e.LoadDatabasesSuccess="compass-saved-aggregations-queries/loadDatabasesSuccess",e.LoadDatabasesError="compass-saved-aggregations-queries/loadDatabasesError",e.SelectCollection="compass-saved-aggregations-queries/selectCollection",e.LoadCollections="compass-saved-aggregations-queries/loadCollections",e.LoadCollectionsSuccess="compass-saved-aggregations-queries/loadCollectionsSuccess",e.LoadCollectionsError="compass-saved-aggregations-queries/loadCollectionsError"}(A||(A={}));const R=(e,t,n)=>async(s,a)=>{const{dataService:i,instance:r,appRegistry:o}=a();if(!r||!i||!o)return;const l=await r.getNamespace({dataService:i,database:t,collection:n});if(!l)return;const c=await l.fetchMetadata({dataService:i});_("aggregation"==e.type?"Aggregation Opened":"Query History Favorite Used",{id:e.id,screen:"my_queries"}),o.emit("open-namespace-in-new-tab",{...c,aggregation:"aggregation"===e.type?e.aggregation:null,query:"query"===e.type?e.query:null})};let O;!function(e){e.SetAppRegistry="compass-saved-aggregations-queries/setAppRegistry"}(O||(O={}));const D=(0,s.createStore)((0,s.combineReducers)({savedItems:(e=f,t)=>{switch(t.type){case y.ITEMS_FETCHED:return{...e,items:t.payload,loading:!1};case p.DeleteItemConfirm:{const n=e.items.filter((e=>e.id!==t.id));return{...e,items:n}}case b.EditItemUpdated:{const n=e.items.find((e=>e.id===t.id));if(!n)return e;const s="query"===n.type?C(t.payload):w(t.payload);return{...e,items:[...e.items.filter((e=>e.id!==t.id)),s]}}}return e},instance:(e=null,t)=>{switch(t.type){case k.SetInstance:return t.instance;case k.ResetInstance:return null;default:return e}},dataService:(e=null,t)=>{switch(t.type){case N.SetDataService:return t.dataService;case N.ResetDataService:return null;default:return e}},openItem:(e=T,t)=>{switch(t.type){case A.OpenModal:return{...e,selectedItem:t.selectedItem,isModalOpen:!0};case A.CloseModal:return{...T};case A.CreateNamespaceStatusChange:return{...e,createCollectionStatus:t.status};case A.SelectDatabase:return{...e,selectedDatabase:t.database,collections:[],collectionsStatus:"initial",selectedCollection:null};case A.LoadDatabases:return{...e,databasesStatus:"fetching"};case A.LoadDatabasesError:return{...e,databasesStatus:"error"};case A.LoadDatabasesSuccess:return{...e,databases:t.databases,databasesStatus:"ready"};case A.SelectCollection:return{...e,selectedCollection:t.collection};case A.LoadCollections:return{...e,collectionsStatus:"fetching"};case A.LoadCollectionsError:return{...e,collectionsStatus:"error"};case A.LoadCollectionsSuccess:return{...e,collections:t.collections,collectionsStatus:"ready"};default:return e}},editItem:(e=g,t)=>{switch(t.type){case b.EditItemClicked:return{id:t.id};case b.EditItemCancelled:case b.EditItemUpdated:return{id:void 0};default:return e}},deleteItem:(e=h,t)=>{switch(t.type){case p.DeleteItem:return{id:t.id};case p.DeleteItemCancel:case p.DeleteItemConfirm:return{id:null};default:return e}},appRegistry:(e=null,t)=>t.type===O.SetAppRegistry?t.appRegistry:e}),(0,s.applyMiddleware)(a.Z)),P=Object.assign(D,{onActivated(e){P.dispatch((e=>({type:O.SetAppRegistry,appRegistry:e}))(e)),e.on("data-service-connected",((e,t)=>{e||P.dispatch(function(e){return{type:N.SetDataService,dataService:e}}(t))})),e.on("data-service-disconnected",(()=>{P.dispatch({type:N.ResetDataService})})),e.on("instance-created",(({instance:e})=>{P.dispatch(function(e){return{type:k.SetInstance,instance:e}}(e))})),e.on("instance-destroyed",(()=>{P.dispatch({type:k.ResetInstance})}))}}),I=P;var L=n(2784),j=n(16435),M=n(50517);const q=36e5,F=24*q,V=7*F,B=new Intl.RelativeTimeFormat("en",{numeric:"auto"}),U=new Intl.DateTimeFormat("en",{dateStyle:"long"}),H={second:1e3,minute:6e4,hour:q,day:F,week:V};function $(e){const t=Date.now()-e;let n=null;if(t<6e4)n="second";else if(t<q)n="minute";else if(t<F)n="hour";else if(t<V)n="day";else{if(!(t<24192e5))return U.format(e);n="week"}return B.format(-Math.round(t/H[n]),n)}function z(){return z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},z.apply(this,arguments)}const G=(0,M.css)({display:"flex",alignItems:"center",gap:M.spacing[2],minWidth:0}),Q=(0,M.css)({flex:"none"}),W=(0,M.css)({whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden"}),K=({type:e,name:t})=>L.createElement("div",{className:G},L.createElement(M.Icon,{title:null,glyph:"database"===e?"Database":"Folder",color:M.uiColors.gray.dark1,className:Q}),L.createElement("span",{className:W},t)),Z=4*M.spacing[6],X=(0,M.css)({minWidth:0,width:"100%",paddingTop:M.spacing[3],paddingBottom:M.spacing[3],paddingLeft:M.spacing[2],paddingRight:M.spacing[2]}),Y=(0,M.css)({display:"flex",alignItems:"center",minHeight:28,marginBottom:M.spacing[2]}),J=(0,M.css)({flex:"none"}),ee=(0,M.css)({flex:"none",marginLeft:"auto"}),te=(0,M.css)({fontWeight:"bold",color:`${M.uiColors.green.dark1} !important`,height:2*M.spacing[4],marginBottom:M.spacing[3],display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:2,textOverflow:"ellipsis",overflow:"hidden"}),ne=(0,M.css)({display:"grid",gap:M.spacing[2],marginBottom:M.spacing[3]}),se=(0,M.css)({fontStyle:"italic"}),ae=(0,M.css)({position:"relative"}),ie=({itemId:e,isVisible:t,onAction:n})=>{const s=(0,L.useRef)(null),[a,i]=(0,L.useState)(!1),r=(0,L.useCallback)((t=>{t.stopPropagation(),i(!1),n(e,t.currentTarget.dataset.action)}),[e,n]),o=t||a;return L.createElement(M.Menu,{open:a,setOpen:i,usePortal:!1,trigger:({onClick:e,children:t})=>o&&L.createElement("div",{className:ae},L.createElement(M.IconButton,{ref:s,"aria-label":"Show actions",title:"Show actions",onClick:t=>{t.stopPropagation(),e()}},L.createElement(M.Icon,{glyph:"Ellipsis"})),t)},L.createElement(M.MenuItem,{"data-action":"copy",onClick:r},"Copy"),L.createElement(M.MenuItem,{"data-action":"rename",onClick:r},"Rename"),L.createElement(M.MenuItem,{"data-action":"delete",onClick:r},"Delete"))},re=({id:e,type:t,name:n,database:s,collection:a,lastModified:i,onAction:r,...o})=>{const[l,c]=(0,M.useHoverState)(),[d,p]=(0,M.useFocusState)(),u=(0,M.useDefaultAction)((()=>{r(e,"open")})),m=(0,M.mergeProps)({className:X},o,l,d,u),h=function(e){const[t,n]=(0,L.useState)((()=>$(e)));return(0,L.useEffect)((()=>{n($(e));const t=setInterval((()=>{n($(e))}),6e4);return()=>{clearInterval(t)}}),[e]),t}(i);return L.createElement(M.Card,z({key:e,contentStyle:"clickable","data-id":e},m),L.createElement("div",{className:Y},L.createElement(M.Badge,{variant:"darkgray",className:J},".","query"===t?"find":"aggregate"),L.createElement("div",{className:ee},L.createElement(ie,{itemId:e,isVisible:c||[M.FocusState.FocusVisible,M.FocusState.FocusWithinVisible].includes(p),onAction:r}))),L.createElement(M.Subtitle,{as:"div",className:te,title:n},n),L.createElement("div",{className:ne},L.createElement(K,{type:"database",name:s}),L.createElement(K,{type:"collection",name:a})),L.createElement("div",{className:se},"LastÂ modified: ",h))},oe=()=>L.createElement("svg",{width:"72",height:"72",viewBox:"0 0 72 72",fill:"none",xmlns:"http://www.w3.org/2000/svg"},L.createElement("path",{d:"M47 53C54.1797 53 60 47.1797 60 40C60 32.8203 54.1797 27 47 27C39.8203 27 34 32.8203 34 40C34 47.1797 39.8203 53 47 53Z",fill:"#00ED64",stroke:"#001E2B",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"}),L.createElement("path",{d:"M56 49L68 61",stroke:"#001E2B"}),L.createElement("path",{d:"M4 35.9501H6.2M6.2 35.9501C9.4 35.9501 12.1 33.3553 12.1 30.0619V19.5828C12.1 14.8922 15.9 11 20.7 11M6.2 35.9501C9.4 35.9501 12.1 38.5449 12.1 41.8383V52.4172C12.1 57.1078 15.9 61 20.7 61M54.0001 35.9501H51.8001M51.8001 35.9501C48.6001 35.9501 45.9001 38.5449 45.9001 41.8383V52.4172C45.9001 57.1078 42.1001 61 37.3001 61M51.8001 35.9501C48.6001 35.9501 45.9 33.3553 45.9 30.0619V19.5828C45.9 14.8922 42.1 11 37.3 11",stroke:"#001E2B",strokeMiterlimit:"10"})),le=()=>L.createElement("svg",{width:"72",height:"72",viewBox:"0 0 72 72",fill:"none",xmlns:"http://www.w3.org/2000/svg"},L.createElement("path",{d:"M43.875 43.875L64 64M50 29C50 40.598 40.598 50 29 50C17.402 50 8 40.598 8 29C8 17.402 17.402 8 29 8C40.598 8 50 17.402 50 29Z",stroke:"#001E2B"}),L.createElement("path",{d:"M22 43C22 45.1132 22.2625 47.1879 22.875 49.125C24.8 49.7413 26.9 50 29 50C40.6375 50 50 40.7107 50 29C50 26.8868 49.7375 24.8121 49.125 22.875C47.2 22.2586 45.1 22 43 22C31.3625 22 22 31.2893 22 43Z",fill:"#00ED64",stroke:"#001E2B",strokeMiterlimit:"10",strokeLinecap:"round",strokeLinejoin:"round"})),ce=(0,M.css)({display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",marginLeft:M.spacing[3],marginRight:M.spacing[3],marginTop:M.spacing[7]}),de=(0,M.css)({flex:"none",maxWidth:"80px",maxHeight:"80px"}),pe=(0,M.css)({color:M.uiColors.green.dark2}),ue=(0,M.css)({marginTop:M.spacing[2],maxWidth:"600px"}),me=(0,M.css)({marginTop:M.spacing[5],maxWidth:"600px"}),he=({icon:e,title:t,subTitle:n,callToAction:s})=>L.createElement("div",{className:ce},L.createElement("div",{className:de},L.createElement(e,null)),L.createElement(M.Subtitle,{className:pe},t),L.createElement(M.Body,{className:ue},n),L.createElement(M.Body,{className:me},s)),ge=()=>L.createElement(he,{icon:oe,title:"No saved queries yet.",subTitle:"Start saving your aggregations and find queries, you'll see them here.",callToAction:L.createElement("div",null,"Not sure where to start? Â ",L.createElement(M.Link,{hideExternalIcon:!0,href:"https://docs.mongodb.com/compass/current/query/queries/"},"Visit our Docs â"))}),be=()=>L.createElement(he,{icon:le,title:"No results found.",subTitle:"We canât find any item matching your search."}),ye=(0,M.css)({button:{zIndex:999}}),fe=({name:e,label:t,items:n,selectedItem:s,isLoading:a,onChange:i})=>L.createElement(M.Select,{name:e,label:t,value:s??"",onChange:i,disabled:a,usePortal:!1,className:ye},n.map((e=>L.createElement(M.Option,{key:e,value:e},e)))),ve=(0,j.$j)((({openItem:{databases:e,databasesStatus:t,selectedDatabase:n}})=>({items:e,selectedItem:n,isLoading:["initial","fetching"].includes(t)})),{onChange:e=>async(t,n)=>{const{instance:s,dataService:a,openItem:{selectedDatabase:i}}=n();if(!s||!a)return;if(e===i)return;t({type:A.SelectDatabase,database:e});const r=s.databases.get(e);if(r)try{await r.fetchCollections({dataService:a}),e===n().openItem.selectedDatabase&&t({type:A.LoadCollectionsSuccess,collections:r.collections.map((e=>e.name))})}catch{e===n().openItem.selectedDatabase&&t({type:A.LoadCollectionsError})}}})(fe),Ee=(0,j.$j)((({openItem:{collections:e,collectionsStatus:t,selectedCollection:n}})=>({items:e,selectedItem:n,isLoading:["initial","fetching"].includes(t)})),{onChange:e=>({type:A.SelectCollection,collection:e})})(fe),Se=(0,M.css)({display:"grid",gridTemplateAreas:"\n    'description description'\n    'database collection'\n  ",gridAutoColumns:"1fr",rowGap:M.spacing[4],columnGap:M.spacing[3]}),xe=(0,M.css)({gridArea:"description"}),we=(0,M.css)({gridArea:"database"}),Ce=(0,M.css)({gridArea:"collection"}),ke={onSubmit:()=>(e,t)=>{const{openItem:{selectedItem:n,selectedDatabase:s,selectedCollection:a}}=t();n&&s&&a&&(e({type:A.CloseModal}),e(R(n,s,a)))},onClose:()=>({type:A.CloseModal})},Ne=(0,j.$j)((({openItem:{isModalOpen:e,selectedDatabase:t,selectedCollection:n,selectedItem:s}})=>({isModalOpen:e,isSubmitDisabled:!(t&&n),namespace:`${s?.database??""}.${s?.collection??""}`,itemName:s?.name??"",itemType:s?.type??""})),ke)((({namespace:e,itemType:t,itemName:n,isModalOpen:s,isSubmitDisabled:a,onClose:i,onSubmit:r})=>L.createElement(M.ConfirmationModal,{open:s,onCancel:i,onConfirm:r,title:"Select a Namespace",buttonText:"Open",submitDisabled:a},L.createElement("div",{className:Se},L.createElement("div",{className:xe},"The namespace ",L.createElement("strong",null,e)," for the saved ",t," ",L.createElement("strong",null,n)," doesnât exist inÂ the current cluster. Please select another namespace toÂ open saved ",t,"."),L.createElement("div",{className:we},L.createElement(ve,{name:"database",label:"Database"})),L.createElement("div",{className:Ce},L.createElement(Ee,{name:"collection",label:"Collection"})))))),_e=(0,M.css)({marginBottom:M.spacing[3],lineHeight:"25px",fontWeight:"bold",fontSize:"24px"}),Te=(0,M.css)({marginTop:M.spacing[5],display:"flex",justifyContent:"flex-end"}),Ae=(0,M.css)({marginRight:M.spacing[2]}),Re={onSubmit:(e,t)=>async(n,s)=>{const{savedItems:{items:a}}=s(),i=a.find((t=>t.id===e));if(!i)return;const r="query"===i.type?await((e,t)=>(new o.FavoriteQueryStorage).updateAttributes(e,{_name:t.name}))(e,t):await((e,t)=>(new l.PipelineStorage).updateAttributes(e,{name:t.name}))(e,t);n({type:b.EditItemUpdated,id:e,payload:r})},onCancel:()=>({type:b.EditItemCancelled})},Oe=(0,j.$j)((({editItem:{id:e},savedItems:{items:t}})=>({isModalOpen:Boolean(e),item:t.find((t=>t.id===e))})),Re)((({isModalOpen:e,item:t,onSubmit:n,onCancel:s})=>{const[a,i]=(0,L.useState)(t?.name??"");(0,L.useEffect)((()=>{i(t?.name??"")}),[t]);const r=()=>!a||a===t?.name;return L.createElement(M.Modal,{setOpen:s,open:e,"data-testid":"edit-item-modal"},L.createElement("form",{onSubmit:e=>{e.preventDefault(),!r()&&t&&n(t.id,{name:a})}},L.createElement(M.H3,{className:_e},`Rename ${t?.type??""}`),L.createElement(M.TextInput,{"aria-label":"Name",label:"Name",name:"name",value:a,onChange:e=>{i(e.target.value)}}),L.createElement("div",{className:Te},L.createElement(M.Button,{className:Ae,variant:"default",onClick:s},"Cancel"),L.createElement(M.Button,{disabled:r(),variant:"primary",type:"submit"},"Update"))))})),De=(0,j.$j)((e=>({isOpen:!!e.deleteItem.id,itemType:e.savedItems.items.find((t=>t.id===e.deleteItem.id))?.type??null})),{onDeleteConfirm:()=>async(e,t)=>{const{savedItems:{items:n},deleteItem:{id:s}}=t(),a=n.find((e=>e.id===s));if(!a)return;d("aggregation"==a.type?"Aggregation Deleted":"Query History Favorite Removed",{id:a.id,screen:"my_queries"});const i="query"===a.type?u.delete.bind(u):m.delete.bind(m);await i(a.id),e({type:p.DeleteItemConfirm,id:a.id})},onDeleteCancel:()=>({type:p.DeleteItemCancel})})((({isOpen:e,itemType:t,onDeleteCancel:n,onDeleteConfirm:s})=>{const a=`Are you sure you want to delete your ${"query"===t?"query":"aggregation"}?`;return L.createElement(M.ConfirmationModal,{"data-testid":"delete-item-modal",open:e,onCancel:n,onConfirm:s,title:a,buttonText:"Delete",variant:"danger"},L.createElement(M.Description,null,"This action can not be undone."))}));var Pe=n(11586),Ie=n(71659);const{track:Le}=(0,c.createLoggerAndTelemetry)("COMPASS-MY-QUERIES-UI"),je=(0,M.css)({display:"flex",flexDirection:"row"}),Me=(0,M.css)({marginRight:M.spacing[2],width:`calc(16ch + ${M.spacing[6]}px)`}),qe=(0,M.css)({display:"flex"}),Fe=(0,M.css)({width:"300px",marginRight:M.spacing[2],marginTop:2}),Ve=({options:e,onSelect:t,value:n,placeholder:s})=>{const a=(0,Pe.Me)(),i=(0,Pe.Me)();return L.createElement(M.Select,{disabled:0===e.length,id:i,"aria-labelledby":a,allowDeselect:!0,placeholder:s,className:Me,onChange:t,value:n,name:n},e.map((e=>L.createElement(M.Option,{key:e,value:e},e))))};function Be(e,t,n){const s=function(e,t){return t&&1!==t.length?new Ie.Z(e,{findAllMatches:!0,shouldSort:!1,minMatchCharLength:2,threshold:.3,ignoreLocation:!0,includeScore:!0,keys:[{name:"name",weight:4},{name:"namespace",weight:3},{name:"tags",weight:2},{name:"data",weight:1}],getFn:(e,t)=>{const n=Array.isArray(t)?t[0]:t;if("namespace"===n)return`${e.database}.${e.collection}`;if("tags"===n)return"query"===e.type?["find","query"]:["aggregate","aggregation","pipeline"];if("data"===n){if("query"===e.type)return JSON.stringify({filter:e.query.filter});{const t=e.aggregation.pipeline.filter((e=>e.stageOperator&&e.stage)).map((e=>`${e.stageOperator}: ${e.stage}`)).join(" ");return JSON.stringify(t)}}return e[n]}}).search(t).map((e=>({item:e.item,score:e.score??0}))):e.map((e=>({item:e,score:1})))}(e,n);return function(e,t){const n={...t};for(const e in n)n[e]||delete n[e];return[...e].filter((e=>function(e,t){if(0===Object.keys(t).length)return!0;let n=!0;for(const s in t)e[s]!==t[s]&&(n=!1);return n}(e.item,n)))}(s,t)}var Ue=n(24179);const{track:He}=(0,c.createLoggerAndTelemetry)("COMPASS-MY-QUERIES-UI");function $e(e,t=2){return e.split("\n").map((e=>`${" ".repeat(t)}${e}`)).join("\n")}function ze(){return ze=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},ze.apply(this,arguments)}const{track:Ge}=(0,c.createLoggerAndTelemetry)("COMPASS-MY-QUERIES-UI");function Qe(e,t){const n=(0,L.useRef)(t);n.current||(n.current=t);const s=(0,L.useRef)(e);s.current=e,(0,L.useEffect)((()=>{if(t!==n.current)return n.current=Symbol(),s.current()}),[t])}const We=[{name:"name",label:"Name"},{name:"lastModified",label:"Last Modified"}],Ke=(0,M.css)({padding:M.spacing[3],display:"flex",justifyContent:"space-between"}),Ze=(0,M.css)({gap:M.spacing[2],paddingLeft:M.spacing[3],paddingRight:M.spacing[3],paddingBottom:M.spacing[2]}),Xe=(0,M.css)({width:"100%"}),Ye=L.createContext({filterControls:null,sortControls:null}),Je=()=>{const{filterControls:e,sortControls:t}=(0,L.useContext)(Ye);return L.createElement("div",{className:Ke},L.createElement("div",null,e),L.createElement("div",null,t))},et={onMount:()=>async e=>{const t=await Promise.allSettled([S(),x()]);e({type:y.ITEMS_FETCHED,payload:t.map((e=>"fulfilled"===e.status?e.value:[])).flat()})},onOpenItem:e=>async(t,n)=>{const{instance:s,dataService:a,savedItems:{items:i}}=n(),r=i.find((t=>t.id===e));if(!r)return;if(!s||!a)return;const{database:o,collection:l}=r;var c;await s.getNamespace({dataService:a,database:o,collection:l})?t(R(r,o,l)):t((c=r,async(e,t)=>{e({type:A.OpenModal,selectedItem:c});const{instance:n,dataService:s}=t();if(n&&s){e({type:A.LoadDatabases});try{await n.fetchDatabases({dataService:s}),e({type:A.LoadDatabasesSuccess,databases:n.databases.map((e=>e.name))})}catch{e({type:A.LoadDatabasesError})}}}))},onEditItem:e=>({type:b.EditItemClicked,id:e}),onDeleteItem:e=>({type:p.DeleteItem,id:e}),onCopyToClipboard:function(e){return async(t,n)=>{const{savedItems:{items:s}}=n(),a=s.find((t=>t.id===e));if(!a)return;He("aggregation"===a.type?"Aggregation Copied":"Query History Favorite Copied",{id:a.id,screen:"my_queries"});const i="aggregation"===a.type?function(e){const t=e.filter((e=>e.stageOperator)).map((e=>`{\n  ${e.stageOperator}: ${$e(e.stage).trim()}\n}`));return t.length>0?`[\n${$e(t.join(",\n"))}\n]`:"[]"}(a.aggregation.pipeline):function(e){const{collation:t,filter:n,limit:s,project:a,skip:i,sort:r}=e;return Ue.EJSON.stringify({collation:t,filter:n,limit:s,project:a,skip:i,sort:r},void 0,2)}(a.query);await navigator.clipboard.writeText(i)}}},tt=(0,j.$j)((({savedItems:{items:e,loading:t}})=>({items:e,loading:t})),et)((({loading:e,items:t,onMount:n,onOpenItem:s,onEditItem:a,onDeleteItem:i,onCopyToClipboard:r})=>{(0,L.useEffect)((()=>{n()}),[n]);const{controls:o,conditions:l,search:c}=function(e){const[t,n]=function(e){const[t,n]=(0,L.useState)(),[s,a]=(0,L.useState)(),[i,r]=(0,L.useState)([]),o=e.map((e=>e.database)).filter(((e,t,n)=>n.indexOf(e)===t)),l=(0,L.useMemo)((()=>t=>{n(t),a(void 0);const s=e.filter((e=>e.database===t)).map((e=>e.collection)).filter(((e,t,n)=>n.indexOf(e)===t));r(s)}),[e]),c=(0,L.useMemo)((()=>e=>{a(e)}),[]);return[(0,L.useMemo)((()=>L.createElement("div",{className:je},L.createElement(Ve,{options:o,placeholder:"All databases",onSelect:l,value:t??""}),L.createElement(Ve,{options:i,placeholder:"All collections",onSelect:c,value:s??""}))),[o,l,t,i,c,s]),(0,L.useMemo)((()=>({database:t,collection:s})),[t,s])]}(e),[s,a]=function(){const[e,t]=(0,L.useState)("");return[(0,L.useMemo)((()=>L.createElement(M.TextInput,{className:Fe,"aria-label":"Search",type:"search",placeholder:"Search",value:e,onChange:e=>{t(e.target.value)},onBlur:()=>{e.length>0&&Le("My Queries Search")},spellCheck:!1})),[e]),e]}();return{controls:(0,L.useMemo)((()=>L.createElement("div",{className:qe},s,t)),[s,t]),conditions:n,search:a}}(t),d=Be(t,l,c).sort(((e,t)=>e.score-t.score)).map((e=>e.item));Qe((()=>{l.database&&Ge("My Queries Filter",{type:"database"})}),l.database),Qe((()=>{l.collection&&Ge("My Queries Filter",{type:"collection"})}),l.collection);const[p,u]=(0,M.useSortControls)(We,{isDisabled:Boolean(c)});Qe((()=>{Ge("My Queries Sort",{sort_by:u.name,order:1===u.order?"ascending":"descending"})}),u);const m=(0,M.useSortedItems)(d,u),h=(0,L.useCallback)(((e,t)=>{switch(t){case"open":return s(e);case"rename":return a(e);case"delete":return i(e);case"copy":return r(e)}}),[s,a,i,r]),g=(0,L.useCallback)((({index:e,...t})=>{const n=m[e];return L.createElement(re,ze({id:n.id,type:n.type,name:n.name,database:n.database,collection:n.collection,lastModified:n.lastModified,onAction:h,"data-testid":`grid-item-${e}`},t))}),[h,m]);return e?null:0===t.length?L.createElement("div",{className:Xe,"data-testid":"my-queries-list"},L.createElement(ge,null)):L.createElement(Ye.Provider,{value:{filterControls:o??null,sortControls:p??null}},L.createElement(M.VirtualGrid,{"data-testid":"my-queries-list",itemMinWidth:Z,itemHeight:218+M.spacing[2],itemsCount:m.length,renderItem:g,itemKey:e=>m[e].id,renderHeader:Je,headerHeight:M.spacing[5]+36,renderEmptyList:be,classNames:{row:Ze},resetActiveItemOnBlur:!1}),L.createElement(Ne,null),L.createElement(Oe,null),L.createElement(De,null))})),nt=JSON.parse('{"name":"@mongodb-js/compass-saved-aggregations-queries","description":"Instance tab plugin that shows saved queries and aggregations","author":{"name":"MongoDB Inc","email":"compass@mongodb.com"},"publishConfig":{"access":"public"},"bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"homepage":"https://github.com/mongodb-js/compass","version":"0.5.0","repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"},"files":["dist"],"license":"SSPL","main":"dist/index.js","exports":{"webpack":"./src/index.ts","require":"./dist/index.js"},"types":"./dist/index.d.ts","scripts":{"prepublishOnly":"npm run compile","compile":"npm run webpack -- --mode production","prewebpack":"rimraf ./lib","webpack":"webpack-compass","start":"npm run webpack serve -- --mode development","analyze":"npm run webpack -- --mode production --analyze","typecheck":"tsc --noEmit","eslint":"eslint","prettier":"prettier","lint":"npm run eslint . && npm run prettier -- --check .","depcheck":"depcheck","check":"npm run typecheck && npm run lint && npm run depcheck","check-ci":"npm run check","test":"mocha","test-electron":"xvfb-maybe electron-mocha --no-sandbox","test-cov":"nyc -x \\"**/*.spec.*\\" --reporter=lcov --reporter=text --reporter=html npm run test","test-watch":"npm run test -- --watch","test-ci":"npm run test-cov","test-ci-electron":"npm run test-electron","reformat":"npm run prettier -- --write ."},"peerDependencies":{"@mongodb-js/compass-components":"^0.13.0","react":"^16.14.0","react-dom":"^16.14.0","react-redux":"^5.1.2","redux-thunk":"^2.4.1"},"dependencies":{"@mongodb-js/compass-aggregations":"^8.22.0","@mongodb-js/compass-components":"^0.13.0","@mongodb-js/compass-logging":"^0.10.0","@mongodb-js/compass-query-history":"^8.21.0","@react-aria/utils":"^3.11.0","bson":"^4.6.1","fuse.js":"^6.5.3","mongodb-ns":"^2.3.0","react":"^16.14.0","react-dom":"^16.14.0","react-redux":"^5.1.2","redux":"^4.1.2","redux-thunk":"^2.4.1"},"devDependencies":{"@mongodb-js/eslint-config-compass":"^0.7.0","@mongodb-js/mocha-config-compass":"^0.10.0","@mongodb-js/prettier-config-compass":"^0.5.0","@mongodb-js/tsconfig-compass":"^0.6.0","@mongodb-js/webpack-config-compass":"^0.7.0","@testing-library/react":"^12.0.0","@testing-library/react-hooks":"^7.0.2","@testing-library/user-event":"^13.5.0","@types/chai":"^4.2.21","@types/chai-dom":"^0.0.10","@types/mocha":"^9.0.0","@types/proxyquire":"^1.3.28","@types/react":"^17.0.5","@types/react-dom":"^17.0.10","@types/sinon-chai":"^3.2.5","chai":"^4.3.4","depcheck":"^1.4.1","eslint":"^7.25.0","hadron-app-registry":"^8.10.0","mocha":"^8.4.0","mongodb-data-service":"^21.19.0","mongodb-instance-model":"^11.21.0","nyc":"^15.1.0","prettier":"2.3.2","proxyquire":"^2.1.3","rimraf":"^3.0.2","sinon":"^9.2.3","xvfb-maybe":"^0.2.1"}}'),st={component:()=>L.createElement(j.zt,{store:I},L.createElement(tt,null)),name:"My Queries",order:1};function at(e){e.registerStore("App.AggregationsQueriesListStore",I),e.registerRole("Instance.Tab",st)}function it(e){e.deregisterStore("App.AggregationsQueriesListStore"),e.deregisterRole("Instance.Tab",st)}},85931:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>pt,configureStore:()=>lt,deactivate:()=>ut,default:()=>mt,metadata:()=>ct});var s=n(2784),a=n(16435),i=n(13980),r=n.n(i),o=n(76635),l=n(50517),c=n(70602),d=n(72779),p=n.n(d),u=(n(95095),n(21291)),m=n(52908),h=n(15251),g=n(6909),b=n(24179),y=n(93347),f=n.n(y),v=n(56081);const E="validation/namespace/LOADING_SAMPLE_DOCUMENTS",S={isLoading:!1},x=1e5,w=e=>({type:"validation/namespace/SAMPLE_DOCUMENTS_FETCHED",matching:e.matching,notmatching:e.notmatching}),C={"validation/namespace/SAMPLE_DOCUMENTS_FETCHED":(e,t)=>({...e,matching:t.matching,notmatching:t.notmatching,isLoading:!1}),"validation/namespace/LOADING_SAMPLE_DOCUMENTS":e=>({...e,type:E,isLoading:!0})},k=e=>e(w({matching:void 0,notmatching:void 0})),N=(e,t)=>e(X(t)),_=(e,t)=>{const n=e.pipeline;e.count>x&&n.unshift({$limit:x}),e.dataService.aggregate(e.namespace,e.pipeline,{allowDiskUse:!0},((n,s)=>{if(n)return k(e.dispatch),void N(e.dispatch,n);s.toArray(((n,a)=>n?(k(e.dispatch),void N(e.dispatch,n)):(s.close(),t(a))))}))},T=(e,t)=>(n,s)=>{if(n({type:E}),t)return k(n);const a=s(),i=a.dataService.dataService,r=a.namespace.ns,o=Q(e),l=Q(o.validator).validator,c=[{$match:l},{$limit:1}];i&&i.count(r,l,{},((e,t)=>{if(e)return k(n),void N(n,e);const s={pipeline:c,namespace:r,dispatch:n,dataService:i,count:t};_(s,(e=>{s.pipeline=[{$match:{$nor:[l]}},{$limit:1}],_(s,(t=>n(w({matching:e[0],notmatching:t[0]}))))}))}))};var A=n(39752),R=n.n(A);const{track:O}=(0,g.createLoggerAndTelemetry)("COMPASS-SCHEMA-VALIDATION-UI"),D="validation/namespace/IS_ZERO_STATE_CHANGED",P=e=>({type:D,isZeroState:e}),I=e=>(t,n)=>{const s=n(),a=s.dataService.dataService,i=s.namespace;return!1===e&&(O("Schema Validation Added"),((e,t,n,s)=>{t.database(n.database,{},((t,s)=>{let a=0;return t||(a=s.collections.find((e=>e.name===n.collection)).document_count),e((0,A.globalAppRegistryEmit)("schema-validation-rules-added",{collectionSize:a}))}))})(t,a,i)),t(P(e))},L="validation/namespace/IS_LOADED_CHANGED",j=e=>({type:L,isLoaded:e}),{track:M}=(0,g.createLoggerAndTelemetry)("COMPASS-SCHEMA-VALIDATION-UI"),q="validation",F=`${q}/VALIDATOR_CHANGED`,V=`${q}/VALIDATION_CANCELED`,B=`${q}/VALIDATION_SAVE_FAILED`,U=`${q}/VALIDATION_FETCHED`,H=`${q}/VALIDATION_ACTION_CHANGED`,$=`${q}/VALIDATION_LEVEL_CHANGED`,z=`${q}/SYNTAX_ERROR_OCCURRED`,G={validator:"",validationAction:"error",validationLevel:"strict",isChanged:!1,syntaxError:null,error:null},Q=e=>{const t={syntaxError:null,validator:e};if(""===e)t.syntaxError={message:"The validator must be an object."};else try{t.validator=f().parseFilter(e)}catch(e){t.syntaxError=e}return t},W=(e,t)=>{const n=Q(t.validation.validator),s=(0,v.P)(n.validator,null,2);return{...e,prevValidation:{validator:s,validationAction:t.validation.validationAction,validationLevel:t.validation.validationLevel},isChanged:t.validation.isChanged||!1,validator:s,validationAction:t.validation.validationAction,validationLevel:t.validation.validationLevel,syntaxError:null,error:t.validation.error||null}},K={[F]:(e,t)=>{const n=Q(t.validator),s={...e,validator:t.validator,syntaxError:n.syntaxError,error:null};return{...s,isChanged:!(0,o.isEqual)((0,o.pick)(s,["validator","validationAction","validationLevel"]),e.prevValidation)}},[V]:W,[U]:W,[B]:(e,t)=>({...e,error:t.error||null}),[H]:(e,t)=>{const n={...e,validationAction:t.validationAction};return{...n,isChanged:!(0,o.isEqual)((0,o.pick)(n,["validator","validationAction","validationLevel"]),e.prevValidation)}},[$]:(e,t)=>{const n={...e,validationLevel:t.validationLevel};return{...n,isChanged:!(0,o.isEqual)((0,o.pick)(n,["validator","validationAction","validationLevel"]),e.prevValidation)}},[z]:(e,t)=>({...e,isChanged:!0,syntaxError:t.syntaxError})},Z=e=>({type:U,validation:e}),X=e=>({type:z,syntaxError:e}),Y=(e,t,n,s,a)=>t.database(n.database,{},((t,i)=>{let r=0,l=0,c=s.validator;t||(r=i.collections.find((e=>e.name===n.collection)).document_count);try{(0,o.isObject)(c)||(c=f().parseFilter(c)),l=Object.keys(c).length}catch(e){l=-1}return e((0,A.globalAppRegistryEmit)(a,{ruleCount:l,validationLevel:s.validationLevel,validationAction:s.validationAction,jsonSchema:!!c.$jsonSchema,collectionSize:r}))})),J=e=>(t,n)=>{const s=n().dataService.dataService;s&&s.collectionInfo(e.database,e.collection).then((n=>{const a=ee(null,n??{});if(!a.validator)return a.validator="{}",t(Z(a)),void t(j(!0));Y(t,s,e,a,"schema-validation-fetched"),a.validator=b.EJSON.stringify(a.validator,null,2),t(T(a.validator)),t(Z(a)),t(P(!1)),t(j(!0))}),(e=>{t(Z(ee(e))),t(P(!1)),t(j(!0))}))};function ee(e,{validation:t}={}){const{validationAction:n,validationLevel:s}=G;return e?{validationAction:n,validationLevel:s,error:e}:{validationAction:t?.validationAction??n,validationLevel:t?.validationLevel??s,...t?.validator&&{validator:t.validator}}}var te=n(13253),ne=n(62823);const se={"option-selector-label":"validation-selector-module-option-selector-label__3VzUP"};class ae extends s.Component{static displayName="ValidationSelector";static propTypes={id:r().string.isRequired,bsSize:r().string,options:r().object.isRequired,label:r().oneOfType([r().string,r().array]),title:r().string,onSelect:r().func,disabled:r().bool};static defaultProps={label:"",title:"Select an option",onSelect:()=>{},disabled:!1};static renderLabel(e,t){return e?s.createElement("label",{className:p()(se["option-selector-label"]),htmlFor:t},e):null}render(){const e=this.constructor.renderLabel(this.props.label,this.props.id),t=[];for(const e in this.props.options)if(this.props.options.hasOwnProperty(e)){const n=this.props.options[e];t.push(s.createElement(te.Z,{key:e,eventKey:e,href:"#"},n))}return s.createElement("div",{className:p()(se["option-selector"])},e,s.createElement(ne.Z,{bsSize:this.props.bsSize,id:this.props.id,onSelect:this.props.onSelect,title:this.props.title,disabled:this.props.disabled},t))}}const ie=ae,re="validation-editor-module-validation-option__3dqwl";var oe=n(59910),le=n.n(oe);n(59047),n(75790);const{track:ce}=(0,g.createLoggerAndTelemetry)("COMPASS-SCHEMA-VALIDATION-UI"),de={enableLiveAutocompletion:!0,tabSize:2,fontSize:11,minLines:17,maxLines:1/0,highlightActiveLine:!1,showGutter:!0,useWorker:!1,mode:"ace/mode/mongodb",showPrintMargin:!1},pe={warn:"Warning",error:"Error"},ue={off:"Off",moderate:"Moderate",strict:"Strict"};class me extends s.Component{static displayName="ValidationEditor";static propTypes={fetchSampleDocuments:r().func.isRequired,validatorChanged:r().func.isRequired,validationActionChanged:r().func.isRequired,validationLevelChanged:r().func.isRequired,cancelValidation:r().func.isRequired,saveValidation:r().func.isRequired,serverVersion:r().string,fields:r().array,validation:r().shape({validator:r().string.isRequired,validationAction:r().string.isRequired,validationLevel:r().string.isRequired,isChanged:r().bool.isRequired,syntaxError:r().object,error:r().object}),openLink:r().func.isRequired,isEditable:r().bool.isRequired};constructor(e){super(e);const t=le().textCompleter;this.completer=new m.ValidationAutoCompleter(e.serverVersion,t,e.fields),this.debounceValidatorChanged=(0,o.debounce)(((e,t)=>{this.props.fetchSampleDocuments(e,t),this.trackValidator(e)}),750)}shouldComponentUpdate(e){return e.validation.validator!==this.props.validation.validator||e.validation.validationAction!==this.props.validation.validationAction||e.validation.validationLevel!==this.props.validation.validationLevel||e.validation.error!==this.props.validation.error||e.validation.syntaxError!==this.props.validation.syntaxError||e.validation.isChanged!==this.props.validation.isChanged||e.serverVersion!==this.props.serverVersion||e.fields.length!==this.props.fields.length}componentDidUpdate(){this.completer.update(this.props.fields),this.completer.version=this.props.serverVersion}onValidatorSave(){this.props.saveValidation(this.props.validation)}onValidatorChange(e){this.props.validatorChanged(e),this.validatorChanged()}hasErrors(){return this.props.validation.error||this.props.validation.syntaxError}validatorChanged(){this.debounceValidatorChanged(this.props.validation.validator,this.hasErrors())}trackValidator(e){const t=Q(e),n={json_schema:Boolean(t.validator.$jsonSchema)};ce("Schema Validation Edited",n)}renderActionSelector(){const e=[s.createElement("span",{key:"validation-action-label"},"Validation Action"),s.createElement(c.InfoSprinkle,{key:"validation-action-sprinkle",helpLink:"https://docs.mongodb.com/manual/reference/command/collMod/#validationAction",onClickHandler:this.props.openLink})];return s.createElement("div",{className:p()(re)},s.createElement(ie,{id:"validation-action-selector",bsSize:"xs",options:pe,title:pe[this.props.validation.validationAction],label:e,disabled:!this.props.isEditable,onSelect:this.props.validationActionChanged}))}renderLevelSelector(){const e=[s.createElement("span",{key:"validation-level-span"},"Validation Level"),s.createElement(c.InfoSprinkle,{key:"validation-level-sprinkle",helpLink:"https://docs.mongodb.com/manual/reference/command/collMod/#validationLevel",onClickHandler:this.props.openLink})];return s.createElement("div",{className:p()(re)},s.createElement(ie,{id:"validation-level-selector",bsSize:"xs",options:ue,title:ue[this.props.validation.validationLevel],label:e,disabled:!this.props.isEditable,onSelect:this.props.validationLevelChanged}))}renderValidationMessage(){if(this.hasErrors()){let e="",t="";return this.props.validation.syntaxError?(e=this.props.validation.syntaxError.message,t="validation-editor-module-validation-message-container-syntax-error__DsCvY"):this.props.validation.error&&(t="validation-editor-module-validation-message-container-error__16qYJ",e=this.props.validation.error.message),s.createElement("div",{className:p()({"validation-editor-module-validation-message-container__3zTt4":!0,[t]:!0})},s.createElement("div",{className:"validation-editor-module-validation-message__3KbQi"},e))}}renderActionsPanel(){if(this.props.validation.isChanged)return s.createElement("div",{className:p()("validation-editor-module-validation-action-container__2G-v5")},s.createElement("div",{className:p()("validation-editor-module-validation-action-message__2NFvg"),"data-test-id":"validation-action-message"},"Validation modified"),s.createElement(h.TextButton,{dataTestId:"cancel-validation-button",className:`btn btn-default btn-xs ${p()("validation-editor-module-cancel__1RR8X")}`,text:"Cancel",clickHandler:this.props.cancelValidation}),s.createElement(h.TextButton,{dataTestId:"update-validation-button",className:"btn btn-primary btn-xs "+(this.hasErrors()?"disabled":""),text:"Update",clickHandler:this.onValidatorSave.bind(this)}))}render(){return s.createElement("div",{className:p()("validation-editor-module-validation-editor__3oyJg"),"data-test-id":"validation-editor"},s.createElement("div",{className:p()("validation-editor-module-validation-editor-content__arVpT")},s.createElement("div",{className:p()("validation-editor-module-validation-options-container__EqjFj")},this.renderActionSelector(),this.renderLevelSelector()),s.createElement("hr",null),s.createElement("div",{className:p()("validation-editor-module-brace-editor-container__3QKA6")},s.createElement(u.default,{mode:"javascript",theme:"mongodb",width:"100%",height:"100%",value:this.props.validation.validator,onChange:this.onValidatorChange.bind(this),editorProps:{$blockScrolling:1/0},setOptions:de,readOnly:!this.props.isEditable,onFocus:()=>le().setCompleters([this.completer])})),this.renderValidationMessage()),this.renderActionsPanel())}}const he=me;class ge extends s.Component{static displayName="CheckCircle";render(){return s.createElement("i",{className:`fa-lg ${p()("check-circle-module-check-circle__McDVb")}`})}}const be=ge;class ye extends s.Component{static displayName="CrossCircle";render(){return s.createElement("i",{className:`fa-lg ${p()("cross-circle-module-cross-circle__3tD7G")}`})}}const fe=ye;var ve=n(37861),Ee=n(74727),Se=n.n(Ee);const xe="document-preview-module-document-preview__1OntE",we="document-preview-module-document-preview-documents__3PNXi";class Ce extends s.Component{static displayName="DocumentPreview";static propTypes={document:r().object};render(){return this.props.document?s.createElement("div",{className:xe,"data-test-id":"document-preview"},s.createElement("div",{className:we},s.createElement("div",{className:"document-preview-module-document-preview-document-card__1WJCk"},s.createElement(ve.Document,{doc:new(Se())(this.props.document),editable:!1})))):s.createElement("div",{className:xe,"data-test-id":"document-preview"},s.createElement("div",{className:we},s.createElement("div",{className:"document-preview-module-no-documents__3ngWy"},s.createElement("i",null,"No Preview Documents"))))}}const ke=Ce;class Ne extends s.PureComponent{static displayName="LoadingOverlay";static propTypes={text:r().string.isRequired};render(){return s.createElement("div",{className:p()("loading-overlay-module-loading-overlay__1KPul")},s.createElement("div",{className:p()("loading-overlay-module-loading-overlay-box__1pKpp")},s.createElement("i",{className:"fa fa-circle-o-notch fa-spin","aria-hidden":!0}),s.createElement("div",{className:p()("loading-overlay-module-loading-overlay-box-text__2IFWt")},this.props.text)))}}const _e=Ne,Te={"sample-documents":"sample-documents-module-sample-documents__2SpED","sample-documents-content":"sample-documents-module-sample-documents-content__2SA25","document-container":"sample-documents-module-document-container__3M1Oo","matching-documents":"sample-documents-module-matching-documents__3FJ5S","info-sprinkle":"sample-documents-module-info-sprinkle__2bCku","notmatching-documents":"sample-documents-module-notmatching-documents__3Aj3l"};class Ae extends s.Component{static displayName="SampleDocuments";static propTypes={sampleDocuments:r().shape({matching:r().object,notmatching:r().object,isLoading:r().bool})};shouldComponentUpdate(e){return e.sampleDocuments.isLoading!==this.props.sampleDocuments.isLoading}renderMatchingDocuments(){return s.createElement("div",{className:Te["document-container"],"data-test-id":"matching-documents"},s.createElement("div",{className:Te["matching-documents"]},s.createElement(be,null),s.createElement("span",{className:Te["matching-documents-title"]},"Sample Document That Passed Validation")),s.createElement(ke,{document:this.props.sampleDocuments.matching}))}renderNotMatchingDocuments(){return s.createElement("div",{className:Te["document-container"],"data-test-id":"notmatching-documents"},s.createElement("div",{className:Te["notmatching-documents"]},s.createElement(fe,null),s.createElement("span",{className:Te["matching-documents-title"]},"Sample Document That Failed Validation")),s.createElement(ke,{document:this.props.sampleDocuments.notmatching}))}render(){return s.createElement("div",{className:Te["sample-documents"]},s.createElement("div",{className:Te["sample-documents-content"]},this.props.sampleDocuments.isLoading?s.createElement(_e,{text:"Sampling Document..."}):null,this.renderMatchingDocuments(),this.renderNotMatchingDocuments()))}}const Re=Ae;class Oe extends s.Component{static displayName="ZeroGraphic";render(){return s.createElement("svg",{className:p()("zero-graphic-module-zero-graphic__2wiNr"),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 60 48"},s.createElement("g",{fill:"none",fillRule:"evenodd",strokeLinejoin:"round",strokeWidth:"2",transform:"translate(1 1)"},s.createElement("polyline",{stroke:"#16CC62",strokeLinecap:"round",points:"22.75 22.75 .25 22.75 .25 .25 57.75 .25 57.75 15.303"}),s.createElement("path",{stroke:"#116149",strokeLinecap:"round",d:"M10.25 6.5L10.25 16.5M14.43225 8.75825L6.06975 14.24075M14.41025 14.276L6.09025 8.7235M25.25 6.5L25.25 16.5M29.43225 8.75825L21.06975 14.24075M29.41025 14.276L21.09025 8.7235"}),s.createElement("path",{stroke:"#116149",d:"M57.75,30.355 C57.75,38.6375 51.0325,45.355 42.75,45.355 C34.4625,45.355 27.75,38.6375 27.75,30.355 C27.75,22.0725 34.4625,15.355 42.75,15.355 C51.0325,15.355 57.75,22.0725 57.75,30.355 L57.75,30.355 Z"}),s.createElement("polyline",{stroke:"#16CC62",strokeLinecap:"round",points:"50.25 26.605 41.5 36.195 35.25 29.945"})))}}const De=Oe,Pe={"validation-states":"validation-states-module-validation-states__1KZv3","content-container":"validation-states-module-content-container__3IKP3","upgrade-link":"validation-states-module-upgrade-link__3epBa","zero-state-container":"validation-states-module-zero-state-container__2UBgq","zero-state-link":"validation-states-module-zero-state-link__zvxMV"};function Ie(){return Ie=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ie.apply(this,arguments)}class Le extends s.Component{static displayName="ValidationStates";static propTypes={isZeroState:r().bool.isRequired,isLoaded:r().bool.isRequired,changeZeroState:r().func.isRequired,zeroStateChanged:r().func.isRequired,editMode:r().object.isRequired,openLink:r().func.isRequired,serverVersion:r().string};isEditable(){return!(this.props.editMode.collectionReadOnly||this.props.editMode.collectionTimeSeries||this.props.editMode.hadronReadOnly||this.props.editMode.writeStateStoreReadOnly||this.props.editMode.oldServerReadOnly)}renderBanner(){if(!this.isEditable()){if(this.props.editMode.collectionTimeSeries)return s.createElement(c.StatusRow,{style:"warning"},s.createElement("div",{id:"collectionTimeSeries"},"Schema validation for time-series collections is not supported."));if(this.props.editMode.collectionReadOnly)return s.createElement(c.StatusRow,{style:"warning"},s.createElement("div",{id:"collectionReadOnly"},"Schema validation for readonly views is not supported."));if(this.props.editMode.writeStateStoreReadOnly)return s.createElement(c.StatusRow,{style:"warning"},s.createElement("div",{id:"writeStateStoreReadOnly"},"This action is not available on a secondary node."));if(this.props.editMode.oldServerReadOnly)return s.createElement(c.StatusRow,{style:"warning"},s.createElement("div",{id:"oldServerReadOnly"},"Compass no longer supports the visual rule builder for server versions below 3.2. To use the visual rule builder, please",s.createElement("div",null,"Â "),s.createElement("a",{className:Pe["upgrade-link"],onClick:this.props.openLink.bind(this,"https://docs.mongodb.com/manual/tutorial/upgrade-revision/")},"upgrade to MongoDB 3.2.")))}}renderZeroState(){if(this.props.isZeroState&&this.props.isLoaded)return s.createElement("div",{className:Pe["zero-state-container"]},s.createElement(De,null),s.createElement(c.ZeroState,{header:"Add validation rules",subtext:"Create rules to enforce data structure of documents on updates and inserts."},s.createElement("div",{className:Pe["zero-state-action"]},s.createElement(l.Button,{"data-test-id":"add-rule-button",disabled:!this.isEditable(),onClick:this.props.changeZeroState.bind(this,!1),variant:l.ButtonVariant.Primary,size:l.ButtonSize.Large},"Add Rule")),s.createElement(l.Link,{className:Pe["zero-state-link"],onClick:this.props.openLink.bind(this,"https://docs.mongodb.com/manual/core/schema-validation/")},"Learn more about validations")))}renderContent(){if(!this.props.isZeroState&&this.props.isLoaded)return s.createElement("div",{className:Pe["content-container"]},s.createElement(he,Ie({},this.props,{isEditable:this.isEditable()})),s.createElement(Re,this.props))}render(){return s.createElement("div",{className:Pe["validation-states"]},this.renderBanner(),this.renderZeroState(),this.renderContent())}}const je=Le,Me="validation/namespace/NAMESPACE_CHANGED",qe=e=>({type:Me,namespace:e}),Fe=navigator.userAgent.toLowerCase();class Ve extends s.Component{static displayName="CompassSchemaValidation";render(){return s.createElement("div",{className:"compass-schema-validation-module-root__3JVdT"},s.createElement(je,this.props))}}const Be=(0,a.$j)((e=>(0,o.pick)(e,["serverVersion","validation","fields","namespace","sampleDocuments","isZeroState","isLoaded","editMode"])),{fetchSampleDocuments:T,validatorChanged:e=>({type:F,validator:e}),cancelValidation:()=>(e,t)=>{const n=t().validation.prevValidation;var s;e((s={isChanged:!1,validator:n.validator,validationAction:n.validationAction,validationLevel:n.validationLevel,syntaxError:null,error:null},{type:V,validation:s})),e(T(n.validator))},saveValidation:e=>(t,n)=>{const s=n(),a=s.dataService.dataService,i=s.namespace,r={validator:Q(e.validator).validator,validationAction:e.validationAction,validationLevel:e.validationLevel,isChanged:!1};if(a){const n={validation_action:e.validationAction,validation_level:e.validationLevel};M("Schema Validation Updated",n),Y(t,a,i,e,"schema-validation-saved"),a.updateCollection(`${i.database}.${i.collection}`,{validator:r.validator,validationAction:r.validationAction,validationLevel:r.validationLevel},(e=>t(e?(e=>({type:B,error:e}))(e):J(i))))}},namespaceChanged:qe,validationActionChanged:e=>({type:H,validationAction:e}),validationLevelChanged:e=>({type:$,validationLevel:e}),openLink:e=>()=>{if(Fe.indexOf("electron")>-1){const{shell:t}=n(72298);t.openExternal(e)}else window.open(e,"_new")},zeroStateChanged:P,changeZeroState:I})(Ve);class Ue extends s.Component{static displayName="CompassSchemaValidationPlugin";static propTypes={store:r().object.isRequired};render(){return s.createElement(a.zt,{store:this.props.store},s.createElement(Be,null))}}const He=Ue;var $e=n(18717),ze=n(43292);const Ge="validation/data-service/DATA_SERVICE_CONNECTED",Qe={error:null,dataService:null},We="validation/fields/FIELDS_CHANGED",Ke=[],Ze="validation/server-version/SERVER_VERSION_CHANGED",Xe="validation/namespace/EDIT_MODE_CHANGED",Ye={collectionReadOnly:!1,hadronReadOnly:!1,writeStateStoreReadOnly:!1,oldServerReadOnly:!1},Je=e=>({type:Xe,editMode:e}),et={appRegistry:A.INITIAL_STATE,dataService:Qe,fields:Ke,namespace:"",serverVersion:"4.0.0",validation:G,sampleDocuments:S,isZeroState:!0,isLoaded:!1,editMode:Ye},tt=(0,$e.combineReducers)({appRegistry:R(),dataService:function(e=Qe,t){return t.type===Ge?{error:t.error,dataService:t.dataService}:e},fields:function(e=Ke,t){return t.type===We?(n=t.fields,Object.keys(n).map((e=>{const t=e.indexOf(".")>-1||e.indexOf(" ")>-1?`"${e}"`:e;return{name:e,value:t,score:1,meta:"field",version:"0.0.0"}}))):e;var n},namespace:function(e="",t){return t.type===Me?t.namespace:e},serverVersion:function(e="4.0.0",t){return t.type===Ze&&t.version||e},validation:function(e=G,t){const n=K[t.type];return n?n(e,t):e},sampleDocuments:function(e=S,t){const n=C[t.type];return n?n(e,t):e},isZeroState:function(e=!0,t){return t.type===D?t.isZeroState:e},isLoaded:function(e=!1,t){return t.type===L?t.isLoaded:e},editMode:function(e=Ye,t){return t.type===Xe?{...e,...t.editMode}:e}}),nt={"validation/reset":()=>({...et})},st=(e,t)=>{const n=nt[t.type];return n?n(e,t):tt(e,t)};var at=n(84935),it=n.n(at),rt=n(93018),ot=n.n(rt);const lt=(e={})=>{const t=(0,$e.createStore)(st,(0,$e.applyMiddleware)(ze.Z));if(e.localAppRegistry){const n=e.localAppRegistry;t.dispatch((0,A.localAppRegistryActivated)(n)),n.on("fields-changed",(e=>{t.dispatch((e=>({type:We,fields:e}))(e.fields))})),n.on("server-version-changed",(e=>{if(t.dispatch((e=>({type:Ze,version:e}))(e)),e){const n={oldServerReadOnly:ot().gte("3.2.0",e)};t.dispatch(Je(n))}})),n.on("subtab-changed",(e=>{"Validation"===e&&t.dispatch(((e,t)=>{const n=t(),s=n.namespace;e(J(s));const a=n.dataService.dataService,i=n.validation;a&&Y(e,a,s,i,"schema-validation-activated")}))}))}if(e.globalAppRegistry){const n=e.globalAppRegistry;t.dispatch((0,A.globalAppRegistryActivated)(n))}if(e.dataProvider&&((e,t,n)=>{e.dispatch(((e,t)=>({type:Ge,error:e,dataService:t}))(t,n))})(t,e.dataProvider.error,e.dataProvider.dataProvider),e.namespace){const n=it()(e.namespace),s=e.globalAppRegistry.getStore("DeploymentAwareness.WriteStateStore"),a={collectionTimeSeries:!!e.isTimeSeries,collectionReadOnly:!!e.isReadonly,hadronReadOnly:!1,writeStateStoreReadOnly:!s.state.isWritable};t.dispatch(qe(n)),(a.collectionReadOnly||a.collectionTimeSeries)&&t.dispatch(I(!0)),t.dispatch(Je(a))}return t},ct=JSON.parse('{"name":"@mongodb-js/compass-schema-validation","productName":"Compass Json Schema Validation plugin","version":"5.22.0","apiVersion":"3.0.0","description":"Compass plugin for document JSON schema validation","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"cross-env NODE_ENV=development webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test:watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","cover":"nyc npm run test","test-check-ci":"npm run cover && npm run compile && npm run check","check":"npm run lint && npm run depcheck","prepublishOnly":"npm run compile","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","bootstrap":"npm run compile"},"license":"SSPL","peerDependencies":{"@mongodb-js/compass-components":"^0.13.0","@mongodb-js/compass-crud":"^12.22.0","bson":"*","hadron-react-buttons":"^5.7.0","hadron-react-components":"^5.13.0","mongodb-ace-autocompleter":"*","mongodb-ace-mode":"^1.6.0","mongodb-ace-theme":"^1.6.0","mongodb-query-parser":"^2.4.4","prop-types":"^15.7.2","react":"^16.14.0","react-ace":"^9.5.0","react-bootstrap":"*","react-dom":"^16.14.0","react-redux":"^5.0.6","react-tooltip":"^3.11.1","redux":"^4.1.2","redux-thunk":"^2.3.0"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","@hot-loader/react-dom":"^16.9.0","@mongodb-js/compass-components":"^0.13.0","@mongodb-js/compass-crud":"^12.22.0","@mongodb-js/compass-logging":"^0.10.0","ace-builds":"^1.4.3","autoprefixer":"^9.4.6","babel-loader":"^8.2.2","bson":"^4.4.1","chai":"^4.1.2","chai-enzyme":"1.0.0-beta.1","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^7.0.0","css-loader":"^4.3.0","debug":"4.3.0","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^5.0.3","eslint-plugin-react":"^7.24.0","extract-text-webpack-plugin":"^4.0.0-beta.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","hadron-document":"^7.9.0","hadron-react-buttons":"^5.7.0","hadron-react-components":"^5.13.0","html-webpack-plugin":"^3.2.0","ignore-loader":"^0.1.2","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","less":"^3.11.1","less-loader":"^7.3.0","mocha":"^5.0.0","mocha-webpack":"^2.0.0-beta.0","mongodb-ace-autocompleter":"^0.11.0","mongodb-ace-mode":"^1.6.0","mongodb-ace-theme":"^1.6.0","mongodb-connection-model":"^21.15.0","mongodb-data-service":"^21.19.0","mongodb-ns":"^2.3.0","mongodb-query-parser":"^2.4.4","mongodb-reflux-store":"^0.0.1","mongodb-schema":"^8.2.5","node-loader":"^0.6.0","nyc":"^15.0.0","peer-deps-externals-webpack-plugin":"^1.0.4","postcss-loader":"^2.1.6","prop-types":"^15.7.2","react":"^16.14.0","react-ace":"^9.5.0","react-dom":"^16.14.0","react-hot-loader":"^4.13.0","react-redux":"^5.0.6","redux":"^4.1.2","redux-thunk":"^2.3.0","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","resolve":"^1.15.1","rimraf":"^3.0.1","shebang-loader":"^0.0.1","sinon":"^8.1.1","sinon-chai":"^3.3.0","style-loader":"^2.0.0","url-loader":"^3.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^3.0.3","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-merge":"^4.2.2","webpack-node-externals":"^3.0.0"},"dependencies":{"@mongodb-js/mongodb-redux-common":"^1.10.0","decomment":"^0.9.2","javascript-stringify":"^2.0.1","lodash":"^4.17.15","react-bootstrap":"*","semver":"^5.7.1"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"}}'),dt={name:"Validation",component:He,configureStore:lt,configureActions:()=>{},storeName:"CompassSchemaValidation.Store",actionName:"CompassSchemaValidation.Action"};function pt(e){e.registerRole("Collection.Tab",dt)}function ut(e){e.deregisterRole("Collection.Tab",dt)}const mt=He},58554:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>gn,configureStore:()=>pn,deactivate:()=>bn,default:()=>yn,metadata:()=>mn});var s=n(2784),a=n(13980),i=n.n(a),r=n(70602),o=n(50517),l=n(84600),c=n.n(l),d=n(16921),p=n.n(d),u=n(1246),m=n.n(u),h=n(45658);const g={SCHEMA_PROBABILITY_PERCENT:"schema-probability-percent",DECIMAL_128:"Decimal128",DOUBLE:"Double",LONG:"Long",INT_32:"Int32",STRING:"String",NUMBER:"Number"};function b(){return b=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},b.apply(this,arguments)}class y extends s.Component{static displayName="TypeComponent";static propTypes={name:i().string.isRequired,types:i().array,activeType:i().any,self:i().object,probability:i().number.isRequired,renderType:i().func.isRequired,showSubTypes:i().bool.isRequired};typeClicked(e){e.stopPropagation(),this.props.renderType(this.props.self)}subTypeClicked(e){this.props.renderType(e)}_getArraySubTypes(){if("Array"!==this.props.name)return null;if(!this.props.showSubTypes)return null;const e=c()(this.props.types,(e=>"Undefined"===e.name?-1/0:e.probability)).reverse(),t=p()(e,this.props.activeType),n=e.map((e=>s.createElement(y,b({key:"subtype-"+e.name,activeType:t,renderType:this.subTypeClicked.bind(this,e),self:e,showSubTypes:!1},e))));return s.createElement("div",{className:"array-subtypes"},s.createElement("div",{className:"schema-field-type-list"},n))}render(){const e=this.props.name.toLowerCase();let t=`schema-field-wrapper schema-field-type-${e}`;this.props.activeType===this.props.self&&(t+=" active");const n="undefined"===e?null:this.typeClicked.bind(this),a={width:100*this.props.probability+"%"},i=this._getArraySubTypes(),r=s.createElement("span",{className:"schema-field-type-label"},this.props.name),o=this.props.probability>.99&&this.props.probability<1||this.props.probability>0&&this.props.probability<.01?"0.0%":"0%",l=`${this.props.name} (${m()(this.props.probability).format(o)})`,c={"data-for":g.SCHEMA_PROBABILITY_PERCENT,"data-tip":l,"data-effect":"solid","data-border":!0};return c["data-offset"]=this.props.showSubTypes?'{"top": -25, "left": 0}':'{"top": 10, "left": 0}',s.createElement("div",b({},c,{className:t,style:a,onClick:n}),s.createElement(h.Z,{id:g.SCHEMA_PROBABILITY_PERCENT}),this.props.showSubTypes?r:null,s.createElement("div",{className:"schema-field-type"}),i,this.props.showSubTypes?null:r)}}const f=y;var v=n(66496),E=n.n(v),S=n(58001);const{DECIMAL_128:x,DOUBLE:w,LONG:C,INT_32:k}=g;class N extends s.Component{static displayName="ValueBubbleComponent";static propTypes={localAppRegistry:i().object.isRequired,fieldName:i().string.isRequired,queryValue:i().string,value:i().any.isRequired};onBubbleClicked(e){const t=this.props.localAppRegistry.getAction("Query.Actions");(e.shiftKey?t.toggleDistinctValue:t.setValue)({field:this.props.fieldName,value:this.props.value,unsetIfSet:!0})}_extractStringValue(e){if(e&&e._bsontype){if([x,C].includes(e._bsontype))return e.toString();if([w,k].includes(e._bsontype))return String(e.value)}return E()(e)?e:String(e)}render(){const e=this._extractStringValue(this.props.value),t=(0,S.hasDistinctValue)(this.props.queryValue,this.props.value)?"selected":"unselected";return s.createElement("li",{className:"bubble"},s.createElement("code",{className:`selectable ${t}`,onClick:this.onBubbleClicked.bind(this)},e))}}const _=N;var T=n(73855),A=n.n(T);class R extends s.Component{static displayName="UniqueMiniChartComponent";static propTypes={localAppRegistry:i().object.isRequired,fieldName:i().string.isRequired,queryValue:i().string,type:i().object.isRequired,width:i().number};constructor(e){super(e),this.state={sample:A()(this.props.type.values,20)}}onRefresh(e){e.stopPropagation(),e.preventDefault(),this.setState({sample:A()(this.props.type.values,20)})}render(){if(!this.props.type.values)return s.createElement("div",null);const e=this.state.sample||[],t=this.props.fieldName.toLowerCase(),n=this.props.type.name.toLowerCase(),a=e.map(((e,a)=>s.createElement(_,{localAppRegistry:this.props.localAppRegistry,key:`${t}-${n}-${a}`,value:e,queryValue:this.props.queryValue,fieldName:this.props.fieldName}))),i={width:this.props.width};return s.createElement("div",{className:"minichart unique",style:i},s.createElement("dl",{className:"dl-horizontal"},s.createElement("dt",null,s.createElement(o.IconButton,{"aria-label":"Refresh sample values",onClick:this.onRefresh.bind(this)},s.createElement(o.Icon,{glyph:"Refresh"}))),s.createElement("dd",null,s.createElement("ul",{className:"list-inline"},a))))}}const O=R;var D=n(75689),P=n.n(D),I=n(77485),L=n.n(I);class j extends s.Component{static displayName="DocumentMiniChartComponent";static propTypes={nestedDocType:i().object};render(){let e="";if(this.props.nestedDocType){const t=L()(this.props.nestedDocType.fields,"length",0);e=`Document with ${P()("nested field",t,!0)}.`}return s.createElement("div",null,s.createElement("dl",null,s.createElement("dt",null,e),s.createElement("dd",null)))}}const M=j;var q=n(41626),F=n.n(q),V=n(54954),B=n.n(V);class U extends s.Component{static displayName="ArrayMiniChartComponent";static propTypes={type:i().object.isRequired,nestedDocType:i().object};render(){let e="";if(this.props.nestedDocType){const t=L()(this.props.nestedDocType.fields,"length",0);e=`Array of documents with ${P()("nested field",t,!0)}.`}const t=F()(this.props.type.lengths),n=m()(this.props.type.average_length).format("0.0[0]"),a=B()(this.props.type.lengths);return s.createElement("div",null,s.createElement("dl",null,s.createElement("dt",null,e),s.createElement("dd",null),s.createElement("dt",null,"Array lengths"),s.createElement("dd",null,s.createElement("ul",{className:"list-inline"},s.createElement("li",null,"min: ",t),s.createElement("li",null,"average: ",n),s.createElement("li",null,"max: ",a)))))}}const H=U;var $=n(85062),z=n.n($),G=n(59598),Q=n(43875),W=n(85080),K=n(8014),Z=(n(87376),n(15209)),X=n(80562);const Y=({fields:e})=>s.createElement(X.Z,{closeButton:!1,className:"marker-popup-module-popup__1VXxb"},s.createElement(J,{fields:e}));Y.propTypes={fields:i().array};const J=({fields:e})=>e.filter((e=>e.key)).map((e=>{const{key:t,value:n}=e;return s.createElement("span",{className:"marker-popup-module-line__YvqjE",key:t},s.createElement("span",{className:"marker-popup-module-key__3K6H2"},t,":")," ",s.createElement("span",{className:"marker-popup-module-value__1LCHC"},n))})),ee=Y;function te(){return te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},te.apply(this,arguments)}const ne={weight:1,radius:5,fillOpacity:.6},se=(e,t)=>{const n={...ne,...t};return s.createElement(e,te({},n,{onMouseOver:e=>{e.target.openPopup()},onMouseOut:e=>{e.target.closePopup()}}),s.createElement(ee,n))};se.propTypes={fields:i().array};const ae=({data:e})=>e.map(((e,t)=>(e.key=t,se(Z.Z,e))));ae.propTypes={data:i().array.isRequired};const ie=ae;let re=n(34911),oe=function(){let e;return async function(){return e||(e=await async function(){return(await re("https://compass-maps.mongodb.com/compass/copyright").then((e=>e.json()))).normal.map((e=>({...e,boxes:e.boxes.map((e=>z().latLngBounds(z().latLng(e[0],e[1]),z().latLng(e[2],e[3]))))})))}()),e}}();var le=n(80594),ce=n.n(le);const de=e=>!isNaN(+e[0])&&!isNaN(+e[1])||(console.warn("@mongodb-js/compass-schema:coordinates-minichart: Dropping invalid coordinate value",e),!1);class pe extends s.PureComponent{static displayName="CoorddinatesMinichart";static propTypes={_id:i().string,type:i().shape({name:i().string.isRequired,count:i().number.isRequired,probability:i().number.isRequired,unique:i().number,values:i().array}),width:i().number.isRequired,actions:i().object.isRequired,height:i().number.isRequired,fieldName:i().string.isRequired};state={ready:!1,attributionMessage:""};fitMapBounds(){const{map:e}=this.refs;if(!e)return;const t=this.refs.map.leafletElement,n=this.props.type.values.filter(de);let s=z().latLngBounds();1===n.length?s=z().latLng(+n[0][1],+n[0][0]).toBounds(800):n.forEach((e=>{s.extend(z().latLng(+e[1],+e[0]))})),s._northEast.lat===s._southWest.lat&&s._northEast.lng===s._southWest.lng&&(s._northEast.lat=s._northEast.lat+.1,s._southWest.lng=s._southWest.lng-.1),t.fitBounds(s)}componentDidUpdate(){this.fitMapBounds(),this.invalidateMapSize()}whenMapReady=()=>{this.state.ready||(this.getTileAttribution(),this.setState({ready:!0},this.invalidateMapSize))};async getTileAttribution(){if(""!==this.state.attributionMessage)return;const{map:e}=this.refs,t=await async function(e){let t="";if(e){const n=e.leafletElement.getBounds(),s=e.leafletElement.getZoom();t=await async function(e,t){const n=await oe(),s=[];n.forEach((n=>{n.boxes.some((t=>e.intersects(t)))>0&&t>n.minLevel&&t<n.maxLevel&&s.push(n.label)}));const a=s.join(", ");return` &copy; 1987-2019 HERE${a.length>0?`, ${a}`:""} | <a href="https://legal.here.com/en/terms/serviceterms/us">Terms of Use</a>`}(n,s)}return t}(e);this.setState({attributionMessage:t})}invalidateMapSize(){const{map:e}=this.refs;e&&(e.container.style.height=`${this.props.height}px`,e.container.style.width=`${this.props.width}px`,e.leafletElement.invalidateSize())}onMoveEnd=ce()((()=>{this.getTileAttribution()}));renderMapItems(){const{fieldName:e}=this.props,t=this.props.type.values.filter(de).map((t=>{const n=(e=>{const[t,n]=[+e[0],+e[1]];return{type:"Point",coordinates:[n,t],center:[n,t],color:"#43B1E5",fields:[{key:"[longitude, latitude]",value:`[Lat = ${n}, Long = ${t}]`}]}})(t);return n.fields[0].key=e,n}));return s.createElement(ie,{data:t})}onCreated=e=>{this.props.actions.geoLayerAdded(this.props.fieldName,e.layer)};onEdited=e=>{this.props.actions.geoLayersEdited(this.props.fieldName,e.layers)};onDeleted=e=>{this.props.actions.geoLayersDeleted(e.layers)};render(){const{attributionMessage:e}=this.state;return s.createElement(G.Z,{minZoom:1,viewport:{center:[0,0],zoom:1},whenReady:this.whenMapReady,ref:"map",onMoveend:this.onMoveEnd},this.renderMapItems(),s.createElement(Q.Z,{url:"https://compass-maps.mongodb.com/compass/maptile/{z}/{x}/{y}/512",attribution:e}),s.createElement(W.Z,null,s.createElement(K.$,{position:"topright",onEdited:this.onEdited,onCreated:this.onCreated,onDeleted:this.onDeleted,onMounted:this.onMounted,onEditStop:this.onEditStop,onDeleteStop:this.onDeleteStop,draw:{rectangle:!1,polyline:!1,marker:!1,circlemarker:!1}})))}}const ue=pe;var me=n(28316),he=n(42895),ge=n.n(he),be=n(24179);const ye={Double:e=>e.map((e=>e.value)),Int32:e=>e.map((e=>e.value)),Long:e=>e.map((e=>e.toNumber())),Decimal128:e=>e.map((e=>e.toString()))},fe={Long:e=>be.default.Long.fromNumber(e),Decimal128:e=>be.default.Decimal128.fromString(e),Date:e=>new Date(e),ObjectID:e=>be.default.ObjectId.createFromHexString(e)},ve=e=>e;class Ee extends s.Component{static displayName="D3Component";static propTypes={fieldName:i().string.isRequired,type:i().object.isRequired,localAppRegistry:i().object.isRequired,renderMode:i().oneOf(["svg","div"]),width:i().number,height:i().number,fn:i().func.isRequired,query:i().any};constructor(e){super(e),this.state={chart:null}}componentWillMount(){this.setState({chart:this.props.fn(this.props.localAppRegistry)})}componentDidMount(){this._redraw()}componentDidUpdate(){this._redraw()}componentWillUnmount(){this._cleanup()}_getContainer(){let e={className:"minichart",ref:"container"};const t={width:this.props.width,height:this.props.height};return"svg"===this.props.renderMode?(e=Object.assign(e,t),s.createElement("svg",e,s.createElement("defs",null,s.createElement("pattern",{id:"diagonal-stripes",width:"4",height:"4",patternUnits:"userSpaceOnUse",patternTransform:"rotate(45)"},s.createElement("rect",{width:"2.5",height:"4",transform:"translate(0,0)",fill:"white"})),s.createElement("mask",{id:"mask-stripe"},s.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:"url(#diagonal-stripes)"}))))):(e=Object.assign(e,{style:t}),s.createElement("div",e))}_cleanup(){this.state.chart&&this.state.chart.cleanup()}_redraw(){const e=me.findDOMNode(this.refs.container);this.state.chart.width(this.props.width).height(this.props.height),this.state.chart.options({fieldName:this.props.fieldName,unique:this.props.type.unique,query:this.props.query,promoter:fe[this.props.type.bsonType]||ve}),ye.hasOwnProperty(this.props.type.bsonType)?ge().select(e).datum(ye[this.props.type.bsonType](this.props.type.values)).call(this.state.chart):ge().select(e).datum(this.props.type.values).call(this.state.chart)}render(){const e=this._getContainer();return s.createElement("div",{className:"minichart-wrapper",ref:"wrapper"},e)}}const Se=Ee;var xe=n(98572),we=n.n(xe),Ce=n(79343),ke=n.n(Ce),Ne=n(74997),_e=n.n(Ne),Te=n(10244),Ae=n.n(Te),Re=n(72803),Oe=n.n(Re),De=n(50748),Pe=n.n(De);const Ie={margin:{top:10,right:0,bottom:10,left:40},friendlyPercentFormat:function(e){const t=ge().format(".1r"),n=ge().format(".0f"),s=(e>1?n:t)(e),a=function(e){return(+e).toFixed(20).replace(/^-?\d*\.?|0+$/g,"").length}(s);return function(t,n){return t===e?s+"%":t>1&&!n?ge().round(t,a)+"%":ge().round(t/e*s,a+1)+"%"}},truncateTooltip:function(e,t){return t=t||500,e.length>t&&(e=e.substring(0,t-1)+"&hellip;"),e},tooltip:function(e,t){return`\n      <div class="tooltip-wrapper">\n        <div class="tooltip-label">${e}</div>\n      <div class=".tooltip-value">${t}</div>\n      </div>`}},Le=Ie;n(38358)(ge());const je=e=>{const t=e.getAction("Query.Actions");let n,s=400,a=100,i=null;const r={bgbars:!1,scale:!1,labels:!1,selectable:!0,selectionType:"distinct"},o=ge().scale.ordinal(),l=ge().scale.linear(),d=ge().scale.ordinal(),p=ge().tip().attr("class","d3-tip d3-tip-many").direction("n").offset([-9,0]),u=ge().svg.brush().on("brush",m).on("brushend",h);function m(){!function(){if(ge().event.shiftKey)return;const e=n.selectAll("rect.selectable"),s=n.selectAll("rect.selectable.selected")[0].length,a=u.extent();e.classed("unselected",!0);const i=e.filter((function(e){const t=o(e.label),n=t+o.rangeBand();return a[0]<=n&&t<=a[1]}));if(i.classed("selected",!0),i.classed("unselected",!1),s!==i[0].length){if(0===i[0].length)return void t.clearValue({field:r.fieldName});if("distinct"===r.selectionType){const e=ke()(i.data(),"value");return void t.setDistinctValues({field:r.fieldName,value:e.map((e=>r.promoter(e)))})}const e=Oe()(i.data(),(function(e){return e.value})),n=Pe()(i.data(),(function(e){return e.value}));if(e.value===n.value+n.dx)return void t.setValue({field:r.fieldName,value:r.promoter(e.bson)});t.setRangeValues({field:r.fieldName,min:r.promoter(e.value),max:r.promoter(n.value+n.dx),maxInclusive:0===n.dx})}}()}function h(){ge().select(this).call(u.clear())}function g(e){if(!r.selectable)return;"distinct"===r.selectionType?(ge().event.shiftKey?t.toggleDistinctValue:t.setValue)({field:r.fieldName,value:r.promoter(e.value),unsetIfSet:!0}):ge().event.shiftKey&&i?t.setRangeValues({field:r.fieldName,min:r.promoter(Math.min(e.value,i.value)),max:r.promoter(Math.max(e.value+e.dx,i.value+i.dx)),maxInclusive:0===e.dx}):(i=e,e.dx>0?t.setRangeValues({field:r.fieldName,min:r.promoter(e.value),max:r.promoter(e.value+e.dx),unsetIfSet:!0}):t.setValue({field:r.fieldName,value:r.promoter(e.bson),unsetIfSet:!0}));const n=_e()(this).closest(".minichart"),s=n.find("g.brush > rect.background")[0],a=n.find("g.brush")[0],o=ge().mouse(s)[0],l=ge().select(window).on("mousemove",(function(){const e=[o,ge().mouse(s)[0]];ge().select(a).call(u.extent(c()(e))),m.call(a)})).on("mouseup",(function(){l.on("mousemove",null).on("mouseup",null),h.call(a)}));ge().event.preventDefault()}function b(e){if(void 0===r.query)return e.classed("unselected",!1),e.classed("selected",!1),void e.classed("half",!1);"distinct"===r.selectionType?(e.each((function(e){e.hasDistinct=(0,S.hasDistinctValue)(r.query,e.value)})),e.classed("selected",(function(e){return e.hasDistinct})),e.classed("unselected",(function(e){return!e.hasDistinct}))):"range"===r.selectionType&&(e.each((function(e){e.inRange=(0,S.inValueRange)(r.query,e)})),e.classed("selected",(function(e){return"yes"===e.inRange})),e.classed("half-selected",(function(e){return"partial"===e.inRange})),e.classed("unselected",(function(e){return"no"===e.inRange})))}function y(e){e.each((function(e){const t=Ae()(e,"count"),c=ge().max(t),m=ge().sum(t),h=Le.friendlyPercentFormat(c/m*100);let y=r.labels;if(n=ge().select(this),o.domain(Ae()(e,"label")).rangeRoundBands([0,s],.3,0),u.x(o),u.extent(u.extent()),l.domain([0,c]).range([a,0]),r.labels&&(y={"text-anchor":function(t,n){return 0===n?"start":n===e.length-1?"end":"middle"},x:"middle"===y["text-anchor"]?o.rangeBand()/2:function(t,n){return 0===n?0:n===e.length-1?o.rangeBand():o.rangeBand()/2},y:a+5,dy:"0.75em",text:function(e){return e.count},...y}),p.html((function(e,t){return"function"==typeof e.tooltip?e.tooltip(e,t):e.tooltip||Le.tooltip(Le.truncateTooltip(e.label),h(e.count/m*100))})),n.call(p),r.scale){const e=function(e){return[e,e/2,0]},t=ke()(e(c/m*100),(function(e){return h(e,!0)}));d.domain(t).rangePoints([0,a]);const i=n.selectAll("g.legend").data(t),r=i.enter().append("g").attr("class","legend");r.append("text").attr("x",0).attr("dx","-1em").attr("dy","0.3em").attr("text-anchor","end"),r.append("line").attr("class","bg").attr("x1",-5).attr("y1",0).attr("y2",0),i.attr("transform",(function(e){return"translate(0, "+d(e)+")"})),i.select("text").text((function(e){return e})),i.select("line").attr("x2",s),i.exit().remove()}r.selectable&&n.selectAll(".brush").data([0]).enter().append("g").attr("class","brush").call(u).selectAll("rect").attr("y",0).attr("height",a);const f=n.selectAll(".bar").data(e,(function(e){return e.label})),v=f.enter().append("g").attr("class","bar");f.attr("transform",(function(e){return"translate("+o(e.label)+", 0)"})),r.bgbars&&v.append("rect").attr("class","bg"),v.append("rect").attr("class",r.selectable?"fg selectable":"fg").attr("x",0),r.bgbars?v.append("rect").attr("class","glass").attr("width",o.rangeBand()).attr("height",a).on("mouseover",p.show).on("mouseout",p.hide):(v.selectAll(".fg").on("mouseover",p.show).on("mouseout",p.hide),r.selectable&&v.selectAll(".selectable").on("mousedown",g)),r.labels&&v.append("text").attr("x",y.x).attr("dx",y.dx).attr("y",y.y).attr("dy",y.dy).attr("text-anchor",y["text-anchor"]),f.selectAll(".bg").attr("width",o.rangeBand()).attr("height",a),f.selectAll(".fg").attr("y",(function(e){return l(e.count)})).attr("width",o.rangeBand()).attr("height",(function(e){return a-l(e.count)})),r.labels?f.select("text").text(y.text):f.select("text").remove(),f.exit().remove(),void 0===r.query&&(i=null),n.selectAll("rect.selectable").call(b)}))}return y.width=function(e){return arguments.length?(s=e,y):s},y.height=function(e){return arguments.length?(a=e,y):a},y.options=function(e){return arguments.length?(Object.assign(r,e),y):r},y.cleanup=function(){return p.destroy(),y},y};function Me(e){if(e&&e._bsontype){if(["Decimal128","Long"].includes(e._bsontype))return parseFloat(e.toString(),10);if(["Double","Int32"].includes(e._bsontype))return e.value}return e}var qe=n(85707),Fe=n.n(qe),Ve=n(61935),Be=n.n(Ve),Ue=n(41771),He=n.n(Ue);n(38358)(ge());const $e=e=>{let t,n=400,s=100;const a=e.getAction("Query.Actions"),i={},r=ge().scale.linear(),o=ge().tip().attr("class","d3-tip d3-tip-few").direction("n").offset([-9,0]),l=ge().svg.brush().x(r).on("brush",d).on("brushend",p);function d(){!function(){if(ge().event.shiftKey)return;const e=t.selectAll("rect.selectable"),n=t.selectAll("rect.selectable.selected")[0].length,s=l.extent();e.classed("unselected",!0);const r=e.filter((function(e){const t=e.xpos,n=t+e.count;return s[0]<=n&&t<=s[1]}));if(r.classed("selected",!0),r.classed("unselected",!1),n!==r[0].length){const e=ke()(r.data(),"value");a.setDistinctValues({field:i.fieldName,value:e.map((e=>i.promoter(e)))})}}()}function p(){ge().select(this).call(l.clear())}function u(e){const t=_e()(this).closest(".minichart"),n=t.find("g.brush > rect.background")[0],s=t.find("g.brush")[0],o=r.invert(ge().mouse(n)[0]);(ge().event.shiftKey?a.toggleDistinctValue:a.setValue)({field:i.fieldName,value:i.promoter(e.value),unsetIfSet:!0});const u=ge().select(window).on("mousemove",(function(){const e=[o,r.invert(ge().mouse(n)[0])];ge().select(s).call(l.extent(c()(e))),d.call(s)})).on("mouseup",(function(){u.on("mousemove",null).on("mouseup",null),p.call(s)}));ge().event.preventDefault()}function m(e){if(void 0===i.query)return e.classed("unselected",!1),e.classed("selected",!1),void e.classed("half",!1);e.classed("selected",(function(e){return(0,S.hasDistinctValue)(i.query,e.value)})),e.classed("unselected",(function(e){return!(0,S.hasDistinctValue)(i.query,e.value)}))}function h(e){e.each((function(e){e.forEach(((t,n)=>{const s=He()(e,0,n),a=ke()(s,"count");e[n].xpos=Be()(a)}));const a=ke()(e,"count"),i=ge().sum(a),c=ge().max(a),d=Le.friendlyPercentFormat(c/i*100);t=ge().select(this),r.domain([0,i]).range([0,n]),o.html((function(e,t){return"function"==typeof e.tooltip?e.tooltip(e,t):e.tooltip||Le.tooltip(Le.truncateTooltip(e.label),d(e.count/i*100))})),t.call(o),t.selectAll(".brush").data([0]).enter().append("g").attr("class","brush").call(l).selectAll("rect").attr("y",(s-80)/2).attr("height",80);const p=t.selectAll("g.bar").data(e,(function(e){return e.label}));p.attr("transform",(function(e){return"translate("+r(e.xpos)+", "+(s-25)/2+")"}));const h=p.enter().append("g").attr("class","bar few").attr("transform",(function(e){return"translate("+r(e.xpos)+", "+(s-25)/2+")"})).on("mousedown",u);h.append("rect").attr("class",(function(e,t){return"selectable fg fg-"+t})).attr("y",0).attr("x",0).attr("height",25),h.append("text").attr("y",12.5).attr("dy","0.3em").attr("dx",10).attr("text-anchor","start").attr("fill","white"),h.append("rect").attr("class","glass").attr("y",0).attr("x",0).attr("height",25).on("mouseover",o.show).on("mouseout",o.hide),p.select("rect.selectable").attr("width",(function(e){return r(e.count)})),p.select("rect.glass").attr("width",(function(e){return r(e.count)})),p.select("text").text((function(e){return e.label})),p.exit().remove(),t.selectAll("rect.selectable").call(m)}))}return h.width=function(e){return arguments.length?(n=e,h):n},h.height=function(e){return arguments.length?(s=e,h):s},h.options=function(e){return arguments.length?(Object.assign(i,e),h):i},h.cleanup=function(){return o.destroy(),h},h};var ze=n(33958),Ge=n.n(ze),Qe=n(92377),We=n.n(Qe),Ke=n(19034),Ze=n.n(Ke);function Xe(e){const t={};return We()(e).forEach((function(e){t[e]=[]})),t}n(38358)(ge());const Ye=e=>{let t,n=400,s=100,a=null;const i={},r=[],o=Ze().weekdays(),l=ge().time.format.utc("%Y-%m-%d %H:%M:%S"),d=Le.margin,p=ge().time.scale(),u=ge().tip().attr("class","d3-tip d3-tip-date").html((function(e){return e.label})).direction("n").offset([-9,0]),m=ge().svg.brush().x(p).on("brush",h).on("brushend",g);function h(){!function(){const n=e.getAction("Query.Actions"),s=t.selectAll("line.selectable"),a=t.selectAll("line.selectable.selected").length,r=m.extent();s.classed("unselected",!0),s.classed("selected",!1);const o=s.filter((function(e){return r[0]<=e.ts&&e.ts<=r[1]}));if(o.classed("selected",!0),o.classed("unselected",!1),a!==o[0].length&&0===o[0].length)return void n.clearValue({field:i.fieldName});const l=Oe()(o.data(),(function(e){return e.ts})),c=Pe()(o.data(),(function(e){return e.ts}));Ge()(l.ts,c.ts)?n.setValue({field:i.fieldName,value:l.value},!0):n.setRangeValues({field:i.fieldName,min:l.value,max:c.value,maxInclusive:!0})}()}function g(){ge().select(this).call(m.clear())}function b(t){const n=e.getAction("Query.Actions");if(ge().event.shiftKey&&a){const e=t.ts<a.ts?t.value:a.value,s=t.ts>a.ts?t.value:a.value;n.setRangeValues({field:i.fieldName,min:e,max:s,maxInclusive:!0})}else a=t,n.setValue({field:i.fieldName,value:t.value,unsetIfSet:!0});const s=_e()(this).closest(".minichart"),r=s.find("g.brush > rect.background")[0],o=s.find("g.brush")[0],l=p.invert(ge().mouse(r)[0]),d=ge().select(window).on("mousemove",(function(){const e=[l,p.invert(ge().mouse(r)[0])];ge().select(o).call(m.extent(c()(e))),h.call(o)})).on("mouseup",(function(){d.on("mousemove",null).on("mouseup",null),g.call(o)}));ge().event.preventDefault()}function y(e){if(void 0===i.query)return e.classed("unselected",!1),e.classed("selected",!1),void e.classed("half",!1);e.each((function(e){e.inRange=(0,S.inValueRange)(i.query,e)})),e.classed("selected",(function(e){return"yes"===e.inRange})),e.classed("unselected",(function(e){return"no"===e.inRange}))}function f(c){c.each((function(c){const h=c.map((function(e){const t=function(e){return"ObjectID"===e._bsontype?e.getTimestamp():e}(e);return{label:l(t),ts:t,value:e,count:1}})),g=n-d.left-d.right-1,f=s-d.top-d.bottom;t=ge().select(this);const v=Math.floor(f/2+15),E=Math.floor(f-10),S=f/2-20;p.domain(ge().extent(h,(function(e){return e.ts}))).range([0,g]);const x=we()(h,(function(e){return Ze()(e.ts).weekday()})),w={...Xe(7),...x},C=ke()(w,(function(e,t){return{label:o[t],count:e.length}})),k=ge().range(24),N=we()(h,(function(e){return e.ts.getHours()})),_={...Xe(24),...N},T=ke()(_,(function(e,t){return{label:k[t]+":00",count:e.length}}));t.call(u);const A=t.selectAll("g").data([c]),R=A.enter().append("g").attr("transform","translate("+d.left+","+d.top+")");R.append("g").attr("class","weekday").append("text").attr("class","date-icon fa-fw").attr("x",0).attr("dx","-0.6em").attr("y",0).attr("dy","1em").attr("text-anchor","end").attr("font-family","FontAwesome").text("ï³"),R.append("g").attr("class","hour").append("text").attr("class","date-icon fa-fw").attr("x",0).attr("dx","-0.6em").attr("y",0).attr("dy","1em").attr("text-anchor","end").attr("font-family","FontAwesome").text("ï"),t.select(".hour").attr("transform","translate("+(g/3.5+20)+", 0)"),A.selectAll(".brush").data([0]).enter().append("g").attr("class","brush").call(m).selectAll("rect").attr("y",v).attr("height",E-v),R.append("g").attr("class","line-container");const O=A.select(".line-container").selectAll(".selectable").data(h,(function(e){return e.ts}));O.enter().append("line").attr("class","line selectable").style("opacity",(function(){return O.size()>200?.3:1})).on("mouseover",u.show).on("mouseout",u.hide).on("mousedown",b),O.attr("y1",v).attr("y2",E).attr("x2",(function(e){return p(e.ts)})).attr("x1",(function(e){return p(e.ts)})),O.exit().remove(),void 0===i.query&&(a=null),t.selectAll("line.selectable").call(y);const D=A.selectAll(".text").data(p.domain());D.enter().append("text").attr("class","text").attr("dy","0.75em").attr("y",E+5),D.attr("x",(function(e,t){return t*g})).attr("text-anchor",(function(e,t){return t?"end":"start"})).text((function(e,t){return l(p.domain()[0])!==l(p.domain()[1])?(t?"last: ":"first: ")+l(e):0===t?"inserted: "+l(e):void 0})),D.exit().remove();let P=g/3.5-20;const I=A.select("g.weekday").data([C]),L=je(e).width(P).height(S).options({selectable:!1,bgbars:!0,labels:{"text-anchor":"middle",text:function(e){return e.label[0]}}});I.call(L),r.push(L),P=g/3.5*2.5-20;const j=A.select("g.hour").data([T]),M=je(e).width(P).height(S).options({selectable:!1,bgbars:!0,labels:{text:function(e,t){return t%6==0||23===t?e.label:""}}});j.call(M),r.push(M)}))}return f.width=function(e){return arguments.length?(n=e,f):n},f.height=function(e){return arguments.length?(s=e,f):s},f.options=function(e){return arguments.length?(Object.assign(i,e),f):i},f.cleanup=function(){for(const e of r)e.cleanup();return u.destroy(),f},f};var Je=n(74744),et=n.n(Je),tt=n(68893),nt=n.n(tt),st=n(89583),at=n.n(st),it=n(23537),rt=n.n(it),ot=n(30517),lt=n.n(ot);const ct="#F68A1E",dt="#43B1E5",pt="#ed271c";lt().config.ACCESS_TOKEN="12345",lt().config.API_URL="https://compass-maps.mongodb.com/compass/maptile";const ut={number:e=>{let t=400,n=100;const s={view:null},a=Le.margin,i=ge().scale.linear(),r=je(e);function o(e){e.each((function(e){let o;const l=ge().select(this),d=t-a.left-a.right,p=n-a.top-a.bottom;if(s.unique<20){const t=we()(e,(function(e){return Me(e)})),n=ke()(t,(function(e,t){return e.label=t,e.x=parseFloat(t,10),e.value=e.x,e.dx=0,e.count=e.length,e.bson=e[0],e}));o=c()(n,(function(e){return e.value}))}else{i.domain(ge().extent(e)).range([0,d]);const t=i.ticks(20),n=ge().layout.histogram().bins(t).value(Me);o=n(e),o.forEach((function(t,n){let s;s=0===n?"< "+(t.x+t.dx):n===e.length-1?"&ge; "+t.x:t.x+"-"+(t.x+t.dx),t.count=t.y,t.value=t.x,t.label=s}))}const u=l.selectAll("g").data([o]);let m;u.enter().append("g").attr("transform","translate("+a.left+","+a.top+")"),m=s.unique<20||{text:function(t,n){return 0===n?"min: "+ge().min(e):n===o.length-1?"max: "+ge().max(e):""}},s.labels=m,s.scale=!0,s.selectionType="range",r.width(d).height(p-10).options(s),u.call(r)}))}return o.width=function(e){return arguments.length?(t=e,o):t},o.height=function(e){return arguments.length?(n=e,o):n},o.options=function(e){return arguments.length?(Object.assign(s,e),o):s},o.cleanup=function(){return r.cleanup(),o},o},boolean:e=>{let t=400,n=100;const s={view:null},a=$e(e),i=Le.margin;function r(e){e.each((function(e){const r=ge().select(this),o=t-i.left-i.right,l=n-i.top-i.bottom,c={false:[],true:[],...we()(e,(function(e){return e}))},d=ke()(c,(function(e,t){return{label:t,value:"true"===t,count:e.length}})),p=Fe()(d,"label",[!1]);a.width(o).height(l).options(s);const u=r.selectAll("g").data([p]);u.enter().append("g").attr("transform","translate("+i.left+","+i.top+")"),u.call(a)}))}return r.width=function(e){return arguments.length?(t=e,r):t},r.height=function(e){return arguments.length?(n=e,r):n},r.options=function(e){return arguments.length?(Object.assign(s,e),r):s},r.cleanup=function(){return a.cleanup(),r},r},date:Ye,string:e=>{let t=400,n=100;const s={query:{}},a=je(e),i=$e(e),r=Le.margin;function o(e){e.each((function(e){const o=ge().select(this),l=t-r.left-r.right,c=n-r.top-r.bottom,d=we()(e,(function(e){return e})),p=ke()(d,(function(e,t){return{label:t,value:t,count:e.length}})),u=Fe()(p,"count",[!1]),m=o.selectAll("g").data([u]);m.enter().append("g").attr("transform","translate("+r.left+","+r.top+")").attr("width",l).attr("height",c);const h=u.length<=5?i:a;s.scale=!0,s.selectionType="distinct",h.width(l).height(c).options(s),m.call(h)}))}return o.width=function(e){return arguments.length?(t=e,o):t},o.height=function(e){return arguments.length?(n=e,o):n},o.options=function(e){return arguments.length?(Object.assign(s,e),o):s},o.cleanup=function(){return i.cleanup(),a.cleanup(),o},o},objectid:Ye,coordinates:e=>{let t,n=400,s=100,a=null,i=!1;const r={view:null};let o,l,c,d,p,u,m=!1;const h=Le.margin;function g(t){let n=!1;const s=ge().dispatch("update","clear");let d,p,u=null;function h(){const t=e.getAction("Query.Actions");o&&l?(c=nt()(at()([o.lng,o.lat]),at()([l.lng,l.lat]),"miles"),t.setGeoWithinValue({field:r.fieldName,center:[o.lng,o.lat],radius:c/3963.2})):t.clearValue({field:r.fieldName})}function g(e,t){const n=d(e),s=d(t);return Math.sqrt((s.x-n.x)*(s.x-n.x)+(s.y-n.y)*(s.y-n.y))}const b=ge().behavior.drag().on("drag",(function(e,s){if(m){n=!0;const e=ge().mouse(t.node()),a=p([e[0],e[1]]);if(s)l=a;else{const e=o.lat-a.lat,t=o.lng-a.lng;o=a,l.lat-=e,l.lng-=t}u(),h()}})).on("dragend",(function(){setTimeout((function(){n=!1,h()}),100)}));function y(e){o=null,l=null,m=!1,t.selectAll("circle.lasso").remove(),t.selectAll("circle.control").remove(),t.selectAll("line.lasso").remove(),s.clear(),e||h()}return this.clear=y,u=function(e){if(e&&(t=e),!o||!l)return;const n=g(o,l),i=t.selectAll("circle.lasso").data([n]);i.enter().append("circle").classed("lasso",!0).style({stroke:ct,"stroke-width":2,fill:ct,"fill-opacity":.1}),i.attr({cx:d(o).x,cy:d(o).y,r:n});const r=t.selectAll("line.lasso").data([l]);r.enter().append("line").classed("lasso",!0).style({stroke:pt,"stroke-dasharray":"2 2"}),r.attr({x1:d(o).x,y1:d(o).y,x2:d(l).x,y2:d(l).y});const c=t.selectAll("circle.control").data([o,l]);c.enter().append("circle").classed("control",!0).style({cursor:"move"}),c.attr({cx:function(e){return d(e).x},cy:function(e){return d(e).y},r:5,stroke:pt,fill:pt,"fill-opacity":.7}).call(b).on("mousedown",(function(){a.dragPan.disable()})).on("mouseup",(function(){a.dragPan.enable()})),s.update()},this.update=u,this.setCircle=function(e,t){const n=at()([e[0],e[1]]),s=rt()(n,t,45,"miles");o=lt().LngLat.convert(n.geometry.coordinates),l=lt().LngLat.convert(s.geometry.coordinates),m=!0,u()},t.on("mousedown.circle",(function(){if(!ge().event.shiftKey)return;if(n&&m)return;if(!n&&m)return void y();a.dragPan.disable(),i=!0;const e=ge().mouse(this),t=p([e[0],e[1]]);o||(o=t,l=t),u()})),t.on("mousemove.circle",(function(){if(m||!o)return;const e=ge().mouse(this),t=p([e[0],e[1]]);l=t,u(),h()})),t.on("mouseup.circle",(function(){if(i=!1,n&&m)return;a.dragPan.enable();const e=ge().mouse(this),t=p([e[0],e[1]]);o&&(m||(l=t,m=!0,h()))})),this.projection=function(e){return e?(d=e,this):d},this.inverseProjection=function(e){return e?(p=e,this):p},this.distance=function(e){return e||(e=l),g(o,e)},ge().rebind(this,s,"on"),this}function b(e){e.each((function(e){function l(e){return e instanceof lt().LngLat?e:new(lt().LngLat)(+e[0],+e[1])}function m(e){return a.project(l(e))}const b=ge().select(this),y=n-h.left-h.right,f=s-h.top-h.bottom,v=b.selectAll("div.map").data([null]);v.enter().append("div").attr("class","map"),v.style({width:y+"px",height:f+"px",padding:h.top+"px "+h.right+"px "+h.bottom+"px "+h.left+"px;"});const E=b.selectAll("div.map-overlay").data([null]).enter().append("div").classed("map-overlay",!0);E.append("div").html("shift").classed("map-overlay-button",!0),E.append("p").html("+ Drag to Build a Query").classed("map-overlay-text",!0);const S=new(lt().LngLatBounds);if(e.forEach((function(e){S.extend(l(e))})),!a){a=new(lt().Map)({container:v[0][0],style:"mapbox://openmaptiles.4qljc88t",center:S.getCenter()}),a.dragPan.enable(),a.scrollZoom.enable(),a.boxZoom.disable();const e=new(lt().NavigationControl);a.addControl(e,"top-left");const n=a.getCanvasContainer();d=ge().select(n).append("svg"),t=new g(d).projection(m).inverseProjection((function(e){return a.unproject({x:e[0],y:e[1]})})),t.on("update",(function(){d.selectAll("circle.dot").style({fill:function(e){return t.distance(e)<t.distance()?ct:dt}})})),t.on("clear",(function(){d.selectAll("circle.dot").style("fill",dt)})),p=function(){u.attr({cx:function(e){return m(e).x},cy:function(e){return m(e).y}}),t.update(d)},a.on("viewreset",(function(){p()})),a.on("move",(function(){p()})),et()((function(){a.resize(),a.fitBounds(S,{linear:!0,padding:20})}))}u=d.selectAll("circle.dot").data(e),u.enter().append("circle").classed("dot",!0).attr("r",4).style({fill:dt,stroke:"white","stroke-opacity":.6,"stroke-width":1}),function(){if(i)return;if(void 0===r.query)return void t.clear(!0);const e=L()(r.query,"$geoWithin.$centerSphere[0]"),n=3963.2*L()(r.query,"$geoWithin.$centerSphere[1]",0);e&&n?n===c&&Ge()(e,[o.lng,o.lat])||t.setCircle(e,n):t.clear(!0)}(),p()}))}return b.width=function(e){return arguments.length?(n=e,b):n},b.height=function(e){return arguments.length?(s=e,b):s},b.options=function(e){return arguments.length?(Object.assign(r,e),b):r},b.geoSelection=function(e){e?t.setCircle(e[0],e[1]):t.clear()},b.cleanup=function(){return b},b}};class mt extends s.Component{static displayName="MiniChartComponent";static propTypes={localAppRegistry:i().object.isRequired,fieldName:i().string.isRequired,actions:i().object.isRequired,type:i().object.isRequired,nestedDocType:i().object};constructor(e){super(e),this.state={containerWidth:null,filter:{},valid:!0,userTyping:!1},this.resizeListener=this.handleResize.bind(this)}componentDidMount(){this.resizeListener(),window.addEventListener("resize",this.resizeListener);const e=this.props.localAppRegistry.getStore("Query.Store"),t=e=>{this.setState({filter:e.filter,valid:e.valid,userTyping:e.userTyping})};t(e.state),this.unsubscribeQueryStore=e.listen(t),this.unsubscribeMiniChartResize=this.props.actions.resizeMiniCharts.listen(this.resizeListener)}shouldComponentUpdate(e,t){return t.valid&&!t.userTyping}componentWillUnmount(){window.removeEventListener("resize",this.resizeListener),this.unsubscribeQueryStore(),this.unsubscribeMiniChartResize()}handleResize(){this.setState((({containerWidth:e})=>{const{width:t}=this._mc.getBoundingClientRect();return t>0&&e!==t?{containerWidth:t}:null}))}minichartFactory(){const e=[g.DECIMAL_128,g.DOUBLE,g.INT_32,g.LONG].includes(this.props.type.name)?g.NUMBER:this.props.type.name,t=this.props.fieldName,n=this.state.filter[t],a=this.props.type.has_duplicates,i=ut[e.toLowerCase()],r=this.state.containerWidth;if([g.STRING,g.NUMBER].includes(e)&&!a)return s.createElement(O,{localAppRegistry:this.props.localAppRegistry,key:e,fieldName:t,queryValue:n,type:this.props.type,width:r});if("Coordinates"===e){const e=r/1.618;return s.createElement(ue,{actions:this.props.actions,fieldName:t,type:this.props.type,width:r,height:e,localAppRegistry:this.props.localAppRegistry})}return"Document"===e?s.createElement(M,{nestedDocType:this.props.nestedDocType}):"Array"===e?s.createElement(H,{type:this.props.type,nestedDocType:this.props.nestedDocType}):"Undefined"===e?s.createElement("div",null,"Undefined"):i?s.createElement(Se,{fieldName:this.props.fieldName,type:this.props.type,renderMode:"svg",query:n,width:r,height:100,fn:i,localAppRegistry:this.props.localAppRegistry}):null}render(){const e=this.state.containerWidth?this.minichartFactory():null;return s.createElement("div",{ref:e=>{this._mc=e}},e)}}const ht=mt;var gt=n(72184),bt=n.n(gt);function yt(){return yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},yt.apply(this,arguments)}class ft extends s.Component{static displayName="FieldComponent";static propTypes={actions:i().object.isRequired,localAppRegistry:i().object.isRequired,name:i().string,path:i().string,types:i().array,fields:i().array};constructor(e){super(e),this.state={collapsed:!0,activeType:null}}componentWillMount(){const e=c()(this.props.types,(e=>"Undefined"===e.name?-1/0:e.probability)).reverse();this.setState({types:e,activeType:e.length>0?e[0]:null})}getChildren(){const e=L()(this.getNestedDocType(),"fields",[]);let t;return t=this.state.collapsed?[]:e.map((e=>s.createElement(ft,yt({key:e.name,actions:this.props.actions,localAppRegistry:this.props.localAppRegistry},e)))),s.createElement("div",{className:"schema-field-list"},t)}getNestedDocType(){const e=p()(this.props.types,{name:"Document"});if(e)return e;const t=p()(this.props.types,{name:"Array"});return t?p()(t.types,{name:"Document"}):null}getSemanticType(e){if(global.hadronApp.isFeatureEnabled("enableMaps")){const t=bt()(e);t&&(e.name="Coordinates",e.values=t)}return e}titleClicked(){this.setState({collapsed:!this.state.collapsed})}renderType(e){this.setState({activeType:e})}render(){const e="schema-field "+(this.state.collapsed?"collapsed":"expanded"),t=this.state.types.map((e=>(e=this.getSemanticType(e),s.createElement(f,yt({key:"type-"+e.name,activeType:this.state.activeType,renderType:this.renderType.bind(this),self:e,showSubTypes:!0},e))))),n=this.state.activeType,a=this.getNestedDocType();return s.createElement("div",{className:e},s.createElement("div",{className:"row"},s.createElement("div",{className:"col-sm-4"},s.createElement("div",{className:"schema-field-name",onClick:this.titleClicked.bind(this)},s.createElement("span",{className:a?"caret":""}),s.createElement("span",null,this.props.name)),s.createElement("div",{className:"schema-field-type-list"},t)),s.createElement("div",{className:"col-sm-7 col-sm-offset-1"},s.createElement(ht,{fieldName:this.props.path,type:n,nestedDocType:a,actions:this.props.actions,localAppRegistry:this.props.localAppRegistry}))),this.getChildren())}}const vt=ft;class Et extends s.Component{static displayName="AnalysisCompleteMessageComponent";static propTypes={sampleSize:i().number.isRequired};_openLink(e){const{shell:t}=n(72298);t.openExternal(e)}render(){const e=this.props.sampleSize,t=P()("document",e);return s.createElement("div",{className:"analysis-message"},"This report is based on a sample ofÂ ",s.createElement("b",null,e),"Â ",t,".",s.createElement(r.InfoSprinkle,{helpLink:"https://docs.mongodb.com/compass/current/sampling#sampling",onClickHandler:this._openLink.bind(this)}))}}const St=Et;var xt=n(72779),wt=n.n(xt);class Ct extends s.Component{static displayName="ZeroGraphic";render(){return s.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",className:wt()("zero-graphic-module-zero-graphic__3gXQ9"),viewBox:"0 0 60 40"},s.createElement("g",{fill:"none",fillRule:"evenodd",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",transform:"translate(1 1)"},s.createElement("polyline",{stroke:"#16CC62",points:"10.25 37.75 10.25 25.25 2.75 25.25 2.75 37.75"}),s.createElement("polyline",{stroke:"#16CC62",points:"40.5 37.5 40.5 10 33 10 33 37.5"}),s.createElement("polyline",{stroke:"#16CC62",points:"25.25 37.75 25.25 17.75 17.75 17.75 17.75 37.75"}),s.createElement("polyline",{stroke:"#16CC62",points:"55.5 37.5 55.5 0 48 0 48 37.5"}),s.createElement("path",{stroke:"#116149",d:"M0.25,37.75 L57.75,37.75"})))}}const kt=Ct,Nt="initial",_t="analyzing",Tt="error",At="complete",Rt="timeout";function Ot(){return Ot=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Ot.apply(this,arguments)}class Dt extends s.Component{static displayName="SchemaComponent";static propTypes={actions:i().object,store:i().object.isRequired,analysisState:i().oneOf([Nt,_t,Tt,At,Rt]),outdated:i().bool,isActiveTab:i().bool,errorMessage:i().string,maxTimeMS:i().number,schema:i().any,count:i().number,resultId:i().number};constructor(e){super(e);const t=e.store.localAppRegistry;this.queryBarRole=t.getRole("Query.QueryBar")[0],this.queryBar=this.queryBarRole.component,this.queryBarStore=t.getStore(this.queryBarRole.storeName),this.queryBarActions=t.getAction(this.queryBarRole.actionName)}componentDidUpdate(e){e.isActiveTab!==this.props.isActiveTab&&this.props.isActiveTab&&this.props.actions.resizeMiniCharts()}onApplyClicked(){this.props.actions.startAnalysis()}onCancelClicked(){this.props.actions.stopAnalysis()}onResetClicked(){this.props.actions.startAnalysis()}renderBanner(){const e=this.props.analysisState;return e===Tt?s.createElement(r.StatusRow,{style:"error"},"An error occurred during schema analysis",": ",this.props.errorMessage):e===Rt?s.createElement(r.StatusRow,{style:"warning"},"Operation exceeded time limit. Please try increasing the maxTimeMS for the query in the filter options."):e===At?this.props.outdated?s.createElement(r.StatusRow,{style:"warning"},'The schema content is outdated and no longer in sync with the documents view. Press "Analyze" again to see the schema for the current query.'):s.createElement(St,{sampleSize:this.props.schema?this.props.schema.count:0}):null}renderFieldList(){if(this.props.analysisState===At)return L()(this.props.schema,"fields",[]).map((e=>s.createElement(vt,Ot({key:e.name,actions:this.props.actions,localAppRegistry:this.props.store.localAppRegistry},e))))}renderInitialScreen(){return s.createElement("div",{className:"compass-schema-module-schema-zero-state__1EZI1"},s.createElement(kt,null),s.createElement(r.ZeroState,{header:"Explore your schema",subtext:"Quickly visualize your schema to understand the frequency, types and ranges ofÂ fields in your data set."},s.createElement("div",null,s.createElement(o.Button,{onClick:this.onApplyClicked.bind(this),"data-test-id":"analyze-schema-button",variant:o.ButtonVariant.Primary,size:o.ButtonSize.Large},"Analyze Schema")),s.createElement(o.Link,{className:"compass-schema-module-schema-zero-state-link__3yONL",href:"https://docs.mongodb.com/compass/master/schema/",target:"_blank"},"Learn more about schema analysis in Compass")))}renderAnalyzing(){return s.createElement(o.CancelLoader,{dataTestId:"analyzing-documents",progressText:"Analyzing Documents",cancelText:"Stop",onCancel:this.onCancelClicked.bind(this)})}renderContent(){return this.props.analysisState===Nt?this.renderInitialScreen():this.props.analysisState===_t?this.renderAnalyzing():s.createElement("div",{className:"schema-field-list"},this.renderFieldList())}render(){return s.createElement("div",{className:"compass-schema-module-root__2Z2Ut"},s.createElement("div",{className:"controls-container"},s.createElement(this.queryBar,{store:this.queryBarStore,actions:this.queryBarActions,buttonLabel:"Analyze",resultId:this.props.resultId,onApply:this.onApplyClicked.bind(this),onReset:this.onResetClicked.bind(this)}),this.renderBanner()),s.createElement("div",{className:"compass-schema-module-schema__17Xus"},this.renderContent()))}}const Pt=Dt;class It extends s.Component{static displayName="CompassSchemaPlugin";static propTypes={store:i().object.isRequired,actions:i().object.isRequired};render(){return s.createElement(r.StoreConnector,{store:this.props.store},s.createElement(Pt,this.props))}}const Lt=It;var jt=n(10862),Mt=n.n(jt),qt=n(45727),Ft=n.n(qt),Vt=n(99837),Bt=n.n(Vt),Ut=n(84935),Ht=n.n(Ut),$t=n(6909),zt=n(76635);const Gt=e=>"circle"===e.type?(e=>{return{[e.field]:{$geoWithin:{$centerSphere:[[e.lng,e.lat],(t=e.radius,t/1609.344/3963.2)]}}};var t})(e):"polygon"===e.type?(e=>({[e.field]:{$geoWithin:{$geometry:{type:"Polygon",coordinates:e.coordinates}}}}))(e):void 0,Qt=e=>{const t=Object.values(e);return 1===t.length?Gt(t[0]):(e=>({$or:e.map((e=>Gt(e)))}))(t)};var Wt=n(73837),Kt=n.n(Wt),Zt=n(35164),Xt=n.n(Zt);const{log:Yt,mongoLogId:Jt,debug:en}=(0,$t.default)("COMPASS-SCHEMA"),tn=Kt().promisify(Xt());class nn{constructor(e,t,n,s){this._ns=t,this._dataService=e,this._cursor=e.sample(t,n,{...s,promoteValues:!1}),this._cancelled=new Promise((e=>{this._cancelGetResult=()=>e(null)}))}getResult(){return this._result||(this._result=Promise.race([this._cancelled,this._sampleAndAnalyze()])),this._result}terminate(){this._cancelGetResult(),this._close()}async _sampleAndAnalyze(){try{Yt.info(Jt(1001000089),"Schema","Starting schema analysis",{ns:this._ns});const e=await this._cursor.toArray().catch((e=>Promise.reject(function(e){return e?("MongoError"===e.name&&void 0!==e.code&&(e.code=JSON.parse(JSON.stringify(e.code))),e):new Error("Unknown error")}(e)))),t=await tn(e);return Yt.info(Jt(1001000090),"Schema","Schema analysis completed",{ns:this._ns}),t}catch(e){if(Yt.error(Jt(1001000091),"Schema","Schema analysis failed",{ns:this._ns,error:e.message}),function(e){return"MongoError"===e.name&&(11601===e.code||43===e.code)}(e))return en("caught background operation terminated error",e),null;throw en("schema analysis failed",e),e}finally{this._close()}}async _close(){if(!this._closed){this._closed=!0;try{await this._cursor.close(),en("background operation terminated")}catch(e){en("error while terminating background operation",e)}}}}const sn="Schema",an=n(21646)("mongodb-compass:stores:schema"),{track:rn}=(0,$t.createLoggerAndTelemetry)("COMPASS-SCHEMA-UI"),on=1e3,ln=["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function cn(e){const t=e&&e.message||"Unknown error";let n;return n=50===(e&&e.code)?Rt:Tt,{analysisState:n,errorMessage:t}}function dn(){return Math.floor(Math.random()*2**53)}const pn=(e={})=>{const t=Mt().createStore({mixins:[Bt().store],listenables:e.actions,init:function(){this.query={filter:{},project:null,limit:on,maxTimeMS:6e4},this.ns="",this.geoLayers={}},getShareText(){return null!==this.state.schema?`The schema definition of ${this.ns} has been copied to your clipboard in JSON format.`:"Please Analyze the Schema First from the Schema Tab."},handleSchemaShare(){const{remote:e}=n(72298);e.clipboard.writeText(JSON.stringify(this.state.schema,null,"  ")),Ft().call("app:show-info-dialog","Share Schema",this.getShareText())},getInitialState:()=>({localAppRegistry:null,globalAppRegistry:null,analysisState:Nt,errorMessage:"",schema:null,outdated:!1,isActiveTab:!1,resultId:dn()}),onQueryChanged(e){this.query.filter=e.filter,this.query.limit=e.limit,this.query.project=e.project,this.query.maxTimeMS=e.maxTimeMS,this.state.analysisState!==At||this.state.isActiveTab||this.setState({outdated:!0})},onSubTabChanged(e){this.setState({isActiveTab:e===sn})},onSchemaSampled(){this.geoLayers={},process.nextTick((()=>{this.globalAppRegistry.emit("compass:schema:schema-sampled",{...this.state,geo:this.geoLayers})}))},geoLayerAdded(e,t){this.geoLayers=((e,t,n)=>t._latlngs?((e,t,n)=>{const s={...n};var a;return s[t._leaflet_id]={field:e,coordinates:(a=t._latlngs,a.map((e=>{const t=e.map((e=>[e.lng,e.lat]));return t.push(t[0]),t}))),type:"polygon"},s})(e,t,n):t._latlng?((e,t,n)=>{const s={...n};return s[t._leaflet_id]={field:e,lat:t._latlng.lat,lng:t._latlng.lng,radius:t._mRadius,type:"circle"},s})(e,t,n):n)(e,t,this.geoLayers),this.localAppRegistry.emit("compass:schema:geo-query",Qt(this.geoLayers))},geoLayersEdited(e,t){t.eachLayer((t=>{this.geoLayerAdded(e,t)}))},geoLayersDeleted(e){e.eachLayer((e=>{delete this.geoLayers[e._leaflet_id]})),this.localAppRegistry.emit("compass:schema:geo-query",Qt(this.geoLayers))},async stopAnalysis(){if(this.schemaAnalysis)try{await this.schemaAnalysis.terminate()}catch(e){an("failed to terminate schema analysis. ignoring ...",e)}finally{this.schemaAnalysis=null}},_calculateDepthByPath(e,t){return e?(e.forEach((({types:e,fields:n,path:s,bsonType:a})=>{const i="Array"===a?1:0,r=s.split(".").length+i;(!t[s]||t[s]<r)&&(t[s]=r),this._calculateDepthByPath(e??n,t)})),t):t},calculateSchemaDepth(e){const t=this._calculateDepthByPath(e.fields,{}),n=Object.values(t);return Math.max(...n,0)},_containsGeoData(e){let t=!1;if(!e)return t;for(const{path:n,values:s,types:a,fields:i}of e)n.endsWith(".type")&&(0,zt.intersection)(ln,s).length>0&&(t=!0),t||(t=this._containsGeoData(a??i));return t},schemaContainsGeoData(e){return this._containsGeoData(e.fields)},_trackSchemaAnalyzed(e){const{schema:t}=this.state,n={with_filter:Object.entries(this.query.filter).length>0,schema_width:t.fields.length,schema_depth:this.calculateSchemaDepth(t),geo_data:this.schemaContainsGeoData(t),analysis_time_ms:e};rn("Schema Analyzed",n)},startAnalysis:async function(){if(this.schemaAnalysis)return;const e=this.query||{},t=e.limit?Math.min(on,e.limit):on,n={query:e.filter,size:t,fields:e.project},s={maxTimeMS:e.maxTimeMS},a=function(e,t,n,s){return new nn(e,t,n,s)}(this.dataService,this.ns,n,s);this.schemaAnalysis=a;try{an("analysis started"),this.setState({analysisState:_t,errorMessage:"",outdated:!1,schema:null});const e=Date.now(),t=await a.getResult(),n=Date.now()-e;this.setState({analysisState:t?At:Nt,schema:t,resultId:dn()}),this._trackSchemaAnalyzed(n),this.onSchemaSampled()}catch(e){an("analysis error catched",e),this.setState({...cn(e),resultId:dn()})}finally{this.schemaAnalysis=null}},storeDidUpdate(e){an("schema store changed from",e,"to",this.state)}});return e.localAppRegistry&&(e.localAppRegistry.on("subtab-changed",(e=>{t.onSubTabChanged(e)})),e.localAppRegistry.on("query-changed",(e=>{t.onQueryChanged(e)})),e.localAppRegistry.on("menu-share-schema-json",t.handleSchemaShare),((e,t)=>{e.localAppRegistry=t})(t,e.localAppRegistry)),e.globalAppRegistry&&((e,t)=>{e.globalAppRegistry=t})(t,e.globalAppRegistry),e.dataProvider&&((e,t,n)=>{t||(e.dataService=n)})(t,e.dataProvider.error,e.dataProvider.dataProvider),e.namespace&&((e,t)=>{Ht()(t).collection&&(e.ns=t)})(t,e.namespace),t},un=n(10862),mn=JSON.parse('{"name":"@mongodb-js/compass-schema","productName":"Compass Schema plugin","version":"5.21.0","apiVersion":"3.0.0","description":"Compass Schema Tab Plugin","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-cov":"nyc npm run test","depcheck":"depcheck","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","check":"npm run depcheck && npm run lint","prepublishOnly":"npm run compile","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","bootstrap":"npm run compile"},"license":"SSPL","peerDependencies":{"@mongodb-js/compass-components":"^0.13.0","@mongodb-js/compass-query-bar":"^7.20.0","bson":"*","d3":"^3.5.17","debug":"^3.0.1","hadron-ipc":"^2.9.0","hadron-react-buttons":"^5.7.0","hadron-react-components":"^5.13.0","jquery":"^2.1.4","mongodb-ns":"^2.3.0","prop-types":"^15.7.2","react":"^16.14.0","react-bootstrap":"0.31.0","react-dom":"^16.14.0","react-tooltip":"^3.11.1","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","@mongodb-js/compass-components":"^0.13.0","@mongodb-js/compass-query-bar":"^7.20.0","autoprefixer":"^9.4.6","babel-loader":"^8.2.2","bson":"^4.4.1","chai":"^4.1.2","chai-enzyme":"1.0.0-beta.0","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^5.2.0","css-loader":"^4.3.0","d3":"^3.5.17","debug":"4.3.0","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^5.0.3","extract-text-webpack-plugin":"^4.0.0-beta.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","hadron-ipc":"^2.9.0","hadron-react-buttons":"^5.7.0","hadron-react-components":"^5.13.0","html-webpack-plugin":"^3.2.0","ignore-loader":"^0.1.2","inject-loader":"^4.0.1","istanbul-instrumenter-loader":"^3.0.1","jquery":"^2.1.4","jsdom":"^16.7.0","jsdom-global":"^3.0.2","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","leaflet-defaulticon-compatibility":"^0.1.1","less":"^3.11.1","less-loader":"^7.3.0","lodash":"^4.17.21","mocha":"^5.2.0","mocha-webpack":"^2.0.0-beta.0","mongodb":"^4.4.0","mongodb-connection-model":"^21.15.0","mongodb-data-service":"^21.19.0","mongodb-ns":"^2.3.0","mongodb-reflux-store":"^0.0.1","node-fetch":"^2.6.1","node-loader":"^0.6.0","nyc":"^13.1.0","peer-deps-externals-webpack-plugin":"^1.0.4","postcss-loader":"^2.1.6","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","react-hot-loader":"^4.13.0","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","resolve":"^1.15.1","rimraf":"^2.6.1","semver":"^5.4.1","shebang-loader":"^0.0.1","sinon":"^3.2.0","sinon-chai":"^2.11.0","style-loader":"^2.0.0","url-loader":"^3.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^2.13.1","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-merge":"^4.2.2","webpack-node-externals":"^3.0.0","xvfb-maybe":"^0.2.1"},"dependencies":{"@mongodb-js/compass-logging":"^0.10.0","leaflet":"^1.5.1","leaflet-draw":"^1.0.4","lodash.debounce":"^4.0.8","lodash.defer":"^4.1.0","lodash.find":"^4.6.0","lodash.get":"^4.4.2","lodash.groupby":"^4.6.0","lodash.isequal":"^4.5.0","lodash.isstring":"^4.0.1","lodash.map":"^4.6.0","lodash.max":"^4.0.1","lodash.maxby":"^4.0.1","lodash.min":"^4.0.1","lodash.minby":"^4.0.1","lodash.pluck":"^3.1.2","lodash.range":"^3.2.0","lodash.samplesize":"^4.2.0","lodash.slice":"^4.2.0","lodash.sortby":"^4.7.0","lodash.sortbyorder":"^3.4.4","lodash.sum":"^4.0.2","mapbox-gl":"^1.2.0","moment":"^2.27.0","mongodb-query-util":"^0.0.3","mongodb-schema":"^8.2.5","numeral":"^1.5.6","pluralize":"^8.0.0","react-leaflet":"2.4.0","react-leaflet-draw":"0.19.0","turf-destination":"^3.0.12","turf-distance":"^3.0.12","turf-point":"^2.0.1"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"}}'),hn={component:Lt,name:sn,hasQueryHistory:!0,order:3,configureStore:pn,configureActions:()=>un.createActions({startAnalysis:{sync:!1},stopAnalysis:{sync:!0},reset:{sync:!1},setMaxTimeMS:{sync:!0},resetMaxTimeMS:{sync:!0},resizeMiniCharts:{sync:!0},geoLayerAdded:{sync:!0},geoLayersEdited:{sync:!0},geoLayersDeleted:{sync:!0}}),storeName:"Schema.Store",actionName:"Schema.Actions"};function gn(e){e.registerRole("Collection.Tab",hn)}function bn(e){e.deregisterRole("Collection.Tab",hn)}const yn=Lt},38358:function(e){var t;t=function(e){return function(){let t=function(){return"n"},n=function(){return[0,0]},s=p(),a=function(){return" "},i=null,r=null,o=null;function l(e){i=function(e){if(e=e.node())return"svg"===e.tagName.toLowerCase()?e:e.ownerSVGElement}(e),i&&(r=i.createSVGPoint(),document.body.appendChild(s))}l.show=function(){const e=Array.prototype.slice.call(arguments);e[e.length-1]instanceof SVGElement&&(o=e.pop());const s=a.apply(this,e),i=n.apply(this,e),r=t.apply(this,e),p=u(),m=document.documentElement.scrollTop||document.body.scrollTop,h=document.documentElement.scrollLeft||document.body.scrollLeft;let g=d.length,b=null;for(p.html(s).style({opacity:1,"pointer-events":"all",display:"block"});g--;)p.classed(d[g],!1);return b=c.get(r).apply(this),p.classed(r,!0).style({top:(b.top+i[0]+m).toString()+"px",left:(b.left+i[1]+h).toString()+"px"}),l},l.hide=function(){return u().style({opacity:0,"pointer-events":"none",display:"none"}),l},l.attr=function(t,n){if(arguments.length<2&&"string"==typeof t)return u().attr(t);{const t=Array.prototype.slice.call(arguments);e.selection.prototype.attr.apply(u(),t)}return l},l.style=function(t,n){if(arguments.length<2&&"string"==typeof t)return u().style(t);{const t=Array.prototype.slice.call(arguments);e.selection.prototype.style.apply(u(),t)}return l},l.direction=function(n){return arguments.length?(t=null==n?n:e.functor(n),l):t},l.offset=function(t){return arguments.length?(n=null==t?t:e.functor(t),l):n},l.html=function(t){return arguments.length?(a=null==t?t:e.functor(t),l):a},l.destroy=function(){return s&&(u().remove(),s=null),l};const c=e.map({n:function(){const e=m();return{top:e.n.y-s.offsetHeight,left:e.n.x-s.offsetWidth/2}},s:function(){const e=m();return{top:e.s.y,left:e.s.x-s.offsetWidth/2}},e:function(){const e=m();return{top:e.e.y-s.offsetHeight/2,left:e.e.x}},w:function(){const e=m();return{top:e.w.y-s.offsetHeight/2,left:e.w.x-s.offsetWidth}},nw:function(){const e=m();return{top:e.nw.y-s.offsetHeight,left:e.nw.x-s.offsetWidth}},ne:function(){const e=m();return{top:e.ne.y-s.offsetHeight,left:e.ne.x}},sw:function(){const e=m();return{top:e.sw.y,left:e.sw.x-s.offsetWidth}},se:function(){const e=m();return{top:e.se.y,left:e.e.x}}}),d=c.keys();function p(){const t=e.select(document.createElement("div"));return t.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box",display:"none"}),t.node()}function u(){return null===s&&(s=p(),document.body.appendChild(s)),e.select(s)}function m(){let t=o;for(t||(t=e.event.target);void 0===t.getScreenCTM&&"undefined"!==t.parentNode;)t=t.parentNode;const n={},s=t.getScreenCTM(),a=t.getBBox(),i=a.width,l=a.height,c=a.x,d=a.y;return r.x=c,r.y=d,n.nw=r.matrixTransform(s),r.x+=i,n.ne=r.matrixTransform(s),r.y+=l,n.se=r.matrixTransform(s),r.x-=i,n.sw=r.matrixTransform(s),r.y-=l/2,n.w=r.matrixTransform(s),r.x+=i,n.e=r.matrixTransform(s),r.x-=i/2,r.y-=l/2,n.n=r.matrixTransform(s),r.y+=l,n.s=r.matrixTransform(s),n}return l}},e.exports?e.exports=function(e){return e.tip=t(e),e.tip}:this.d3.tip=t(this.d3)},72184:(e,t,n)=>{const s=n(76635);function a(e){return!!e.lengths&&!!s.every(e.lengths,(function(e){return 2===e}))&&!!e.types&&!!s.isArray(e.types)&&1===e.types.length&&!!s.includes(["Number","Double","Int32","Decimal128"],e.types[0].name)&&function(e){const t=s.filter(e,(function(e,t){return t%2==0})),n=s.filter(e,(function(e,t){return t%2==1}));return s.min(t)>=-180&&s.max(t)<=180&&s.min(n)>=-90&&s.max(n)<=90&&s.zip(t,n)}(e.types[0].values)}e.exports=function(e){return"Document"===e.name?function(e){if(!e.fields)return!1;if(!s.isArray(e.fields))return!1;if(e.fields.length<2)return!1;const t=s.find(e.fields,["name","type"]),n=s.find(e.fields,["name","coordinates"]);return!(!t||!n)&&!!t.types&&!!s.isArray(t.types)&&1===t.types.length&&"String"===t.types[0].name&&!!s.every(t.types[0].values,(function(e){return"Point"===e}))&&!!n.types&&!!s.isArray(n.types)&&1===n.types.length&&"Array"===n.types[0].name&&a(n.types[0])}(e):"Array"===e.name&&a(e)}},58937:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>x,deactivate:()=>w,default:()=>C,metadata:()=>E});var s=n(2784),a=n(70602),i=n(13980),r=n.n(i),o=n(72779),l=n.n(o);const c="Enterprise",d="Community";class p extends s.Component{static displayName="ServerVersionComponent";static propTypes={versionNumber:r().string,versionDistro:r().oneOf(["",c,d]),isDataLake:r().bool,dataLakeVersion:r().string};static defaultProps={versionNumber:"",versionDistro:""};getVersion(){return this.props.isDataLake?`Atlas Data Lake ${this.props.dataLakeVersion?this.props.dataLakeVersion:""}`:`MongoDB ${this.props.versionNumber} ${this.props.versionDistro}`}render(){return""===this.props.versionNumber||""===this.props.versionDistro?null:s.createElement("div",{className:l()("server-version-module-server-version__3hOSi"),"data-test-id":"server-version"},s.createElement("div",{className:l()("server-version-module-server-version-edition__1KLQG")},"EDITION"),s.createElement("div",{className:l()("server-version-module-server-version-text__2v8FD"),"data-test-id":"server-version-text"},this.getVersion()))}}const u=p;var m=n(10862),h=n.n(m),g=n(99837),b=n.n(g);const y=h().createStore({mixins:[b().store],onActivated(e){this.appRegistry=e,e.on("instance-created",(({instance:e})=>{e.on("change:status",this.onInstanceStatusChange.bind(this))})),e.on("data-service-disconnected",(()=>this.setState(this.getInitialState())))},onInstanceStatusChange(e,t){"ready"===t&&(this.state.versionNumber!==e.build.version&&this.appRegistry.emit("server-version-changed",e.build.version),this.setState({versionDistro:e.build.isEnterprise?c:d,versionNumber:e.build.version,isDataLake:e.dataLake.isDataLake,dataLakeVersion:e.dataLake.version||null}))},getInitialState:()=>({versionDistro:"",versionNumber:"",isDataLake:!1,dataLakeVersion:""})});class f extends s.Component{static displayName="ServerVersionPlugin";render(){return s.createElement(a.StoreConnector,{store:y},s.createElement(u,this.props))}}const v=f,E=JSON.parse('{"name":"@mongodb-js/compass-server-version","productName":"Server Version","version":"5.21.0","apiVersion":"3.0.0","description":"Compass Server Version","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-cov":"nyc npm run test","check":"npm run lint && npm run depcheck","prepublishOnly":"npm run compile","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","bootstrap":"npm run compile"},"license":"SSPL","peerDependencies":{"hadron-react-components":"^5.13.0","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","autoprefixer":"^7.1.2","babel-loader":"^8.2.2","chai":"^4.1.2","chai-enzyme":"1.0.0-beta.0","cheerio":"^1.0.0-rc.2","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^5.0.1","css-loader":"^4.3.0","debug":"^3.0.1","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^2.1.0","eslint-plugin-react":"^7.24.0","extract-text-webpack-plugin":"^4.0.0-beta.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","hadron-react-components":"^5.13.0","html-webpack-plugin":"^3.2.0","ignore-loader":"^0.1.2","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","less":"^3.11.1","less-loader":"^7.3.0","mocha":"^4.1.0","mocha-webpack":"^2.0.0-beta.0","mongodb-reflux-store":"^0.0.1","node-loader":"^0.6.0","nyc":"^11.0.3","peer-deps-externals-webpack-plugin":"^1.0.4","postcss-loader":"^2.1.6","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","react-hot-loader":"^4.13.0","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","resolve":"^1.15.1","rimraf":"^2.6.1","semver":"^5.4.1","shebang-loader":"^0.0.1","sinon":"^3.2.0","sinon-chai":"^2.11.0","style-loader":"^2.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^2.9.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^3.0.0"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"}}'),S={name:"ServerVersion",component:v,order:3};function x(e){e.registerRole("InstanceDetails.Item",S),e.registerStore("ServerVersion.Store",y)}function w(e){e.deregisterRole("InstanceDetails.Item",S),e.deregisterStore("ServerVersion.Store")}const C=v},20045:(e,t,n)=>{const s=n(10862).createActions(["pause","dbError","showOperationDetails","hideOperationDetails","restart","mouseOut","currentOp","serverStats","top","killOp",{mouseOver:{sync:!0}}]);e.exports=s},82977:(e,t,n)=>{const s=n(2784),a=n(13980),i=n(28316),r=n(20045),o=n(42895),l=n(16653).realTimeLineChart,c=["#45BAAB","#23B1FF","#6F72FF","#A33A35","#FFA900","#C7E82F"];class d extends s.Component{constructor(e){super(e),this.state={error:null,data:{}},this.chart=l()}componentDidMount(){this.unsubscribeRefresh=this.props.store.listen(this.refresh.bind(this)),this.redraw()}componentDidUpdate(){this.redraw()}componentWillUnmount(){this.unsubscribeRefresh()}refresh(e,t){this.setState({error:e,data:t})}redraw(){const e=i.findDOMNode(this.refs.container),t=this.state.error?{}:this.state.data;if(!t.localTime||0===t.localTime.length)return;const n=t.localTime?t.localTime[t.localTime.length-1]:new Date,s=t.xLength?new Date(n.getTime()-1e3*t.xLength):n;this.chart.width(this.props.width).height(this.props.height).title(t.labels?t.labels.title:"Loading...").animationDelay(t.paused?null:1e3).singlePointTime(1e3).xDomain([s,n]).xVal(((e,n)=>t.localTime[n])).xValues((e=>e.localTime)).yDomain(t.yDomain||[0,0]).yVal((e=>e)).yValues((e=>e.dataSets)).yUnits(t.labels?t.labels.yAxis:"").yData((e=>e.count)).yLabel((e=>e.line)).yFormat(o.format("s")).y2Domain(t.secondScale?[0,t.secondScale.currentMax]:null).y2Val((e=>e)).y2Values((e=>e.secondScale?[e.secondScale]:[])).y2Units(t.secondScale?t.secondScale.units:"").y2Data((e=>e.count)).y2Label((e=>e.line)).y2Format(o.format("s")).defined(((e,n)=>!t.skip[n])).color(o.scale.ordinal().range(c)).strokeWidth(2).on("mouseover",r.mouseOver).on("mouseout",r.mouseOut).eventDispatcher(this.props.dispatcher),o.select(e).datum(this.state.data).call(this.chart)}render(){return s.createElement("div",{className:"chart"},s.createElement("div",{ref:"container"}))}}d.propTypes={width:a.number,height:a.number,store:a.any.isRequired,dispatcher:a.any.isRequired},d.displayName="ChartComponent",e.exports=d},50443:(e,t,n)=>{const s=n(61840),a=n(2784),i=n(13980),r=n(20045),o=n(78840);class l extends a.Component{constructor(e){super(e),this.state={error:null,data:[],display:"flex"}}componentDidMount(){this.unsubscribeRefresh=this.props.store.listen(this.refresh.bind(this)),this.unsubscribeShowOperationDetails=r.showOperationDetails.listen(this.hide.bind(this)),this.unsubscribeHideOperationDetails=r.hideOperationDetails.listen(this.show.bind(this)),o.ops.currentOp||(this.unsubscribeError=o.listen(this.stop.bind(this)),this.timer=s.interval((()=>{r.currentOp()}),this.props.interval))}componentWillUnmount(){this.unsubscribeRefresh(),this.unsubscribeShowOperationDetails(),this.unsubscribeHideOperationDetails(),this.unsubscribeError&&(this.unsubscribeError(),this.timer.stop())}stop(){this.timer&&this.timer.stop()}refresh(e,t){this.setState({error:e,data:t})}show(){this.setState({display:"flex"})}hide(){this.setState({display:"none"})}showOperationDetails(e){r.showOperationDetails(e)}renderError(){return a.createElement("div",{className:"rt-lists",style:{display:this.state.display}},a.createElement("header",{className:"rt-lists__header"},a.createElement("h2",{className:"rt-lists__headerlabel"},"Slowest Operations")),a.createElement("div",{className:"rt-lists__empty-error"},"â  DATA UNAVAILABLE"))}renderZero(){return a.createElement("div",{className:"rt-lists",style:{display:this.state.display}},a.createElement("header",{className:"rt-lists__header"},a.createElement("h2",{className:"rt-lists__headerlabel"},"Slowest Operations")),a.createElement("div",{"data-test-id":"no-slow-operations",className:"rt-lists__empty-error"},"â No Slow Operations"))}renderGraph(){const e=this.showOperationDetails,t=this.state.data.map((function(t,n){return a.createElement("li",{className:"rt-lists__item rt-lists__item--slow",onClick:e.bind(null,t),key:`list-item-${n}`},a.createElement("div",{className:"rt-lists__op"},t.op),a.createElement("div",{className:"rt-lists__collection-slow"},t.ns),a.createElement("div",{className:"rt-lists__time"},t.ms_running+" ms"))}));return a.createElement("div",{className:"rt-lists",style:{display:this.state.display}},a.createElement("header",{className:"rt-lists__header"},a.createElement("h2",{className:"rt-lists__headerlabel"},"Slowest Operations")),a.createElement("div",{className:"rt-lists__listdiv",id:"div-scroll"},a.createElement("ul",{className:"rt-lists__list"},t)))}render(){return this.state.error?this.renderError():0===this.state.data.length?this.renderZero():this.renderGraph()}}l.propTypes={store:i.any.isRequired,interval:i.number.isRequired},l.displayName="CurrentOpComponent",e.exports=l},61053:(e,t,n)=>{const s=n(2784),a=n(13980);class i extends s.Component{constructor(e){super(e),this.state={data:[]}}componentDidMount(){this.unsubscribeRefresh=this.props.store.listen(this.refresh.bind(this))}componentWillUnmount(){this.unsubscribeRefresh()}refresh(e){this.setState({data:e})}renderErrors(){const e=this.state.data.map((function(e,t){return s.createElement("li",{className:"rt-errors__item status-row status-row-has-error",key:`list-item-${t}`},s.createElement("div",{className:"rt-errors__operror"},s.createElement("span",null,'â  Command "',e.ops,'" returned error '),s.createElement("span",{className:"rt-errors__bold"},'"',e.errorMsg,'"')))}));return s.createElement("div",{className:"rt-errors"},s.createElement("ul",{className:"rt-errors__list"},e))}render(){return this.state.data.length?this.renderErrors():null}}i.propTypes={store:a.any.isRequired},i.displayName="DBErrorComponent",e.exports=i},96020:(e,t,n)=>{const s=n(2784),a=n(20045),{TextButton:i}=n(15251);class r extends s.Component{constructor(e){super(e),this.state={error:null,data:{},display:"none"}}componentDidMount(){this.unsubscribeShowOperationDetails=a.showOperationDetails.listen(this.show.bind(this)),this.unsubscribeHideOperationDetails=a.hideOperationDetails.listen(this.hide.bind(this))}componentWillUnmount(){this.unsubscribeShowOperationDetails(),this.unsubscribeHideOperationDetails()}show(e){this.setState({data:e,display:"block"})}hide(){this.setState({data:{},display:"none"})}killOp(){a.killOp(this.state.data.opid),this.hideOperationDetails()}hideOperationDetails(){a.hideOperationDetails()}removeMs(e,t){if("ms_running"!==e)return t}renderError(){return s.createElement("div",{style:{display:this.state.display}},"this.state.error.message")}renderZero(){return s.createElement("div",{style:{display:this.state.display}})}renderGraph(){return s.createElement("div",{className:"rt-details",style:{display:this.state.display}},s.createElement("header",{className:"rt-details__header"},s.createElement("h2",{className:"rt-details__headerlabel"},"operation details"),s.createElement("div",{className:"rt-details__closebutton",onClick:this.hideOperationDetails.bind(this)},s.createElement("i",{className:"fa fa-times"}),"Close")),s.createElement("div",{className:"rt-details__body"},s.createElement("div",{className:"rt-details__opinfo"},s.createElement("div",{className:"rt-details__op"},this.state.data.op),s.createElement("div",{className:"rt-details__collection-slow"},this.state.data.ns),s.createElement("div",{className:"rt-details__time"},this.state.data.ms_running+" ms")),s.createElement("ul",{className:"rt-details__list"},s.createElement("li",{className:"rt-details__item"},s.createElement("div",{className:"rt-details__datatype"},"opid"),s.createElement("div",{className:"rt-details__datatype-val"},this.state.data.opid)),s.createElement("li",{className:"rt-details__item"},s.createElement("div",{className:"rt-details__datatype"},"client s"),s.createElement("div",{className:"rt-details__datatype-val"},this.state.data.client)),s.createElement("li",{className:"rt-details__item"},s.createElement("div",{className:"rt-details__datatype"},"active"),s.createElement("div",{className:"rt-details__datatype-val"},this.state.data.active)),s.createElement("li",{className:"rt-details__item"},s.createElement("div",{className:"rt-details__datatype"},"wait lock"),s.createElement("div",{className:"rt-details__datatype-val"},this.state.data.waitingForLock)),s.createElement("li",{className:"rt-details__item"},s.createElement("div",{className:"rt-details__datatype"},s.createElement(i,{text:"Kill Op",clickHandler:this.killOp.bind(this),className:"btn btn-alert btn-xs"})))),s.createElement("div",{className:"rt-details__raw"},s.createElement("span",null,JSON.stringify(this.state.data,this.removeMs,4)))))}render(){return this.state.error?this.renderError():0===this.state.data.length?this.renderZero():this.renderGraph()}}r.displayName="DetailViewComponent",e.exports=r},38539:(e,t,n)=>{n(65005);const s=n(2784),a=n(81220),{realTimeDispatcher:i}=n(16653),r=n(10636),o=n(61053),l=n(80907),c=n(78840),d=n(64632),{StatusRow:p}=n(70602);class u extends s.Component{constructor(e){super(e),this.eventDispatcher=i()}renderTopMessage(){return s.createElement(p,{style:"warning"},"Top command is not available for mongos, some charts may not show any data.")}render(){return s.createElement("section",{className:"rt-perf"},s.createElement("div",{className:"controls-container"},s.createElement(l,{paused:!1,eventDispatcher:this.eventDispatcher}),d.isMongos?this.renderTopMessage():null,s.createElement(o,{store:c})),s.createElement("div",{className:"column-container"},s.createElement("div",{className:"column main"},s.createElement("section",{className:"rt__graphs-out"},s.createElement(a,{eventDispatcher:this.eventDispatcher,interval:1e3})),s.createElement("section",{className:"rt__lists-out"},s.createElement(r,{interval:1e3})))))}}e.exports=u},81220:(e,t,n)=>{const s=n(61840),a=n(2784),i=n(13980),r=n(82977),o=n(9854),l=n(73661),c=n(10749),d=n(99503),p=n(20045),u=n(78840);class m extends a.Component{constructor(e){super(e)}componentDidMount(){u.ops.serverStatus||(this.unsubscribeError=u.listen(this.stop.bind(this)),this.timer=s.interval((()=>{p.serverStats()}),this.props.interval))}componentWillUnmount(){this.unsubscribeError&&(this.unsubscribeError(),this.timer.stop())}stop(){this.timer&&this.timer.stop()}render(){const{eventDispatcher:e}=this.props;return a.createElement("div",{className:"serverstats"},a.createElement(r,{width:520,height:145,store:o,dispatcher:e}),a.createElement(r,{width:520,height:145,store:c,dispatcher:e}),a.createElement(r,{width:520,height:145,store:l,dispatcher:e}),a.createElement(r,{width:520,height:145,store:d,dispatcher:e}))}}m.propTypes={interval:i.number.isRequired,eventDispatcher:i.object.isRequired},m.displayName="ServerStatsComponent",e.exports=m},10636:(e,t,n)=>{const s=n(2784),a=n(13980),i=n(96020),r=n(50443),o=n(1268),l=n(90133),c=n(28823);class d extends s.Component{render(){return s.createElement("div",{className:"listview"},s.createElement(i,null),s.createElement(o,{interval:this.props.interval,store:c}),s.createElement(r,{interval:this.props.interval,store:l}))}}d.propTypes={interval:a.number.isRequired},e.exports=d},80907:(e,t,n)=>{const s=n(2784),a=n(42895),i=n(13980),r=n(20045),o=n(64632);class l extends s.Component{constructor(e){super(e),this.state={paused:o.isPaused,time:"00:00:00"}}componentDidMount(){this.props.eventDispatcher.on("newXValue",(e=>{this.setState({time:a.time.format.utc("%X")(e)})}))}handlePause(){this.setState({paused:!this.state.paused}),r.pause()}render(){return s.createElement("div",{className:"time-and-pause action-bar"},s.createElement("button",{onClick:this.handlePause.bind(this),className:"play btn btn-xs btn-primary","data-test-id":"performance-play",style:{display:this.state.paused?null:"none"}},s.createElement("span",{className:"playbutton"},s.createElement("i",{className:"fa fa-play"}),"PLAY")),s.createElement("button",{onClick:this.handlePause.bind(this),className:"pause btn btn-default btn-xs","data-test-id":"performance-pause",style:{display:this.state.paused?"none":null}},s.createElement("span",{className:"pausebutton"},s.createElement("i",{className:"fa fa-pause"}),"PAUSE")),s.createElement("div",{className:"time"},s.createElement("span",{className:"currentTime"},this.state.time)))}}l.propTypes={paused:i.bool.isRequired,eventDispatcher:i.object.isRequired},l.defaultProps={paused:!1},l.displayName="TimeAndPauseButton",e.exports=l},1268:(e,t,n)=>{const s=n(61840),a=n(2784),i=n(13980),r=n(20045),o=n(78840);class l extends a.Component{constructor(e){super(e),this.state={error:null,data:[],display:"flex"}}componentDidMount(){this.unsubscribeRefresh=this.props.store.listen(this.refresh.bind(this)),this.unsubscribeShowOperationDetails=r.showOperationDetails.listen(this.hide.bind(this)),this.unsubscribeHideOperationDetails=r.hideOperationDetails.listen(this.show.bind(this)),o.ops.top||(this.unsubscribeError=o.listen(this.stop.bind(this)),this.timer=s.interval((()=>{r.top()}),this.props.interval))}componentWillUnmount(){this.unsubscribeRefresh(),this.unsubscribeShowOperationDetails(),this.unsubscribeHideOperationDetails(),this.unsubscribeError&&(this.unsubscribeError(),this.timer.stop())}stop(){this.timer&&this.timer.stop()}show(){this.setState({display:"flex"})}hide(){this.setState({display:"none"})}refresh(e,t){this.setState({error:e,data:t})}renderError(){return a.createElement("div",{className:"rt-lists",style:{display:this.state.display}},a.createElement("header",{className:"rt-lists__header"},a.createElement("h2",{className:"rt-lists__headerlabel"},"Hottest Collections")),a.createElement("div",{className:"rt-lists__empty-error"},"â  DATA UNAVAILABLE"))}renderZero(){return a.createElement("div",{className:"rt-lists",style:{display:this.state.display}},a.createElement("header",{className:"rt-lists__header"},a.createElement("h2",{className:"rt-lists__headerlabel"},"Hottest Collections")),a.createElement("div",{className:"rt-lists__empty-error"},"â No Hot Collections"))}renderGraph(){const e=this.state.data.map((function(e,t){const n={width:`${e.loadPercent}%`},s={width:`${e.loadPercentR}%`},i={width:`${e.loadPercentW}%`};return a.createElement("li",{className:"rt-lists__item",key:`list-item-${t}`},a.createElement("div",{className:"rt-lists__collection-hot",title:e.collectionName},e.collectionName),a.createElement("div",{className:"rt-lists__load"},e.loadPercent,a.createElement("span",null,"%")),a.createElement("div",{className:"rt-lists__rw",style:n},a.createElement("div",{className:"rt-lists__r",style:s},"R"),a.createElement("div",{className:"rt-lists__w",style:i},"W")))}));return a.createElement("div",{className:"rt-lists",style:{display:this.state.display}},a.createElement("header",{className:"rt-lists__header"},a.createElement("h2",{className:"rt-lists__headerlabel"},"Hottest Collections")),a.createElement("div",{className:"rt-lists__listdiv",id:"div-scroll"},a.createElement("ul",{className:"rt-lists__list"},e)))}render(){return this.state.error?this.renderError():0===this.state.data.length?this.renderZero():this.renderGraph()}}l.propTypes={store:i.any.isRequired,interval:i.number.isRequired},l.displayName="TopComponent",e.exports=l},16653:(e,t,n)=>{e.exports.realTimeLineChart=n(83174),e.exports.realTimeDispatcher=n(85529)},92722:(e,t,n)=>{const s=n(42895);e.exports=function(){let e,t,n=s.time.scale(),a=s.scale.linear(),i=e=>e.x,r=e=>e.y,o=e=>e.data,l=s.scale.category10(),c=1,d=()=>!0;const p=(e,t)=>n(i(e,t)),u=(e,t)=>a(r(e,t));function m(i){i.each((function(i){const r=s.select(this),m=s.svg.line().defined(d).interpolate("monotone").x(p).y(u);r.selectAll("defs").data([0]).enter().append("defs").append("clipPath").attr("id","clip").append("rect"),r.selectAll("clipPath#clip rect").attr("width",Math.abs(n.range()[0]-n.range()[1])).attr("height",Math.abs(a.range()[0]-a.range()[1])+c),r.attr("clip-path","url(#clip)");const h=r.selectAll("path.line").data(i,((e,t)=>t));h.enter().append("path").attr("class","line").attr("stroke-width",c).attr("stroke",((e,t)=>l(t))).style("fill","none"),h.attr("d",((e,t)=>m(o(e,t)))),!isNaN(Number(e))&&t&&(h.interrupt("translate"),h.attr("transform",isNaN(e)?null:`translate(${e})`).transition("translate").duration(t).ease(s.ease("linear")).attr("transform","translate(0)"))}))}return m.xScale=function(e){return void 0===e?n:(n=e,m)},m.yScale=function(e){return void 0===e?a:(a=e,m)},m.xVal=function(e){return void 0===e?i:(i=e,m)},m.yVal=function(e){return void 0===e?r:(r=e,m)},m.yData=function(e){return void 0===e?o:(o=e,m)},m.color=function(e){return void 0===e?l:(l=e,m)},m.defined=function(e){return void 0===e?d:(d=e,m)},m.singlePointDistance=function(t){return void 0===t?e:(e=t,m)},m.expectedPointSpeed=function(e){return void 0===e?t:(t=e,m)},m.strokeWidth=function(e){return void 0===e?c:(c=e,m)},m}},85529:(e,t,n)=>{const s=n(42895);e.exports=function(){return s.dispatch("mouseover","updateoverlay","mouseout","newXValue")}},33065:(e,t,n)=>{const s=n(42895);e.exports=function(){let e=e=>e.label,t="legend",n=s.scale.category10(),a=8,i=function(){},r="flex-start",o=e=>e,l=e=>e.data;function c(r){r.each((function(r){const d=s.select(this),p=d.selectAll(`div.${t}-item`).data(r).enter().append("div").attr("class",`${t}-item`);p.append("svg").attr("height",a+2).attr("width",a+2).append("rect").attr("fill",((e,t)=>n(t))).attr("stroke",((e,t)=>n(t))).attr("class",`${t}-box`).attr("width",a).attr("height",a).attr("x",1).attr("y",1).attr("rx",a/5).attr("ry",a/5).on("click",(function(e,t){const n=s.select(this),a="1"!==n.style("fill-opacity"),r=a?1:0;n.transition().duration(100).style("fill-opacity",r),i(e,t,a)}));const u=p.append("div").attr("class",`${t}-text`);u.append("p").attr("class",`${t}-linename`).text(e),u.append("p").attr("data-test-id",(function(t){return`performance-${e(t)}`})).attr("class",`${t}-count`);const m=d.selectAll(`p.${t}-count`);c.showValues=function(e){m.text(((t,n)=>o(l(t,n)[e])))}}))}return c.label=function(t){return void 0===t?e:(e=t,c)},c.color=function(e){return void 0===e?n:(n=e,c)},c.bubbleWidth=function(e){return void 0===e?a:(a=e,c)},c.onToggle=function(e){return void 0===e?i:(i=e,c)},c.justifyContent=function(e){return void 0===e?r:(r=e,c)},c.yData=function(e){return void 0===e?l:(l=e,c)},c.prefix=function(e){return void 0===e?t:(t=e,c)},c.format=function(e){return void 0===e?o:(o=e,c)},c}},83174:(e,t,n)=>{const s=n(42895),a=n(33065),i=n(92722),r=n(49666);e.exports=function(){const e=s.time.scale(),t=s.scale.linear(),n=s.scale.linear(),o=s.dispatch("mouseover","mouseout");let l=520,c=160,d="serverstats",p="CHANGE ME",u=[0,0],m=e=>e.x,h=()=>[],g=[0,0],b=e=>e.y,y="",f=()=>[],v=e=>e.data,E=e=>e.label,S=e=>e,x=null,w=e=>e,C="",k=()=>[],N=e=>e.data,_=e=>e.label,T=e=>e,A=e=>e.defined,R=s.scale.category10(),O=1,D=5e3,P=5e3,I=!0,L=!1,j=s.dispatch("mouseover","updateoverlay","mouseout","newXValue");function M(w){w.each((function(w){const q=c-25-45,F=l-55-40;e.domain(u).range([0,F]),t.domain(g).range([q-O,O/2]),n.domain(x||[0,0]).range([q-O,O/2]);let V=null,B=null;const U=i().xScale(e).yScale(t).xVal(m).yVal(b).yData(v).color(R).defined(A).strokeWidth(O).singlePointDistance(e(P)-e(0)).expectedPointSpeed(D),H=i().xScale(e).yScale(n).xVal(m).yVal(b).yData(N).color((e=>R(e+f(w).length))).defined(A).strokeWidth(O).singlePointDistance(e(P)-e(0)).expectedPointSpeed(D),$=`${d}-legend`,z=a().label(E).yData(v).color(R).prefix($).format(S).onToggle(((e,t,n)=>{const s=n?1:0;V.selectAll("path.line").filter((t=>t===e)).transition("opacity").duration(100).style("opacity",s)})),G=a().label(_).yData(N).justifyContent("flex-end").color((e=>R(e+f(w).length))).prefix(`${$}-2`).format(T).onToggle(((e,t,n)=>{const s=n?1:0;B.selectAll("path.line").filter((t=>e===t)).transition("opacity").duration(100).style("opacity",s)}));function Q(t){const n=e.invert(t),a=s.bisectLeft(h(w),n);let i=Math.min(a,h(w).length-1);for(;!A(null,i);)i++;return i}const W=r().bubbleWidth(8).strokeWidth(2).enableMouse(I).title(p).eventDispatcher(j).on("updateoverlay",(t=>{let n=h(w).length-1,a=F+4;L&&void 0===t||(void 0!==t&&(n=Q(t),a=e(h(w)[n])+4,o.mouseover(n)),z.showValues(n),G.showValues(n),h(w).length&&j.newXValue(h(w)[n]),I&&s.select(this).selectAll("g.serverstats-overlay-group").attr("transform",`translate(${a})`))})).on("mouseover",(e=>{L=!0;const t=Q(e);o.mouseover(t)})).on("mouseout",(e=>{L=!1;const t=h(w).length-1;z.showValues(t),G.showValues(t),s.select(this).selectAll("g.serverstats-overlay-group").attr("transform",`translate(${e})`),j.newXValue(h(w)[t]),o.mouseout()})),K=s.select(this);K.style("height",`${c}px`).style("width",`${l}px`);const Z=`${d}-chart-title`;K.selectAll(`p.${Z}`).data([0]).enter().append("p").attr("class",Z).style("margin-left","55px").text(p);const X=K.selectAll(`div.${d}-chart-row`).data([0]).enter().append("div").attr("class",`${d}-chart-row`).style("display","flex").style("align-items","flex-start"),Y=`${d}-max-y-value`,J=`${d}-max-y-units`,ee=X.append("p").attr("class",`${d}-y-axis-label`).style("text-align","right").style("width","51px");ee.append("span").attr("class",Y),ee.append("span").attr("class",J),X.append("svg").attr("class",`${d}-chart`).append("g").attr("class",`${d}-chart-group`).attr("transform","translate(4, 4)").append("rect").attr("class",`${d}-chart-background`),K.selectAll(`svg.${d}-chart`).attr("height",q+4).attr("width",F+8),K.selectAll(`rect.${d}-chart-background`).attr("width",F).attr("height",q);const te=K.selectAll(`g.${d}-chart-group`),ne=`${d}-max-y2-value`,se=`${d}-max-y2-units`,ae=X.append("p").attr("class",`${d}-y2-axis-label`).style("width","36px");ae.append("span").attr("class",ne),ae.append("span").attr("class",se),V=te.selectAll(".chart-line-group-container").data([f(w)]),V.enter().append("g").attr("class","chart-line-group-container"),V.call(U),K.selectAll(`span.${Y}`).text(S(g[1])),K.selectAll(`span.${J}`).text(` ${y}`),K.selectAll(`span.${ne}`).text(x?T(x[1]):""),K.selectAll(`span.${se}`).text(` ${C}`);const ie=`${d}-legend-container`,re=K.selectAll(`div.${ie}`).data([0]);re.enter().append("div").attr("class",ie).style("margin-left","55px").style("margin-right","40px").style("display","flex").style("justify-content","space-between");const oe=re.selectAll(`div.${$}`).data([f(w)]);oe.enter().append("div").style("display","flex").attr("class",$),oe.call(z),B=te.selectAll(".chart-line-group-container-2").data([k(w)]),B.enter().append("g").attr("class","chart-line-group-container-2"),B.call(H);const le=re.selectAll(`div.${$}-2`).data([k(w)]);le.enter().append("div").style("display","flex").attr("class",`${$}-2`),le.call(G),K.selectAll(`svg.${d}-chart`).call(W),M.setPosition=function(e){const t=Q(e);r.setPosition(e),z.showValues(t),G.showValues(t)}}))}return M.width=function(e){return void 0===e?l:(l=e,M)},M.height=function(e){return void 0===e?c:(c=e,M)},M.title=function(e){return void 0===e?p:(p=e,M)},M.xDomain=function(e){return void 0===e?u:(u=e,M)},M.yDomain=function(e){return void 0===e?g:(g=e,M)},M.y2Domain=function(e){return void 0===e?x:(x=e,M)},M.xVal=function(e){return void 0===e?m:(m=e,M)},M.xValues=function(e){return void 0===e?h:(h=e,M)},M.yVal=function(e){return void 0===e?b:(b=e,M)},M.yUnits=function(e){return void 0===e?y:(y=e,M)},M.yFormat=function(e){return void 0===e?S:(S=e,M)},M.y2Val=function(e){return void 0===e?w:(w=e,M)},M.y2Units=function(e){return void 0===e?C:(C=e,M)},M.y2Format=function(e){return void 0===e?T:(T=e,M)},M.yValues=function(e){return void 0===e?f:(f=e,M)},M.yData=function(e){return void 0===e?v:(v=e,M)},M.yLabel=function(e){return void 0===e?E:(E=e,M)},M.y2Values=function(e){return void 0===e?k:(k=e,M)},M.y2Data=function(e){return void 0===e?N:(N=e,M)},M.y2Label=function(e){return void 0===e?_:(_=e,M)},M.defined=function(e){return void 0===e?A:(A=e,M)},M.color=function(e){return void 0===e?R:(R=e,M)},M.on=function(e,t){return o.on(e,t),M},M.prefix=function(e){return void 0===e?d:(d=e,M)},M.animationDelay=function(e){return void 0===e?D:(D=e,M)},M.singlePointTime=function(e){return void 0===e?P:(P=e,M)},M.strokeWidth=function(e){return void 0===e?O:(O=e,M)},M.enableMouse=function(e){return void 0===e?I:(I=e,M)},M.eventDispatcher=function(e){return void 0===e?j:(j=e,M)},M}},49666:(e,t,n)=>{const s=n(42895);e.exports=function(){let e="serverstats-overlay",t=30,n=1,a=!0,i="CHANGE ME",r=s.dispatch("mouseover","updateoverlay","mouseout");function o(i){i.each((function(i){const l=s.select(this),c=l.attr("height"),d=l.attr("width"),p=d-t/2,u=`${e}-group`,m=l.selectAll(`g.${u}`).data([i]);let h;m.enter().append("g").attr("class",u).attr("transform",`translate(${p})`),m.selectAll("line").data([i]).enter().append("line").attr("stroke","white").attr("class",`${e}-line`),m.selectAll("line").attr("x1",0).attr("y1",c).attr("x2",0).attr("y2",0),m.selectAll("path").data([i]).enter().append("path").attr("stroke","white").attr("fill","white").attr("class",`${e}-triangle`).attr("d",s.svg.symbol().type("triangle-down").size(3*t)).attr("stroke","white").attr("stroke-width",n);const g=l.selectAll(`rect.${e}-mouse-target`).data([i]).attr("height",c-t/2).attr("width",d-t).enter().append("rect").attr("class",`${e}-mouse-target`).attr("fill","none").attr("stroke","none").attr("transform",`translate(${t/2}, ${t/2})`).style("pointer-events","visible");a?g.on("mouseover",(function(){const e=s.mouse(this)[0];r.mouseover(e)})).on("mousemove",(function e(t){clearInterval(h),t=t||s.mouse(this)[0],r.updateoverlay(t),h=setInterval(e.bind(this,t),20)})).on("mouseout",(function(){clearInterval(h),r.mouseout(p)})):g.on("mouseover",null).on("mousemove",null).on("mouseout",null),m.attr("transform")===`translate(${p})`&&r.updateoverlay(),o.setPosition=function(e){m.attr("transform",`translate(${e})`)}}))}return o.title=function(e){return void 0===e?i:(i=e,o)},o.bubbleWidth=function(e){return void 0===e?t:(t=e,o)},o.on=function(e,t){return r.on(`${e}.${i}`,t),o},o.prefix=function(t){return void 0===t?e:(e=t,o)},o.strokeWidth=function(e){return void 0===e?n:(n=e,o)},o.enableMouse=function(e){return void 0===e?a:(a=e,o)},o.eventDispatcher=function(e){return void 0===e?r:(r=e,o)},o}},25229:(e,t,n)=>{const s=n(38539),a=n(64632),i=n(90133),r=n(28823),o={component:s,name:"Performance",order:3};e.exports.d3=n(16653),e.exports.activate=function(e){e.registerRole("Instance.Tab",o),e.registerStore("RTSS.ServerStatsStore",a),e.registerStore("RTSS.CurrentOpStore",i),e.registerStore("RTSS.TopStore",r)},e.exports.deactivate=function(){global.hadronApp.appRegistry.deregisterRole("Instance.Tab",o),global.hadronApp.appRegistry.deregisterStore("RTSS.ServerStatsStore",a),global.hadronApp.appRegistry.deregisterStore("RTSS.CurrentOpStore",i),global.hadronApp.appRegistry.deregisterStore("RTSS.TopStore",r)},e.exports.metadata=n(19653)},90133:(e,t,n)=>{const s=n(10862),a=n(20045),i=n(84935),r=n(40398),o=n(53268)("mongodb-compass:server-stats:current-op-store"),l=s.createStore({init:function(){this.restart(),this.listenTo(a.currentOp,this.currentOp),this.listenTo(a.pause,this.pause),this.listenTo(a.restart,this.restart),this.listenTo(a.mouseOver,this.mouseOver),this.listenTo(a.mouseOut,this.mouseOut),this.listenTo(a.killOp,this.killOp)},onActivated:function(e){e.on("data-service-connected",((e,t)=>{if(e)throw e;this.dataService=t}))},restart:function(){this.allOps=[],this.isPaused=!1,this.endPause=0,this.overlayIndex=0,this.inOverlay=!1,this.xLength=60,this.starting=!0,this.errored=[]},pause:function(){this.endPause=this.allOps.length,this.isPaused=!this.isPaused},killOp:function(e){this.dataService.command("admin",{killOp:1,op:e},(e=>{e&&a.dbError({op:"currentOp",error:e})}))},mouseOver:function(e){const t=Math.max(this.endPause-this.xLength,0),n=this.allOps.slice(t,this.endPause),s=this.errored.slice(t,this.endPause);e>=n.length&&(e=n.length-1),this.overlayIndex=e,this.inOverlay=!0;const a=0===n.length?[]:n[this.overlayIndex];this.trigger(s[this.overlayIndex],a)},mouseOut:function(){this.inOverlay=!1;const e=Math.max(this.endPause-this.xLength,0),t=this.allOps.slice(e,this.endPause),n=this.errored.slice(e,this.endPause),s=0===t.length?[]:t[t.length-1];this.trigger(n[this.overlayIndex],s)},currentOp:function(){this.dataService&&this.dataService.currentOp(!1,((e,t)=>{null===e&&this.errored.length>0&&null!==this.errored[this.errored.length-1]?a.dbError({op:"currentOp",error:null}):null!==e&&a.dbError({op:"currentOp",error:e}),this.errored.push(e),(null!==e||this.starting)&&this.allOps.push([]);let n=[];if(null===e){let e=[];if(void 0!==t&&"inprog"in t&&(e=t.inprog),this.starting)return void(this.starting=!1);for(let t=0;t<e.length;t++)i(e[t].ns).specialish||("microsecs_running"in e[t]?e[t].ms_running=r(e[t].microsecs_running/1e3,2):(o("Error: currentOp result from DB did not include 'microsecs_running'",e[t]),e[t].ms_running=0),"ns"in e[t]&&"op"in e[t]||o("Error: currentOp result from DB did not include 'ns' or 'op'",e[t]),"active"in e[t]?e[t].active=e[t].active.toString():o("Error: currentOp result from DB did not include 'active'",e[t]),"waitingForLock"in e[t]?e[t].waitingForLock=e[t].waitingForLock.toString():o("Error: currentOp result from DB did not include 'waitingForLock'",e[t]),n.push(e[t]));n.sort((function(e,t){const n=t.ms_running<e.ms_running?-1:0;return e.ms_running<t.ms_running?1:n})),this.allOps.push(n)}this.isPaused?(n=this.allOps[this.endPause],e=this.errored[this.endPause]):this.endPause=this.allOps.length,this.inOverlay||this.trigger(e,n)}))}});e.exports=l},78840:(e,t,n)=>{const s=n(10862),a=n(20045),i=n(23262).translate,r=n(33958),o=s.createStore({init:function(){this.restart(),this.listenTo(a.dbError,this.dbError),this.listenTo(a.restart,this.restart)},restart:function(){this.ops={top:null,currentOp:null,serverStatus:null},this.srcName={top:"Hottest Collections",currentOp:"Slowest Operations",serverStatus:"Stats Charts"}},_translateMessage(e){const t=i(e);return t&&(e.message=t.message),e},publish:function(){const e=[];for(let t in this.ops)this.ops.hasOwnProperty(t)&&null!==this.ops[t]&&e.push({errorMsg:this._translateMessage(this.ops[t]).message,ops:t,type:this.ops[t].name,srcName:this.srcName[t]});this.trigger(e)},dbError:function(e){null!==this.ops[e.op]&&null===e.error&&(this.ops[e.op]=e.error,this.publish()),null===e.error||r(this.ops[e.op],e.error)||(this.ops[e.op]=e.error,this.publish())}});e.exports=o},10749:(e,t,n)=>{const s=n(10862),a=n(20045),i=n(64632),r=n(54954),o=s.createStore({init:function(){this.restart(),this.listenTo(i,this.globalLock),this.listenTo(a.restart,this.restart)},restart:function(){this.totalCount={aReads:[],aWrites:[],qReads:[],qWrites:[]},this.localTime=[],this.skip=[],this.currentMaxs=[],this.starting=!0,this.xLength=60,this.endPause=0,this.isPaused=!1,this.data={dataSets:[{line:"aReads",count:[],active:!0},{line:"aWrites",count:[],active:!0},{line:"qReads",count:[],active:!0},{line:"qWrites",count:[],active:!0}],localTime:[],skip:[],yDomain:[0,1],xLength:this.xLength,labels:{title:"read & write",keys:["active reads","active writes","queued reads","queued writes"],yAxis:""},keyLength:4,paused:!1}},globalLock:function(e,t,n){if(!e&&t&&"localTime"in t&&"globalLock"in t){if(this.starting)return void(this.starting=!1);let e,s;const a={};if(a.aReads=t.globalLock.activeClients.readers,a.aWrites=t.globalLock.activeClients.writers,a.qReads=t.globalLock.currentQueue.readers,a.qWrites=t.globalLock.currentQueue.writers,this.localTime.length>0&&t.localTime.getTime()-this.localTime[this.localTime.length-1].getTime()<500)return;const i=this.localTime.length>0&&t.localTime-this.localTime[this.localTime.length-1]>2e3;n&&!this.isPaused?(this.isPaused=!0,this.endPause=this.localTime.length):!n&&this.isPaused?(this.isPaused=!1,this.endPause=this.localTime.length+1):n||this.isPaused||(this.endPause++,i&&this.endPause++);const o=Math.max(this.endPause-this.xLength,0);for(let t=0;t<this.data.dataSets.length;t++)e=this.data.dataSets[t].line,s=a[e],this.totalCount[e].push(s),i&&this.totalCount[e].push(s),this.data.dataSets[t].count=this.totalCount[e].slice(o,this.endPause);const l=[1];for(let e=0;e<this.data.dataSets.length;e++)l.push(r(this.data.dataSets[e].count));i&&(this.localTime.push(new Date(t.localTime.getTime()-1e3)),this.currentMaxs.push(r(l)),this.skip.push(i)),this.skip.push(!1),this.currentMaxs.push(r(l)),this.data.yDomain=[0,this.currentMaxs[this.endPause-1]],this.localTime.push(t.localTime),this.data.localTime=this.localTime.slice(o,this.endPause),this.data.skip=this.skip.slice(o,this.endPause),this.data.paused=n}this.trigger(e,this.data)}});e.exports=o},99503:(e,t,n)=>{const s=n(10862),a=n(20045),i=n(64632),r=n(85968),o=n(63211),l=n(40398),c=n(54954),d=s.createStore({init:function(){this.restart(),this.listenTo(i,this.mem),this.listenTo(a.restart,this.restart)},restart:function(){this.totalCount={virtual:[],resident:[],mapped:[]},this.localTime=[],this.skip=[],this.currentMaxs=[],this.starting=!0,this.xLength=60,this.endPause=0,this.isPaused=!1,this.data={dataSets:[{line:"virtual",count:[],active:!0},{line:"resident",count:[],active:!0},{line:"mapped",count:[],active:!0}],localTime:[],skip:[],yDomain:[0,1],xLength:this.xLength,labels:{title:"memory",keys:["vsize","resident","mapped"],yAxis:"GB"},keyLength:6,paused:!1}},mem:function(e,t,n){if(!e&&t&&"localTime"in t&&"mem"in t){if(this.starting)return void(this.starting=!1);let e,s;if(this.localTime.length>0&&t.localTime.getTime()-this.localTime[this.localTime.length-1].getTime()<500)return;const a=this.localTime.length>0&&t.localTime-this.localTime[this.localTime.length-1]>2e3;n&&!this.isPaused?(this.isPaused=!0,this.endPause=this.localTime.length):!n&&this.isPaused?(this.isPaused=!1,this.endPause=this.localTime.length+1):n||this.isPaused||(this.endPause++,a&&this.endPause++);const i=Math.max(this.endPause-this.xLength,0);r(this.data.dataSets,(e=>!o(t.mem,e.line)));for(let n=0;n<this.data.dataSets.length;n++)e=this.data.dataSets[n].line,s=l(t.mem[e]/1e3,2),this.totalCount[e].push(s),a&&this.totalCount[e].push(s),this.data.dataSets[n].count=this.totalCount[e].slice(i,this.endPause);const d=[1];for(let e=0;e<this.data.dataSets.length;e++)d.push(c(this.data.dataSets[e].count));a&&(this.localTime.push(new Date(t.localTime.getTime()-1e3)),this.currentMaxs.push(c(d)),this.skip.push(a)),this.skip.push(!1),this.currentMaxs.push(c(d)),this.localTime.push(t.localTime),this.data.skip=this.skip.slice(i,this.endPause),this.data.yDomain=[0,this.currentMaxs[this.endPause-1]],this.data.localTime=this.localTime.slice(i,this.endPause),this.data.paused=n}this.trigger(e,this.data)}});e.exports=d},73661:(e,t,n)=>{const s=n(10862),a=n(20045),i=n(64632),r=n(40398),o=n(54954),l=s.createStore({init:function(){this.restart(),this.listenTo(i,this.network),this.listenTo(a.restart,this.restart)},restart:function(){this.bytesPerSec={bytesIn:[],bytesOut:[]},this.connectionCount=[],this.localTime=[],this.skip=[],this.currentMaxs=[],this.secondCurrentMaxs=[],this.starting=!0,this.xLength=60,this.endPause=0,this.isPaused=!1,this.data={dataSets:[{line:"bytesIn",count:[],active:!0,current:0},{line:"bytesOut",count:[],active:!0,current:0}],localTime:[],skip:[],yDomain:[0,1],xLength:this.xLength,labels:{title:"network",keys:["net in","net out","connections"],yAxis:"KB"},keyLength:6,secondScale:{line:"connections",count:[],active:!0,currentMax:1,units:"conn"},paused:!1}},network:function(e,t,n){if(!e&&t&&"localTime"in t&&"network"in t){let e,s,a;if(this.localTime.length>0&&t.localTime.getTime()-this.localTime[this.localTime.length-1].getTime()<500)return;const i=this.localTime.length>0&&t.localTime-this.localTime[this.localTime.length-1]>2e3;n&&!this.isPaused?(this.isPaused=!0,this.endPause=this.localTime.length):!n&&this.isPaused?(this.isPaused=!1,this.endPause=this.localTime.length+1):n||this.isPaused||this.starting||(this.endPause++,i&&this.endPause++);const l=Math.max(this.endPause-this.xLength,0);for(let n=0;n<this.data.dataSets.length;n++)e=this.data.dataSets[n].line,a=r(t.network[e]/1e3,2),this.starting||(s=r(Math.max(0,a-this.data.dataSets[n].current,2)),this.bytesPerSec[e].push(s),i&&this.bytesPerSec[e].push(s),this.data.dataSets[n].count=this.bytesPerSec[e].slice(l,this.endPause)),this.data.dataSets[n].current=a;if(this.starting)return void(this.starting=!1);const c=[1];for(let e=0;e<this.data.dataSets.length;e++)c.push(o(this.data.dataSets[e].count));this.currentMaxs.push(r(o(c),2));const d=t.connections.current;this.connectionCount.push(d),i&&(this.connectionCount.push(d),this.localTime.push(new Date(t.localTime.getTime()-1e3)),this.currentMaxs.push(o(c)),this.secondCurrentMaxs.push(o(this.data.secondScale.count)),this.skip.push(i)),this.skip.push(!1),this.data.secondScale.count=this.connectionCount.slice(l,this.endPause),this.secondCurrentMaxs.push(o(this.data.secondScale.count)),this.data.secondScale.currentMax=this.secondCurrentMaxs[this.endPause-1],this.data.yDomain=[0,this.currentMaxs[this.endPause-1]],this.localTime.push(t.localTime),this.data.localTime=this.localTime.slice(l,this.endPause),this.data.skip=this.skip.slice(l,this.endPause),this.data.paused=n}this.trigger(e,this.data)}});e.exports=l},9854:(e,t,n)=>{const s=n(10862),a=n(20045),i=n(64632),r=n(54954),o=s.createStore({init:function(){this.restart(),this.listenTo(i,this.opCounter),this.listenTo(a.restart,this.restart)},restart:function(){this.opsPerSec={insert:[],query:[],update:[],delete:[],command:[],getmore:[]},this.localTime=[],this.skip=[],this.currentMaxs=[],this.starting=!0,this.xLength=60,this.endPause=0,this.isPaused=!1,this.data={dataSets:[{line:"insert",count:[],active:!0,current:0},{line:"query",count:[],active:!0,current:0},{line:"update",count:[],active:!0,current:0},{line:"delete",count:[],active:!0,current:0},{line:"command",count:[],active:!0,current:0},{line:"getmore",count:[],active:!0,current:0}],localTime:[],skip:[],yDomain:[0,1],xLength:this.xLength,labels:{title:"operations",keys:["inserts","queries","updates","deletes","commands","getmores"],yAxis:"ops"},keyLength:6,paused:!1,trigger:!0}},opCounter:function(e,t,n){if(!e&&t&&"localTime"in t&&"opcounters"in t){let e,s,a;if(this.localTime.length>0&&t.localTime.getTime()-this.localTime[this.localTime.length-1].getTime()<500)return;const i=this.localTime.length>0&&t.localTime-this.localTime[this.localTime.length-1]>2e3;n&&!this.isPaused?(this.isPaused=!0,this.endPause=this.localTime.length):!n&&this.isPaused?(this.isPaused=!1,this.endPause=this.localTime.length+1):n||this.isPaused||this.starting||(this.endPause++,i&&this.endPause++);const o=Math.max(this.endPause-this.xLength,0);for(let n=0;n<this.data.dataSets.length;n++)e=this.data.dataSets[n].line,a=t.opcounters[e],this.starting||(s=Math.max(0,a-this.data.dataSets[n].current),this.opsPerSec[e].push(s),i&&this.opsPerSec[e].push(s),this.data.dataSets[n].count=this.opsPerSec[e].slice(o,this.endPause)),this.data.dataSets[n].current=a;if(this.starting)return void(this.starting=!1);const l=[1];for(let e=0;e<this.data.dataSets.length;e++)l.push(r(this.data.dataSets[e].count));i&&(this.localTime.push(new Date(t.localTime.getTime()-1e3)),this.currentMaxs.push(r(l)),this.skip.push(i)),this.skip.push(!1),this.currentMaxs.push(r(l)),this.localTime.push(t.localTime),this.data.yDomain=[0,this.currentMaxs[this.endPause-1]],this.data.localTime=this.localTime.slice(o,this.endPause),this.data.skip=this.skip.slice(o,this.endPause),this.data.paused=n}this.trigger(e,this.data)}});e.exports=o},64632:(e,t,n)=>{const s=n(10862),a=n(20045),i=s.createStore({init:function(){this.restart(),this.listenTo(a.serverStats,this.serverStats),this.listenTo(a.restart,this.restart),this.listenTo(a.pause,this.pause)},onActivated:function(e){e.on("data-service-connected",((e,t)=>{e||(this.dataService=t,this.isMongos=t.isMongos(),this.isWritable=t.isWritable())}))},restart:function(){this.isPaused=!1},serverStats:function(){this.dataService&&this.dataService.serverstats(((e,t)=>{null===e&&null!==this.error?a.dbError({op:"serverStatus",error:null}):null!==e&&a.dbError({op:"serverStatus",error:e}),this.trigger(e,t,this.isPaused)}))},pause:function(){this.isPaused=!this.isPaused}});e.exports=i},28823:(e,t,n)=>{const s=n(10862),a=n(20045),i=n(84935),r=n(40398),o=n(53268)("mongodb-compass:server-stats:top-store"),l=s.createStore({init:function(){this.restart(),this.listenTo(a.top,this.topDelta),this.listenTo(a.pause,this.pause),this.listenTo(a.restart,this.restart),this.listenTo(a.mouseOver,this.mouseOver),this.listenTo(a.mouseOut,this.mouseOut)},onActivated:function(e){e.on("data-service-connected",((e,t)=>{if(e)throw e;this.dataService=t,this.isMongos=t.isMongos()}))},restart:function(){this.allOps=[],this.errored=[],this.isPaused=!1,this.endPause=0,this.overlayIndex=0,this.inOverlay=!1,this.xLength=60,this.starting=!0,this.t1s={},this.disableTop=!1},pause:function(){this.endPause=this.allOps.length,this.isPaused=!this.isPaused},mouseOver:function(e){const t=Math.max(this.endPause-this.xLength,0),n=this.allOps.slice(t,this.endPause),s=this.errored.slice(t,this.endPause);e>=n.length&&(e=n.length-1),this.overlayIndex=e,this.inOverlay=!0;const a=0===n.length?[]:n[this.overlayIndex];this.trigger(s[this.overlayIndex],a)},mouseOut:function(){this.inOverlay=!1;const e=Math.max(this.endPause-this.xLength,0),t=this.allOps.slice(e,this.endPause),n=this.errored.slice(e,this.endPause),s=0===t.length?[]:t[t.length-1];this.trigger(n[this.overlayIndex],s)},topDelta:function(){this.isMongos||this.dataService&&this.dataService.top(((e,t)=>{null===e&&this.errored.length>0&&null!==this.errored[this.errored.length-1]?a.dbError({op:"top",error:null}):null!==e&&a.dbError({op:"top",error:e}),this.errored.push(e),(null!==e||this.starting)&&this.allOps.push([]);let n=[];if(null===e){let e={};void 0!==t&&"totals"in t&&(e=t.totals);const s=global.hadronApp.instance.host.cpu_cores,a=1e6,l={};for(let t in e){if(!e.hasOwnProperty(t)||"note"===t||i(t).specialish)continue;const n=e[t];"readLock"in n&&"writeLock"in n&&"total"in n||o("Error: top response from DB missing fields",n),l[t]={loadPercentR:n.readLock.time,loadPercentL:n.writeLock.time,loadPercent:n.total.time}}if(this.starting)return this.t1s=l,void(this.starting=!1);for(let e in l){if(!l.hasOwnProperty(e))continue;const t=e in this.t1s?this.t1s[e]:{loadPercent:0,loadPercentR:0,loadPercentL:0},i=l[e],o=i.loadPercent-t.loadPercent,c=0===o?0:r((i.loadPercentL-t.loadPercentL)/o*100,0),d=0===o?0:r((i.loadPercentR-t.loadPercentR)/o*100,0);n.push({collectionName:e,loadPercent:r(100*o/(a*s),2),loadPercentR:d,loadPercentL:c})}this.t1s=l,n.sort((function(e,t){const n=t.loadPercent<e.loadPercent?-1:0;return e.loadPercent<t.loadPercent?1:n})),this.allOps.push(n)}this.isPaused?(n=this.allOps[this.endPause],e=this.errored[this.endPause]):this.endPause=this.allOps.length,this.inOverlay||this.trigger(e,n)}))}});e.exports=l},6975:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>T,deactivate:()=>A,default:()=>R,metadata:()=>k});var s=n(2784),a=n(59337),i=n(18717),r=n(39752),o=n.n(r);const{WorkerRuntime:l}=(()=>{const e=require,t=e.resolve("@mongosh/node-runtime-worker-thread");if(/\.asar(?!\.unpacked)/.test(t))try{return e(t.replace(".asar",".asar.unpacked"))}catch(e){throw e.message+="\n\n@mongosh/node-runtime-worker-thread module and all its dependencies needs to be unpacked before it can be used",e}return e(t)})(),c="shell/runtime/SETUP_RUNTIME",d={error:null,dataService:null,runtime:null},p=(e,t,n)=>({type:c,error:e,dataService:t,appRegistry:n}),u=(0,i.combineReducers)({appRegistry:o(),runtime:function(e=d,t){return t.type===c?function(e,t){if(t.error||!t.dataService)return{error:t.error,dataService:null,runtime:null};if(e.dataService===t.dataService)return e;const n=function(e,t){const{url:n,options:s,cliOptions:a}=e.getMongoClientConnectionOptions();return new l(n,s,a??{},{env:{...process.env,ELECTRON_RUN_AS_NODE:1},serialization:"advanced"},t)}(t.dataService,t.appRegistry);return{error:t.error,dataService:t.dataService,runtime:n}}(e,t):e}});var m=n(15861),h=n(6909);const{log:g,debug:b,track:y}=(0,h.default)("COMPASS-SHELL"),{remote:f}=n(72298),v=n(71017);var E=n(57147),S=n.n(E),x=n(71017),w=n.n(x);class C{constructor(e){this.filePath=e}async save(e){const t=w().dirname(this.filePath);try{await S().promises.mkdir(t,{recursive:!0})}catch(e){if("EEXIST"!==e.code)throw e}await S().promises.writeFile(this.filePath,JSON.stringify(e))}async load(){if(!await this._canAccess(this.filePath))return[];const e=await S().promises.readFile(this.filePath,"utf-8");return JSON.parse(e)}async _canAccess(e){try{return await S().promises.access(e),!0}catch(e){return!1}}}var k=n(49245);const{store:N,Plugin:_}=function(){const e=new class{constructor(){this.reduxStore=(0,i.createStore)(u)}globalAppRegistry=null;onActivated(e){b("activated"),this.globalAppRegistry=e,e.on("data-service-connected",this.onDataServiceConnected),e.on("data-service-disconnected",this.onDataServiceDisconnected),(0,m.uX)(e,g.unbound,{identify:()=>{},track:({event:e,properties:t})=>y(`Shell ${e}`,t)},{platform:process.platform,arch:process.arch},n(49245).version),e.emit("mongosh:new-user","<compass user>"),this.reduxStore.dispatch((0,r.globalAppRegistryActivated)(e))}onDataServiceConnected=(e,t)=>{this.reduxStore.dispatch(p(e,t,this.globalAppRegistry))};onDataServiceDisconnected=()=>{const{runtime:{runtime:e}}=this.reduxStore.getState();e&&e.terminate(),this.reduxStore.dispatch(p(null,null,null))}};return{store:e,Plugin:function(){const[t,i]=(0,s.useState)(null),r=(0,s.useRef)(null);if(!r.current){const e=function(e){if(!f)return;const t=f.app;return t?v.join(t.getPath("userData"),t.getName(),"shell-history.json"):void 0}();e&&(r.current=new C(e))}return(0,s.useEffect)((()=>{let e=!0;return Promise.all([n.e(379),n.e(183)]).then(n.bind(n,38183)).then((({default:t})=>{e&&i(t)})),()=>{e=!1}}),[]),t?s.createElement(a.zt,{store:e.reduxStore},s.createElement(t,{historyStorage:r.current})):null}}}();function T(e){e.registerComponent("Global.Shell",_),e.registerStore("CompassShell.Store",N)}function A(e){e.registerComponent("Global.Shell",_),e.deregisterStore("CompassShell.Store")}const R=_},64659:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>Le,deactivate:()=>je,default:()=>Me,metadata:()=>Ie});var s=n(2784),a=n(16435),i=n(13980),r=n.n(i),o=n(39752),l=n.n(o),c=n(50517),d=n(72779),p=n.n(d);const u={"compass-sidebar":"sidebar-module-compass-sidebar__2h8Sm","compass-sidebar-toggle":"sidebar-module-compass-sidebar-toggle__2ykfN","compass-sidebar-properties":"sidebar-module-compass-sidebar-properties__1vbyo","compass-sidebar-filter":"sidebar-module-compass-sidebar-filter__20hxr","compass-sidebar-search-icon":"sidebar-module-compass-sidebar-search-icon__3xZdl","compass-sidebar-search-input":"sidebar-module-compass-sidebar-search-input__38jZa","compass-sidebar-content":"sidebar-module-compass-sidebar-content__1i8lh","compass-sidebar-button-create-database-container":"sidebar-module-compass-sidebar-button-create-database-container__3bjv2","compass-sidebar-button-create-database":"sidebar-module-compass-sidebar-button-create-database__2aaJT","plus-button":"sidebar-module-plus-button__z8aJ7","compass-sidebar-button-is-disabled":"sidebar-module-compass-sidebar-button-is-disabled__3SOm3","compass-sidebar-collapsed":"sidebar-module-compass-sidebar-collapsed__1OaX1","compass-sidebar-item":"sidebar-module-compass-sidebar-item__2Cdix","compass-sidebar-property-column":"sidebar-module-compass-sidebar-property-column__2S0_P","compass-sidebar-instance-hostname":"sidebar-module-compass-sidebar-instance-hostname__3Fodo","compass-sidebar-instance-version":"sidebar-module-compass-sidebar-instance-version__23k7_","compass-sidebar-instance-ssh-tunnel":"sidebar-module-compass-sidebar-instance-ssh-tunnel__bUBnq","compass-sidebar-instance":"sidebar-module-compass-sidebar-instance__SP0BG","compass-sidebar-stats":"sidebar-module-compass-sidebar-stats__QABxL","compass-sidebar-collapsed-refresh-button":"sidebar-module-compass-sidebar-collapsed-refresh-button__2w3Gh","compass-sidebar-autosizer-list":"sidebar-module-compass-sidebar-autosizer-list__3IwI5"};var m=n(29487),h=n(84935),g=n.n(h);const b="sidebar/databases/CHANGE_FILTER_REGEX",y="sidebar/databases/CHANGE_DATABASES",f="sidebar/databases/CHANGE_ACTIVE_NAMESPACE",v="sidebar/databases/TOGGLE_DATABASE",E={databases:[],filteredDatabases:[],expandedDbList:{},activeNamespace:"",filterRegex:null},S=e=>({type:f,activeNamespace:e,activeDatabase:g()(e).database}),x=(e,t)=>t?e.reduce(((e,n)=>{const s=n._id;if(t.test(s))e.push(n);else{const s=n.collections.filter((e=>t.test(e.name)));s.length>0&&e.push({...n,collections:s})}return e}),[]):e,w=({connectionInfo:e})=>{const t=!!e.favorite;return s.createElement("div",{style:t?{backgroundColor:e.favorite.color||"transparent"}:{},className:"sidebar-title-module-sidebar-title-logo__3355M"},s.createElement(c.MongoDBLogoMark,{color:"white"}))};w.propTypes={connectionInfo:r().object.isRequired};const C=({connectionInfo:e})=>s.createElement("div",{className:"sidebar-title-module-sidebar-title-name__3ixTo"},(0,m.getConnectionTitle)(e));C.propTypes={connectionInfo:r().object.isRequired};const k=({activeNamespace:e,connectionInfo:t,isSidebarExpanded:n,onClick:a})=>s.createElement("div",{className:p()("sidebar-title-module-sidebar-title__w3Bll",{"sidebar-title-module-sidebar-title-is-active__2Rh_T":""===e}),"data-test-id":"sidebar-title",onClick:a},n?s.createElement(C,{connectionInfo:t}):s.createElement(w,{connectionInfo:t}));k.displayName="SidebarTitleComponent",k.propTypes={activeNamespace:r().string.isRequired,connectionInfo:r().object.isRequired,isSidebarExpanded:r().bool.isRequired,onClick:r().func.isRequired};const N=(0,a.$j)((e=>({activeNamespace:e.databases.activeNamespace})))(k);var _=n(69089);const T="sidebar-instance-stats-module-sidebar-instance-stats-column__3GdbR",A="sidebar-instance-stats-module-sidebar-instance-stats-strong-property__1fpLG";class R extends s.PureComponent{static propTypes={instance:r().object,databases:r().array,isExpanded:r().bool.isRequired,toggleIsExpanded:r().func.isRequired,globalAppRegistryEmit:r().func.isRequired};onRefresh=()=>{this.props.globalAppRegistryEmit("refresh-data")};onToggleExpanded=()=>{this.props.toggleIsExpanded(!this.props.isExpanded)};getArrowIconClasses(){const e=this.props.isExpanded?"fa fa-rotate-90":"";return p()("mms-icon-right-arrow",e)}render(){const{instance:e,databases:t}=this.props;let n=t.length,a=t.map((e=>e.collectionsLength)).reduce(((e,t)=>e+t),0),i="fa fa-repeat";const r=!e||["initial","fetching","refreshing"].includes(e.refreshingStatus);return r&&(i="fa fa-refresh fa-spin"),(!e||["initial","fetching"].includes(e.refreshingStatus))&&(n="-",a="-"),s.createElement("div",{className:"sidebar-instance-stats-module-sidebar-instance-stats__2Ophp"},s.createElement("div",{className:"sidebar-instance-stats-module-sidebar-instance-stats-expand__3xI2Q",onClick:this.onToggleExpanded},s.createElement("i",{className:this.getArrowIconClasses()})),s.createElement("div",{className:T},s.createElement("span",{id:"sidebar-instance-stats-dbs",className:A},n)," DBs"),s.createElement("div",{className:T},s.createElement("span",{id:"sidebar-instance-stats-collections",className:A},a)," Collections"),s.createElement("div",{className:"sidebar-instance-stats-module-sidebar-instance-stats-refresh-button-container__3HKuS"},s.createElement("button",{onClick:this.onRefresh,className:"sidebar-instance-stats-module-sidebar-instance-stats-refresh-button__2sOlC",disabled:r},s.createElement("i",{className:i}))))}}const O=R;class D extends s.PureComponent{static displayName="SidebarInstanceDetails";static propTypes={isExpanded:r().bool.isRequired,detailsPlugins:r().array.isRequired};constructor(e){super(e),this.details=e.detailsPlugins.map(((e,t)=>s.createElement(e.component,{key:t})))}renderPlugins(){if(this.props.isExpanded)return s.createElement("div",{className:"sidebar-instance-details-module-sidebar-instance-details-container__7rAJd"},this.details)}render(){return s.createElement("div",{className:"sidebar-instance-details-module-sidebar-instance-details___3v6M"},this.renderPlugins())}}const P=D;var I=n(12170),L=n.n(I);class j extends s.PureComponent{static displayName="NonGenuineWarningPill";static propTypes={isGenuineMongoDB:r().bool.isRequired};render(){return this.props.isGenuineMongoDB?null:s.createElement("div",{className:"non-genuine-warning-pill-module-non-genuine-warning-pill__21U_j"},s.createElement("div",{className:"non-genuine-warning-pill-module-non-genuine-warning-pill-text__3U38b"},s.createElement(L(),{name:"exclamation-circle"}),"Â NON-GENUINE MONGODB"))}}const M=j,q=({favoriteOptions:e,toggleIsFavoriteModalVisible:t})=>{const n=!!e,a={backgroundColor:"#243642",color:n?"#ffffff":"#88989a"},i=(0,c.useFocusRing)(),r=(0,c.mergeProps)({type:"button","aria-label":"Edit saved connection",title:"Edit saved connection",onClick:()=>t(),className:"favorite-button-module-favorite-button-text__1ULd8",style:a},i);return s.createElement("div",{className:"favorite-button-module-favorite-button__w4i4o"},s.createElement("button",r,s.createElement(c.FavoriteIcon,{darkMode:!0,isFavorite:n,favoriteColor:"#ffffff",showCircle:!1,size:18}),"FAVORITE"))};q.displayName="FavoriteButton",q.propTypes={favoriteOptions:r().object,toggleIsFavoriteModalVisible:r().func.isRequired};const F=q;var V=n(76635);const B=({instance:e,databases:t,isExpanded:n,isGenuineMongoDB:a,toggleIsDetailsExpanded:i,globalAppRegistryEmit:r,detailsPlugins:o,connectionInfo:l,updateConnectionInfo:c})=>{const[d,p]=(0,s.useState)(!1),u=(0,s.useCallback)((e=>{c({...(0,V.cloneDeep)(l),favorite:e}),p(!1)}),[l,c,p]);return s.createElement("div",{className:"sidebar-instance-module-sidebar-instance__KCGVJ"},s.createElement(O,{instance:e,databases:t,isExpanded:n,toggleIsExpanded:i,globalAppRegistryEmit:r}),s.createElement(F,{favoriteOptions:l.favorite,toggleIsFavoriteModalVisible:()=>p(!d)}),s.createElement(_.dy,{initialFavoriteInfo:l.favorite,open:d,onCancelClicked:()=>p(!1),onSaveClicked:e=>u(e)}),s.createElement(M,{isGenuineMongoDB:a}),s.createElement(P,{detailsPlugins:o,isExpanded:n}))};B.displayName="SidebarInstance",B.propTypes={instance:r().object,databases:r().array,isExpanded:r().bool.isRequired,isGenuineMongoDB:r().bool.isRequired,toggleIsDetailsExpanded:r().func.isRequired,globalAppRegistryEmit:r().func.isRequired,detailsPlugins:r().array.isRequired,connectionInfo:r().object.isRequired,updateConnectionInfo:r().func.isRequired};const U=B,H=(0,c.css)({padding:"initial"}),$=(0,c.css)({padding:c.spacing[5]}),z=(0,c.css)({marginTop:c.spacing[3],marginBottom:c.spacing[2]});function G({isVisible:e,toggleIsVisible:t}){const n=(0,s.useCallback)((()=>{t(!1)}),[t]);return s.createElement(c.Modal,{open:e,trackingId:"non_genuine_mongodb_modal",setOpen:n,contentClassName:H},s.createElement("div",{className:$},s.createElement(c.ModalTitle,null,"Non-Genuine MongoDB Detected"),s.createElement(c.Banner,{variant:c.BannerVariant.Warning},"This server or service appears to be an emulation of MongoDB rather than an official MongoDB product."),s.createElement(c.Body,{className:z},"Some documented MongoDB features may work differently, be entirely missing or incomplete, or have unexpected performance characteristics. "),s.createElement(c.Link,{href:"https://docs.mongodb.com/compass/master/faq/#how-does-compass-determine-a-connection-is-not-genuine",target:"_blank","data-test-id":"non-genuine-warning-modal-learn-more-link"},"Learn more")),s.createElement(c.ModalFooter,null,s.createElement(c.Button,{onClick:n,variant:c.ButtonVariant.Primary,"data-test-id":"continue-button"},"Continue")))}G.displayName="NonGenuineWarningModal",G.propTypes={isVisible:r().bool.isRequired,toggleIsVisible:r().func.isRequired};const Q=G;var W=n(58252);const K=(0,a.$j)((function(e){const{databases:{filterRegex:t,filteredDatabases:n,expandedDbList:s,activeNamespace:a},instance:i}=e,r=!["initial","fetching"].includes(i?.databasesStatus),o=Boolean(t),l=Object.fromEntries(n.map((({name:e})=>[e,s[e]??o])));return{isReady:r,isReadOnly:e.isDataLake||!e.isWritable,activeNamespace:a,databases:n,expanded:l}}),{onDatabaseExpand:(e,t)=>(n,s)=>{const{appRegistry:a,databases:i}=s(),r=t??!i.expandedDbList[e];a.globalAppRegistry&&r&&a.globalAppRegistry.emit("sidebar-expand-database",e),n({type:v,id:e,expanded:r})},onNamespaceAction:(e,t)=>n=>{const s=(...e)=>n((0,o.globalAppRegistryEmit)(...e)),a=g()(e);switch(t){case"select-database":return void s("select-database",a.database);case"select-collection":return void s("sidebar-select-collection",a);case"drop-database":return void s("open-drop-database",a.database);case"drop-collection":return void s("open-drop-collection",a);case"create-collection":return void s("open-create-collection",a);case"open-in-new-tab":return void s("sidebar-open-collection-in-new-tab",a);case"modify-view":return void s("sidebar-modify-view",a);case"duplicate-view":s("sidebar-duplicate-view",a)}}})(W.Z),Z="sidebar/is-details-expanded/TOGGLE_IS_DETAILS_EXPANDED",X="sidebar/is-genuine-mongodb-visible/TOGGLE_IS_GENUINE_MONGODB_VISIBLE",Y=e=>({type:X,isVisible:e});var J=n(6909);const{debug:ee}=(0,J.createLoggerAndTelemetry)("COMPASS-SIDEBAR"),te="sidebar/connection/CHANGE_CONNECTION_INFO",ne="sidebar/connection/SAVE_CONNECTION_INFO",se={connectionInfo:{connectionOptions:{connectionString:"mongodb://localhost:27017"}},connectionStorage:new m.ConnectionStorage},ae={[te]:(e,t)=>({...e,connectionInfo:t.connectionInfo}),[ne]:(e,t)=>(async function(e,t){try{await t.save(e),ee(`saved connection with id ${e.id||""}`)}catch(t){ee(`error saving connection with id ${e.id||""}: ${t.message}`)}}(t.connectionInfo,e.connectionStorage),{...e,connectionInfo:t.connectionInfo})},ie=[{icon:"CurlyBraces",label:"My Queries",tabName:"My Queries"},{icon:"Database",label:"Databases",tabName:"Databases"}],re=(0,c.css)({margin:0,padding:0,listStyle:"none"}),oe=(0,c.css)({width:"100%",display:"flex",alignItems:"center",margin:0,padding:0,background:"none",border:"none",backgroundColor:c.uiColors.gray.dark2,":hover":{cursor:"pointer",backgroundColor:c.uiColors.gray.dark3}}),le=(0,c.css)({padding:10,boxSizing:"content-box",fontSize:0}),ce=(0,c.css)({display:"none"}),de=({label:e,icon:t,onItemClick:n,isExpanded:a})=>{const i=(0,c.useFocusRing)(),r=(0,c.mergeProps)({type:"button","aria-label":`Open "${e}" tab`,title:e,onClick:n,className:oe},i);return s.createElement("button",r,s.createElement(c.Icon,{title:null,glyph:t,className:le}),s.createElement("span",{className:a?void 0:ce},e))};de.propTypes={label:r().string,icon:r().string,onItemClick:r().func,isExpanded:r().bool};const pe=({onItemClick:e,isExpanded:t})=>s.createElement("nav",null,s.createElement("ul",{className:re},ie.map(((n,a)=>s.createElement(de,{key:`${a}-${n.tabName}`,label:n.label,icon:n.icon,onItemClick:()=>e(n.tabName),isExpanded:t})))));pe.propTypes={onItemClick:r().func,isExpanded:r().bool};const ue=160;function me(){return Math.max(ue,window.innerWidth-100)}class he extends s.PureComponent{static displayName="Sidebar";static propTypes={instance:r().object.isRequired,databases:r().array.isRequired,isDetailsExpanded:r().bool.isRequired,isWritable:r().bool.isRequired,toggleIsDetailsExpanded:r().func.isRequired,detailsPlugins:r().array.isRequired,changeFilterRegex:r().func.isRequired,isDataLake:r().bool.isRequired,isGenuineMongoDB:r().bool.isRequired,isGenuineMongoDBVisible:r().bool.isRequired,toggleIsGenuineMongoDBVisible:r().func.isRequired,globalAppRegistryEmit:r().func.isRequired,connectionInfo:r().object.isRequired,updateAndSaveConnectionInfo:r().func.isRequired};state={width:250,prevWidth:250};onNavigationItemClick(e){this.props.globalAppRegistryEmit("open-instance-workspace",e)}updateWidth(e){this.setState(e>ue?{width:e,prevWidth:e}:{width:e})}handleSearchFocus(){this.state.width<ue&&this.updateWidth(this.state.prevWidth),this.refs.filter.focus()}handleFilter(e){const t=e.target.value;let n;try{n=t?new RegExp(t,"i"):null}catch(e){n=null}this.props.changeFilterRegex(n)}handleCreateDatabaseClick(e){e&&this.props.globalAppRegistryEmit("open-create-database")}isReadonlyDistro(){return!1}renderCreateDatabaseButton(){if(!this.isReadonlyDistro()&&!this.props.isDataLake){const e=this.props.isWritable?"":u["compass-sidebar-button-is-disabled"],t=p()(u["compass-sidebar-button-create-database"],u[e]);return s.createElement("div",{className:p()(u["compass-sidebar-button-create-database-container"])},s.createElement("button",{className:t,title:"Create Database","data-test-id":"create-database-button",onClick:this.handleCreateDatabaseClick.bind(this,this.props.isWritable)},s.createElement("i",{className:"mms-icon-add"}),s.createElement("div",{className:p()(u["plus-button"])},"Create Database")))}}render(){const{width:e,prevWidth:t}=this.state,n=e>ue,a=n?function(e){const t=me();return Math.min(t,Math.max(ue,e))}(e):36,i="fa"+(n?" fa-caret-left":" fa-caret-right");return s.createElement("div",{className:p()(u["compass-sidebar"],{[u["compass-sidebar-collapsed"]]:!n}),"data-test-id":"compass-sidebar-panel",style:{width:a}},s.createElement(c.ResizeHandle,{onChange:e=>this.updateWidth(e),direction:c.ResizeDirection.RIGHT,value:e,minValue:36,maxValue:me(),title:"sidebar"}),s.createElement("button",{className:p()(u["compass-sidebar-toggle"],"btn btn-default btn-sm"),onClick:()=>n?this.updateWidth(36):this.updateWidth(t),"data-test-id":"toggle-sidebar"},s.createElement("i",{className:i})),s.createElement(N,{connectionInfo:this.props.connectionInfo,isSidebarExpanded:n,onClick:()=>this.onNavigationItemClick()}),n&&s.createElement(U,{instance:this.props.instance,databases:this.props.databases,isExpanded:this.props.isDetailsExpanded,detailsPlugins:this.props.detailsPlugins,isGenuineMongoDB:this.props.isGenuineMongoDB,toggleIsDetailsExpanded:this.props.toggleIsDetailsExpanded,globalAppRegistryEmit:this.props.globalAppRegistryEmit,connectionInfo:this.props.connectionInfo,updateConnectionInfo:this.props.updateAndSaveConnectionInfo}),s.createElement(pe,{onItemClick:e=>this.onNavigationItemClick(e),isExpanded:n}),s.createElement("div",{className:u["compass-sidebar-filter"],onClick:this.handleSearchFocus.bind(this)},s.createElement("i",{className:p()("fa","fa-search",u["compass-sidebar-search-icon"])}),s.createElement("input",{"data-test-id":"sidebar-filter-input",ref:"filter",className:u["compass-sidebar-search-input"],placeholder:"Filter your data",onChange:this.handleFilter.bind(this)})),s.createElement("div",{className:u["compass-sidebar-content"]},n&&s.createElement(K,null),this.renderCreateDatabaseButton()),s.createElement(Q,{isVisible:this.props.isGenuineMongoDBVisible,toggleIsVisible:this.props.toggleIsGenuineMongoDBVisible}))}}const ge=(0,a.$j)((e=>({connectionInfo:e.connectionInfo.connectionInfo,instance:e.instance,databases:e.databases.databases,isDetailsExpanded:e.isDetailsExpanded,isWritable:e.isWritable,detailsPlugins:e.detailsPlugins,isDataLake:e.isDataLake,isGenuineMongoDB:e.isGenuineMongoDB,isGenuineMongoDBVisible:e.isGenuineMongoDBVisible})),{toggleIsDetailsExpanded:e=>({type:Z,isExpanded:e}),toggleIsGenuineMongoDBVisible:Y,changeFilterRegex:e=>(t,n)=>{const{appRegistry:s}=n();s.globalAppRegistry&&e&&s.globalAppRegistry.emit("sidebar-filter-navigation-list"),t({type:b,filterRegex:e})},globalAppRegistryEmit:o.globalAppRegistryEmit,updateAndSaveConnectionInfo:e=>({type:ne,connectionInfo:e})})(he);var be=n(18717),ye=n(12436),fe=n.n(ye);const ve="sidebar/details-plugins/LOAD_DETAILS_PLUGINS",Ee=[],Se="sidebar/description/CHANGE_DESCRIPTION",xe="Topology type not yet discovered.",we="sidebar/instance/CHANGE_INSTANCE",Ce="sidebar/is-writable/TOGGLE_IS_WRITABLE",ke="sidebar/is-data-lake/TOGGLE_IS_DATA_LAKE",Ne="sidebar/reset",_e="sidebar/is-genuine-mongodb/TOGGLE_IS_GENUINE_MONGODB",Te=(0,be.combineReducers)({appRegistry:l(),databases:function(e=E,t){if(t.type===v)return{...e,expandedDbList:{...e.expandedDbList,[t.id]:t.expanded}};if(t.type===b){const n=Boolean(e.filterRegex&&!t.filterRegex)||Boolean(!e.filterRegex&&t.filterRegex);let s=e.expandedDbList;return n&&(s=Object.fromEntries(Object.entries(s).filter((([,e])=>!1!==e)))),{...e,filterRegex:t.filterRegex,filteredDatabases:x(e.databases,t.filterRegex),expandedDbList:s}}return t.type===f?{...e,activeNamespace:t.activeNamespace,...t.activeDatabase&&{expandedDbList:{...e.expandedDbList,[t.activeDatabase]:!0}}}:t.type===y?{...e,databases:t.databases,filteredDatabases:x(t.databases,e.filterRegex)}:e},connectionInfo:function(e=se,t){const n=ae[t.type];return n?n(e,t):e},description:(e=xe,t)=>t.type===Se?t.description:e,detailsPlugins:(e=Ee,t)=>t.type===ve?t.roles:e,instance:function(e=null,t){return t.type===we?t.instance:e},isDetailsExpanded:function(e=!0,t){return t.type===Z?t.isExpanded:e},isWritable:(e=!0,t)=>t.type===Ce?t.isWritable:e,isGenuineMongoDB:function(e=!0,t){return t.type===_e?t.isGenuineMongoDB:e},isGenuineMongoDBVisible:function(e=!1,t){return t.type===X?t.isVisible:e},isDataLake:(e=!1,t)=>t.type===ke?t.isDataLake:e});var Ae=n(43292);const Re=(0,be.createStore)(((e,t)=>t.type===Ne?{...e,connectionInfo:se,databases:E,description:xe,instance:null,isDetailsExpanded:!0,isWritable:!0,isGenuineMongoDB:!0,isGenuineMongoDBVisible:!1,isDataLake:!1}:Te(e,t)),(0,be.applyMiddleware)(Ae.Z));Re.onActivated=e=>{const t=fe()((e=>{Re.dispatch((e=>({type:we,instance:e}))({refreshingStatus:e.refreshingStatus,databasesStatus:e.databasesStatus}))}),300);function n(e){return{_id:e._id,name:e.name,collectionsStatus:e.collectionsStatus,collectionsLength:e.collectionsLength}}const s=fe()((e=>{const t=e.map((e=>({...n(e),collections:e.collections.map((e=>function(e){return{_id:e._id,name:e.name,type:e.type}}(e)))})));Re.dispatch((e=>({type:y,databases:e}))(t))}),300);Re.dispatch((0,o.globalAppRegistryActivated)(e)),Re.dispatch((e=>({type:ve,roles:e.getRole("InstanceDetails.Item")||[]}))(e)),e.on("data-service-connected",((e,t,n)=>{Re.dispatch((e=>({type:te,connectionInfo:e}))(n))})),e.on("instance-destroyed",(()=>{t.cancel(),s.cancel()})),e.on("instance-created",(({instance:e})=>{t(e),s(e.databases),e.on("change:refreshingStatus",(()=>{t(e)})),e.on("change:databasesStatus",(()=>{t(e),s(e.databases)})),e.on("change:databases.status",(()=>{s(e.databases)})),e.on("change:databases.collectionsStatus",(()=>{s(e.databases)})),e.genuineMongoDB.on("change:isGenuine",((e,t)=>{!function(e){Re.dispatch({type:_e,isGenuineMongoDB:!!e}),Re.dispatch(Y(!e))}(t)})),e.dataLake.on("change:isDataLake",((e,t)=>{!function(e){Re.dispatch((e=>({type:ke,isDataLake:e}))(e))}(t)}))})),e.getStore("DeploymentAwareness.WriteStateStore").listen((e=>{var t;Re.dispatch((t=e.isWritable,{type:Ce,isWritable:t})),Re.dispatch((e=>({type:Se,description:e}))(e.description))})),e.on("select-namespace",(({namespace:e})=>{Re.dispatch(S(e))})),e.on("open-namespace-in-new-tab",(({namespace:e})=>{Re.dispatch(S(e))})),e.on("select-database",(e=>{Re.dispatch(S(e))})),e.on("open-instance-workspace",(()=>{Re.dispatch(S(""))})),e.on("data-service-disconnected",(()=>{Re.dispatch({type:Ne})}))};const Oe=Re;function De(){return s.createElement(a.zt,{store:Oe},s.createElement(ge,null))}De.displayName="SidebarPlugin";const Pe=De,Ie=JSON.parse('{"name":"@mongodb-js/compass-sidebar","productName":"Sidebar plugin","version":"4.22.0","apiVersion":"3.0.0","description":"Sidebar external plugin","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"cross-env NODE_ENV=development webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-cov":"nyc npm run test","check":"npm run lint && npm run depcheck","prepublishOnly":"npm run compile","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","bootstrap":"npm run compile"},"license":"SSPL","peerDependencies":{"@mongodb-js/compass-components":"^0.13.0","@mongodb-js/connection-form":"^0.4.0","debug":"*","mongodb-data-service":"^21.19.0","prop-types":"^15.7.2","react":"^16.14.0","react-bootstrap":"^0.32.1","react-dom":"^16.14.0","react-redux":"^5.0.6","react-tooltip":"^3.11.1","redux":"^4.1.2"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","@hot-loader/react-dom":"^16.9.0","@mongodb-js/compass-app-stores":"^5.21.0","@mongodb-js/compass-components":"^0.13.0","@mongodb-js/compass-databases-navigation":"^0.7.0","@mongodb-js/compass-deployment-awareness":"^11.21.0","@mongodb-js/compass-server-version":"^5.21.0","@mongodb-js/compass-ssh-tunnel-status":"^6.21.0","@mongodb-js/connection-form":"^0.4.0","autoprefixer":"^9.4.6","babel-loader":"^8.2.2","chai":"^4.2.0","chai-enzyme":"^1.0.0-beta.1","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^7.0.0","css-loader":"^4.3.0","debug":"4.3.0","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^5.0.3","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","html-webpack-plugin":"^3.2.0","ignore-loader":"^0.1.2","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","less":"^3.11.1","less-loader":"^7.3.0","lodash":"^4.17.21","mini-css-extract-plugin":"^0.9.0","mocha":"^7.0.1","mocha-webpack":"^2.0.0-beta.0","mongodb-connection-model":"^21.15.0","mongodb-data-service":"^21.19.0","mongodb-database-model":"^1.10.0","mongodb-instance-model":"^11.21.0","mongodb-ns":"^2.3.0","mongodb-reflux-store":"^0.0.1","node-loader":"^0.6.0","nyc":"^15.0.0","peer-deps-externals-webpack-plugin":"^1.0.4","postcss-loader":"^2.1.6","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","react-fontawesome":"^1.6.1","react-hot-loader":"^4.13.0","react-redux":"^5.0.6","react-tooltip":"^3.11.1","redux":"^4.1.2","redux-thunk":"^2.3.0","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","resolve":"^1.15.1","rimraf":"^3.0.1","semver":"^5.4.1","shebang-loader":"^0.0.1","sinon":"^8.1.1","sinon-chai":"^3.4.0","style-loader":"^2.0.0","url-loader":"^3.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^3.6.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-merge":"^4.2.2","webpack-node-externals":"^3.0.0","xvfb-maybe":"^0.2.1"},"dependencies":{"@mongodb-js/compass-logging":"^0.10.0","@mongodb-js/mongodb-redux-common":"^1.10.0"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"}}');function Le(e){e.registerComponent("Sidebar.Component",Pe),e.registerStore("Sidebar.Store",Oe)}function je(e){e.deregisterComponent("Sidebar.Component"),e.deregisterStore("Sidebar.Store")}const Me=Pe},74428:(e,t,n)=>{"use strict";n.r(t),n.d(t,{activate:()=>E,deactivate:()=>S,default:()=>x,metadata:()=>f});var s=n(2784),a=n(70602),i=n(13980),r=n.n(i),o=n(72779),l=n.n(o);class c extends s.Component{static displayName="SshTunnelStatusComponent";static propTypes={sshTunnel:r().bool,sshTunnelHostPortString:r().string};static defaultProps={sshTunnel:!1,sshTunnelHostPortString:""};render(){return this.props.sshTunnel?s.createElement("div",{"data-test-id":"ssh-tunnel-status",className:l()("ssh-tunnel-status-module-ssh-tunnel-status__3pzWu")},s.createElement("div",{className:l()("ssh-tunnel-status-module-ssh-tunnel-status-label__1IvKE")},"SSH connection via"),s.createElement("div",{className:l()("ssh-tunnel-status-module-ssh-tunnel-status-string__26TvS")},this.props.sshTunnelHostPortString)):null}}const d=c;var p=n(10862),u=n.n(p),m=n(99837),h=n.n(m);const g=u().createStore({mixins:[h().store],onActivated(e){e.on("data-service-connected",this.onConnected.bind(this))},onConnected(e,t){if(e)return;const n=t.getConnectionOptions(),s=!!n.sshTunnel,a=s?n.sshTunnel.host:"",i=s?n.sshTunnel.port:"",r=s?this._combineHostPort(a,i,!0):"";this.setState({sshTunnel:s,sshTunnelHostname:a,sshTunnelPort:i,sshTunnelHostPortString:r})},_combineHostPort:(e,t,n)=>e.length>=25&&n?`${e.slice(0,9)}...${e.slice(-9)}:${t}`:`${e}:${t}`,getInitialState:()=>({sshTunnel:!1,sshTunnelHostname:"",sshTunnelPort:"",sshTunnelHostPortString:""})});class b extends s.Component{static displayName="SshTunnelStatusPlugin";render(){return s.createElement(a.StoreConnector,{store:g},s.createElement(d,this.props))}}const y=b,f=JSON.parse('{"name":"@mongodb-js/compass-ssh-tunnel-status","productName":"SSH Tunnel Status","version":"6.21.0","apiVersion":"3.0.0","description":"Compass SSH Tunnel Status","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"scripts":{"clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","start":"webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-cov":"nyc npm run test","check":"npm run lint && npm run depcheck","prepublishOnly":"npm run compile","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","bootstrap":"npm run compile"},"license":"SSPL","peerDependencies":{"hadron-react-components":"^5.13.0","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","autoprefixer":"^7.1.2","babel-loader":"^8.2.2","chai":"^4.1.2","chai-enzyme":"1.0.0-beta.0","cheerio":"^1.0.0-rc.2","classnames":"^2.2.6","core-js":"^3.12.1","cross-env":"^5.0.1","css-loader":"^4.3.0","debug":"^3.0.1","depcheck":"^1.4.1","electron":"^13.5.1","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^2.1.0","eslint-plugin-react":"^7.24.0","extract-text-webpack-plugin":"^4.0.0-beta.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","hadron-react-components":"^5.13.0","html-webpack-plugin":"^3.2.0","ignore-loader":"^0.1.2","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","less":"^3.11.1","less-loader":"^7.3.0","mocha":"^4.1.0","mocha-webpack":"^2.0.0-beta.0","mongodb-connection-model":"^21.15.0","mongodb-data-service":"^21.19.0","mongodb-reflux-store":"^0.0.1","node-loader":"^0.6.0","nyc":"^11.0.3","peer-deps-externals-webpack-plugin":"^1.0.4","postcss-loader":"^2.1.6","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","react-hot-loader":"^4.13.0","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","resolve":"^1.15.1","rimraf":"^2.6.1","semver":"^5.4.1","shebang-loader":"^0.0.1","sinon":"^3.2.0","sinon-chai":"^2.11.0","style-loader":"^2.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^2.9.0","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-node-externals":"^3.0.0"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"}}'),v={name:"SshTunnelStatus",component:y,order:1};function E(e){e.registerRole("InstanceDetails.Item",v),e.registerStore("SshTunnelStatus.Store",g)}function S(e){e.deregisterRole("InstanceDetails.Item",v),e.deregisterStore("SshTunnelStatus.Store")}const x=y},32228:(e,t,n)=>{var s=n(53293);e.exports=s},53293:(e,t,n)=>{var s=n(71305),a=n(37421),i=n(98022),r=n(72298),o=r.remote?r.remote.app:void 0,l=s.extend(a,{idAttribute:"id",namespace:"Users",storage:{backend:"disk",basepath:o?o.getPath("userData"):void 0},props:{id:{type:"string",required:!0,default:function(){return i.v4()}},name:"string",email:{type:"any",default:void 0,required:!1,allowNull:!0},createdAt:"date",lastUsed:"date",avatarUrl:"string",companyName:"string",developer:"boolean",twitter:"string"}});l.getOrCreate=function(e,t){var n=new l({id:e||i.v4(),createdAt:new Date});n.fetch({success:function(){n.save({lastUsed:new Date}),t(null,n)},error:function(e,n){t(n)}})},e.exports=l},69089:(e,t,n)=>{"use strict";n.d(t,{dy:()=>ht,ZP:()=>Tt,IK:()=>rt});var s=n(2784),a=n(50517),i=n(76635),r=n(91491);const o=function({onCancel:e,onConfirm:t,open:n}){return s.createElement(a.ConfirmationModal,{title:"Are you sure you want to edit your connection string?",open:n,onConfirm:t,onCancel:e,buttonText:"Confirm"},s.createElement("div",{"data-testid":"edit-uri-note"},"Editing this connection string will reveal your credentials."))},l=(0,a.css)({marginTop:a.spacing[1],marginBottom:a.spacing[3]}),c=(0,a.css)({flexGrow:1}),d=(0,a.css)({textarea:{fontSize:1.75*a.spacing[2],minHeight:a.spacing[7],resize:"vertical"}}),p=(0,a.css)({height:14,width:26,margin:0,marginLeft:a.spacing[1]}),u=(0,a.css)({"&:hover":{cursor:"pointer"}}),m=(0,a.css)({marginTop:a.spacing[3],display:"flex",flexDirection:"row"}),h="connectionString",g="connectionStringLabel",b=function({connectionString:e,enableEditingConnectionString:t,setEnableEditingConnectionString:n,updateConnectionFormField:i,onSubmit:b}){const y=(0,s.useRef)(null),[f,v]=(0,s.useState)(e),[E,S]=(0,s.useState)(!1);(0,s.useEffect)((()=>{f===e||y.current&&y.current===document.activeElement||v(e)}),[e,t,f]);const x=(0,s.useCallback)((e=>{if(13===e.which&&!e.shiftKey)return e.preventDefault(),void b()}),[b]),w=(0,s.useCallback)((e=>{const t=e.target.value;v(t),i({type:"update-connection-string",newConnectionStringValue:t})}),[i]),C=t?f:function(e){return(0,r.rA)(e,{redactUsernames:!1,replacementString:"*****"})}(f);return s.createElement(s.Fragment,null,s.createElement("div",{className:m},s.createElement("div",{className:c},s.createElement(a.Label,{htmlFor:h,id:g},"URI"),s.createElement(a.InlineInfoLink,{"aria-label":"Connection String Documentation","data-testid":"connectionStringDocsButton",href:"https://docs.mongodb.com/manual/reference/connection-string/"})),s.createElement(a.Label,{className:u,id:"edit-connection-string-label",htmlFor:"toggle-edit-connection-string"},"Edit Connection String"),s.createElement(a.Toggle,{className:p,id:"toggle-edit-connection-string","aria-labelledby":"edit-connection-string-label",size:"xsmall",type:"button",checked:t,onChange:e=>{e?S(!0):n(!1)}})),s.createElement("div",{className:l},s.createElement(a.TextArea,{onChange:w,onKeyPress:x,value:C,className:d,disabled:!t,id:h,"data-testid":h,ref:y,"aria-labelledby":g,placeholder:"e.g mongodb+srv://username:password@cluster0-jtpxd.mongodb.net/admin",spellCheck:!1}),s.createElement(o,{open:E,onCancel:()=>{S(!1)},onConfirm:()=>{n(!0),S(!1)}})))};var y,f=n(59176);function v(e,t){return(e||[]).find((e=>e.fieldName===t))?.message}function E(e,t){return!!v(e,t)}function S(e,t,n){return(e||[]).find((e=>e.fieldName===t&&e.fieldIndex===n))?.message}function x(e){switch((e.typedSearchParams().get("authMechanism")||"").toUpperCase()){case"":return function(e){const{username:t,password:n}=e;return t||n?w(e):[]}(e);case"MONGODB-X509":return function(e){const t=[];return N(e)||t.push({fieldTab:"tls",fieldName:"tls",message:"TLS must be enabled in order to use x509 authentication."}),e.searchParams.has("tlsCertificateKeyFile")||t.push({fieldTab:"tls",fieldName:"tlsCertificateKeyFile",message:"A Client Certificate is required with x509 authentication."}),t}(e);case"GSSAPI":return function(e){const t=[];return e.username||t.push({fieldTab:"authentication",fieldName:"kerberosPrincipal",message:"Principal name is required with Kerberos."}),t}(e);case"PLAIN":case"SCRAM-SHA-1":case"SCRAM-SHA-256":return function(e){return w(e)}(e);default:return[]}}function w(e){const{username:t,password:n}=e,s=[];return t||s.push({fieldTab:"authentication",fieldName:"username",message:"Username is missing."}),n||s.push({fieldTab:"authentication",fieldName:"password",message:"Password is missing."}),s}function C(e){const t=[];return e.host||t.push({fieldTab:"proxy",fieldName:"sshHostname",message:"A hostname is required to connect with an SSH tunnel."}),e.password||e.identityKeyFile||t.push({fieldTab:"proxy",fieldName:"sshPassword",message:"When connecting via SSH tunnel either password or identity file is required."}),e.identityKeyPassphrase&&!e.identityKeyFile&&t.push({fieldTab:"proxy",fieldName:"sshIdentityKeyFile",message:"File is required along with passphrase."}),t}function k(e){const t=e.typedSearchParams(),n=t.get("proxyHost"),s=t.get("proxyPort"),a=t.get("proxyUsername"),i=t.get("proxyPassword"),r=[];return!n&&(s||a||i)?(r.push({fieldTab:"proxy",fieldName:"proxyHostname",message:"Proxy hostname is required."}),r):r}function N(e){const t=e.searchParams.get("ssl"),n=e.searchParams.get("tls");return t||n?"true"===t||"true"===n:e.isSRV}function _(e){let t;try{t=new r.ZP(e.connectionString,{looseValidation:!0})}catch(e){return[]}return[...R(t),...A(t),...T(t),...O(t),...D(t),...P(t),...I(t),...L(t)]}function T(e){const t=[];if(!N(e))return[];const n="true"===e.searchParams.get("tlsInsecure"),s="true"===e.searchParams.get("tlsAllowInvalidHostnames"),a="true"===e.searchParams.get("tlsAllowInvalidCertificates");return(n||s||a)&&t.push({message:"TLS/SSL certificate validation is disabled. If possible, enable certificate validation to avoid security vulnerabilities."}),t}function A(e){const t=[];return e.searchParams.has("tlsCertificateFile")&&t.push({message:"tlsCertificateFile is deprecated and will be removed in future versions of Compass, please embed the client key and certificate chain in a single .pem bundle and use tlsCertificateKeyFile instead."}),t}function R(e){const t=[],n=e.searchParams.get("readPreference");return n&&!["primary","primaryPreferred","secondary","secondaryPreferred","nearest"].includes(n)&&t.push({message:`Unknown read preference ${n}`}),t}function O(e){const t=[];return e.isSRV&&"true"===e.searchParams.get("directConnection")&&t.push({message:"directConnection not supported with SRV URI."}),t}function D(e){const t=[];return e.searchParams.get("replicaSet")&&"true"===e.searchParams.get("directConnection")&&t.push({message:"directConnection is not supported with replicaSet."}),t}function P(e){const t=[];return e.hosts.length>1&&"true"===e.searchParams.get("directConnection")&&t.push({message:"directConnection is not supported with multiple hosts."}),t}function I(e){const t=[];return e.hosts.filter((e=>!(0,f.isLocalhost)(e))).length&&!N(e)&&t.push({message:"TLS/SSL is disabled. If possible, enable TLS/SSL to avoid security vulnerabilities."}),t}function L(e){const t=[],n=e.typedSearchParams(),s=n.get("proxyHost");return!s||(0,f.isLocalhost)(s)||(n.get("proxyPassword")&&t.push({message:"Socks5 proxy password will be transmitted in plaintext."}),e.hosts.find(f.isLocalhost)&&t.push({message:"Using remote proxy with local MongoDB service host."})),t}!function(e){e.MONGODB="MONGODB",e.MONGODB_SRV="MONGODB_SRV"}(y||(y={}));const j=(0,a.css)({marginTop:a.spacing[2]}),M=function({connectionStringUrl:e,errors:t,updateConnectionFormField:n}){const{isSRV:i}=e,r=(0,s.useCallback)((e=>{n({type:"update-connection-scheme",isSrv:e.target.value===y.MONGODB_SRV})}),[n]);return s.createElement(s.Fragment,null,s.createElement(a.Label,{htmlFor:"connection-scheme-radio-box-group"},"Connection String Scheme"),s.createElement(a.RadioBoxGroup,{id:"connection-scheme-radio-box-group",value:i?y.MONGODB_SRV:y.MONGODB,onChange:r},s.createElement(a.RadioBox,{id:"connection-scheme-mongodb-radiobox","data-testid":"connection-scheme-mongodb-radiobox",value:y.MONGODB},"mongodb"),s.createElement(a.RadioBox,{id:"connection-scheme-srv-radiobox","data-testid":"connection-scheme-srv-radiobox",value:y.MONGODB_SRV},"mongodb+srv")),s.createElement(a.Description,{className:j},i?"DNS Seed List Connection Format. The +srv indicates to the client that the hostname that follows corresponds to a DNS SRV record.":"Standard Connection String Format. The standard format of the MongoDB connection URI is used to connect to a MongoDB deployment: standalone, replica set, or a sharded cluster."),E(t,"isSrv")&&s.createElement(a.Banner,{variant:a.BannerVariant.Danger},v(t,"isSrv")))},q=(0,a.css)({marginTop:a.spacing[3]}),F=function({className:e="",children:t}){return s.createElement("div",{className:(0,a.cx)(q,e)},t)},V=(0,a.css)({marginTop:a.spacing[1]}),B=function({connectionStringUrl:e,updateConnectionFormField:t}){const n="true"===e.typedSearchParams().get("directConnection"),i=(0,s.useCallback)((e=>e.target.checked?t({type:"update-search-param",currentKey:"directConnection",value:e.target.checked?"true":"false"}):t({type:"delete-search-param",key:"directConnection"})),[t]);return s.createElement(a.Checkbox,{onChange:i,id:"direct-connection-checkbox",label:s.createElement(s.Fragment,null,s.createElement(a.Label,{htmlFor:"direct-connection-checkbox"},"Direct Connection"),s.createElement(a.Description,{className:V},"Specifies whether to force dispatch all operations to the specified host.")),checked:n,bold:!1})},U=(0,a.css)({display:"flex",flexDirection:"row",width:"100%",marginBottom:a.spacing[2],marginTop:a.spacing[1]}),H=(0,a.css)({flexGrow:1}),$=(0,a.css)({marginLeft:a.spacing[1],marginTop:a.spacing[1]}),z=(0,a.css)({width:"50%"}),G=function({errors:e,connectionStringUrl:t,updateConnectionFormField:n}){const[i,r]=(0,s.useState)([...t.hosts]),{isSRV:o}=t,l="true"===t.typedSearchParams().get("directConnection")||!t.isSRV&&1===i.length;(0,s.useEffect)((()=>{r([...t.hosts])}),[t]);const c=(0,s.useCallback)(((e,t)=>{const s=[...i];s[t]=e.target.value||"",r(s),n({type:"update-host",fieldIndex:t,newHostValue:e.target.value})}),[i,r,n]);return s.createElement(s.Fragment,null,s.createElement(F,{className:z},s.createElement(a.Label,{htmlFor:"connection-host-input-0",id:"connection-host-input-label"},o?"Hostname":"Host"),i.map(((t,r)=>s.createElement("div",{className:U,key:`host-${r}`,"data-testid":"host-input-container"},s.createElement(a.TextInput,{className:H,type:"text","data-testid":`connection-host-input-${r}`,id:`connection-host-input-${r}`,"aria-labelledby":"connection-host-input-label",state:E(e,"hosts")?"error":void 0,errorMessage:S(e,"hosts",r),value:`${t}`,onChange:e=>c(e,r)}),!o&&s.createElement(a.IconButton,{className:$,"aria-label":"Add new host",type:"button","data-testid":"connection-add-host-button",onClick:()=>n({type:"add-new-host",fieldIndexToAddAfter:r})},s.createElement(a.Icon,{glyph:"Plus"})),!o&&i.length>1&&s.createElement(a.IconButton,{className:$,"aria-label":"Remove host",type:"button","data-testid":"connection-remove-host-button",onClick:()=>n({type:"remove-host",fieldIndexToRemove:r})},s.createElement(a.Icon,{glyph:"Minus"})))))),l&&s.createElement(F,null,s.createElement(B,{connectionStringUrl:t,updateConnectionFormField:n})))},Q=function({errors:e,connectionStringUrl:t,updateConnectionFormField:n}){return s.createElement("div",null,s.createElement(F,null,s.createElement(M,{errors:e,connectionStringUrl:t,updateConnectionFormField:n})),s.createElement(G,{errors:e,connectionStringUrl:t,updateConnectionFormField:n}))};var W=n(48761);function K(e){const t=e.typedSearchParams().get("authMechanismProperties");try{return new r.yc(t)}catch(e){return new r.yc}}function Z(e){try{return[new r.ZP(e,{looseValidation:!0}),void 0]}catch(e){return[void 0,e]}}function X(e){return decodeURIComponent(e.username)}function Y(e){return decodeURIComponent(e.password)}const J=(0,a.css)({marginTop:a.spacing[1]}),ee=[{title:"Default",value:W.AuthMechanism.MONGODB_DEFAULT},{title:"SCRAM-SHA-1",value:W.AuthMechanism.MONGODB_SCRAM_SHA1},{title:"SCRAM-SHA-256",value:W.AuthMechanism.MONGODB_SCRAM_SHA256}],te={none:{label:"None",value:"none"},forward:{label:"Forward",value:"forward"},forwardAndReverse:{label:"Forward and reverse",value:"forwardAndReverse"}},ne=[{title:"None",id:"AUTH_NONE",component:function(){return s.createElement(s.Fragment,null)}},{title:"Username/Password",id:W.AuthMechanism.MONGODB_DEFAULT,component:function({errors:e,connectionStringUrl:t,updateConnectionFormField:n}){const i=Y(t),r=X(t),o=(t.searchParams.get("authMechanism")??"").toUpperCase(),l=ee.find((({value:e})=>e===o))??ee[0],c=(0,s.useCallback)((e=>{e.preventDefault(),n({type:"update-search-param",currentKey:"authMechanism",value:e.target.value})}),[n]),d=v(e,"username"),p=v(e,"password");return s.createElement(s.Fragment,null,s.createElement(F,null,s.createElement(a.TextInput,{onChange:({target:{value:e}})=>{n({type:"update-username",username:e})},label:"Username","data-testid":"connection-username-input",errorMessage:d,state:d?"error":void 0,value:r||""})),s.createElement(F,null,s.createElement(a.TextInput,{onChange:({target:{value:e}})=>{n({type:"update-password",password:e})},label:"Password",type:"password","data-testid":"connection-password-input",value:i||"",errorMessage:p,state:p?"error":void 0})),s.createElement(F,null,s.createElement(a.Label,{htmlFor:"authSourceInput",id:"authSourceLabel"},"Authentication Database"),s.createElement(a.InlineInfoLink,{"aria-label":"Authentication Database Documentation",href:"https://docs.mongodb.com/manual/reference/connection-string/#mongodb-urioption-urioption.authSource"}),s.createElement(a.TextInput,{className:J,onChange:({target:{value:e}})=>{n(""!==e?{type:"update-search-param",currentKey:"authSource",value:e}:{type:"delete-search-param",key:"authSource"})},id:"authSourceInput","aria-labelledby":"authSourceLabel",value:t.searchParams.get("authSource")??"",optional:!0})),s.createElement(F,null,s.createElement(a.Label,{htmlFor:"authentication-mechanism-radio-box-group"},"Authentication Mechanism"),s.createElement(a.RadioBoxGroup,{onChange:c,id:"authentication-mechanism-radio-box-group",value:l.value},ee.map((({title:e,value:t})=>s.createElement(a.RadioBox,{id:`${t}-tab-button`,"data-testid":`${t}-tab-button`,checked:l.value===t,value:t,key:t},e))))))}},{title:"X.509",id:W.AuthMechanism.MONGODB_X509,component:function(){return s.createElement(s.Fragment,null,s.createElement(a.Banner,{variant:a.BannerVariant.Info},"X.509 Authentication type requires a ",s.createElement("strong",null,"Client Certificate")," ","to work. Make sure to enable TLS and add one in the"," ",s.createElement("strong",null,"TLS/SSL")," tab."))}},{title:"Kerberos",id:W.AuthMechanism.MONGODB_GSSAPI,component:function({errors:e,connectionStringUrl:t,updateConnectionFormField:n}){const i=v(e,"kerberosPrincipal"),r=X(t),o=Y(t),l=K(t),c=l.get("SERVICE_NAME"),d=l.get("SERVICE_REALM"),p=l.get("CANONICALIZE_HOST_NAME")||"none",[u,m]=(0,s.useState)(!1);return(0,s.useEffect)((()=>{!u&&o.length&&m(!0)}),[o,u,n]),s.createElement(s.Fragment,null,s.createElement(F,null,s.createElement(a.TextInput,{onChange:({target:{value:e}})=>{n({type:"update-username",username:e})},"data-testid":"gssapi-principal-input",label:"Principal",errorMessage:i,state:i?"error":void 0,value:r||""})),s.createElement(F,null,s.createElement(a.TextInput,{"data-testid":"gssapi-service-name-input",onChange:({target:{value:e}})=>{n({type:"update-auth-mechanism-property",key:"SERVICE_NAME",value:e})},optional:!0,label:"Service Name",value:c||""})),s.createElement(F,null,s.createElement(a.Label,{htmlFor:"canonicalize-hostname-select"},"Canonicalize Host Name"),s.createElement(a.RadioBoxGroup,{name:"canonicalize-hostname",id:"canonicalize-hostname-select",onChange:({target:{value:e}})=>{n({type:"update-auth-mechanism-property",key:"CANONICALIZE_HOST_NAME",value:"none"===e?"":e})},value:p,size:"compact"},Object.entries(te).map((([e,{label:t,value:n}])=>s.createElement(a.RadioBox,{id:`gssapi-canonicalize-host-name-${e}`,"data-testid":`gssapi-canonicalize-host-name-${e}`,key:n,value:n},t))))),s.createElement(F,null,s.createElement(a.TextInput,{onChange:({target:{value:e}})=>{n({type:"update-auth-mechanism-property",key:"SERVICE_REALM",value:e})},"data-testid":"gssapi-service-realm-input",label:"Service Realm",value:d||"",optional:!0})),s.createElement(F,null,s.createElement(a.Checkbox,{"data-testid":"gssapi-password-checkbox",checked:u,label:"Provide password directly",onChange:({target:{checked:e}})=>{e||n({type:"update-password",password:""}),m(e)}})),u&&s.createElement(F,null,s.createElement(a.TextInput,{onChange:({target:{value:e}})=>{n({type:"update-password",password:e})},"data-testid":"gssapi-password-input",label:"Password",value:o,type:"password",optional:!0})))}},{title:"LDAP",id:W.AuthMechanism.MONGODB_PLAIN,component:function({connectionStringUrl:e,updateConnectionFormField:t,errors:n}){const i=X(e),r=Y(e),o=v(n,"username"),l=v(n,"password");return s.createElement(s.Fragment,null,s.createElement(F,null,s.createElement(a.TextInput,{"data-testid":"connection-plain-username-input",onChange:({target:{value:e}})=>{t({type:"update-username",username:e})},label:"Username",value:i||"",errorMessage:o,state:o?"error":void 0})),s.createElement(F,null,s.createElement(a.TextInput,{"data-testid":"connection-plain-password-input",onChange:({target:{value:e}})=>{t({type:"update-password",password:e})},label:"Password",type:"password",value:r||"",errorMessage:l,state:l?"error":void 0})))}},{title:"AWS IAM",id:W.AuthMechanism.MONGODB_AWS,component:function({connectionStringUrl:e,updateConnectionFormField:t}){const n=X(e),i=Y(e),r=K(e).get("AWS_SESSION_TOKEN");return s.createElement(s.Fragment,null,s.createElement(F,null,s.createElement(a.TextInput,{"data-testid":"connection-form-aws-access-key-id-input",onChange:({target:{value:e}})=>{t({type:"update-username",username:e})},label:"AWS Access Key Id",value:n||""})),s.createElement(F,null,s.createElement(a.TextInput,{"data-testid":"connection-form-aws-secret-access-key-input",onChange:({target:{value:e}})=>{t({type:"update-password",password:e})},label:"AWS Secret Access Key",type:"password",value:i||"",optional:!0})),s.createElement(F,null,s.createElement(a.TextInput,{"data-testid":"connection-form-aws-secret-token-input",onChange:({target:{value:e}})=>{t({type:"update-auth-mechanism-property",key:"AWS_SESSION_TOKEN",value:e})},label:"AWS Session Token",value:r||"",optional:!0,type:"password"})))}}],se=(0,a.css)({marginTop:a.spacing[3]}),ae=(0,a.css)({marginTop:a.spacing[3],width:5*a.spacing[7]}),ie=function({errors:e,updateConnectionFormField:t,connectionStringUrl:n}){const i=function(e){const t=(e.searchParams.get("authMechanism")||"").toUpperCase(),n=e.password||e.username;if(!t&&n)return W.AuthMechanism.MONGODB_DEFAULT;const s=ne.find((({id:e})=>e===t));if(s)return s.id;switch(t){case W.AuthMechanism.MONGODB_DEFAULT:case W.AuthMechanism.MONGODB_SCRAM_SHA1:case W.AuthMechanism.MONGODB_SCRAM_SHA256:case W.AuthMechanism.MONGODB_CR:return W.AuthMechanism.MONGODB_DEFAULT;default:return"AUTH_NONE"}}(n),r=ne.find((({id:e})=>e===i))||ne[0],o=(0,s.useCallback)((e=>(e.preventDefault(),t({type:"update-auth-mechanism",authMechanism:"AUTH_NONE"===e.target.value?null:e.target.value}))),[t]),l=r.component;return s.createElement("div",{className:se},s.createElement(a.Label,{htmlFor:"authentication-method-radio-box-group"},"Authentication Method"),s.createElement(a.RadioBoxGroup,{id:"authentication-method-radio-box-group",onChange:o,value:r.id,size:"compact"},ne.map((({title:e,id:t})=>s.createElement(a.RadioBox,{id:`connection-authentication-method-${t}-button`,"data-testid":`connection-authentication-method-${t}-button`,checked:r.id===t,value:t,key:t},e)))),s.createElement("div",{className:ae,"data-testid":`${r.id}-tab-content`},s.createElement(l,{errors:e,connectionStringUrl:n,updateConnectionFormField:t})))},re=[{title:"None",id:"none",type:"none",component:function(){return s.createElement(s.Fragment,null)}},{title:"SSH with Password",id:"password",type:"ssh-password",component:function({sshTunnelOptions:e,updateConnectionFormField:t,errors:n}){const i=(0,s.useCallback)(((e,n)=>t({type:"update-ssh-options",key:e,value:n})),[t]),r=[{name:"host",label:"SSH Hostname",type:"text",optional:!1,value:e?.host,errorMessage:v(n,"sshHostname"),state:E(n,"sshHostname")?"error":"none"},{name:"port",label:"SSH Port",type:"number",optional:!1,value:e?.port?.toString(),errorMessage:void 0,state:"none"},{name:"username",label:"SSH Username",type:"text",optional:!1,value:e?.username,errorMessage:v(n,"sshUsername"),state:E(n,"sshUsername")?"error":"none"},{name:"password",label:"SSH Password",type:"password",optional:!0,value:e?.password,errorMessage:v(n,"sshPassword"),state:E(n,"sshPassword")?"error":"none"}];return s.createElement(s.Fragment,null,r.map((({name:e,label:t,type:n,optional:r,value:o,errorMessage:l,state:c})=>s.createElement(F,{key:e},s.createElement(a.TextInput,{onChange:({target:{value:t}})=>{i(e,t)},name:e,"data-testid":e,label:t,type:n,optional:r,value:o||"",errorMessage:l,state:c,spellCheck:!1})))))}},{title:"SSH with Identity File",id:"identity",type:"ssh-identity",component:function({sshTunnelOptions:e,updateConnectionFormField:t,errors:n}){const i=(0,s.useCallback)(((e,n)=>t({type:"update-ssh-options",key:e,value:n})),[t]),r=[{name:"host",label:"SSH Hostname",type:"text",optional:!1,value:e?.host,errorMessage:v(n,"sshHostname"),state:E(n,"sshHostname")?"error":"none"},{name:"port",label:"SSH Port",type:"number",optional:!1,value:e?.port?.toString(),errorMessage:"",state:"none"},{name:"username",label:"SSH Username",type:"text",optional:!1,value:e?.username,errorMessage:v(n,"sshUsername"),state:E(n,"sshUsername")?"error":"none"},{name:"identityKeyFile",label:"SSH Identity File",type:"file",errorMessage:v(n,"sshIdentityKeyFile"),state:E(n,"sshIdentityKeyFile")?"error":"none",value:e?.identityKeyFile&&e.identityKeyFile?[e.identityKeyFile]:void 0},{name:"identityKeyPassphrase",label:"SSH Passphrase",type:"password",optional:!0,value:e?.identityKeyPassphrase,errorMessage:void 0,state:"none"}];return s.createElement(s.Fragment,null,r.map((e=>{const{name:t,label:n,optional:r,value:o,errorMessage:l,state:c}=e;switch(e.type){case"file":return s.createElement(F,{key:t},s.createElement(a.FileInput,{id:t,dataTestId:t,onChange:e=>{i(t,e[0])},label:n,error:Boolean(l),errorMessage:l,values:o}));case"text":case"password":case"number":return s.createElement(F,{key:t},s.createElement(a.TextInput,{onChange:({target:{value:e}})=>{i(t,e)},name:t,"data-testid":t,label:n,type:e.type,optional:r,value:o,errorMessage:l,state:c,spellCheck:!1}))}})))}},{title:"Socks5",id:"socks",type:"socks",component:function({updateConnectionFormField:e,errors:t,connectionStringUrl:n}){const i=n.typedSearchParams(),r=(0,s.useCallback)(((t,n)=>e(n?{type:"update-search-param",currentKey:t,value:n}:{type:"delete-search-param",key:t})),[e]),o=[{name:"proxyHost",label:"Proxy Hostname",type:"text",optional:!1,value:i.get("proxyHost")??"",errorMessage:v(t,"proxyHostname"),state:E(t,"proxyHostname")?"error":"none"},{name:"proxyPort",label:"Proxy Tunnel Port",type:"number",optional:!0,value:i.get("proxyPort")??"",state:"none"},{name:"proxyUsername",label:"Proxy Username",type:"text",optional:!0,value:i.get("proxyUsername")??"",state:"none"},{name:"proxyPassword",label:"Proxy Password",type:"password",optional:!0,value:i.get("proxyPassword")??"",state:"none"}];return s.createElement(s.Fragment,null,o.map((({name:e,label:t,type:n,optional:i,value:o,errorMessage:l,state:c})=>s.createElement(F,{key:e},s.createElement(a.TextInput,{onChange:({target:{value:t}})=>{r(e,t)},name:e,"data-testid":e,label:t,type:n,optional:i,value:o,errorMessage:l,state:c,spellCheck:!1})))))}}],oe=(0,a.css)({marginTop:a.spacing[3]}),le=(0,a.css)({marginTop:a.spacing[3],width:"50%",minWidth:400}),ce=function({connectionOptions:e,updateConnectionFormField:t,errors:n,connectionStringUrl:i}){const r=((e,t)=>{const n=e.typedSearchParams();return n.get("proxyHost")||n.get("proxyPort")||n.get("proxyUsername")||n.get("proxyPassword")?"socks":t&&t?.sshTunnel&&Object.values(t.sshTunnel).find(Boolean)?t.sshTunnel.identityKeyFile||t.sshTunnel.identityKeyPassphrase?"ssh-identity":"ssh-password":"none"})(i,e),o=re.findIndex((e=>e.type===r))??0,[l,c]=(0,s.useState)(re[o]),d=(0,s.useCallback)(((e,n)=>{let s;switch(n){case"socks":s="remove-ssh-options";break;case"ssh-identity":case"ssh-password":s="remove-proxy-options";break;default:s="socks"===e?"remove-proxy-options":"remove-ssh-options"}t({type:s})}),[t]),p=(0,s.useCallback)((e=>{e.preventDefault();const t=re.find((({id:t})=>t===e.target.value));t&&(d(l.type,t.type),c(t))}),[l,d]),u=l.component;return s.createElement("div",{className:oe},s.createElement(a.Label,{htmlFor:"ssh-options-radio-box-group"},"SSH Tunnel/Proxy Method"),s.createElement(a.RadioBoxGroup,{id:"ssh-options-radio-box-group",onChange:p,size:"compact",className:"radio-box-group-style"},re.map((({title:e,id:t,type:n})=>s.createElement(a.RadioBox,{id:`${n}-tab-button`,"data-testid":`${n}-tab-button`,checked:l.id===t,value:t,key:t},e)))),e&&s.createElement("div",{className:le,"data-testid":`${l.type}-tab-content`},s.createElement(u,{errors:n,sshTunnelOptions:e.sshTunnel,updateConnectionFormField:t,connectionStringUrl:i})))},de=(0,a.css)({width:"80%"}),pe=function({tlsCertificateKeyFile:e,tlsCertificateKeyFilePassword:t,disabled:n,updateTLSClientCertificate:i,updateTLSClientCertificatePassword:r}){return s.createElement(s.Fragment,null,s.createElement(F,{className:de},s.createElement(a.FileInput,{description:"Learn More",disabled:n,id:"tlsCertificateKeyFile",label:"Client Certificate and Key (.pem)",dataTestId:"tlsCertificateKeyFile-input",link:"https://docs.mongodb.com/manual/reference/connection-string/#mongodb-urioption-urioption.tlsCertificateKeyFile",values:e?[e]:[],onChange:e=>{i(e&&e.length>0?e[0]:null)},showFileOnNewLine:!0,optional:!0,optionalMessage:"Optional (required with X.509 auth)"})),s.createElement(F,null,s.createElement(a.TextInput,{className:de,onChange:({target:{value:e}})=>{r(e)},disabled:n,"data-testid":"tlsCertificateKeyFilePassword-input",id:"tlsCertificateKeyFilePassword",label:"Client Key Password",type:"password",value:t||"",optional:!0})))},ue=(0,a.css)({width:"80%"}),me=function({tlsCAFile:e,useSystemCA:t,disabled:n,handleTlsOptionChanged:i}){return s.createElement(F,{className:ue},s.createElement(a.FileInput,{description:"Learn More",disabled:n||t,id:"tlsCAFile",dataTestId:"tlsCAFile-input",label:"Certificate Authority (.pem)",link:"https://docs.mongodb.com/manual/reference/connection-string/#mongodb-urioption-urioption.tlsCAFile",onChange:e=>{i("tlsCAFile",e?.[0]??null)},showFileOnNewLine:!0,values:e?[e]:void 0,optional:!0}),s.createElement(a.Checkbox,{onChange:e=>{i("useSystemCA",e.target.checked?"true":null)},"data-testid":"useSystemCA-input",id:"useSystemCA-input",label:s.createElement(s.Fragment,null,s.createElement(a.Label,{htmlFor:"useSystemCA-input"},"Use System Certificate Authority"),s.createElement(a.Description,{className:(0,a.cx)(he,{[ge]:n})},"Use the operating systemâs Certificate Authority store.")),disabled:n,checked:t}))},he=(0,a.css)({marginTop:a.spacing[1]}),ge=(0,a.css)({color:a.uiColors.gray.light1}),be=[{value:"DEFAULT",label:"Default"},{value:"ON",label:"On"},{value:"OFF",label:"Off"}],ye=function({connectionStringUrl:e,connectionOptions:t,updateConnectionFormField:n}){const i=function(e){const t=e.typedSearchParams();return null===t.get("ssl")&&null===t.get("tls")?"DEFAULT":"true"!==t.get("tls")||null!==t.get("ssl")&&"true"!==t.get("ssl")?"false"!==t.get("tls")||null!==t.get("ssl")&&"false"!==t.get("ssl")?"true"===t.get("ssl")&&null===t.get("tls")?"ON":"false"===t.get("ssl")&&null===t.get("tls")?"OFF":void 0:"OFF":"ON"}(e),r=(0,s.useCallback)((e=>{n({type:"update-tls",tlsOption:e.target.value})}),[n]),o=e.typedSearchParams(),l=[{name:"tlsInsecure",description:"This includes tlsAllowInvalidHostnames and tlsAllowInvalidCertificates.",checked:"true"===o.get("tlsInsecure")},{name:"tlsAllowInvalidHostnames",description:"Disable the validation of the hostnames in the certificate presented by the mongod/mongos instance.",checked:"true"===o.get("tlsAllowInvalidHostnames")},{name:"tlsAllowInvalidCertificates",description:"Disable the validation of the server certificates.",checked:"true"===o.get("tlsAllowInvalidCertificates")}],c="OFF"===i,d=(0,s.useCallback)(((e,t)=>n({type:"update-tls-option",key:e,value:t})),[n]);return s.createElement("div",null,s.createElement(F,null,s.createElement(a.Label,{htmlFor:"tls-radio-box-group"},"SSL/TLS Connection"),s.createElement(a.InlineInfoLink,{href:"https://docs.mongodb.com/manual/reference/connection-string/#tls-options","aria-label":"TLS/SSL Option Documentation"}),s.createElement(a.RadioBoxGroup,{id:"tls-radio-box-group",value:i||"",onChange:r},be.map((e=>s.createElement(a.RadioBox,{id:`connection-tls-enabled-${e.value}-radio-button`,"data-testid":`connection-tls-enabled-${e.value}-radio-button`,value:e.value,key:e.value},e.label))))),s.createElement(me,{tlsCAFile:o.get("tlsCAFile"),useSystemCA:!!t.useSystemCA,disabled:c,handleTlsOptionChanged:d}),s.createElement(pe,{tlsCertificateKeyFile:o.get("tlsCertificateKeyFile"),tlsCertificateKeyFilePassword:o.get("tlsCertificateKeyFilePassword"),disabled:c,updateTLSClientCertificate:e=>{d("tlsCertificateKeyFile",e)},updateTLSClientCertificatePassword:e=>{d("tlsCertificateKeyFilePassword",e)}}),l.map((e=>s.createElement(F,{key:e.name},s.createElement(a.Checkbox,{onChange:t=>{d(e.name,t.target.checked?"true":null)},"data-testid":`${e.name}-input`,id:`${e.name}-input`,label:s.createElement(s.Fragment,null,s.createElement(a.Label,{htmlFor:`${e.name}-input`},e.name),s.createElement(a.Description,{className:(0,a.cx)(he,{[ge]:c})},e.description)),disabled:c,checked:e.checked})))))},fe=[{title:"Connection Timeout Options",values:["connectTimeoutMS","socketTimeoutMS"]},{title:"Compression Options",values:["compressors","zlibCompressionLevel"]},{title:"Connection Pool Options",values:["maxPoolSize","minPoolSize","maxIdleTimeMS","waitQueueMultiple","waitQueueTimeoutMS"]},{title:"Write Concern Options",values:["w","wtimeoutMS","journal"]},{title:"Read Concern Options",values:["readConcernLevel"]},{title:"Read Preferences Options",values:["maxStalenessSeconds","readPreferenceTags"]},{title:"Server Options",values:["localThresholdMS","serverSelectionTimeoutMS","serverSelectionTryOnce","heartbeatFrequencyMS"]},{title:"Miscellaneous Configuration",values:["appName","retryReads","retryWrites","uuidRepresentation"]}],ve=(0,a.css)({width:9*a.spacing[5]}),Ee=(0,a.css)({width:9*a.spacing[5]}),Se=(0,a.css)({display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}),xe=(0,a.css)({width:a.spacing[7]}),we=(0,a.css)({marginLeft:a.spacing[2]});function Ce(e){return!e.length||e[e.length-1].name?[...e,{name:void 0,value:void 0}]:e}const ke=function({updateConnectionFormField:e,connectionStringUrl:t}){const[n,i]=s.useState([]);(0,s.useEffect)((()=>{const e=Ce(function(e){let t=[];const n=[],s=e.typedSearchParams();return fe.forEach((({values:e})=>t=t.concat(e))),s.forEach(((e,s)=>{t.includes(s)&&n.push({value:e,name:s})})),n}(t));i(e)}),[t]);const r=(t,s,a)=>{const r=n.findIndex((e=>e.name===t)),o={name:s,value:a},l=[...n];l[r]=o,i(Ce(l)),s&&e({type:"update-search-param",currentKey:t??s,newKey:t===s?void 0:s,value:a??""})};return s.createElement(s.Fragment,null,s.createElement(a.Table,{"data-testid":"url-options-table",data:n,columns:[s.createElement(a.TableHeader,{key:"name",label:"Key"}),s.createElement(a.TableHeader,{key:"value",label:"Value"})]},(({datum:o})=>s.createElement(a.Row,{key:o.name,"data-testid":o.name?`${o.name}-table-row`:"new-option-table-row"},s.createElement(a.Cell,{className:Ee},s.createElement(a.Select,{id:"select-key",className:ve,placeholder:"Select key",name:"name","aria-labelledby":o.name?`${o.name} select`:"new option select",onChange:(e,t)=>{t.preventDefault(),r(o.name,e,o.value)},allowDeselect:!1,value:o.name??""},fe.map((({title:e,values:n})=>s.createElement(a.OptionGroup,{key:e,label:e},n.map((e=>s.createElement(a.Option,{key:e,value:e,disabled:t.searchParams.has(e)&&o.name!==e},e)))))))),s.createElement(a.Cell,null,s.createElement("div",{className:Se},s.createElement(a.TextInput,{onChange:e=>{e.preventDefault(),r(o.name,o.name,e.target.value)},"data-testid":o.name?`${o.name}-input-field`:"new-option-input-field",spellCheck:!1,type:"text",placeholder:"Value","aria-labelledby":"Enter value",value:o.value,className:xe}),o.name?s.createElement(a.IconButton,{"data-testid":o.name?`${o.name}-delete-button`:"new-option-delete-button","aria-label":`Delete option: ${o.name??""}`,onClick:()=>(t=>{if(!t)return;const s=n.findIndex((e=>e.name===t)),a=[...n];a.splice(s,1),i(Ce(a)),e({type:"delete-search-param",key:t})})(o.name),className:we,type:"button"},s.createElement(a.Icon,{glyph:"X"})):""))))))},Ne=(0,a.css)({marginTop:a.spacing[3],width:7*a.spacing[6]}),_e=(0,a.css)({marginTop:a.spacing[1]}),Te=function({updateConnectionFormField:e,connectionStringUrl:t}){return s.createElement("div",{className:Ne,"data-testid":"url-options"},s.createElement(a.Label,{htmlFor:""},"URI Options"),s.createElement(a.Description,{className:_e},"Add additional MongoDB URI options to customize your connection.Â ",s.createElement(a.Link,{href:"https://docs.mongodb.com/manual/reference/connection-string/#connection-string-options"},"Learn More")),s.createElement(ke,{connectionStringUrl:t,updateConnectionFormField:e}))},Ae="defaultReadPreference",Re=[{title:"Primary",id:W.ReadPreference.PRIMARY},{title:"Primary Preferred",id:W.ReadPreference.PRIMARY_PREFERRED},{title:"Secondary",id:W.ReadPreference.SECONDARY},{title:"Secondary Preferred",id:W.ReadPreference.SECONDARY_PREFERRED},{title:"Nearest",id:W.ReadPreference.NEAREST}],Oe=(0,a.css)({marginTop:a.spacing[3]}),De=(0,a.css)({width:"50%"}),Pe=function({updateConnectionFormField:e,connectionStringUrl:t}){const{searchParams:n,pathname:i}=t,r=n.get("readPreference"),o=n.get("replicaSet"),l=i.startsWith("/")?i.substr(1):i,c=(0,s.useCallback)(((t,n)=>e(n?{type:"update-search-param",currentKey:t,value:n}:{type:"delete-search-param",key:t})),[e]),d=(0,s.useCallback)((t=>e({type:"update-connection-path",value:t})),[e]);return s.createElement("div",{className:Oe},s.createElement(a.Label,{htmlFor:"read-preferences"},"Read Preference"),s.createElement(a.RadioBoxGroup,{onChange:({target:{value:e}})=>{c("readPreference",e===Ae?void 0:e)},value:r??Ae,"data-testid":"read-preferences",id:"read-preferences",size:"compact"},s.createElement(a.RadioBox,{id:"default-preference-button","data-testid":"default-preference-button",key:"defaultReadPreference",value:Ae,checked:!r},"Default"),Re.map((({title:e,id:t})=>s.createElement(a.RadioBox,{id:`${t}-preference-button`,"data-testid":`${t}-preference-button`,checked:r===t,value:t,key:t},e)))),s.createElement(F,null,s.createElement(a.TextInput,{spellCheck:!1,className:De,onChange:({target:{value:e}})=>{c("replicaSet",e)},name:"replica-set","data-testid":"replica-set",label:"Replica Set Name",type:"text",optional:!0,value:o??""})),s.createElement(F,null,s.createElement(a.TextInput,{spellCheck:!1,className:De,onChange:({target:{value:e}})=>{d(e)},name:"default-database","data-testid":"default-database",label:"Default Authentication Database",type:"text",optional:!0,value:l??"",description:"Authentication database used when authSource is not specified."})),s.createElement(Te,{connectionStringUrl:t,updateConnectionFormField:e}))},Ie="localhost",Le="mongodb://localhost:27017",je=(0,a.css)({marginTop:a.spacing[2]}),Me=(0,a.css)({position:"relative","&::after":{position:"absolute",top:-a.spacing[2],right:-a.spacing[2],content:'""',width:a.spacing[2],height:a.spacing[2],borderRadius:"50%",backgroundColor:a.uiColors.red.base}}),qe=function({errors:e,updateConnectionFormField:t,connectionOptions:n}){const[i,o]=(0,s.useState)(0),l=[{name:"General",id:"general",component:Q},{name:"Authentication",id:"authentication",component:ie},{name:"TLS/SSL",id:"tls",component:ye},{name:"Proxy/SSH Tunnel",id:"proxy",component:ce},{name:"Advanced",id:"advanced",component:Pe}],c=(0,s.useMemo)((()=>{try{return new r.ZP(n.connectionString,{looseValidation:!0})}catch(e){return new r.ZP(Le)}}),[n]);return s.createElement(a.Tabs,{className:je,setSelected:o,selected:i,"aria-label":"Advanced Options Tabs"},l.map(((i,r)=>{const o=i.component,l=function(e,t){return e.filter((e=>e.fieldTab===t))}(e,i.id),d=l.length>0;return s.createElement(a.Tab,{key:r,name:s.createElement("div",{className:(0,a.cx)({[Me]:d})},i.name),"aria-label":`${i.name}${l.length>0?` (${l.length} error${l.length>1?"s":""})`:""}`,type:"button","data-testid":`connection-${i.id}-tab`,"data-has-error":d},s.createElement(o,{errors:e,connectionStringUrl:c,updateConnectionFormField:t,connectionOptions:n}))})))},Fe=(0,a.css)({position:"absolute",top:0,bottom:-a.spacing[1],left:-a.spacing[1],right:-a.spacing[1],backgroundColor:a.compassUIColors.transparentWhite,zIndex:1,cursor:"not-allowed"}),Ve=(0,a.css)({position:"relative"}),Be=function({disabled:e,errors:t,updateConnectionFormField:n,connectionOptions:i}){return s.createElement(a.Accordion,{"data-testid":"advanced-connection-options",text:"Advanced Connection Options"},s.createElement("div",{className:Ve},e&&s.createElement("div",{className:Fe,title:"The connection form is disabled when the connection string cannot be parsed."}),s.createElement(qe,{errors:t,updateConnectionFormField:n,connectionOptions:i})))},Ue=(0,a.css)({marginTop:a.spacing[1]}),He=(0,a.css)({padding:0,margin:0,listStylePosition:"inside"});function $e({errors:e}){return e&&e.length?s.createElement(a.Banner,{"data-testid":"connection-error-summary",variant:a.BannerVariant.Danger,className:Ue},s.createElement(Ge,{messages:e.map((e=>e.message))})):null}function ze({warnings:e}){return e&&e.length?s.createElement(a.Banner,{variant:a.BannerVariant.Warning,className:Ue},s.createElement(Ge,{messages:e.map((e=>e.message))})):null}function Ge({messages:e}){if(1===e.length)return s.createElement("div",null,e[0]);if(2===e.length)return s.createElement("div",null,s.createElement("ol",{className:He},e.map(((e,t)=>s.createElement("li",{key:t},e)))));const t=s.createElement("ol",{className:He},e.map(((e,t)=>s.createElement("li",{key:t},e)))),n=e[0].endsWith(".")?e[0].slice(0,e[0].length-1):e[0];return s.createElement("div",null,s.createElement("span",null,n,", and other ",e.length-1," problems.")," ",s.createElement(a.InlineDefinition,{tooltipProps:{align:"top",justify:"start",delay:500},definition:t},"View all"))}const Qe=(0,a.css)({borderTop:`1px solid ${a.uiColors.gray.light2}`,paddingLeft:a.spacing[4],paddingRight:a.spacing[4]}),We=(0,a.css)({display:"flex",justifyContent:"flex-end",gap:a.spacing[2],paddingTop:a.spacing[3],paddingBottom:a.spacing[3]}),Ke=function({errors:e,warnings:t,onConnectClicked:n,onSaveClicked:i,saveButton:r}){return s.createElement("div",{className:Qe},t.length?s.createElement(ze,{warnings:t}):"",e.length?s.createElement($e,{errors:e}):"",s.createElement("div",{className:We},"hidden"!==r&&s.createElement(a.Button,{"data-testid":"save-connection-button",variant:a.ButtonVariant.Default,disabled:"disabled"===r,onClick:i},"Save"),s.createElement(a.Button,{"data-testid":"connect-button",variant:a.ButtonVariant.Primary,onClick:n},"Connect")))};const Ze=/[@/]/,Xe=/[:@,/]/;function Ye(e,t){switch(t.type){case"set-connection-form-state":return{...e,...t.newState};case"set-enable-editing-connection-string":return{...e,enableEditingConnectionString:t.enableEditing};case"set-form-errors":return{...e,errors:t.errors}}}function Je(e){const[t,n]=Z(e);return[t,n?[{fieldName:"connectionString",fieldTab:"general",message:n.message}]:[]]}function et(e){const[,t]=Je(e.connectionOptions.connectionString);return{errors:t,enableEditingConnectionString:e.connectionOptions.connectionString===Le&&!e.lastUsed,warnings:t?.length?[]:_(e.connectionOptions),connectionOptions:(0,i.cloneDeep)(e.connectionOptions),isDirty:!1}}function tt(e,t){if("update-connection-string"===e.type){const[n,s]=Je(e.newConnectionStringValue);return{connectionOptions:{...t,connectionString:n?.toString()||e.newConnectionStringValue},errors:s}}const[n,s]=Je(t.connectionString);if(!n)return{connectionOptions:t,errors:s};const a=n.typedSearchParams();switch(e.type){case"add-new-host":{const{fieldIndexToAddAfter:s}=e,i=function(e,t){if(e.length<1)return"localhost:27017";const n=e[t],s=n.includes(":")?n.slice(0,n.indexOf(":")):n,a=(function(e){return e.includes(":")&&!isNaN(Number(e.slice(e.indexOf(":")+1)))}(i=n)&&Number(i.slice(i.indexOf(":")+1))||27017)+1;var i;return`${s||Ie}:${a}`}(n.hosts,s);return n.hosts.splice(s+1,0,i),a.get("directConnection")&&a.delete("directConnection"),{connectionOptions:{...t,connectionString:n.toString()}}}case"remove-host":{const{fieldIndexToRemove:s}=e;return n.hosts.splice(s,1),1!==n.hosts.length||n.hosts[0]||(n.hosts[0]="localhost:27017"),{connectionOptions:{...t,connectionString:n.toString()}}}case"update-tls":return function({action:e,connectionStringUrl:t,connectionOptions:n}){const s=t.clone(),a=s.typedSearchParams();return"ON"===e.tlsOption?(a.delete("ssl"),a.set("tls","true")):"OFF"===e.tlsOption?(a.delete("ssl"),a.set("tls","false")):"DEFAULT"===e.tlsOption&&(a.delete("ssl"),a.delete("tls")),{connectionOptions:{...(0,i.cloneDeep)(n),connectionString:s.toString()}}}({action:e,connectionStringUrl:n,connectionOptions:t});case"update-tls-option":return function({action:e,connectionStringUrl:t,connectionOptions:n}){const s=(0,i.cloneDeep)(n),a=t.clone(),r=a.typedSearchParams();return"useSystemCA"===e.key?(e.value&&r.delete("tlsCAFile"),s.useSystemCA=!!e.value):e.value?(r.delete("ssl"),r.set("tls","true"),r.set(e.key,e.value),"tlsCAFile"===e.key&&(s.useSystemCA=!1)):r.delete(e.key),{connectionOptions:{...s,connectionString:a.toString()}}}({action:e,connectionStringUrl:n,connectionOptions:t});case"update-auth-mechanism":return function({action:e,connectionStringUrl:t,connectionOptions:n}){const s=function(e){const t=e.clone(),n=t.typedSearchParams();return n.delete("authMechanism"),t.password="",t.username="",n.delete("authMechanismProperties"),n.delete("gssapiServiceName"),n.delete("authSource"),t}(t),a=s.typedSearchParams();return e.authMechanism&&(a.set("authMechanism",e.authMechanism),["MONGODB-AWS","GSSAPI","PLAIN","MONGODB-X509"].includes(e.authMechanism)&&a.set("authSource","$external")),{connectionOptions:{...(0,i.cloneDeep)(n),connectionString:s.toString()}}}({action:e,connectionStringUrl:n,connectionOptions:t});case"update-username":return function({action:e,connectionStringUrl:t,connectionOptions:n}){const s=function(e,t){const n=e.clone();return n.username=encodeURIComponent(t),n}(t,e.username),[,a]=Z(s.toString());return a?{connectionOptions:n,errors:[{fieldName:"username",fieldTab:"authentication",message:a.message}]}:{connectionOptions:{...(0,i.cloneDeep)(n),connectionString:s.toString()}}}({action:e,connectionStringUrl:n,connectionOptions:t});case"update-password":return function({action:e,connectionStringUrl:t,connectionOptions:n}){const s=function(e,t){const n=e.clone();return n.password=encodeURIComponent(t),n}(t,e.password),[,a]=Z(s.toString());return a?{connectionOptions:n,errors:[{fieldName:"password",fieldTab:"authentication",message:a.message}]}:{connectionOptions:{...(0,i.cloneDeep)(n),connectionString:s.toString()}}}({action:e,connectionStringUrl:n,connectionOptions:t});case"update-host":return function({action:e,connectionStringUrl:t,connectionOptions:n}){const{newHostValue:s,fieldIndex:a}=e;try{if(function(e,t){const n=(t?Xe:Ze).exec(e);if(n)throw new Error(`Invalid character in host: '${n[0]}'`)}(s,t.isSRV),1===t.hosts.length&&""===s)throw new Error("Host cannot be empty. The host is the address hostname, IP address, or UNIX domain socket where the mongodb instance is running.");const e=t.clone();e.hosts[a]=s||"";const r=e.clone();return{connectionOptions:{...(0,i.cloneDeep)(n),connectionString:r.toString()},errors:[]}}catch(e){return{connectionOptions:{...(0,i.cloneDeep)(n),connectionString:t.toString()},errors:[{fieldName:"hosts",fieldTab:"general",fieldIndex:a,message:e.message}]}}}({action:e,connectionStringUrl:n,connectionOptions:t});case"update-connection-scheme":{const{isSrv:s}=e;try{const e=(r=n,s?function(e){if(e.isSRV)return e;const t=e.clone(),n=t.hosts.length>0?t.hosts[0].substring(0,-1===t.hosts[0].indexOf(":")?void 0:t.hosts[0].indexOf(":")):Ie;t.hosts=[n],t.protocol="mongodb+srv:";const s=t.typedSearchParams();return s.get("directConnection")&&s.delete("directConnection"),t}(r):function(e){if(!e.isSRV)return e;const t=e.clone();return t.protocol="mongodb:",t.hosts=[`${t.hosts[0]}:27017`],t}(r));return{connectionOptions:{...t,connectionString:e.toString()},errors:[]}}catch(e){return{connectionOptions:{...t},errors:[{fieldName:"isSrv",fieldTab:"general",message:`Error updating connection schema: ${e.message}`}]}}}case"update-ssh-options":return function({action:e,connectionOptions:t}){const n=(0,i.cloneDeep)(t),{key:s,value:a}=e;return{connectionOptions:{...n,sshTunnel:{host:"",port:22,username:"",...n.sshTunnel,[s]:a}}}}({action:e,connectionOptions:t});case"update-search-param":if(e.newKey){const t=e.value??a.get(e.currentKey);a.delete(e.currentKey),a.set(e.newKey,t)}else a.set(e.currentKey,e.value);return{connectionOptions:{...t,connectionString:n.toString()}};case"update-auth-mechanism-property":{const s=K(n);e.value?s.set(e.key,e.value):s.delete(e.key);const i=s.toString();return i?a.set("authMechanismProperties",i):a.delete("authMechanismProperties"),{connectionOptions:{...t,connectionString:n.toString()}}}case"delete-search-param":return a.delete(e.key),{connectionOptions:{...t,connectionString:n.toString()}};case"update-connection-path":return n.pathname=e.value,{connectionOptions:{...t,connectionString:n.toString()}};case"remove-proxy-options":return["proxyHost","proxyPort","proxyPassword","proxyUsername"].forEach((e=>a.delete(e))),{connectionOptions:{...t,connectionString:n.toString()}};case"remove-ssh-options":return{connectionOptions:{...t,sshTunnel:void 0}}}var r}const nt={color1:"#00A35C",color2:"#71F6BA",color3:"#016BF8",color4:"#0498EC",color5:"#FFC010",color6:"#EF5752",color7:"#B45AF2",color8:"#F1D4FD",color9:"#889397",color10:"#C1C7C6"},st={"#5fc86e":"color1","#326fde":"color2","#deb342":"color3","#d4366e":"color4","#59c1e2":"color5","#2c5f4a":"color6","#d66531":"color7","#773819":"color8","#3b8196":"color9","#ababab":"color10"},at=Object.keys(nt);function it(e){if(e)return function(e){return at.includes(e)}(e)?e:st[e]}function rt(){return{connectionColorToHex:(0,s.useCallback)((e=>{if(!e)return;const t=it(e);return t?nt[t]:void 0}),[])}}const ot=(0,a.css)({outline:"none",margin:0,padding:0,marginRight:a.spacing[2],borderRadius:"50%",verticalAlign:"middle",width:a.spacing[5]+a.spacing[1],height:a.spacing[5]+a.spacing[1],border:"1px solid transparent",boxShadow:`0 0 0 0 ${a.uiColors.focus}`,transition:"box-shadow .16s ease-in",position:"relative",overflow:"hidden","&:hover":{cursor:"pointer"}}),lt=(0,a.css)({boxShadow:`0 0 0 3px ${a.uiColors.focus}`,transitionTimingFunction:"ease-out"}),ct=(0,a.css)({"&:focus, &:hover":{boxShadow:`0 0 0 3px ${a.uiColors.gray.light1}`}}),dt=(0,a.css)({width:40,borderTop:`3px solid ${a.uiColors.red.base}`,transform:"rotate(-45deg)",position:"absolute",left:-5}),pt=(0,a.css)({margin:0,padding:0});function ut({isSelected:e,onClick:t,code:n,hex:i}){return s.createElement("button",{style:{background:i},className:(0,a.cx)({[ot]:!0,[lt]:e,[ct]:!e}),"data-testid":`color-pick-${n}${e?"-selected":""}`,onClick:t,title:i,"aria-pressed":e},e&&s.createElement("svg",{className:pt,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:20,height:34},s.createElement("g",{fill:"white",fillOpacity:e?1:0,strokeOpacity:e?1:0},s.createElement("path",{stroke:"#ffffff",d:"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"}))))}function mt({colorCode:e,onChange:t}){const n=it(e),{connectionColorToHex:i}=rt(),r=i(n);return s.createElement(s.Fragment,null,s.createElement(a.Label,{htmlFor:"favorite-color-selector"},"Color"),s.createElement("div",{id:"favorite-color-selector"},s.createElement("button",{style:{background:"white",borderColor:a.uiColors.black},className:(0,a.cx)({[ot]:!0,[lt]:!r}),onClick:()=>{t()},"data-testid":"color-pick-no-color"+(r?"":"-selected"),title:"No color","aria-pressed":!r},s.createElement("div",{className:dt})),at.map((e=>{const a=i(e)||"";return s.createElement(ut,{onClick:()=>{t(e)},isSelected:e===n,hex:a,code:e,key:e})}))))}const ht=function({initialFavoriteInfo:e,onCancelClicked:t,onSaveClicked:n,open:i}){const[r,o]=(0,s.useState)({name:"",...e});return s.createElement(a.ConfirmationModal,{title:e?"Edit favorite":"Save connection to favorites",open:i,onConfirm:()=>{n({...r})},submitDisabled:!(r.name||"").trim(),onCancel:t,buttonText:"Save","data-testid":"favorite_modal"},s.createElement(F,null,s.createElement(a.TextInput,{"data-testid":"favorite-name-input",spellCheck:!1,onChange:({target:{value:e}})=>{o({...r,name:e})},label:"Name",value:r.name})),s.createElement(F,null,s.createElement(mt,{colorCode:r.color,onChange:e=>{o({...r,color:e})}})))},gt=(0,a.css)({margin:0,padding:0,height:"fit-content",width:10*a.spacing[6],position:"relative",display:"inline-block"}),bt=(0,a.css)({margin:0,height:"fit-content",width:"100%",position:"relative",display:"flex",flexFlow:"column nowrap",maxHeight:"95vh"}),yt=(0,a.css)({background:a.uiColors.gray.dark3}),ft=(0,a.css)({background:a.uiColors.white}),vt=(0,a.css)({marginTop:a.spacing[2]}),Et=(0,a.css)({display:"contents"}),St=(0,a.css)({padding:a.spacing[4],overflowY:"auto",position:"relative"}),xt=(0,a.css)({marginTop:"auto"}),wt=(0,a.css)({position:"absolute",top:a.spacing[2],right:a.spacing[2],hover:{cursor:"pointer"},width:a.spacing[7],height:a.spacing[7]}),Ct=(0,a.css)({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}),kt=(0,a.css)({button:{visibility:"hidden"},"&:hover":{button:{visibility:"visible"}}}),Nt=(0,a.css)({verticalAlign:"text-top"}),_t=(0,a.css)({paddingTop:a.spacing[1],color:a.uiColors.black,fontWeight:"bold",fontSize:12}),Tt=(0,a.withTheme)((function({darkMode:e,initialConnectionInfo:t,connectionErrorMessage:n,onConnectClicked:o,onSaveConnectionClicked:l}){const[{enableEditingConnectionString:c,isDirty:d,errors:p,warnings:u,connectionOptions:m},{setEnableEditingConnectionString:h,updateConnectionFormField:g,setErrors:y}]=function(e,t){const[n,a]=(0,s.useReducer)(Ye,e,et),r=(0,s.useCallback)((e=>{a({type:"set-form-errors",errors:e})}),[]),o=(0,s.useCallback)((e=>{a({type:"set-enable-editing-connection-string",enableEditing:e})}),[]),l=(0,s.useCallback)((e=>{const t=tt(e,n.connectionOptions);a({type:"set-connection-form-state",newState:{...n,errors:[],...t,warnings:t.errors?.length?[]:_(t.connectionOptions),isDirty:!(0,i.isEqual)(t.connectionOptions,n.connectionOptions)}})}),[n]);return function({connectionErrorMessage:e,initialConnectionInfo:t,setErrors:n,dispatch:a}){(0,s.useEffect)((()=>{const{errors:e,enableEditingConnectionString:n,warnings:s,connectionOptions:i}=et(t);a({type:"set-connection-form-state",newState:{errors:e,enableEditingConnectionString:n,warnings:s,connectionOptions:i,isDirty:!1}})}),[t]),(0,s.useEffect)((()=>{e&&n([{message:e}])}),[n,e])}({connectionErrorMessage:t,initialConnectionInfo:e,setErrors:r,dispatch:a}),[n,{updateConnectionFormField:l,setEnableEditingConnectionString:o,setErrors:r}]}(t,n),[f,v]=(0,s.useState)(!1),E=p.find((e=>"connectionString"===e.fieldName)),S=(0,s.useCallback)((()=>{const e=(0,i.cloneDeep)(m),n=function(e,t){const n=new r.ZP(e.connectionString,{looseValidation:!0});return[...x(n),...e.sshTunnel?C(e.sshTunnel):k(n)]}(e);n.length?y(n):o({...t,connectionOptions:e})}),[t,o,y,m]),w=(0,s.useCallback)((async e=>{try{await(l?.(e))}catch(e){y([{message:`Unable to save connection: ${e.message}`}])}}),[l,y]);return s.createElement(s.Fragment,null,s.createElement("div",{className:gt,"data-testid":"connection-form"},s.createElement(a.Card,{className:(0,a.cx)(bt,e?yt:ft)},s.createElement("form",{className:Et,onSubmit:e=>{e.preventDefault(),S()},noValidate:!0},s.createElement("div",{className:St},s.createElement(a.H3,{className:kt},t.favorite?.name??"New Connection",!!l&&s.createElement(a.IconButton,{type:"button","aria-label":"Save Connection","data-testid":"edit-favorite-name-button",className:Nt,onClick:()=>{v(!0)}},s.createElement(a.Icon,{glyph:"Edit"}))),s.createElement(a.Description,{className:vt},"Connect to a MongoDB deployment"),!!l&&s.createElement(a.IconButton,{"aria-label":"Save Connection","data-testid":"edit-favorite-icon-button",type:"button",className:wt,size:"large",onClick:()=>{v(!0)}},s.createElement("div",{className:Ct},s.createElement(a.FavoriteIcon,{isFavorite:!!t.favorite,size:a.spacing[5]}),s.createElement("span",{className:_t},"FAVORITE"))),s.createElement(b,{connectionString:m.connectionString,enableEditingConnectionString:c,setEnableEditingConnectionString:h,onSubmit:S,updateConnectionFormField:g}),E&&s.createElement(a.Banner,{variant:a.BannerVariant.Danger},E.message),s.createElement(Be,{errors:E?[]:p,disabled:!!E,updateConnectionFormField:g,connectionOptions:m})),s.createElement("div",{className:xt},s.createElement(Ke,{errors:E?[]:p,warnings:E?[]:u,saveButton:t.favorite?d?"enabled":"disabled":"hidden",onSaveClicked:async()=>{await w({...(0,i.cloneDeep)(t),connectionOptions:(0,i.cloneDeep)(m)})},onConnectClicked:S}))))),!!l&&s.createElement(ht,{open:f,onCancelClicked:()=>{v(!1)},onSaveClicked:async e=>{v(!1),await w({...(0,i.cloneDeep)(t),connectionOptions:(0,i.cloneDeep)(m),favorite:{...e}})},key:t.id,initialFavoriteInfo:t.favorite}))}))},15753:e=>{e.exports={DEFAULT:"MONGODB","SCRAM-SHA-1":"MONGODB","SCRAM-SHA-256":"SCRAM-SHA-256","MONGODB-CR":"MONGODB","MONGODB-X509":"X509",GSSAPI:"KERBEROS",SSPI:"KERBEROS",PLAIN:"LDAP",LDAP:"LDAP"}},68588:e=>{e.exports={NONE:void 0,MONGODB:"DEFAULT",KERBEROS:"GSSAPI",X509:"MONGODB-X509",LDAP:"PLAIN","SCRAM-SHA-256":"SCRAM-SHA-256"}},54342:e=>{e.exports={NONE:[],MONGODB:["mongodbUsername","mongodbPassword","mongodbDatabaseName"],"SCRAM-SHA-256":["mongodbUsername","mongodbPassword","mongodbDatabaseName"],KERBEROS:["kerberosPrincipal","kerberosServiceName","kerberosCanonicalizeHostname"],X509:["x509Username"],LDAP:["ldapUsername","ldapPassword"]}},59082:e=>{e.exports=["NONE","MONGODB","X509","KERBEROS","LDAP","SCRAM-SHA-256"]},85399:e=>{e.exports={NODE_DRIVER:"NODE_DRIVER",STITCH_ON_PREM:"STITCH_ON_PREM",STITCH_ATLAS:"STITCH_ATLAS"}},47408:e=>{e.exports=["NONE","USER_PASSWORD","IDENTITY_FILE"]},82074:e=>{e.exports=["NONE","SYSTEMCA","IFAVAILABLE","UNVALIDATED","SERVER","ALL"]},44399:(e,t,n)=>{e.exports=n(76740),e.exports.connect=n(28009),e.exports.ConnectionCollection=n(31694)},28009:(e,t,n)=>{const{EventEmitter:s,once:a}=n(82361),{MongoClient:i}=n(48761),{default:r}=n(64853),{default:o}=n(4680),l=n(76740),{redactSshTunnelOptions:c,redactConnectionString:d}=n(14663),p=n(87837)("mongodb-connection-model:connect");async function u(e){const[t]=await a(e||new s,"error");throw t}function m(e,t){return void 0!==t.directConnection||1!==t.hosts.length||t.isSrvRecord||t.loadBalanced||void 0!==t.replicaSet&&""!==t.replicaSet?e:{...e,directConnection:!0}}e.exports=(e,t,n)=>async function(e,t){void 0===e.serialize&&(e=new l(e)),p("connecting ...");const n=function(e){const t=new o(e);return t.searchParams.delete("gssapiServiceName"),t.toString()}(e.driverUrlWithSsh),s={...m(e.driverOptions,e)};delete s.auth;const a=await async function(e){if(!e.sshTunnel||"NONE"===e.sshTunnel||!e.sshTunnelOptions)return null;p("creating ssh tunnel with options",e.sshTunnel,c(e.sshTunnelOptions));const t=new r(e.sshTunnelOptions);return p("ssh tunnel listen ..."),await t.listen(),p("ssh tunnel opened"),t}(e);p("creating MongoClient",{url:d(n),options:s});const h=new i(n,s);t&&t(h);try{return p("waiting for MongoClient to connect ..."),[await Promise.race([h.connect(),u(a)]),a,{url:n,options:s}]}catch(e){throw p("connection error",e),p("force shutting down ssh tunnel ..."),await async function(e){if(e)try{await e.close(),p("ssh tunnel stopped")}catch(e){p("ssh tunnel stopped with error: %s",e.message)}}(a),e}}(e,t).then((e=>process.nextTick((()=>n(null,...e)))),(e=>process.nextTick((()=>n(e)))))},31694:(e,t,n)=>{const s=n(51762),a=n(76740),i=n(37421),{each:r}=n(76635),o=n(23493);let l,c;try{const e=n(72298);l=e.remote?e.remote.app.getName():void 0,c=e.remote?e.remote.app.getPath("userData"):void 0}catch(e){console.log("Could not load electron",e.message)}e.exports=s.extend(i,{model:a,namespace:"Connections",storage:{backend:"true"===process.env.COMPASS_E2E_DISABLE_KEYCHAIN_USAGE?"disk":"splice-disk-ipc",appName:l,basepath:c},comparator:(e,t)=>e.isFavorite===t.isFavorite?e.lastUsed-t.lastUsed:e.isFavorite?-1:1,mainIndex:"_id",indexes:["name"],maxLength:10,_prune(){const e=this.filter((e=>!e.isFavorite));if(e.length>this.maxLength){const t=this.remove(e.slice(0,e.length-this.maxLength));r(t,(e=>e.destroy()))}},add(e,t){s.prototype.add.call(this,e,t),this._prune()},select(e){return!e.selected&&(o((()=>{const t=this.selected;t&&(t.selected=!1),e.selected=!0,this.selected=e,this.trigger("change:selected",this.selected)}).bind(this)),!0)},unselectAll(){this.selected&&this.selected.set({selected:!1}),this.selected=null,this.trigger("change:selected",this.selected)}})},32179:e=>{e.exports={port:{set:e=>({type:"port",val:e})}}},76740:(e,t,n)=>{const s=n(57152),a=n(37421),{v4:i}=n(52544);let r,o;try{const e=n(72298);r=e.remote?e.remote.app.getName():void 0,o=e.remote?e.remote.app.getPath("userData"):void 0}catch(e){console.log("Could not load electron",e.message)}const l=s.extend(a,{idAttribute:"_id",namespace:"Connections",storage:{backend:"splice-disk-ipc",namespace:"Connections",basepath:o,appName:r,secureCondition:(e,t)=>t.match(/(password|passphrase|secrets|sslpass)/i)},props:{_id:{type:"string",default:()=>i()},lastUsed:{type:"date",default:null},isFavorite:{type:"boolean",default:!1},name:{type:"string",default:"Local"},color:{type:"string",default:void 0},ns:{type:"string",default:void 0},isSrvRecord:{type:"boolean",default:!1},appname:{type:"string",default:void 0}},session:{selected:{type:"boolean",default:!1}},derived:{username:{deps:["authStrategy"],fn(){return"NONE"===this.authStrategy?"":"MONGODB"===this.authStrategy?this.mongodbUsername:"KERBEROS"===this.authStrategy?this.kerberosPrincipal:"X509"===this.authStrategy?this.x509Username:"LDAP"===this.authStrategy?this.ldapUsername:void 0}},title:{deps:["name","isFavorite","isSrvRecord","hostname","port","hosts"],fn(){return this.isFavorite&&this.name?this.name:this.isSrvRecord?this.hostname:this.hosts&&this.hosts.length>1?this.hosts.map((({host:e,port:t})=>`${e}:${t}`)).join(","):`${this.hostname}:${this.port}`},cache:!1}},serialize(){return s.prototype.serialize.call(this,{all:!0})}});l.from=(e,t)=>s.from(e,((e,n)=>{if(e)return t(e);t(null,new l(n.getAttributes({props:!0})))})),e.exports=l},99651:e=>{e.exports=()=>{const e=(730*Math.random()+29170).toString();return parseInt(e,10)}},57152:(e,t,n)=>{const s=n(35034).format,{format:a,promisify:i,callbackify:r}=n(73837),o=n(57147),{defaults:l,clone:c,cloneDeep:d,unescape:p}=n(76635),u=n(71305),m=n(51762),{ReadPreference:h}=n(48761),{parseConnectionString:g}=n(77212),b=n(4680).default,y=n(32179),f=n(99651),v=n(41742),E={};try{const e=n(38560);E.dns=e.withNodeFallback}catch(e){console.error(e)}const S=n(85399),x=n(15753),w=n(68588),C=n(59082),k=n(54342),N=n(82074),_=n(47408),T=[h.PRIMARY,h.PRIMARY_PREFERRED,h.SECONDARY,h.SECONDARY_PREFERRED,h.NEAREST],A="NONE",R=h.PRIMARY,O="admin",D="mongodb",P="NONE",I="NONE",L={},j={mongodb_password:"mongodbPassword",ldap_password:"ldapPassword",ssl_private_key_password:"sslPass",ssh_tunnel_password:"sshTunnelPassword",ssh_tunnel_passphrase:"sshTunnelPassphrase"},M={},q={},F={};let V={};Object.assign(M,{connectionInfo:{type:"object",default:void 0},secrets:{type:"object",default:void 0}}),Object.assign(M,{ns:{type:"string",default:void 0},isSrvRecord:{type:"boolean",default:!1},hostname:{type:"string",default:"localhost"},port:{type:"port",default:27017},hosts:{type:"array",default:()=>[{host:"localhost",port:27017}]},extraOptions:{type:"object",default:()=>({})},connectionType:{type:"string",default:S.NODE_DRIVER},authStrategy:{type:"string",values:C,default:A}}),Object.assign(F,{auth:{type:"object",default:void 0}});const B={replicaSet:{type:"string",default:void 0},connectTimeoutMS:{type:"number",default:void 0},socketTimeoutMS:{type:"number",default:void 0},compression:{type:"object",default:void 0},maxPoolSize:{type:"number",default:void 0},minPoolSize:{type:"number",default:void 0},maxIdleTimeMS:{type:"number",default:void 0},waitQueueMultiple:{type:"number",default:void 0},waitQueueTimeoutMS:{type:"number",default:void 0},w:{type:"any",default:void 0},wTimeoutMS:{type:"number",default:void 0},journal:{type:"boolean",default:void 0},readConcernLevel:{type:"string",default:void 0},readPreference:{type:"string",values:T,default:R},maxStalenessSeconds:{type:"number",default:void 0},readPreferenceTags:{type:"array",default:void 0},authSource:{type:"string",default:void 0},authMechanism:{type:"string",default:void 0},authMechanismProperties:{type:"object",default:void 0},gssapiServiceName:{type:"string",default:void 0},gssapiServiceRealm:{type:"string",default:void 0},gssapiCanonicalizeHostName:{type:"boolean",default:void 0},localThresholdMS:{type:"number",default:void 0},serverSelectionTimeoutMS:{type:"number",default:void 0},serverSelectionTryOnce:{type:"boolean",default:void 0},heartbeatFrequencyMS:{type:"number",default:void 0},appname:{type:"string",default:void 0},retryWrites:{type:"boolean",default:void 0},uuidRepresentation:{type:"string",values:[void 0,"standard","csharpLegacy","javaLegacy","pythonLegacy"],default:void 0},directConnection:{type:"boolean",default:void 0},loadBalanced:{type:"boolean",default:void 0}};function U(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%"+e.charCodeAt(0).toString(16)}))}function H({url:e,isPasswordProtected:t}){let n="",s="",i="";return"MONGODB"===this.authStrategy||"SCRAM-SHA-256"===this.authStrategy?(n=U(this.mongodbUsername),s=t?"*****":U(this.mongodbPassword),i=a("%s:%s",n,s)):"LDAP"===this.authStrategy?(n=U(this.ldapUsername),s=t?"*****":U(this.ldapPassword),i=a("%s:%s",n,s)):"X509"===this.authStrategy&&this.x509Username?(n=U(this.x509Username),i=n):"KERBEROS"===this.authStrategy&&(n=U(this.kerberosPrincipal),i=a("%s",n)),e=e.replace("AUTH_TOKEN",i,1),["LDAP","KERBEROS","X509"].includes(this.authStrategy)&&(e=function(e){const t=new b(e);return t.searchParams.set("authSource","$external"),t.toString()}(e)),e}Object.assign(M,B),Object.assign(M,{stitchServiceName:{type:"string",default:void 0},stitchClientAppId:{type:"string",default:void 0},stitchGroupId:{type:"string",default:void 0},stitchBaseUrl:{type:"string",default:void 0}}),Object.assign(M,{mongodbUsername:{type:"string",default:void 0},mongodbPassword:{type:"string",default:void 0},mongodbDatabaseName:{type:"string",default:void 0},promoteValues:{type:"boolean",default:void 0}}),Object.assign(M,{kerberosServiceName:{type:"string",default:void 0},kerberosPrincipal:{type:"string",default:void 0},kerberosServiceRealm:{type:"string",default:void 0},kerberosCanonicalizeHostname:{type:"boolean",default:!1}}),Object.assign(M,{ldapUsername:{type:"string",default:void 0},ldapPassword:{type:"string",default:void 0}}),Object.assign(M,{x509Username:{type:"string",default:void 0}}),Object.assign(M,{ssl:{type:"any",default:void 0},sslMethod:{type:"string",values:N,default:P},sslCA:{type:"any",default:void 0},sslCert:{type:"any",default:void 0},sslKey:{type:"any",default:void 0},sslPass:{type:"string",default:void 0}}),Object.assign(M,{sshTunnel:{type:"string",values:_,default:I},sshTunnelHostname:{type:"string",default:void 0},sshTunnelPort:{type:"port",default:22},sshTunnelBindToLocalPort:{type:"port",default:void 0},sshTunnelUsername:{type:"string",default:void 0},sshTunnelPassword:{type:"string",default:void 0},sshTunnelIdentityFile:{type:"any",default:void 0},sshTunnelPassphrase:{type:"string",default:void 0}}),Object.assign(q,{instanceId:{type:"string",deps:["hostname","port"],fn(){return a("%s:%s",this.hostname,this.port)}},driverAuthMechanism:{type:"string",deps:["authStrategy"],fn(){return w[this.authStrategy]}}});const $=e=>{const t={protocol:"mongodb",port:null,slashes:!0,pathname:"/",query:{}};e.isSrvRecord?(t.protocol="mongodb+srv",t.hostname=e.hostname):1===e.hosts.length?(t.hostname=e.hostname,t.port=e.port):t.host=e.hosts.map((e=>`${e.host}:${e.port}`)).join(","),e.ns&&(t.pathname=a("/%s",e.ns));const n={};return"MONGODB"===e.authStrategy?(t.auth="AUTH_TOKEN",t.query.authSource=e.mongodbDatabaseName||O):"SCRAM-SHA-256"===e.authStrategy?(t.auth="AUTH_TOKEN",t.query.authSource=e.mongodbDatabaseName||O,t.query.authMechanism=e.driverAuthMechanism):"KERBEROS"===e.authStrategy?(t.auth="AUTH_TOKEN",l(t.query,{authMechanism:e.driverAuthMechanism}),e.kerberosServiceName&&e.kerberosServiceName!==D&&(n.SERVICE_NAME=e.kerberosServiceName),e.kerberosServiceRealm&&(n.SERVICE_REALM=e.kerberosServiceRealm),!0===e.kerberosCanonicalizeHostname&&(n.gssapiCanonicalizeHostName=!0)):"X509"===e.authStrategy?(e.x509Username&&(t.auth="AUTH_TOKEN"),l(t.query,{authMechanism:e.driverAuthMechanism})):"LDAP"===e.authStrategy&&(t.auth="AUTH_TOKEN",l(t.query,{authMechanism:e.driverAuthMechanism})),Object.keys(B).forEach((s=>{"authMechanismProperties"===s?(Object.assign(n,e.authMechanismProperties||{}),Object.keys(n).length&&(t.query.authMechanismProperties=Object.keys(n).map((e=>`${e}:${n[e]}`)).join(","))):void 0===e[s]||t.query[s]||("compression"===s?(e.compression&&e.compression.compressors&&(t.query.compressors=e.compression.compressors.join(",")),e.compression&&e.compression.zlibCompressionLevel&&(t.query.zlibCompressionLevel=e.compression.zlibCompressionLevel)):"readPreferenceTags"===s?e.readPreferenceTags&&(t.query.readPreferenceTags=Object.values(e.readPreferenceTags).map((e=>Object.keys(e).map((t=>`${t}:${e[t]}`)).join(",")))):""!==e[s]&&(t.query[s]=e[s]))})),e.ssl?t.query.ssl=e.ssl:["UNVALIDATED","SYSTEMCA","SERVER","ALL"].includes(e.sslMethod)?t.query.ssl="true":"IFAVAILABLE"===e.sslMethod?t.query.ssl="prefer":"NONE"===e.sslMethod&&(t.query.ssl="false"),t};Object.assign(q,{safeUrl:{cache:!1,fn(){return H.call(this,{url:s($(this)),isPasswordProtected:!0})}},driverUrl:{cache:!1,fn(){const e=$(this);return H.call(this,{url:s(e),isPasswordProtected:!1})}},driverUrlWithSsh:{cache:!1,fn(){const e=d($(this));return"NONE"!==this.sshTunnel&&(e.hostname=this.sshTunnelOptions.localAddr,e.port=this.sshTunnelOptions.localPort),H.call(this,{url:s(e),isPasswordProtected:!1})}},driverOptions:{cache:!1,fn(){const e=c(L,!0);return"SERVER"===this.sslMethod?Object.assign(e,{sslValidate:!0,sslCA:this.sslCA}):"ALL"===this.sslMethod?(Object.assign(e,{sslValidate:!0,sslCA:this.sslCA,sslKey:this.sslKey,sslCert:this.sslCert}),this.sslPass&&(e.sslPass=this.sslPass),"X509"===this.authStrategy&&(e.tlsAllowInvalidHostnames=!0,e.sslValidate=!1)):"UNVALIDATED"===this.sslMethod?Object.assign(e,{tlsAllowInvalidHostnames:!0,sslValidate:!1}):"SYSTEMCA"===this.sslMethod?Object.assign(e,{tlsAllowInvalidHostnames:!1,sslValidate:!0}):"IFAVAILABLE"===this.sslMethod&&Object.assign(e,{tlsAllowInvalidHostnames:!0,sslValidate:!0}),Object.assign(e,this.extraOptions),void 0!==this.promoteValues&&(e.promoteValues=this.promoteValues),e.readPreference=this.readPreference,e}},sshTunnelOptions:{cache:!1,fn(){if("NONE"===this.sshTunnel)return{};this.sshTunnelBindToLocalPort||(this.sshTunnelBindToLocalPort=f());const e={readyTimeout:2e4,forwardTimeout:2e4,keepaliveInterval:2e4,srcAddr:"127.0.0.1",dstPort:this.port,dstAddr:this.hostname,localPort:this.sshTunnelBindToLocalPort,localAddr:"127.0.0.1",host:this.sshTunnelHostname,port:this.sshTunnelPort,username:this.sshTunnelUsername};if("USER_PASSWORD"===this.sshTunnel)e.password=this.sshTunnelPassword;else if("IDENTITY_FILE"===this.sshTunnel){const t=Array.isArray(this.sshTunnelIdentityFile)?this.sshTunnelIdentityFile[0]:this.sshTunnelIdentityFile;if(t)try{e.privateKey=o.readFileSync(t)}catch(e){console.error(`Could not locate ssh tunnel identity file: ${t}`)}this.sshTunnelPassphrase&&(e.passphrase=this.sshTunnelPassphrase)}return e}}}),V=u.extend({namespace:"Connection",idAttribute:"instanceId",props:M,derived:q,session:F,dataTypes:y,initialize(e){if(e){if("string"==typeof e)throw new TypeError("To create a connection object from URI please use `Connection.from` function.");if(e.sslCA&&!Array.isArray(e.sslCA)&&(this.sslCA=e.sslCA=[e.sslCA]),e.sshTunnel&&"NONE"!==e.sshTunnel){const t=f();e.sshTunnelBindToLocalPort=t,this.sshTunnelBindToLocalPort=t}this.parse(e)}},parse(e){return e?(e.mongodbUsername&&"SCRAM-SHA-256"!==e.authStrategy?this.authStrategy=e.authStrategy="MONGODB":e.kerberosPrincipal?this.authStrategy=e.authStrategy="KERBEROS":e.ldapUsername?this.authStrategy=e.authStrategy="LDAP":e.x509Username&&(this.authStrategy=e.authStrategy="X509"),"MONGODB"!==e.authStrategy&&"SCRAM-SHA-256"!==e.authStrategy||(e.mongodbDatabaseName||(e.mongodbDatabaseName=O),this.mongodbDatabaseName=e.mongodbDatabaseName),"KERBEROS"===e.authStrategy&&this.parseKerberosProperties(e),Object.keys(j).forEach((t=>{const n=j[t];!e[n]&&e[t]&&(this[n]=e[n]=e[t])})),e):e},parseKerberosProperties(e){const t=e.authMechanismProperties||{};this.kerberosServiceName=e.kerberosServiceName||e.gssapiServiceName||t.SERVICE_NAME,this.kerberosServiceRealm=e.kerberosServiceRealm||e.gssapiServiceRealm||t.SERVICE_REALM,this.kerberosCanonicalizeHostname=e.kerberosCanonicalizeHostname||e.gssapiCanonicalizeHostName||t.CANONICALIZE_HOST_NAME||t.gssapiCanonicalizeHostName,this.gssapiServiceName=void 0,delete e.gssapiServiceName,this.gssapiServiceRealm=void 0,delete e.gssapiServiceRealm,this.gssapiCanonicalizeHostName=void 0,delete e.gssapiCanonicalizeHostName,delete t.SERVICE_NAME,delete t.SERVICE_REALM,delete t.CANONICALIZE_HOST_NAME,delete t.gssapiCanonicalizeHostName,this.authProperties&&(delete this.authProperties.SERVICE_NAME,delete this.authProperties.SERVICE_REALM,delete this.authProperties.CANONICALIZE_HOST_NAME,delete this.authProperties.gssapiCanonicalizeHostName)},validate(e){try{this.validateSsl(e),this.validateMongodb(e),this.validateKerberos(e),this.validateX509(e),this.validateLdap(e),this.validateSshTunnel(e),this.validateStitch(e)}catch(e){return e}},validateSsl(e){if(e.sslMethod&&!["NONE","UNVALIDATED","IFAVAILABLE","SYSTEMCA"].includes(e.sslMethod)){if("SERVER"===e.sslMethod&&!e.sslCA)throw new TypeError("sslCA is required when ssl is SERVER.");if("ALL"===e.sslMethod){if(!e.sslCA)throw new TypeError("SSL 'Certificate Authority' is required when the SSL method is set to 'Server and Client Validation'.");if(!e.sslCert)throw new TypeError("SSL 'Client Certificate' is required when the SSL method is set to 'Server and Client Validation'.");if(!e.sslKey)throw new TypeError("SSL 'Client Private Key' is required when the SSL method is set to 'Server and Client Validation'.")}}},validateMongodb(e){if("MONGODB"===e.authStrategy||"SCRAM-SHA-256"===e.authStrategy){if(!e.mongodbUsername)throw new TypeError("The 'Username' field is required when using 'Username/Password' or 'SCRAM-SHA-256' for authentication.");if(!e.mongodbPassword)throw new TypeError("The 'Password' field is required when using 'Username/Password' or 'SCRAM-SHA-256' for authentication.")}},validateKerberos(e){if("KERBEROS"!==e.authStrategy){if(e.kerberosServiceName)throw new TypeError(a("The Kerberos 'Service Name' field does not apply when using %s for authentication.",e.authStrategy));if(e.kerberosPrincipal)throw new TypeError(a("The Kerberos 'Principal' field does not apply when using %s for authentication.",e.authStrategy))}else if(!e.kerberosPrincipal)throw new TypeError("The Kerberos 'Principal' field is required when using 'Kerberos' for authentication.")},validateX509(e){if("X509"===e.authStrategy&&"ALL"!==e.sslMethod)throw new TypeError("SSL method is required to be set to 'Server and Client Validation' when using X.509 authentication.")},validateLdap(e){if("LDAP"===e.authStrategy){if(!e.ldapUsername)throw new TypeError(a("The 'Username' field is required when using 'LDAP' for authentication."));if(!e.ldapPassword)throw new TypeError(a("The 'Password' field is required when using LDAP for authentication."))}},validateSshTunnel(e){if(e.sshTunnel&&e.sshTunnel!==I)if("USER_PASSWORD"===e.sshTunnel){if(this.validateStandardSshTunnelOptions(e),!e.sshTunnelPassword)throw new TypeError("'SSH Password' is required when SSH Tunnel is set to 'Use Password'.")}else if("IDENTITY_FILE"===e.sshTunnel&&(this.validateStandardSshTunnelOptions(e),!e.sshTunnelIdentityFile))throw new TypeError("'SSH Identity File' is required when SSH Tunnel is set to 'Use Identity File'.")},validateStandardSshTunnelOptions(e){if(!e.sshTunnelUsername)throw new TypeError("'SSH Username' is required when SSH Tunnel is set.");if(!e.sshTunnelHostname)throw new TypeError("'SSH Hostname' is required when SSH Tunnel is set.");if(!e.sshTunnelPort)throw new TypeError("'SSH Tunnel Port' is required when SSH Tunnel is set.")},validateStitch(e){if(e.connectionType===S.STITCH_ATLAS){if(!e.stitchClientAppId)throw new TypeError("stitchClientAppId is required when connectionType is STITCH_ATLAS.")}else if(e.connectionType===S.STITCH_ON_PREM){if(!e.stitchClientAppId)throw new TypeError("stitchClientAppId is required when connectionType is STITCH_ON_PREM.");if(!e.stitchBaseUrl)throw new TypeError("stitchBaseUrl is required when connectionType is STITCH_ON_PREM.");if(!e.stitchGroupId)throw new TypeError("stitchGroupId is required when connectionType is STITCH_ON_PREM.");if(!e.stitchServiceName)throw new TypeError("stitchServiceName is required when connectionType is STITCH_ON_PREM.")}else if(e.connectionType===S.NODE_DRIVER){if(e.stitchClientAppId)throw new TypeError("stitchClientAppId should not be provided when connectionType is NODE_DRIVER.");if(e.stitchBaseUrl)throw new TypeError("stitchBaseUrl should not be provided when connectionType is NODE_DRIVER.");if(e.stitchGroupId)throw new TypeError("stitchGroupId should not be provided when connectionType is NODE_DRIVER.");if(e.stitchServiceName)throw new TypeError("stitchServiceName should not be provided when connectionType is NODE_DRIVER.")}}});const z=i(g);V.from=r((async function(e){const t=p(e),n=await v(t,E),s=await z(n),a=t.startsWith("mongodb+srv://"),i=Object.assign({hosts:s.hosts,hostname:a?new b(t).hosts[0]:s.hosts[0].host,auth:s.auth,isSrvRecord:a},s.options);a?delete i.directConnection:i.port=s.hosts[0].port,e.indexOf(s.defaultDatabase)>-1&&(i.ns=s.defaultDatabase);let r=null;if(i.authMechanism?r=i.authMechanism:i.auth&&i.auth.username&&i.auth.password&&(r="DEFAULT"),i.authStrategy=r?x[r]:A,s.auth){let t=s.auth.username,n=s.auth.password;"LDAP"===i.authStrategy?(i.ldapUsername=t,i.ldapPassword=n):"X509"===i.authStrategy&&s.auth.username?i.x509Username=t:"KERBEROS"===i.authStrategy?i.kerberosPrincipal=t:"MONGODB"!==i.authStrategy&&"SCRAM-SHA-256"!==i.authStrategy||(i.mongodbUsername=t,i.mongodbPassword=n,i.mongodbDatabaseName=decodeURIComponent(i.authSource||V.MONGODB_DATABASE_NAME_DEFAULT),Object.assign(i,V._improveAtlasDefaults(e,i.auth.password,i.ns)))}switch(new b(t).searchParams.get("loadBalanced")){case"true":i.loadBalanced=!0,delete i.directConnection;break;case"false":i.loadBalanced=!1}return new V(i)})),V._improveAtlasDefaults=(e,t,n)=>{const s={};return V.isAtlas(e)&&(s.sslMethod="SYSTEMCA",t.match(/^.?PASSWORD.?$/i)&&(s.mongodbPassword=""),n&&!n.match(/^.?DATABASE.?$/i)||(s.ns=V.MONGODB_DATABASE_NAME_DEFAULT)),s},V.getFieldNames=e=>k[e],V.isAtlas=e=>e.match(/mongodb.net[:/]/i),V.isURI=e=>e.startsWith("mongodb://")||e.startsWith("mongodb+srv://"),V.encodeURIComponentRFC3986=U,V.AUTH_STRATEGY_VALUES=C,V.AUTH_STRATEGY_DEFAULT=A,V.SSL_METHOD_VALUES=N,V.SSL_DEFAULT=P,V.SSH_TUNNEL_VALUES=_,V.SSH_TUNNEL_DEFAULT=I,V.MONGODB_DATABASE_NAME_DEFAULT=O,V.KERBEROS_SERVICE_NAME_DEFAULT=D,V.DRIVER_OPTIONS_DEFAULT=L,V.READ_PREFERENCE_VALUES=T,V.READ_PREFERENCE_DEFAULT=R,V.CONNECTION_TYPE_VALUES=S;const G=m.extend({comparator:"instanceId",model:V,modelType:"ConnectionCollection"});e.exports=V,e.exports.Collection=G},14663:(e,t,n)=>{const{redactConnectionString:s}=n(4680);e.exports={redactConnectionString:s,redactSshTunnelOptions:function(e){const t={...e};return t.password&&(t.password="<redacted>"),t.privateKey&&(t.privateKey="<redacted>"),t.passphrase&&(t.passphrase="<redacted>"),t}}},19653:e=>{"use strict";e.exports=JSON.parse('{"name":"@mongodb-js/compass-serverstats","productName":"Compass Server Stats plugin","version":"15.21.0","apiVersion":"3.0.0","description":"Compass Real Time Server Stats Component.","main":"lib/index.js","exports":{"webpack":"./src/index.js","browser":"./lib/browser.js","require":"./lib/index.js"},"scripts":{"compile":"npm run webpack -- --mode production","prewebpack":"rimraf ./lib","webpack":"webpack-compass","start":"npm run webpack serve -- --mode development","test":"mocha","test-electron":"xvfb-maybe electron-mocha --no-sandbox","check":"npm run lint && npm run depcheck","lint":"eslint \\"./{src,test}/**/*.{js,jsx}\\"","depcheck":"depcheck","test-ci":"npm run test","test-ci-electron":"npm run test-electron","prepublishOnly":"npm run compile","bootstrap":"npm run compile"},"license":"SSPL","peerDependencies":{"d3":"^3.5.17","hadron-react-buttons":"^5.7.0","hadron-react-components":"^5.13.0","react":"^16.14.0","react-dom":"^16.14.0"},"dependencies":{"d3":"^3.5.17","d3-timer":"^1.0.3","lodash.has":"^4.5.2","lodash.isequal":"^4.5.0","lodash.max":"^4.0.1","lodash.remove":"^4.7.0","lodash.round":"^4.0.4","mongodb-js-errors":"^0.3.2","reflux":"^0.4.1"},"devDependencies":{"@mongodb-js/mocha-config-compass":"^0.10.0","@mongodb-js/webpack-config-compass":"^0.7.0","chai":"^4.1.2","debug":"4.3.0","depcheck":"^1.4.1","electron":"^13.5.1","electron-mocha":"^10.1.0","enzyme":"^3.11.0","eslint":"^7.25.0","eslint-config-mongodb-js":"^2.1.0","eslint-plugin-react":"^7.24.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","hadron-react-buttons":"^5.7.0","hadron-react-components":"^5.13.0","mocha":"^8.4.0","mongodb-connection-model":"^21.15.0","mongodb-data-service":"^21.19.0","mongodb-ns":"^2.3.0","prop-types":"^15.7.2","react":"^16.14.0","react-dom":"^16.14.0","rimraf":"^3.0.1","xvfb-maybe":"^0.2.1"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"}}')},49245:e=>{"use strict";e.exports=JSON.parse('{"name":"@mongodb-js/compass-shell","productName":"Compass Shell plugin","version":"2.22.0","apiVersion":"3.0.0","description":"Compass Shell Plugin","main":"lib/index.js","exports":{"webpack":"./src/index.js","require":"./lib/index.js"},"scripts":{"prepublishOnly":"npm run compile","clean":"rimraf lib","precompile":"npm run clean","compile":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js","compile:watch":"cross-env NODE_ENV=production webpack --config ./config/webpack.prod.config.js --watch","start":"cross-env NODE_ENV=development webpack-dev-server --config ./config/webpack.dev.config.js","start:watch":"npm run clean && webpack --config ./config/webpack.watch.config.js","test":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\"","test-ci":"npm run test","test-ci-electron":"echo \\"TODO(COMPASS-5555): These tests are broken and disabled for now\\"","test-watch":"cross-env NODE_ENV=test mocha-webpack \\"./src/**/*.spec.js\\" --watch","test-electron":"xvfb-maybe cross-env NODE_ENV=test karma start","test-cov":"echo","check":"npm run lint && npm run depcheck","lint":"eslint \\"./src/**/*.{js,jsx}\\" \\"./test/**/*.js\\" \\"./electron/**/*.js\\" \\"./config/**/*.{js,jsx}\\"","depcheck":"depcheck","bootstrap":"npm run compile"},"repository":{"type":"git","url":"https://github.com/mongodb-js/compass.git"},"config":{"unsafe-perm":true},"engines":{"node":">=14.17.5"},"license":"SSPL","publishConfig":{"access":"public"},"dependencies":{"@leafygreen-ui/code":"^9.4.0","@mongodb-js/compass-logging":"^0.10.0","@mongodb-js/mongodb-redux-common":"^1.10.0","@mongosh/browser-repl":"^1.2.3","@mongosh/logging":"^1.2.3","@mongosh/node-runtime-worker-thread":"^1.2.3","@mongosh/service-provider-core":"^1.2.3"},"peerDependencies":{"@mongodb-js/compass-components":"^0.13.0","ace-builds":"^1.4.3","hadron-ipc":"^2.9.0","hadron-react-components":"^5.13.0","prop-types":"^15.7.2","react":"^16.14.0","react-ace":"^9.5.0","react-dom":"^16.14.0"},"devDependencies":{"@babel/cli":"^7.14.3","@babel/core":"^7.14.3","@babel/plugin-proposal-decorators":"^7.14.2","@babel/plugin-syntax-dynamic-import":"^7.8.3","@babel/preset-env":"^7.14.2","@babel/preset-react":"^7.13.13","@babel/register":"^7.13.16","@hot-loader/react-dom":"^16.9.0","@mongodb-js/compass-components":"^0.13.0","ace-builds":"^1.4.3","autoprefixer":"^9.4.6","babel-loader":"^8.2.2","chai":"^4.2.0","chai-enzyme":"1.0.0-beta.0","core-js":"^3.12.1","cross-env":"^5.0.1","depcheck":"^1.4.1","electron":"^13.5.1","electron-devtools-installer":"^3.2.0","enzyme":"^3.11.0","enzyme-adapter-react-16":"^1.15.2","eslint":"^7.25.0","eslint-config-mongodb-js":"^5.0.3","eslint-plugin-react":"^7.24.0","file-loader":"^5.1.0","font-awesome":"^4.7.0","hadron-app":"^4.21.0","hadron-app-registry":"^8.10.0","html-webpack-plugin":"^3.2.0","ignore-loader":"^0.1.2","istanbul-instrumenter-loader":"^3.0.1","jsdom":"^16.7.0","jsdom-global":"^3.0.2","karma":"^6.3.4","karma-chai":"^0.1.0","karma-chai-sinon":"^0.1.5","karma-electron":"^7.0.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","karma-sinon":"^1.0.5","karma-sourcemap-loader":"^0.3.8","karma-webpack":"^4.0.2","mocha":"^5.2.0","mocha-webpack":"^2.0.0-beta.0","mongodb":"^4.4.0","mongodb-reflux-store":"^0.0.1","node-loader":"^0.6.0","nyc":"^13.1.0","peer-deps-externals-webpack-plugin":"^1.0.4","prop-types":"^15.7.2","react":"^16.14.0","react-ace":"^9.5.0","react-dom":"^16.14.0","react-hot-loader":"^4.13.0","react-redux":"^7.1.1","react-tooltip":"^3.11.1","redux":"^4.1.2","reflux":"^0.4.1","reflux-state-mixin":"github:mongodb-js/reflux-state-mixin","resolve":"^1.15.1","rimraf":"^2.6.1","semver":"^5.4.1","shebang-loader":"^0.0.1","sinon":"^7.2.5","sinon-chai":"^3.3.0","url-loader":"^3.0.0","webpack":"^4.46.0","webpack-bundle-analyzer":"^3.0.3","webpack-cli":"^3.3.12","webpack-dev-server":"^3.11.2","webpack-merge":"^4.2.2","webpack-node-externals":"^3.0.0"},"homepage":"https://github.com/mongodb-js/compass","bugs":{"url":"https://jira.mongodb.org/projects/COMPASS/issues","email":"compass@mongodb.com"}}')}}]);